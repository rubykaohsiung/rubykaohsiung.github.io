<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rails 外向內路由 — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Rails 外向內路由 — Ruby on Rails Guides" />
  <meta name="description" content="Rails 外向內路由本指南包含了 Rails 路由的面向使用者的功能。閱讀本指南後，您將瞭解： 如何解釋config/routes.rb 中的程式碼。 如何構建您自己的路線，使用首選的資源豐富的風格或 match 方法。 如何宣告路由引數，傳遞到 controller actions。 如何使用路由 helpers 自動建立路徑和 URL。 高階技術，例如建立約束和掛載 Rack 端點。" />
  <meta property="og:description" content="Rails 外向內路由本指南包含了 Rails 路由的面向使用者的功能。閱讀本指南後，您將瞭解： 如何解釋config/routes.rb 中的程式碼。 如何構建您自己的路線，使用首選的資源豐富的風格或 match 方法。 如何宣告路由引數，傳遞到 controller actions。 如何使用路由 helpers 自動建立路徑和 URL。 高階技術，例如建立約束和掛載 Rack 端點。" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v7.0.0</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多資訊請前往 <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多在 Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">部落格</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">論壇</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 上做出貢獻</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">手冊目錄</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>從這裡開始</dt>
                  <dd><a href="getting_started.html">Rails 入門</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record 遷移 (Migrations)</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 驗證 (Validations)</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record 回呼 (Callbacks)</a></dd>
                  <dd><a href="association_basics.html">Active Record 關聯 (Associations)</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查詢介面</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 中的版面配置(Layouts)和算繪(Rendering)</a></dd>
                  <dd><a href="form_helpers.html">Action View 表單 Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller 概述</a></dd>
                  <dd><a href="routing.html">Rails 從外到內路由</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他元件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心擴充套件</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基礎知識</a></dd>
                  <dd><a href="active_job_basics.html">Active Job 基礎</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 概述</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 概述</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>深入研究</dt>
                  <dd><a href="i18n.html">Rails 國際化 (I18n) API</a></dd>
                  <dd><a href="testing.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="security.html">保護 Rails 應用程式</a></dd>
                  <dd><a href="debugging_rails_applications.html">除錯 Rails 應用程式</a></dd>
                  <dd><a href="configuring.html">設定 Rails 應用程式</a></dd>
                  <dd><a href="command_line.html">Rails 命令列</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自動載入和重新載入常量</a></dd>
                  <dd><a href="caching_with_rails.html">使用 Rails 快取</a></dd>
                  <dd><a href="api_app.html">將 Rails 用於僅 API 的應用程式</a></dd>
                </div>
                <div class="guides-section">
                  <dt>擴充 rails</dt>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">建立和自定義 Rails 產生器和模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>貢獻</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文件指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南指南</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策</dt>
                  <dd><a href="maintenance_policy.html">維修政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>發行說明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</a></dd>
                  <dd><a href="6_1_release_notes.html">6.1 版 - 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版 - 2019 年 8 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版 - 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版 - 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版 - 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版 - 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版 - 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版 - 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版 - 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版 - 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版 - 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版 - 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版 - 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">手冊目錄</option>
              <optgroup label="從這裡開始">
                  <option value="getting_started.html">Rails 入門</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="active_record_migrations.html">Active Record 遷移 (Migrations)</option>
                  <option value="active_record_validations.html">Active Record 驗證 (Validations)</option>
                  <option value="active_record_callbacks.html">Active Record 回呼 (Callbacks)</option>
                  <option value="association_basics.html">Active Record 關聯 (Associations)</option>
                  <option value="active_record_querying.html">Active Record 查詢介面</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 中的版面配置(Layouts)和算繪(Rendering)</option>
                  <option value="form_helpers.html">Action View 表單 Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller 概述</option>
                  <option value="routing.html">Rails 從外到內路由</option>
              </optgroup>
              <optgroup label="其他元件">
                  <option value="active_support_core_extensions.html">Active Support 核心擴充套件</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎知識</option>
                  <option value="active_job_basics.html">Active Job 基礎</option>
                  <option value="active_storage_overview.html">Active Storage 概述</option>
                  <option value="action_cable_overview.html">Action Cable 概述</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="深入研究">
                  <option value="i18n.html">Rails 國際化 (I18n) API</option>
                  <option value="testing.html">測試 Rails 應用程式</option>
                  <option value="security.html">保護 Rails 應用程式</option>
                  <option value="debugging_rails_applications.html">除錯 Rails 應用程式</option>
                  <option value="configuring.html">設定 Rails 應用程式</option>
                  <option value="command_line.html">Rails 命令列</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="autoloading_and_reloading_constants.html">自動載入和重新載入常量</option>
                  <option value="caching_with_rails.html">使用 Rails 快取</option>
                  <option value="api_app.html">將 Rails 用於僅 API 的應用程式</option>
              </optgroup>
              <optgroup label="擴充 rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">建立和自定義 Rails 產生器和模板</option>
              </optgroup>
              <optgroup label="貢獻">
                  <option value="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</option>
                  <option value="api_documentation_guidelines.html">API 文件指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南指南</option>
              </optgroup>
              <optgroup label="政策">
                  <option value="maintenance_policy.html">維修政策</option>
              </optgroup>
              <optgroup label="發行說明">
                  <option value="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</option>
                  <option value="6_1_release_notes.html">6.1 版 - 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版 - 2019 年 8 月</option>
                  <option value="5_2_release_notes.html">5.2 版 - 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版 - 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版 - 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版 - 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版 - 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版 - 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版 - 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版 - 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版 - 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版 - 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版 - 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Rails 外向內路由</h2><p>本指南包含了 Rails 路由的面向使用者的功能。</p><p>閱讀本指南後，您將瞭解：</p>
<ul>
<li>如何解釋<code>config/routes.rb</code> 中的程式碼。</li>
<li>如何構建您自己的路線，使用首選的資源豐富的風格或 <code>match</code> 方法。</li>
<li>如何宣告路由引數，傳遞到 controller actions。</li>
<li>如何使用路由 helpers 自動建立路徑和 URL。</li>
<li>高階技術，例如建立約束和掛載 Rack 端點。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#rails">Rails 路由器的用途</a>

<ul>
<li><a href="#url">將 URL 連線到程式碼</a></li>
<li><a href="#url">從程式碼產生路徑和 URL</a></li>
<li><a href="#rails">設定 Rails 路由器</a></li>
</ul>
</li>
<li>
<a href="#rails">資源路由：Rails 預設</a>

<ul>
<li><a href="#">網路資源</a></li>
<li><a href="#crud-actions">CRUD、動詞和 Actions</a></li>
<li><a href="#url-helpers">路徑和 URL Helpers</a></li>
<li><a href="#">同時定義多個資源</a></li>
<li><a href="#">單一資源</a></li>
<li><a href="#controller">Controller 名稱空間和路由</a></li>
<li><a href="#">巢狀資源</a></li>
<li><a href="#">路由問題</a></li>
<li><a href="#url">從物件建立路徑和 URL</a></li>
<li><a href="#restful-action">新增更多 RESTful Action</a></li>
</ul>
</li>
<li>
<a href="#">無資源路線</a>

<ul>
<li><a href="#">繫結引數</a></li>
<li><a href="#">動態段</a></li>
<li><a href="#">靜態段</a></li>
<li><a href="#">查詢字串</a></li>
<li><a href="#">定義預設值</a></li>
<li><a href="#">命名路由</a></li>
<li><a href="#http">HTTP 動詞約束</a></li>
<li><a href="#">段約束</a></li>
<li><a href="#">根據請求的約束</a></li>
<li><a href="#">高階約束</a></li>
<li><a href="#">路由萬用字元和萬用字元段</a></li>
<li><a href="#">重定向</a></li>
<li><a href="#rack">路由到 Rack 應用程式</a></li>
<li><a href="#root">使用 <code>root</code></a></li>
<li><a href="#unicode">Unicode 字元路由</a></li>
<li><a href="#">直達路線</a></li>
<li><a href="#resolve">使用 <code>resolve</code></a></li>
</ul>
</li>
<li>
<a href="#">自定義資源豐富的路由</a>

<ul>
<li><a href="#controller">指定要使用的 Controller</a></li>
<li><a href="#">指定約束</a></li>
<li><a href="#helpers">覆蓋命名路由 Helpers</a></li>
<li><a href="#new-edit">覆蓋 <code>new</code> 和 <code>edit</code> 段</a></li>
<li><a href="#helpers">命名路由的字首 Helpers</a></li>
<li><a href="#">限制建立的路由</a></li>
<li><a href="#">翻譯路徑</a></li>
<li><a href="#">覆蓋單數形式</a></li>
<li><a href="#as">在巢狀資源中使用 <code>:as</code></a></li>
<li><a href="#">覆蓋命名路由引數</a></li>
</ul>
</li>
<li>
<a href="#">將<em>非常</em>大的路由檔案分解成多個小檔案：</a>

<ul>
<li><a href="#">不要使用這個功能，除非你真的需要它</a></li>
</ul>
</li>
<li>
<a href="#">檢查和測試路線</a>

<ul>
<li><a href="#">列出現有路線</a></li>
<li><a href="#">測試路線</a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="rails"><a class="anchorlink" href="#rails">1 Rails 路由器的用途</a></h3><p>Rails 路由器識別 URL 並將它們分派到 controller 的 action 或 Rack 應用程式。它還可以產生路徑和 URL，避免在 views 中硬編碼字串的需要。</p><h4 id="url"><a class="anchorlink" href="#url">1.1 將 URL 連線到程式碼</a></h4><p>當您的 Rails 應用程式收到傳入請求時：</p><div class="code_container">
<pre><code class="highlight plaintext">GET /patients/17
</code></pre>
<button class="clipboard-button" data-clipboard-text="GET /patients/17
">Copy</button>
</div>
<p>它要求路由器將其與 controller action 匹配。如果第一個匹配的路由是：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/patients/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'patients#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/patients/:id', to: 'patients#show'
">Copy</button>
</div>
<p>請求被分派到 <code>patients</code> controller 的 <code>show</code> action 和 <code>params</code> 中的 <code>{ id: '17' }</code>。</p><div class="note"><p>Rails 在這裡使用snake_case 作為controller 名稱，如果您有多個詞controller 像<code>MonsterTrucksController</code>，例如您想使用<code>monster_trucks#show</code>。</p></div><h4 id="url"><a class="anchorlink" href="#url">1.2 從程式碼產生路徑和 URL</a></h4><p>您還可以產生路徑和 URL。如果上面的路由修改為：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/patients/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'patients#show'</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'patient'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/patients/:id', to: 'patients#show', as: 'patient'
">Copy</button>
</div>
<p>並且您的應用程式在 controller 中包含此程式碼：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@patient</span> <span class="o">=</span> <span class="no">Patient</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="@patient = Patient.find(params[:id])
">Copy</button>
</div>
<p>這在相應的 view 中：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Patient Record'</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">(</span><span class="vi">@patient</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'Patient Record', patient_path(@patient) %&gt;
">Copy</button>
</div>
<p>那麼路由器會產生路徑<code>/patients/17</code>。這減少了 view 的脆弱性並使您的程式碼更易於理解。注意在路由helper中不需要指定id。</p><h4 id="rails"><a class="anchorlink" href="#rails">1.3 設定 Rails 路由器</a></h4><p>應用程式或引擎的路由位於檔案 <code>config/routes.rb</code> 中，通常如下所示：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:brands</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="n">resource</span> <span class="ss">:basket</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="p">]</span>

  <span class="n">resolve</span><span class="p">(</span><span class="s2">"Basket"</span><span class="p">)</span> <span class="p">{</span> <span class="n">route_for</span><span class="p">(</span><span class="ss">:basket</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Rails.application.routes.draw do
  resources :brands, only: [:index, :show] do
    resources :products, only: [:index, :show]
  end

  resource :basket, only: [:show, :update, :destroy]

  resolve("Basket") { route_for(:basket) }
end
'>Copy</button>
</div>
<p>由於這是一個正常的 Ruby 原始檔，您可以使用其所有功能來幫助您定義路由，但要注意變數名稱，因為它們可能與路由器的 DSL 方法發生衝突。</p><div class="note"><p>包裝路由定義的 <code>Rails.application.routes.draw do ... end</code> 塊是建立路由器 DSL 範圍所必需的，不得刪除。</p></div><h3 id="rails"><a class="anchorlink" href="#rails">2 資源路由：Rails 預設</a></h3><p>資源路由允許您快速宣告給定資源豐富的 controller 的所有公共路由。一次呼叫 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-resources"><code>resources</code></a> 可以為您的 <code>index</code>、<code>show</code>、<code>new</code>、<code>edit</code>、<code>create</code>、<code>update</code> 和 <code>destroy</code> 宣告所有必要的路由。</p><h4 id=""><a class="anchorlink" href="#">2.1 網路資源</a></h4><p>瀏覽器通過使用特定的 HTTP 方法請求 URL 來從 Rails 請求頁面，例如 <code>GET</code>、<code>POST</code>、<code>PATCH</code>、<code>PUT</code> 和 <code>DELETE</code>。每個方法都是對資源執行操作的請求。資源路由將多個相關請求對映到單個 controller 中的 actions。</p><p>當您的 Rails 應用程式收到傳入請求時：</p><div class="code_container">
<pre><code class="highlight plaintext">DELETE /photos/17
</code></pre>
<button class="clipboard-button" data-clipboard-text="DELETE /photos/17
">Copy</button>
</div>
<p>它要求路由器將其對映到 controller action。如果第一個匹配的路由是：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos
">Copy</button>
</div>
<p>Rails 會將該請求傳送到 <code>photos</code> 上的 <code>destroy</code> action controller 和 <code>params</code> 中的 <code>{ id: '17' }</code>。</p><h4 id="crud-actions"><a class="anchorlink" href="#crud-actions">2.2 CRUD、動詞和 Actions</a></h4><p>在 Rails 中，資源豐富的路由提供了 HTTP 動詞和 URL 之間的對映，以
controller actions。按照慣例，每個動作也對映到一個特定的 CRUD
在資料庫中操作。路由檔案中的單個條目，例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos
">Copy</button>
</div>
<p>在您的應用程式中建立七個不同的路由，都對映到 <code>Photos</code> controller：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>用於</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/照片</td>
<td>照片#index</td>
<td>顯示所有照片的列表</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/新</td>
<td>照片#new</td>
<td>返回用於建立新照片的 HTML 表單</td>
</tr>
<tr>
<td>釋出</td>
<td>/照片</td>
<td>照片#create</td>
<td>建立新照片</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/:id</td>
<td>照片#show</td>
<td>顯示特定照片</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/:id/編輯</td>
<td>照片#編輯</td>
<td>返回用於編輯照片的 HTML 表單</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/照片/:id</td>
<td>照片#更新</td>
<td>更新特定照片</td>
</tr>
<tr>
<td>刪除</td>
<td>/照片/:id</td>
<td>照片#destroy</td>
<td>刪除特定照片</td>
</tr>
</tbody>
</table>
<div class="note"><p>因為路由器使用 HTTP 動詞和 URL 來匹配入站請求，所以四個 URL 對映到七個不同的 actions。</p></div><div class="note"><p>Rails 路線按照指定的順序進行匹配，因此如果您的 <code>resources :photos</code> 高於 <code>get 'photos/poll'</code>，則 <code>show</code> action 路線的 <code>resources</code> 線路將在 4_ZWZHT 之前進行線路匹配。要解決此問題，請將 <code>get</code> 行 ** 移到 <code>resources</code> 行的**上方，使其首先匹配。</p></div><h4 id="url-helpers"><a class="anchorlink" href="#url-helpers">2.3 路徑和 URL Helpers</a></h4><p>建立一個資源豐富的路由也會在你的應用程式中暴露一些 helpers 到 controllers。在 <code>resources :photos</code> 的情況下：</p>
<ul>
<li>
<code>photos_path</code> 返回 <code>/photos</code>
</li>
<li>
<code>new_photo_path</code> 返回 <code>/photos/new</code>
</li>
<li>
<code>edit_photo_path(:id)</code> 返回 <code>/photos/:id/edit</code>（例如，<code>edit_photo_path(10)</code> 返回 <code>/photos/10/edit</code>）</li>
<li>
<code>photo_path(:id)</code> 返回 <code>/photos/:id</code>（例如，<code>photo_path(10)</code> 返回 <code>/photos/10</code>）</li>
</ul>
<p>這些 helpers 中的每一個都有一個對應的 <code>_url</code> 助手（例如 <code>photos_url</code>），它返回以當前主機、埠和路徑字首為字首的相同路徑。</p><h4 id=""><a class="anchorlink" href="#">2.4 同時定義多個資源</a></h4><p>如果你需要為多個資源建立路由，你可以通過一次呼叫 <code>resources</code> 來定義它們，從而節省一些輸入：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:videos</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, :books, :videos
">Copy</button>
</div>
<p>這與以下工作完全相同：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span>
<span class="n">resources</span> <span class="ss">:books</span>
<span class="n">resources</span> <span class="ss">:videos</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos
resources :books
resources :videos
">Copy</button>
</div>
<h4 id=""><a class="anchorlink" href="#">2.5 單一資源</a></h4><p>有時，您有一個資源，客戶端總是在不引用 ID 的情況下查詢該資源。例如，您希望 <code>/profile</code> 始終顯示當前登入使用者的個人資料。在這種情況下，您可以使用單一資源將 <code>/profile</code>（而不是 <code>/profile/:id</code>）對映到 <code>show</code> action：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'profile'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'users#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'profile', to: 'users#show'
">Copy</button>
</div>
<p>將 <code>String</code> 傳遞給 <code>to:</code> 將期望使用 <code>controller#action</code> 格式。使用 <code>Symbol</code> 時，應將 <code>to:</code> 選項替換為 <code>action:</code>。當使用沒有 <code>#</code> 的 <code>String</code> 時，應將 <code>to:</code> 選項替換為 <code>controller:</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'profile'</span><span class="p">,</span> <span class="ss">action: :show</span><span class="p">,</span> <span class="ss">controller: </span><span class="s1">'users'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'profile', action: :show, controller: 'users'
">Copy</button>
</div>
<p>這條足智多謀的路線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resource</span> <span class="ss">:geocoder</span>
<span class="n">resolve</span><span class="p">(</span><span class="s1">'Geocoder'</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="ss">:geocoder</span><span class="p">]</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resource :geocoder
resolve('Geocoder') { [:geocoder] }
">Copy</button>
</div>
<p>在您的應用程式中建立六個不同的路由，都對映到 <code>Geocoders</code> controller：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>用於</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/地理編碼器/新</td>
<td>地理編碼器#new</td>
<td>返回用於建立地理編碼器的 HTML 表單</td>
</tr>
<tr>
<td>釋出</td>
<td>/地理編碼器</td>
<td>地理編碼器#create</td>
<td>建立新的地理編碼器</td>
</tr>
<tr>
<td>獲取</td>
<td>/地理編碼器</td>
<td>地理編碼器#show</td>
<td>顯示唯一的地理編碼器資源</td>
</tr>
<tr>
<td>獲取</td>
<td>/地理編碼器/編輯</td>
<td>地理編碼器#edit</td>
<td>返回用於編輯地理編碼器的 HTML 表單</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/地理編碼器</td>
<td>地理編碼器#update</td>
<td>更新唯一的地理編碼器資源</td>
</tr>
<tr>
<td>刪除</td>
<td>/地理編碼器</td>
<td>地理編碼器#destroy</td>
<td>刪除地理編碼器資源</td>
</tr>
</tbody>
</table>
<div class="note"><p>因為您可能希望對單數路由 (<code>/account</code>) 和複數路由 (<code>/accounts/45</code>) 使用相同的控制器，所以單數資源對映到複數 controllers。因此，例如，<code>resource :photo</code> 和 <code>resources :photos</code> 建立對映到同一控制器 (<code>PhotosController</code>) 的單數和複數路由。</p></div><p>一個單一的資源豐富的路線產生這些 helpers：</p>
<ul>
<li>
<code>new_geocoder_path</code> 返回 <code>/geocoder/new</code>
</li>
<li>
<code>edit_geocoder_path</code> 返回 <code>/geocoder/edit</code>
</li>
<li>
<code>geocoder_path</code> 返回 <code>/geocoder</code>
</li>
</ul>
<div class="note"><p>呼叫 <code>resolve</code> 是將 <code>Geocoder</code> 實例轉換為通過 <a href="form_helpers.html#relying-on-record-identification">記錄標識</a> 的路由所必需的。</p></div><p>與多個資源一樣，以 <code>_url</code> 結尾的相同 helpers 還將包括主機、埠和路徑字首。</p><h4 id="controller"><a class="anchorlink" href="#controller">2.6 Controller 名稱空間和路由</a></h4><p>您可能希望在名稱空間下組織 controllers 組。最常見的是，您可以將多個管理 controllers 分組到 <code>Admin::</code> 名稱空間下，並將這些 controllers 放在 <code>app/controllers/admin</code> 目錄下。您可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-namespace"><code>namespace</code></a> 塊路由到這樣的組：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="namespace :admin do
  resources :articles, :comments
end
">Copy</button>
</div>
<p>這將為 <code>articles</code> 和 <code>comments</code> controller 中的每一個建立許多路由。對於 <code>Admin::ArticlesController</code>，Rails 將建立：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/管理員/文章</td>
<td>管理員/文章#index</td>
<td>admin_articles_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/管理員/文章/新</td>
<td>管理員/文章#new</td>
<td>new_admin_article_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/管理員/文章</td>
<td>管理員/文章#create</td>
<td>admin_articles_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/admin/articles/:id</td>
<td>管理/文章#show</td>
<td>admin_article_path(:id)</td>
</tr>
<tr>
<td>獲取</td>
<td>/admin/articles/:id/edit</td>
<td>管理員/文章#edit</td>
<td>edit_admin_article_path(:id)</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/admin/articles/:id</td>
<td>管理員/文章#update</td>
<td>admin_article_path(:id)</td>
</tr>
<tr>
<td>刪除</td>
<td>/admin/articles/:id</td>
<td>管理員/文章#destroy</td>
<td>admin_article_path(:id)</td>
</tr>
</tbody>
</table>
<p>相反，如果您想將 <code>/articles</code>（不帶字首 <code>/admin</code>）路由到 <code>Admin::ArticlesController</code>，您可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-scope"><code>scope</code></a> 塊指定 module：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="ss">module: </span><span class="s1">'admin'</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope module: 'admin' do
  resources :articles, :comments
end
">Copy</button>
</div>
<p>這也可以用於單個路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">module: </span><span class="s1">'admin'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles, module: 'admin'
">Copy</button>
</div>
<p>相反，如果您想將 <code>/admin/articles</code> 路由到 <code>ArticlesController</code>（沒有 <code>Admin::</code> module 字首），您可以使用 <code>scope</code> 塊指定路徑：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="s1">'/admin'</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope '/admin' do
  resources :articles, :comments
end
">Copy</button>
</div>
<p>這也可以用於單個路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">path: </span><span class="s1">'/admin/articles'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles, path: '/admin/articles'
">Copy</button>
</div>
<p>在這兩種情況下，命名路由 helpers 保持不變，就像您沒有使用 <code>scope</code> 一樣。在最後一種情況下，以下路徑對映到 <code>ArticlesController</code>：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/管理員/文章</td>
<td>文章#index</td>
<td>文章路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/管理員/文章/新</td>
<td>文章#new</td>
<td>new_article_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/管理員/文章</td>
<td>文章#建立</td>
<td>文章路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/admin/articles/:id</td>
<td>文章#show</td>
<td>article_path(:id)</td>
</tr>
<tr>
<td>獲取</td>
<td>/admin/articles/:id/edit</td>
<td>文章#edit</td>
<td>edit_article_path(:id)</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/admin/articles/:id</td>
<td>文章#更新</td>
<td>article_path(:id)</td>
</tr>
<tr>
<td>刪除</td>
<td>/admin/articles/:id</td>
<td>文章#destroy</td>
<td>article_path(:id)</td>
</tr>
</tbody>
</table>
<p>提示：如果您需要在 <code>namespace</code> 塊內使用不同的 controller 名稱空間，您可以指定絕對 controller 路徑，例如：<code>get '/foo', to: '/foo#index'</code>。</p><h4 id=""><a class="anchorlink" href="#">2.7 巢狀資源</a></h4><p>擁有邏輯上是其他資源的子資源的資源是很常見的。例如，假設您的應用程式包含這些 models：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Magazine</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:ads</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Ad</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:magazine</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Magazine &lt; ApplicationRecord
  has_many :ads
end

class Ad &lt; ApplicationRecord
  belongs_to :magazine
end
">Copy</button>
</div>
<p>巢狀路由允許您在路由中捕獲這種關係。在這種情況下，您可以包含此路由宣告：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:magazines</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:ads</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :magazines do
  resources :ads
end
">Copy</button>
</div>
<p>除了雜誌的路由，此宣告還將廣告路由到 <code>AdsController</code>。廣告 URL 需要一本雜誌：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>用於</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/magazines/:magazine_id/ads</td>
<td>廣告#index</td>
<td>顯示特定雜誌的所有廣告列表</td>
</tr>
<tr>
<td>獲取</td>
<td>/magazines/:magazine_id/ads/new</td>
<td>廣告#new</td>
<td>返回用於建立屬於特定雜誌的新廣告的 HTML 表單</td>
</tr>
<tr>
<td>釋出</td>
<td>/magazines/:magazine_id/ads</td>
<td>廣告#建立</td>
<td>建立屬於特定雜誌的新廣告</td>
</tr>
<tr>
<td>獲取</td>
<td>/magazines/:magazine_id/ads/:id</td>
<td>廣告#show</td>
<td>顯示屬於特定雜誌的特定廣告</td>
</tr>
<tr>
<td>獲取</td>
<td>/magazines/:magazine_id/ads/:id/edit</td>
<td>廣告#edit</td>
<td>返回用於編輯屬於特定雜誌的廣告的 HTML 表單</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/magazines/:magazine_id/ads/:id</td>
<td>廣告#更新</td>
<td>更新屬於特定雜誌的特定廣告</td>
</tr>
<tr>
<td>刪除</td>
<td>/magazines/:magazine_id/ads/:id</td>
<td>廣告#destroy</td>
<td>刪除屬於特定雜誌的特定廣告</td>
</tr>
</tbody>
</table>
<p>這也將建立路由 helpers，例如 <code>magazine_ads_url</code> 和 <code>edit_magazine_ad_path</code>。這些 helpers 以 Magazine 的實例作為第一個引數 (<code>magazine_ads_url(@magazine)</code>)。</p><h5 id=""><a class="anchorlink" href="#">2.7.1 巢狀限制</a></h5><p>如果願意，您可以在其他巢狀資源中巢狀資源。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:publishers</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:magazines</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:photos</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :publishers do
  resources :magazines do
    resources :photos
  end
end
">Copy</button>
</div>
<p>深度巢狀的資源很快就會變得笨重。例如，在這種情況下，應用程式將識別路徑，例如：</p><div class="code_container">
<pre><code class="highlight plaintext">/publishers/1/magazines/2/photos/3
</code></pre>
<button class="clipboard-button" data-clipboard-text="/publishers/1/magazines/2/photos/3
">Copy</button>
</div>
<p>對應的路徑 helper 將是 <code>publisher_magazine_photo_url</code>，要求您指定所有三個級別的物件。事實上，這種情況已經足夠令人困惑了，以至於 Jamis Buck 的一篇流行的 <a href="http://weblog.jamisbuck.org/2007/2/5/nesting-resources">文章</a> 提出了一個好的 Rails 設計的經驗法則：</p><p>提示：資源的巢狀深度不應超過 1 級。</p><h5 id=""><a class="anchorlink" href="#">2.7.2 淺巢狀</a></h5><p>避免深度巢狀的一種方法（如上所述）是產生作用域在父級之下的集合 actions，以便了解層次結構，但不要巢狀成員 actions。換句話說，只構建具有最少資訊量的路由來唯一標識資源，如下所示：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span><span class="p">]</span>
<span class="k">end</span>
<span class="n">resources</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles do
  resources :comments, only: [:index, :new, :create]
end
resources :comments, only: [:show, :edit, :update, :destroy]
">Copy</button>
</div>
<p>這個想法在描述性路線和深度巢狀之間取得了平衡。存在通過 <code>:shallow</code> 選項實現這一點的速記語法：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">shallow: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles do
  resources :comments, shallow: true
end
">Copy</button>
</div>
<p>這將產生與第一個示例完全相同的路由。您還可以在父資源中指定 <code>:shallow</code> 選項，在這種情況下，所有巢狀資源都將是淺層的：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">shallow: </span><span class="kp">true</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
  <span class="n">resources</span> <span class="ss">:quotes</span>
  <span class="n">resources</span> <span class="ss">:drafts</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :articles, shallow: true do
  resources :comments
  resources :quotes
  resources :drafts
end
">Copy</button>
</div>
<p>此處的文章資源將為它產生以下路由：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/articles/:article_id/comments(.:format)</td>
<td>評論#index</td>
<td>article_comments_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/articles/:article_id/comments(.:format)</td>
<td>評論#create</td>
<td>article_comments_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/comments/new(.:format)</td>
<td>評論#new</td>
<td>new_article_comment_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/comments/:id/edit(.:format)</td>
<td>評論#edit</td>
<td>edit_comment_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/comments/:id(.:format)</td>
<td>評論#show</td>
<td>評論路徑</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/comments/:id(.:format)</td>
<td>評論#update</td>
<td>評論路徑</td>
</tr>
<tr>
<td>刪除</td>
<td>/comments/:id(.:format)</td>
<td>評論#destroy</td>
<td>評論路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/quotes(.:format)</td>
<td>報價#index</td>
<td>article_quotes_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/articles/:article_id/quotes(.:format)</td>
<td>報價#create</td>
<td>article_quotes_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/quotes/new(.:format)</td>
<td>報價#new</td>
<td>new_article_quote_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/quotes/:id/edit(.:format)</td>
<td>報價#edit</td>
<td>edit_quote_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/quotes/:id(.:format)</td>
<td>報價#show</td>
<td>報價路徑</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/quotes/:id(.:format)</td>
<td>報價#update</td>
<td>報價路徑</td>
</tr>
<tr>
<td>刪除</td>
<td>/quotes/:id(.:format)</td>
<td>報價#destroy</td>
<td>報價路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/drafts(.:format)</td>
<td>草稿#index</td>
<td>article_drafts_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/articles/:article_id/drafts(.:format)</td>
<td>草稿#create</td>
<td>article_drafts_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/drafts/new(.:format)</td>
<td>草稿#new</td>
<td>new_article_draft_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/drafts/:id/edit(.:format)</td>
<td>草稿#edit</td>
<td>edit_draft_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/drafts/:id(.:format)</td>
<td>草稿#show</td>
<td>草稿路徑</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/drafts/:id(.:format)</td>
<td>草稿#更新</td>
<td>草稿路徑</td>
</tr>
<tr>
<td>刪除</td>
<td>/drafts/:id(.:format)</td>
<td>草稿#destroy</td>
<td>草稿路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/文章(.:格式)</td>
<td>文章#index</td>
<td>文章路徑</td>
</tr>
<tr>
<td>釋出</td>
<td>/文章(.:格式)</td>
<td>文章#建立</td>
<td>文章路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/new(.:format)</td>
<td>文章#new</td>
<td>new_article_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:id/edit(.:format)</td>
<td>文章#edit</td>
<td>edit_article_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:id(.:format)</td>
<td>文章#show</td>
<td>article_path</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/articles/:id(.:format)</td>
<td>文章#更新</td>
<td>article_path</td>
</tr>
<tr>
<td>刪除</td>
<td>/articles/:id(.:format)</td>
<td>文章#destroy</td>
<td>article_path</td>
</tr>
</tbody>
</table>
<p>DSL 的 <code>shallow</code> 方法建立了一個範圍，其中的每個巢狀都是淺層。這將產生與上一個示例相同的路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">shallow</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span>
    <span class="n">resources</span> <span class="ss">:quotes</span>
    <span class="n">resources</span> <span class="ss">:drafts</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="shallow do
  resources :articles do
    resources :comments
    resources :quotes
    resources :drafts
  end
end
">Copy</button>
</div>
<p><code>scope</code> 有兩個選項可以自定義淺層路線。 <code>:shallow_path</code> 使用指定引數為成員路徑新增字首：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="ss">shallow_path: </span><span class="s2">"sekret"</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">shallow: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='scope shallow_path: "sekret" do
  resources :articles do
    resources :comments, shallow: true
  end
end
'>Copy</button>
</div>
<p>此處的評論資源將為其產生以下路由：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/articles/:article_id/comments(.:format)</td>
<td>評論#index</td>
<td>article_comments_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/articles/:article_id/comments(.:format)</td>
<td>評論#create</td>
<td>article_comments_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/comments/new(.:format)</td>
<td>評論#new</td>
<td>new_article_comment_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/sekret/comments/:id/edit(.:format)</td>
<td>評論#edit</td>
<td>edit_comment_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/sekret/comments/:id(.:format)</td>
<td>評論#show</td>
<td>評論路徑</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/sekret/comments/:id(.:format)</td>
<td>評論#update</td>
<td>評論路徑</td>
</tr>
<tr>
<td>刪除</td>
<td>/sekret/comments/:id(.:format)</td>
<td>評論#destroy</td>
<td>評論路徑</td>
</tr>
</tbody>
</table>
<p><code>:shallow_prefix</code> 選項將指定的引數新增到命名路由 helpers 中：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="ss">shallow_prefix: </span><span class="s2">"sekret"</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span><span class="p">,</span> <span class="ss">shallow: </span><span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='scope shallow_prefix: "sekret" do
  resources :articles do
    resources :comments, shallow: true
  end
end
'>Copy</button>
</div>
<p>此處的評論資源將為其產生以下路由：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/articles/:article_id/comments(.:format)</td>
<td>評論#index</td>
<td>article_comments_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/articles/:article_id/comments(.:format)</td>
<td>評論#create</td>
<td>article_comments_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/articles/:article_id/comments/new(.:format)</td>
<td>評論#new</td>
<td>new_article_comment_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/comments/:id/edit(.:format)</td>
<td>評論#edit</td>
<td>edit_sekret_comment_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/comments/:id(.:format)</td>
<td>評論#show</td>
<td>sekret_comment_path</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/comments/:id(.:format)</td>
<td>評論#update</td>
<td>sekret_comment_path</td>
</tr>
<tr>
<td>刪除</td>
<td>/comments/:id(.:format)</td>
<td>評論#destroy</td>
<td>sekret_comment_path</td>
</tr>
</tbody>
</table>
<h4 id=""><a class="anchorlink" href="#">2.8 路由問題</a></h4><p>路由問題允許您宣告可以在其他資源和路由中重用的公共路由。要定義關注點，請使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Concerns.html#method-i-concern"><code>concern</code></a> 塊：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">concern</span> <span class="ss">:commentable</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
<span class="k">end</span>

<span class="n">concern</span> <span class="ss">:image_attachable</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:images</span><span class="p">,</span> <span class="ss">only: :index</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="concern :commentable do
  resources :comments
end

concern :image_attachable do
  resources :images, only: :index
end
">Copy</button>
</div>
<p>這些問題可以在資源中使用，以避免程式碼重複和跨路由共享行為：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:messages</span><span class="p">,</span> <span class="ss">concerns: :commentable</span>

<span class="n">resources</span> <span class="ss">:articles</span><span class="p">,</span> <span class="ss">concerns: </span><span class="p">[</span><span class="ss">:commentable</span><span class="p">,</span> <span class="ss">:image_attachable</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :messages, concerns: :commentable

resources :articles, concerns: [:commentable, :image_attachable]
">Copy</button>
</div>
<p>以上等價於：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:messages</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
<span class="k">end</span>

<span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
  <span class="n">resources</span> <span class="ss">:images</span><span class="p">,</span> <span class="ss">only: :index</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :messages do
  resources :comments
end

resources :articles do
  resources :comments
  resources :images, only: :index
end
">Copy</button>
</div>
<p>您還可以通過呼叫 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Concerns.html#method-i-concerns"><code>concerns</code></a> 在任何地方使用它們。例如，在 <code>scope</code> 或 <code>namespace</code> 塊中：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">namespace</span> <span class="ss">:articles</span> <span class="k">do</span>
  <span class="n">concerns</span> <span class="ss">:commentable</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="namespace :articles do
  concerns :commentable
end
">Copy</button>
</div>
<h4 id="url"><a class="anchorlink" href="#url">2.9 從物件建立路徑和 URL</a></h4><p>除了使用路由 helpers 之外，Rails 還可以從引數陣列建立路徑和 URL。例如，假設您有這組路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:magazines</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:ads</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :magazines do
  resources :ads
end
">Copy</button>
</div>
<p>使用 <code>magazine_ad_path</code> 時，您可以傳入 <code>Magazine</code> 和 <code>Ad</code> 的實例而不是數字 ID：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Ad details'</span><span class="p">,</span> <span class="n">magazine_ad_path</span><span class="p">(</span><span class="vi">@magazine</span><span class="p">,</span> <span class="vi">@ad</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'Ad details', magazine_ad_path(@magazine, @ad) %&gt;
">Copy</button>
</div>
<p>您還可以將 <code>url_for</code> 與一組物件一起使用，Rails 將自動確定您想要的路線：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Ad details'</span><span class="p">,</span> <span class="n">url_for</span><span class="p">([</span><span class="vi">@magazine</span><span class="p">,</span> <span class="vi">@ad</span><span class="p">])</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'Ad details', url_for([@magazine, @ad]) %&gt;
">Copy</button>
</div>
<p>在這種情況下，Rails 將看到 <code>@magazine</code> 是一個 <code>Magazine</code> 而 <code>@ad</code> 是一個 <code>Ad</code>，因此將使用 <code>magazine_ad_path</code> 助手。在類似於 <code>link_to</code> 的 helpers 中，您可以僅指定物件來代替完整的 <code>url_for</code> 呼叫：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Ad details'</span><span class="p">,</span> <span class="p">[</span><span class="vi">@magazine</span><span class="p">,</span> <span class="vi">@ad</span><span class="p">]</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'Ad details', [@magazine, @ad] %&gt;
">Copy</button>
</div>
<p>如果您只想連結到一本雜誌：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Magazine details'</span><span class="p">,</span> <span class="vi">@magazine</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'Magazine details', @magazine %&gt;
">Copy</button>
</div>
<p>對於其他的 actions，你只需要插入動作名稱作為陣列的第一個元素：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Edit Ad'</span><span class="p">,</span> <span class="p">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="vi">@magazine</span><span class="p">,</span> <span class="vi">@ad</span><span class="p">]</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= link_to 'Edit Ad', [:edit, @magazine, @ad] %&gt;
">Copy</button>
</div>
<p>這允許您將 models 的實例視為 URL，這是使用資源豐富的樣式的 key 優勢。</p><h4 id="restful-action"><a class="anchorlink" href="#restful-action">2.10 新增更多 RESTful Action</a></h4><p>您不僅限於 RESTful 路由預設建立的七個路由。如果您願意，可以新增適用於集合或集合的單個成員的其他路由。</p><h5 id=""><a class="anchorlink" href="#">2.10.1 新增成員路由</a></h5><p>要新增成員路由，只需在資源塊中新增一個 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-member"><code>member</code></a> 塊：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span> <span class="k">do</span>
  <span class="n">member</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'preview'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos do
  member do
    get 'preview'
  end
end
">Copy</button>
</div>
<p>這將使用 GET 識別 <code>/photos/1/preview</code>，並路由到 <code>PhotosController</code> 的 <code>preview</code> action，資源 id value 傳入 <code>params[:id]</code>。它還將建立 <code>preview_photo_url</code> 和 <code>preview_photo_path</code> helpers。</p><p>在成員路由塊中，每個路由名稱都指定了 HTTP 動詞
會被認可。您可以在此處使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-get"><code>get</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-patch"><code>patch</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-put"><code>put</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-post"><code>post</code></a> 或 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-delete"><code>delete</code></a>
.如果你沒有多個 <code>member</code> 路由，你也可以將 <code>:on</code> 傳遞給一個
路線，消除塊：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'preview'</span><span class="p">,</span> <span class="ss">on: :member</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos do
  get 'preview', on: :member
end
">Copy</button>
</div>
<p>您可以省略 <code>:on</code> 選項，這將建立相同的成員路由，但資源 ID value 將在 <code>params[:photo_id]</code> 中可用，而不是 <code>params[:id]</code>。路線 helpers 也將從 <code>preview_photo_url</code> 和 <code>preview_photo_path</code> 重新命名為 <code>photo_preview_url</code> 和 <code>photo_preview_path</code>。</p><h5 id=""><a class="anchorlink" href="#">2.10.2 新增採集路由</a></h5><p>要向集合新增路由，請使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-collection"><code>collection</code></a> 塊：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span> <span class="k">do</span>
  <span class="n">collection</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'search'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos do
  collection do
    get 'search'
  end
end
">Copy</button>
</div>
<p>這將使 Rails 能夠使用 GET 識別路徑，例如 <code>/photos/search</code>，並路由到 <code>PhotosController</code> 的 <code>search</code> action。它還將建立 <code>search_photos_url</code> 和 <code>search_photos_path</code> 路線 helpers。</p><p>與成員路由一樣，您可以將 <code>:on</code> 傳遞給路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'search'</span><span class="p">,</span> <span class="ss">on: :collection</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos do
  get 'search', on: :collection
end
">Copy</button>
</div>
<div class="note"><p>如果您使用符號作為第一個位置引數定義附加資源路由，請注意它不等同於使用字串。 Symbols 推斷 controller actions 而字串推斷路徑。</p></div><h5 id="action"><a class="anchorlink" href="#action">2.10.3 為其他新的 Action 新增路由</a></h5><p>要使用 <code>:on</code> 快捷方式新增備用的新 action：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:comments</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'preview'</span><span class="p">,</span> <span class="ss">on: :new</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :comments do
  get 'preview', on: :new
end
">Copy</button>
</div>
<p>這將使 Rails 能夠使用 GET 識別路徑，例如 <code>/comments/new/preview</code>，並路由到 <code>CommentsController</code> 的 <code>preview</code> action。它還將建立 <code>preview_new_comment_url</code> 和 <code>preview_new_comment_path</code> 路線 helpers。</p><p>提示：如果您發現自己在資源豐富的路線中添加了許多額外的 actions，是時候停下來問問自己是否在掩飾其他資源的存在。</p><h3 id=""><a class="anchorlink" href="#">3 無資源路線</a></h3><p>除了資源路由之外，Rails 還強大的支援將任意 URL 路由到 actions。在這裡，您不會獲得由資源豐富的路由自動產生的路由組。相反，您可以在應用程式中單獨設定每個路由。</p><p>雖然您通常應該使用資源豐富的路由，但仍有許多地方更適合更簡單的路由。如果這不合適，則無需嘗試將應用程式的最後一部分硬塞進資源豐富的框架中。</p><p>特別是，簡單的路由使得將舊 URL 對映到新的 Rails actions 變得非常容易。</p><h4 id=""><a class="anchorlink" href="#">3.1 繫結引數</a></h4><p>當您設定正常路由時，您提供一系列 symbols，Rails 對映到傳入 HTTP 請求的部分。例如，考慮這條路線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos(/:id)'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#display'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos(/:id)', to: 'photos#display'
">Copy</button>
</div>
<p>如果一個傳入的 <code>/photos/1</code> 請求被這條路由處理（因為它沒有匹配檔案中任何先前的路由），那麼結果將是呼叫 <code>PhotosController</code> 的 <code>display</code> action，並使最後一個引數 <code>"1"</code> 作為 ZHTW_WTHZ 可用.該路由還將傳入的 <code>/photos</code> 請求路由到 <code>PhotosController#display</code>，因為 <code>:id</code> 是一個可選引數，用括號表示。</p><h4 id=""><a class="anchorlink" href="#">3.2 動態段</a></h4><p>您可以根據需要在正常路線中設定任意數量的動態路段。作為 <code>params</code> 的一部分，任何段都可用於 action。如果您設定此路線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id/:user_id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id/:user_id', to: 'photos#show'
">Copy</button>
</div>
<p><code>/photos/1/2</code> 的傳入路徑將被排程到 <code>PhotosController</code> 的 <code>show</code> action。 <code>params[:id]</code> 將是 <code>"1"</code>，而 <code>params[:user_id]</code> 將是 <code>"2"</code>。</p><p>提示：預設情況下，動態段不接受點 - 這是因為點用作格式化路由的分隔符。如果您需要在動態段中使用一個點，請新增一個覆蓋它的約束——例如，<code>id: /[^\/]+/</code> 允許除斜槓之外的任何內容。</p><h4 id=""><a class="anchorlink" href="#">3.3 靜態段</a></h4><p>您可以在建立路由時通過不在段前新增冒號來指定靜態段：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id/with_user/:user_id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id/with_user/:user_id', to: 'photos#show'
">Copy</button>
</div>
<p>此路由將回應諸如 <code>/photos/1/with_user/2</code> 之類的路徑。在這種情況下，<code>params</code> 將是 <code>{ controller: 'photos', action: 'show', id: '1', user_id: '2' }</code>。</p><h4 id=""><a class="anchorlink" href="#">3.4 查詢字串</a></h4><p><code>params</code> 還將包括查詢字串中的任何引數。例如，使用這條路線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show'
">Copy</button>
</div>
<p><code>/photos/1?user_id=2</code> 的傳入路徑將被排程到 <code>Photos</code> controller 的 <code>show</code> action。 <code>params</code> 將是 <code>{ controller: 'photos', action: 'show', id: '1', user_id: '2' }</code>。</p><h4 id=""><a class="anchorlink" href="#">3.5 定義預設值</a></h4><p>您可以通過為 <code>:defaults</code> 選項提供雜湊來定義路由中的預設值。這甚至適用於您沒有指定為動態段的引數。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">defaults: </span><span class="p">{</span> <span class="ss">format: </span><span class="s1">'jpg'</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show', defaults: { format: 'jpg' }
">Copy</button>
</div>
<p>Rails 會將 <code>photos/12</code> 與 <code>PhotosController</code> 的 <code>show</code> action 匹配，並將 <code>params[:format]</code> 設定為 <code>"jpg"</code>。</p><p>您還可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-defaults"><code>defaults</code></a> 塊來定義多個專案的預設值：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">defaults</span> <span class="ss">format: :json</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:photos</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="defaults format: :json do
  resources :photos
end
">Copy</button>
</div>
<div class="note"><p>您不能通過查詢引數覆蓋預設值 - 這是出於安全原因。唯一可以覆蓋的預設值是通過 URL 路徑中的替換進行的動態段。</p></div><h4 id=""><a class="anchorlink" href="#">3.6 命名路由</a></h4><p>您可以使用 <code>:as</code> 選項為任何路由指定名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'exit'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'sessions#destroy'</span><span class="p">,</span> <span class="ss">as: :logout</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'exit', to: 'sessions#destroy', as: :logout
">Copy</button>
</div>
<p>這將在您的應用程式中建立 <code>logout_path</code> 和 <code>logout_url</code> 作為命名路由 helpers。呼叫 <code>logout_path</code> 將返回 <code>/exit</code></p><p>您還可以通過在定義資源之前放置自定義路由來使用它來覆蓋由資源定義的路由方法，如下所示：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">':username'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'users#show'</span><span class="p">,</span> <span class="ss">as: :user</span>
<span class="n">resources</span> <span class="ss">:users</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get ':username', to: 'users#show', as: :user
resources :users
">Copy</button>
</div>
<p>這將定義一個 <code>user_path</code> 方法，該方法將在 controllers、helpers 和 views 中可用，它們將轉到諸如 <code>/bob</code> 之類的路線。在 <code>UsersController</code> 的 <code>show</code> action 中，<code>params[:username]</code> 將包含使用者的使用者名稱。如果您不希望引數名稱為 <code>:username</code>，請更改路由定義中的 <code>:username</code>。</p><h4 id="http"><a class="anchorlink" href="#http">3.7 HTTP 動詞約束</a></h4><p>通常，您應該使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-get"><code>get</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-post"><code>post</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-put"><code>put</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-patch"><code>patch</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/HttpHelpers.html#method-i-delete"><code>delete</code></a> 方法將路由限制為特定動詞。您可以使用帶有 <code>:via</code> 選項的 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Base.html#method-i-match"><code>match</code></a> 方法一次匹配多個動詞：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'photos'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">via: </span><span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match 'photos', to: 'photos#show', via: [:get, :post]
">Copy</button>
</div>
<p>您可以使用 <code>via: :all</code> 將所有動詞匹配到特定路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'photos'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">via: :all</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match 'photos', to: 'photos#show', via: :all
">Copy</button>
</div>
<div class="note"><p>將 <code>GET</code> 和 <code>POST</code> 請求路由到單個 action 具有安全隱患。通常，除非有充分的理由，否則應避免將所有動詞路由到 action。</p></div><div class="note"><p>Rails 中的 <code>GET</code> 不會檢查 CSRF token。您永遠不應該從 <code>GET</code> 請求寫入資料庫，有關更多資訊，請參閱有關 CSRF 對策的 <a href="security.html#csrf-countermeasures">安全指南</a>。</p></div><h4 id=""><a class="anchorlink" href="#">3.8 段約束</a></h4><p>您可以使用 <code>:constraints</code> 選項來強制動態段的格式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/[A-Z]\d{5}/</span><span class="err"> }
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show', constraints: { id: /[A-Z]\d{5}/ }
">Copy</button>
</div>
<p>此路由將匹配諸如 <code>/photos/A12345</code> 之類的路徑，但不會匹配 <code>/photos/893</code>。您可以通過這種方式更簡潔地表達相同的路線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#show'</span><span class="p">,</span> <span class="ss">id: </span><span class="sr">/[A-Z]\d{5}/</span><span class="err">
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/:id', to: 'photos#show', id: /[A-Z]\d{5}/
">Copy</button>
</div>
<p><code>:constraints</code> 採用正則表示式，但不能使用正則表示式錨點。例如，以下路由將不起作用：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'articles#show'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/^\d/</span><span class="err"> }
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="get '/:id', to: 'articles#show', constraints: { id: /^\d/ }
">Copy</button>
</div>
<p>但是，請注意，您不需要使用錨點，因為所有路由都錨定在起點和終點。</p><p>例如，以下路由將允許 <code>articles</code> 和 <code>to_param</code> values 像 <code>1-hello-world</code> 一樣總是以數字開頭，而 <code>users</code> 和 <code>to_param</code> values 像 <code>david</code> 一樣從不共享根以名稱空間開頭的數字：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/:id'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'articles#show'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/\d.+/</span><span class="err"> }
g</span><span class="sr">e</span><span class="n">t</span> <span class="s1">'/:username'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'users#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/:id', to: 'articles#show', constraints: { id: /\d.+/ }
get '/:username', to: 'users#show'
">Copy</button>
</div>
<h4 id=""><a class="anchorlink" href="#">3.9 根據請求的約束</a></h4><p>您還可以根據返回 <code>String</code> 的 <a href="action_controller_overview.html#the-request-object">Request object</a> 上的任何方法來約束路由。</p><p>您可以像指定段約束一樣指定根據請求的約束：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#index'</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">subdomain: </span><span class="s1">'admin'</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos', to: 'photos#index', constraints: { subdomain: 'admin' }
">Copy</button>
</div>
<p>您還可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-constraints"><code>constraints</code></a> 塊指定約束：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">constraints</span> <span class="ss">subdomain: </span><span class="s1">'admin'</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:photos</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="namespace :admin do
  constraints subdomain: 'admin' do
    resources :photos
  end
end
">Copy</button>
</div>
<div class="note"><p>請求約束的工作方式是呼叫 <a href="action_controller_overview.html#the-request-object">Request object</a> 與雜湊 key 同名的方法，然後將返回值與雜湊值進行比較。因此，約束 values 應該匹配對應的 Request 物件方法返回型別。例如： <code>constraints: { subdomain: 'api' }</code> 將按預期匹配 <code>api</code> 子域。但是，使用 symbol <code>constraints: { subdomain: :api }</code> 不會，因為 <code>request.subdomain</code> 將 <code>'api'</code> 作為字串返回。</p></div><div class="note"><p><code>format</code> 約束有一個例外：雖然它是 Request 物件上的一個方法，但它也是每個路徑上的一個隱式可選引數。段約束優先，並且 <code>format</code> 約束僅在通過雜湊強制執行時才應用。例如，<code>get 'foo', constraints: { format: 'json' }</code> 將匹配 <code>GET  /foo</code>，因為預設情況下格式是可選的。但是，您可以 <a href="#advanced-constraints">使用 lambda</a> 就像在 <code>get 'foo', constraints: lambda { |req| req.format == :json }</code> 中一樣，並且該路由將僅匹配顯式 JSON 請求。</p></div><h4 id=""><a class="anchorlink" href="#">3.10 高階約束</a></h4><p>如果您有更高階的約束，您可以提供一個回應 <code>matches?</code> 的物件，該物件應該使用 Rails。假設您想將受限列表中的所有使用者路由到 <code>RestrictedListController</code>。你可以這樣做：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">RestrictedListConstraint</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@ips</span> <span class="o">=</span> <span class="no">RestrictedList</span><span class="p">.</span><span class="nf">retrieve_ips</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">matches?</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="vi">@ips</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span><span class="p">,</span>
    <span class="ss">constraints: </span><span class="no">RestrictedListConstraint</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class RestrictedListConstraint
  def initialize
    @ips = RestrictedList.retrieve_ips
  end

  def matches?(request)
    @ips.include?(request.remote_ip)
  end
end

Rails.application.routes.draw do
  get '*path', to: 'restricted_list#index',
    constraints: RestrictedListConstraint.new
end
">Copy</button>
</div>
<p>您還可以將約束指定為 lambda：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span><span class="p">,</span>
    <span class="ss">constraints: </span><span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span> <span class="no">RestrictedList</span><span class="p">.</span><span class="nf">retrieve_ips</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Rails.application.routes.draw do
  get '*path', to: 'restricted_list#index',
    constraints: lambda { |request| RestrictedList.retrieve_ips.include?(request.remote_ip) }
end
">Copy</button>
</div>
<p><code>matches?</code> 方法和 lambda 都以 <code>request</code> 物件作為引數。</p><h5 id=""><a class="anchorlink" href="#">3.10.1 塊形式的約束</a></h5><p>您可以以塊形式指定約束。當您需要將相同的規則應用於多個路由時，這很有用。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">RestrictedListConstraint</span>
  <span class="c1"># ...Same as the example above</span>
<span class="k">end</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">constraints</span><span class="p">(</span><span class="no">RestrictedListConstraint</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span>
    <span class="n">get</span> <span class="s1">'*other-path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'other_restricted_list#index'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class RestrictedListConstraint
  # ...Same as the example above
end

Rails.application.routes.draw do
  constraints(RestrictedListConstraint.new) do
    get '*path', to: 'restricted_list#index'
    get '*other-path', to: 'other_restricted_list#index'
  end
end
">Copy</button>
</div>
<p>您還可以使用 <code>lambda</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">constraints</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span> <span class="no">RestrictedList</span><span class="p">.</span><span class="nf">retrieve_ips</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="nf">remote_ip</span><span class="p">)</span> <span class="p">})</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'*path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'restricted_list#index'</span>
    <span class="n">get</span> <span class="s1">'*other-path'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'other_restricted_list#index'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Rails.application.routes.draw do
  constraints(lambda { |request| RestrictedList.retrieve_ips.include?(request.remote_ip) }) do
    get '*path', to: 'restricted_list#index'
    get '*other-path', to: 'other_restricted_list#index'
  end
end
">Copy</button>
</div>
<h4 id=""><a class="anchorlink" href="#">3.11 路由萬用字元和萬用字元段</a></h4><p>路由通配是一種指定特定引數應與路由的所有剩餘部分匹配的方法。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'photos/*other'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'photos#unknown'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'photos/*other', to: 'photos#unknown'
">Copy</button>
</div>
<p>此路由將匹配 <code>photos/12</code> 或 <code>/photos/long/path/to/12</code>，將 <code>params[:other]</code> 設定為 <code>"12"</code> 或 <code>"long/path/to/12"</code>。以星號為字首的段稱為“萬用字元段”。</p><p>萬用字元段可以出現在路徑中的任何位置。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'books/*section/:title'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'books#show'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'books/*section/:title', to: 'books#show'
">Copy</button>
</div>
<p>將匹配 <code>books/some/section/last-words-a-memoir</code>，其中 <code>params[:section]</code> 等於 <code>'some/section'</code>，而 <code>params[:title]</code> 等於 <code>'last-words-a-memoir'</code>。</p><p>從技術上講，一條路由甚至可以有多個萬用字元段。匹配器以直觀的方式將段分配給引數。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'*a/foo/*b'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'test#index'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '*a/foo/*b', to: 'test#index'
">Copy</button>
</div>
<p>將匹配 <code>zoo/woo/foo/bar/baz</code>，其中 <code>params[:a]</code> 等於 <code>'zoo/woo'</code>，而 <code>params[:b]</code> 等於 <code>'bar/baz'</code>。</p><div class="note"><p>通過請求 <code>'/foo/bar.json'</code>，你的 <code>params[:pages]</code> 將等於 <code>'foo/bar'</code>，請求格式為 JSON。如果你想要舊的 3.0.x 行為，你可以像這樣提供 <code>format: false</code>：</p></div><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'*pages'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'pages#show'</span><span class="p">,</span> <span class="ss">format: </span><span class="kp">false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '*pages', to: 'pages#show', format: false
">Copy</button>
</div>
<div class="note"><p>如果你想讓格式段成為強制性的，所以它不能被省略，你可以像這樣提供 <code>format: true</code>：</p></div><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'*pages'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'pages#show'</span><span class="p">,</span> <span class="ss">format: </span><span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '*pages', to: 'pages#show', format: true
">Copy</button>
</div>
<h4 id=""><a class="anchorlink" href="#">3.12 重定向</a></h4><p>您可以使用路由器中的 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Redirection.html#method-i-redirect"><code>redirect</code></a> helper 將任何路徑重定向到另一個路徑：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span><span class="p">(</span><span class="s1">'/articles'</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories', to: redirect('/articles')
">Copy</button>
</div>
<p>您還可以重用路徑中匹配項的動態段以重定向到：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories/:name'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span><span class="p">(</span><span class="s1">'/articles/%{name}'</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories/:name', to: redirect('/articles/%{name}')
">Copy</button>
</div>
<p>您還可以向 <code>redirect</code> 提供一個塊，它接收 symbolized 路徑引數和請求物件：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories/:name'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span> <span class="p">{</span> <span class="o">|</span><span class="n">path_params</span><span class="p">,</span> <span class="n">req</span><span class="o">|</span> <span class="s2">"/articles/</span><span class="si">#{</span><span class="n">path_params</span><span class="p">[</span><span class="ss">:name</span><span class="p">].</span><span class="nf">pluralize</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
<span class="n">get</span> <span class="s1">'/stories'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span> <span class="p">{</span> <span class="o">|</span><span class="n">path_params</span><span class="p">,</span> <span class="n">req</span><span class="o">|</span> <span class="s2">"/articles/</span><span class="si">#{</span><span class="n">req</span><span class="p">.</span><span class="nf">subdomain</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories/:name', to: redirect { |path_params, req| &quot;/articles/#{path_params[:name].pluralize}&quot; }
get '/stories', to: redirect { |path_params, req| &quot;/articles/#{req.subdomain}&quot; }
">Copy</button>
</div>
<p>請注意，預設重定向是 301“永久移動”重定向。請記住，某些 Web 瀏覽器或代理伺服器會快取這種型別的重定向，從而使舊頁面無法訪問。您可以使用 <code>:status</code> 選項來更改回應狀態：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'/stories/:name'</span><span class="p">,</span> <span class="ss">to: </span><span class="n">redirect</span><span class="p">(</span><span class="s1">'/articles/%{name}'</span><span class="p">,</span> <span class="ss">status: </span><span class="mi">302</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get '/stories/:name', to: redirect('/articles/%{name}', status: 302)
">Copy</button>
</div>
<p>在所有這些情況下，如果您不提供主要主機 (<code>http://www.example.com</code>)，Rails 將從當前請求中獲取這些詳細資訊。</p><h4 id="rack"><a class="anchorlink" href="#rack">3.13 路由到 Rack 應用程式</a></h4><p>您可以指定任何 <a href="rails_on_rack.html">Rack 應用程式</a> 作為匹配器的端點，而不是像 <code>'articles#index'</code> 這樣的字串，它對應於 <code>ArticlesController</code> 中的 <code>index</code> action：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'/application.js'</span><span class="p">,</span> <span class="ss">to: </span><span class="no">MyRackApp</span><span class="p">,</span> <span class="ss">via: :all</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match '/application.js', to: MyRackApp, via: :all
">Copy</button>
</div>
<p>只要<code>MyRackApp</code>回應<code>call</code>並返回<code>[status, headers, body]</code>，路由器就不會知道Rack應用程式和action之間的差別。這是對 <code>via: :all</code> 的適當使用，因為您將希望讓 Rack 應用程式處理它認為合適的所有動詞。</p><div class="note"><p>對於好奇，<code>'articles#index'</code> 實際上擴充套件到 <code>ArticlesController.action(:index)</code>，它返回一個有效的 Rack 應用程式。</p></div><div class="note"><p>由於 procs/lambdas 是回應 <code>call</code> 的物件，您可以內聯實現非常簡單的路由（例如用於健康檢查）：<br><code>get '/health', to: -&gt;(env) { [204, {}, ['']] }</code></p></div><p>如果您指定 Rack 應用程式作為匹配器的端點，請記住
接收應用程式中的路由將保持不變。與以下
路由您的 Rack 應用程式應該期望路由為 <code>/admin</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">match</span> <span class="s1">'/admin'</span><span class="p">,</span> <span class="ss">to: </span><span class="no">AdminApp</span><span class="p">,</span> <span class="ss">via: :all</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="match '/admin', to: AdminApp, via: :all
">Copy</button>
</div>
<p>如果您希望讓 Rack 應用程式在根目錄接收請求
代替路徑，使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Base.html#method-i-mount"><code>mount</code></a>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">mount</span> <span class="no">AdminApp</span><span class="p">,</span> <span class="ss">at: </span><span class="s1">'/admin'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="mount AdminApp, at: '/admin'
">Copy</button>
</div>
<h4 id="root"><a class="anchorlink" href="#root">3.14 使用 <code>root</code></a></h4><p>您可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-root"><code>root</code></a> 方法指定 Rails 應該將 <code>'/'</code> 路由到什麼位置：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">root</span> <span class="ss">to: </span><span class="s1">'pages#main'</span>
<span class="n">root</span> <span class="s1">'pages#main'</span> <span class="c1"># shortcut for the above</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="root to: 'pages#main'
root 'pages#main' # shortcut for the above
">Copy</button>
</div>
<p>您應該將 <code>root</code> 路由放在檔案的頂部，因為它是最受歡迎的路由，應該首先匹配。</p><div class="note"><p><code>root</code> 路由只將 <code>GET</code> 請求路由到 action。</p></div><p>您也可以在名稱空間和範圍內使用 root。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">to: </span><span class="s2">"admin#index"</span>
<span class="k">end</span>

<span class="n">root</span> <span class="ss">to: </span><span class="s2">"home#index"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='namespace :admin do
  root to: "admin#index"
end

root to: "home#index"
'>Copy</button>
</div>
<h4 id="unicode"><a class="anchorlink" href="#unicode">3.15 Unicode 字元路由</a></h4><p>您可以直接指定 unicode 字元路由。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">get</span> <span class="s1">'こんにちは'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'welcome#index'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="get 'こんにちは', to: 'welcome#index'
">Copy</button>
</div>
<h4 id=""><a class="anchorlink" href="#">3.16 直達路線</a></h4><p>您可以通過呼叫 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/CustomUrls.html#method-i-direct"><code>direct</code></a> 直接建立自定義 URL helpers。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">direct</span> <span class="ss">:homepage</span> <span class="k">do</span>
  <span class="s2">"https://rubyonrails.org"</span>
<span class="k">end</span>

<span class="c1"># &gt;&gt; homepage_url</span>
<span class="c1"># =&gt; "https://rubyonrails.org"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='direct :homepage do
  "https://rubyonrails.org"
end

# &gt;&gt; homepage_url
# =&gt; "https://rubyonrails.org"
'>Copy</button>
</div>
<p>塊的返回 value 必須是 <code>url_for</code> 方法的有效引數。因此，您可以傳遞有效的字串 URL、雜湊、陣列、Active Model 實例或 Active Model 類。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">direct</span> <span class="ss">:commentable</span> <span class="k">do</span> <span class="o">|</span><span class="n">model</span><span class="o">|</span>
  <span class="p">[</span> <span class="n">model</span><span class="p">,</span> <span class="ss">anchor: </span><span class="n">model</span><span class="p">.</span><span class="nf">dom_id</span> <span class="p">]</span>
<span class="k">end</span>

<span class="n">direct</span> <span class="ss">:main</span> <span class="k">do</span>
  <span class="p">{</span> <span class="ss">controller: </span><span class="s1">'pages'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'index'</span><span class="p">,</span> <span class="ss">subdomain: </span><span class="s1">'www'</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="direct :commentable do |model|
  [ model, anchor: model.dom_id ]
end

direct :main do
  { controller: 'pages', action: 'index', subdomain: 'www' }
end
">Copy</button>
</div>
<h4 id="resolve"><a class="anchorlink" href="#resolve">3.17 使用 <code>resolve</code></a></h4><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/CustomUrls.html#method-i-resolve"><code>resolve</code></a> 方法允許自定義 models 的多型對映。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resource</span> <span class="ss">:basket</span>

<span class="n">resolve</span><span class="p">(</span><span class="s2">"Basket"</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="ss">:basket</span><span class="p">]</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='resource :basket

resolve("Basket") { [:basket] }
'>Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@basket</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="c">&lt;!-- basket form --&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= form_with model: @basket do |form| %&gt;
  &lt;!-- basket form --&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>這將產生單一的 URL <code>/basket</code> 而不是通常的 <code>/baskets/:id</code>。</p><h3 id=""><a class="anchorlink" href="#">4 自定義資源豐富的路由</a></h3><p>雖然 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-resources"><code>resources</code></a> 產生的預設路由和 helpers 通常會很好地為您服務，但您可能希望以某種方式自定義它們。 Rails 允許您自定義資源豐富的 helpers 的幾乎任何通用部分。</p><h4 id="controller"><a class="anchorlink" href="#controller">4.1 指定要使用的 Controller</a></h4><p><code>:controller</code> 選項允許您明確指定用於資源的 controller。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">controller: </span><span class="s1">'images'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, controller: 'images'
">Copy</button>
</div>
<p>將識別以 <code>/photos</code> 開頭的傳入路徑，但路由到 <code>Images</code> controller：</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/照片</td>
<td>影象#index</td>
<td>照片路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/新</td>
<td>影象#new</td>
<td>new_photo_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/照片</td>
<td>影象#建立</td>
<td>照片路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/:id</td>
<td>影象#show</td>
<td>photo_path(:id)</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/:id/編輯</td>
<td>影象#edit</td>
<td>edit_photo_path(:id)</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/照片/:id</td>
<td>影象#更新</td>
<td>photo_path(:id)</td>
</tr>
<tr>
<td>刪除</td>
<td>/照片/:id</td>
<td>影象#destroy</td>
<td>photo_path(:id)</td>
</tr>
</tbody>
</table>
<div class="note"><p>使用 <code>photos_path</code>、<code>new_photo_path</code> 等為該資源產生路徑。</p></div><p>對於名稱空間 controllers，您可以使用目錄表示法。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:user_permissions</span><span class="p">,</span> <span class="ss">controller: </span><span class="s1">'admin/user_permissions'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :user_permissions, controller: 'admin/user_permissions'
">Copy</button>
</div>
<p>這將路由到 <code>Admin::UserPermissions</code> controller。</p><div class="note"><p>僅支援目錄符號。指定
controller 帶有 Ruby 常量符號（例如 <code>controller: 'Admin::UserPermissions'</code>）
可能會導致路由問題並導致
一個警告。</p></div><h4 id=""><a class="anchorlink" href="#">4.2 指定約束</a></h4><p>您可以使用 <code>:constraints</code> 選項在隱式 <code>id</code> 上指定所需的格式。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">constraints: </span><span class="p">{</span> <span class="ss">id: </span><span class="sr">/[A-Z][A-Z][0-9]+/</span><span class="err"> }
</span></code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, constraints: { id: /[A-Z][A-Z][0-9]+/ }
">Copy</button>
</div>
<p>此宣告約束 <code>:id</code> 引數以匹配提供的正則表示式。因此，在這種情況下，路由器將不再將 <code>/photos/1</code> 與此路由匹配。相反，<code>/photos/RR27</code> 會匹配。</p><p>您可以使用塊形式指定單個約束以應用於多個路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">constraints</span><span class="p">(</span><span class="ss">id: </span><span class="sr">/[A-Z][A-Z][0-9]+/</span><span class="err">) d</span><span class="sr">o</span>
  <span class="n">resources</span> <span class="ss">:photos</span>
  <span class="n">resources</span> <span class="ss">:accounts</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="constraints(id: /[A-Z][A-Z][0-9]+/) do
  resources :photos
  resources :accounts
end
">Copy</button>
</div>
<div class="note"><p>當然，您可以在此上下文中使用非資源路由中可用的更高階約束。</p></div><p>提示：預設情況下，<code>:id</code> 引數不接受點 - 這是因為點用作格式化路由的分隔符。如果您需要在 <code>:id</code> 中使用一個點，請新增一個覆蓋它的約束 - 例如 <code>id: /[^\/]+/</code> 允許除斜槓之外的任何內容。</p><h4 id="helpers"><a class="anchorlink" href="#helpers">4.3 覆蓋命名路由 Helpers</a></h4><p><code>:as</code> 選項允許您覆蓋命名路由 helpers 的正常命名。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'images'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, as: 'images'
">Copy</button>
</div>
<p>將識別以 <code>/photos</code> 開頭的傳入路徑並將請求路由到 <code>PhotosController</code>，但使用 <code>:as</code> 選項的 value 來命名 helpers。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/照片</td>
<td>照片#index</td>
<td>影象路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/新</td>
<td>照片#new</td>
<td>new_image_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/照片</td>
<td>照片#create</td>
<td>影象路徑</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/:id</td>
<td>照片#show</td>
<td>影象路徑(:id)</td>
</tr>
<tr>
<td>獲取</td>
<td>/照片/:id/編輯</td>
<td>照片#編輯</td>
<td>edit_image_path(:id)</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/照片/:id</td>
<td>照片#更新</td>
<td>影象路徑(:id)</td>
</tr>
<tr>
<td>刪除</td>
<td>/照片/:id</td>
<td>照片#destroy</td>
<td>影象路徑(:id)</td>
</tr>
</tbody>
</table>
<h4 id="new-edit"><a class="anchorlink" href="#new-edit">4.4 覆蓋 <code>new</code> 和 <code>edit</code> 段</a></h4><p><code>:path_names</code> 選項允許您覆蓋路徑中自動產生的 <code>new</code> 和 <code>edit</code> 段：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">path_names: </span><span class="p">{</span> <span class="ss">new: </span><span class="s1">'make'</span><span class="p">,</span> <span class="ss">edit: </span><span class="s1">'change'</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, path_names: { new: 'make', edit: 'change' }
">Copy</button>
</div>
<p>這將導致路由識別路徑，例如：</p><div class="code_container">
<pre><code class="highlight plaintext">/photos/make
/photos/1/change
</code></pre>
<button class="clipboard-button" data-clipboard-text="/photos/make
/photos/1/change
">Copy</button>
</div>
<div class="note"><p>此選項不會更改實際操作名稱。顯示的兩條路徑仍將路由到 <code>new</code> 和 <code>edit</code> actions。</p></div><p>提示：如果您發現自己想要為所有路線統一更改此選項，您可以使用範圍，如下所示：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="ss">path_names: </span><span class="p">{</span> <span class="ss">new: </span><span class="s1">'make'</span> <span class="p">}</span> <span class="k">do</span>
  <span class="c1"># rest of your routes</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope path_names: { new: 'make' } do
  # rest of your routes
end
">Copy</button>
</div>
<h4 id="helpers"><a class="anchorlink" href="#helpers">4.5 命名路由的字首 Helpers</a></h4><p>您可以使用 <code>:as</code> 選項為 Rails 為路由產生的命名路由 helpers 加上字首。使用此選項可防止使用路徑範圍的路由之間發生名稱衝突。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="s1">'admin'</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'admin_photos'</span>
<span class="k">end</span>

<span class="n">resources</span> <span class="ss">:photos</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope 'admin' do
  resources :photos, as: 'admin_photos'
end

resources :photos
">Copy</button>
</div>
<p>這將提供路由 helpers，例如 <code>admin_photos_path</code>、<code>new_admin_photo_path</code> 等。</p><p>要為一組路由 helpers 新增字首，請使用 <code>:as</code> 和 <code>scope</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="s1">'admin'</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'admin'</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">:accounts</span>
<span class="k">end</span>

<span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">:accounts</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope 'admin', as: 'admin' do
  resources :photos, :accounts
end

resources :photos, :accounts
">Copy</button>
</div>
<p>這將產生諸如 <code>admin_photos_path</code> 和 <code>admin_accounts_path</code> 之類的路由，它們分別對映到 <code>/admin/photos</code> 和 <code>/admin/accounts</code>。</p><div class="note"><p><code>namespace</code> 範圍將自動新增 <code>:as</code> 以及 <code>:module</code> 和 <code>:path</code> 字首。</p></div><p>您也可以使用命名引數為路由新增字首：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span> <span class="s1">':username'</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope ':username' do
  resources :articles
end
">Copy</button>
</div>
<p>這將為您提供諸如 <code>/bob/articles/1</code> 之類的 URL，並允許您將路徑的 <code>username</code> 部分引用為 controllers、helpers 和 views 中的 <code>params[:username]</code>。</p><h4 id=""><a class="anchorlink" href="#">4.6 限制建立的路由</a></h4><p>預設情況下，Rails 為您的應用程式中的每個路由中的七個預設 actions（<code>index</code>、<code>show</code>、<code>new</code>、<code>create</code>、<code>edit</code>、<code>update</code> 和 ZHTfulZW_6）建立路由。您可以使用 <code>:only</code> 和 <code>:except</code> 選項來微調此行為。 <code>:only</code> 選項告訴 Rails 只建立指定的路由：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, only: [:index, :show]
">Copy</button>
</div>
<p>現在，對 <code>/photos</code> 的 <code>GET</code> 請求會成功，但對 <code>/photos</code> 的 <code>POST</code> 請求（通常會路由到 <code>create</code> action）將失敗。</p><p><code>:except</code> 選項指定 Rails 應該<em>不</em>建立的路由或路由列表：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">except: :destroy</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :photos, except: :destroy
">Copy</button>
</div>
<p>在這種情況下，Rails 將建立除 <code>destroy</code> 的路由（對 <code>/photos/:id</code> 的 <code>DELETE</code> 請求）之外的所有正常路由。</p><p>提示：如果您的應用程式有很多 RESTful 路由，使用 <code>:only</code> 和 <code>:except</code> 僅產生您實際需要的路由可以減少記憶體使用並加快路由過程。</p><h4 id=""><a class="anchorlink" href="#">4.7 翻譯路徑</a></h4><p>使用 <code>scope</code>，我們可以更改由 <code>resources</code> 產生的路徑名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">scope</span><span class="p">(</span><span class="ss">path_names: </span><span class="p">{</span> <span class="ss">new: </span><span class="s1">'neu'</span><span class="p">,</span> <span class="ss">edit: </span><span class="s1">'bearbeiten'</span> <span class="p">})</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:categories</span><span class="p">,</span> <span class="ss">path: </span><span class="s1">'kategorien'</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="scope(path_names: { new: 'neu', edit: 'bearbeiten' }) do
  resources :categories, path: 'kategorien'
end
">Copy</button>
</div>
<p>Rails 現在建立到 <code>CategoriesController</code> 的路由。</p>
<table>
<thead>
<tr>
<th>HTTP 動詞</th>
<th>路徑</th>
<th>Controller#Action</th>
<th>命名路線Helper</th>
</tr>
</thead>
<tbody>
<tr>
<td>獲取</td>
<td>/類別</td>
<td>類別#index</td>
<td>category_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/kategorien/neu</td>
<td>類別#new</td>
<td>new_category_path</td>
</tr>
<tr>
<td>釋出</td>
<td>/類別</td>
<td>類別#建立</td>
<td>category_path</td>
</tr>
<tr>
<td>獲取</td>
<td>/kategorien/:id</td>
<td>類別#show</td>
<td>category_path(:id)</td>
</tr>
<tr>
<td>獲取</td>
<td>/kategorien/:id/bearbeiten</td>
<td>類別#edit</td>
<td>edit_category_path(:id)</td>
</tr>
<tr>
<td>補丁/放置</td>
<td>/kategorien/:id</td>
<td>類別#更新</td>
<td>category_path(:id)</td>
</tr>
<tr>
<td>刪除</td>
<td>/kategorien/:id</td>
<td>類別#destroy</td>
<td>category_path(:id)</td>
</tr>
</tbody>
</table>
<h4 id=""><a class="anchorlink" href="#">4.8 覆蓋單數形式</a></h4><p>如果你想覆蓋一個資源的單數形式，你應該通過 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActiveSupport/Inflector.html#method-i-inflections"><code>inflections</code></a> 向變形器新增額外的規則：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="p">.</span><span class="nf">inflections</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
  <span class="n">inflect</span><span class="p">.</span><span class="nf">irregular</span> <span class="s1">'tooth'</span><span class="p">,</span> <span class="s1">'teeth'</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport::Inflector.inflections do |inflect|
  inflect.irregular 'tooth', 'teeth'
end
">Copy</button>
</div>
<h4 id="as"><a class="anchorlink" href="#as">4.9 在巢狀資源中使用 <code>:as</code></a></h4><p><code>:as</code> 選項覆蓋巢狀路由 helpers 中資源的自動產生的名稱。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:magazines</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:ads</span><span class="p">,</span> <span class="ss">as: </span><span class="s1">'periodical_ads'</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :magazines do
  resources :ads, as: 'periodical_ads'
end
">Copy</button>
</div>
<p>這將建立路由 helpers，例如 <code>magazine_periodical_ads_url</code> 和 <code>edit_magazine_periodical_ad_path</code>。</p><h4 id=""><a class="anchorlink" href="#">4.10 覆蓋命名路由引數</a></h4><p><code>:param</code> 選項覆蓋預設資源識別符號 <code>:id</code>（名稱
<a href="routing.html#dynamic-segments">動態段</a> 用於產生
路線）。您可以使用 controller 訪問該段
<code>params[&lt;:param&gt;]</code>。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">resources</span> <span class="ss">:videos</span><span class="p">,</span> <span class="ss">param: :identifier</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="resources :videos, param: :identifier
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight plaintext">    videos GET  /videos(.:format)                  videos#index
           POST /videos(.:format)                  videos#create
 new_video GET  /videos/new(.:format)              videos#new
edit_video GET  /videos/:identifier/edit(.:format) videos#edit
</code></pre>
<button class="clipboard-button" data-clipboard-text="    videos GET  /videos(.:format)                  videos#index
           POST /videos(.:format)                  videos#create
 new_video GET  /videos/new(.:format)              videos#new
edit_video GET  /videos/:identifier/edit(.:format) videos#edit
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Video</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">identifier: </span><span class="n">params</span><span class="p">[</span><span class="ss">:identifier</span><span class="p">])</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Video.find_by(identifier: params[:identifier])
">Copy</button>
</div>
<p>您可以覆蓋關聯的 model 的 <code>ActiveRecord::Base#to_param</code> 來構造
一個網址：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Video</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="n">identifier</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Video &lt; ApplicationRecord
  def to_param
    identifier
  end
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="n">video</span> <span class="o">=</span> <span class="no">Video</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">identifier: </span><span class="s2">"Roman-Holiday"</span><span class="p">)</span>
<span class="n">edit_video_path</span><span class="p">(</span><span class="n">video</span><span class="p">)</span> <span class="c1"># =&gt; "/videos/Roman-Holiday/edit"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='video = Video.find_by(identifier: "Roman-Holiday")
edit_video_path(video) # =&gt; "/videos/Roman-Holiday/edit"
'>Copy</button>
</div>
<h3 id=""><a class="anchorlink" href="#">5 將<em>非常</em>大的路由檔案分解成多個小檔案：</a></h3><p>如果您在具有數千條路由的大型應用程式中工作，則單個 <code>config/routes.rb</code> 檔案可能會變得繁瑣且難以閱讀。</p><p>Rails 提供了一種使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-draw"><code>draw</code></a> 巨集將巨大的單個 <code>routes.rb</code> 檔案分解為多個小檔案的方法。</p><p>您可以有一個 <code>admin.rb</code> 路由，其中​​包含管理區域的所有路由，另一個 <code>api.rb</code> 檔案用於 API 相關資源等。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 設定/路由.rb</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="ss">to: </span><span class="s1">'foo#bar'</span>

  <span class="n">draw</span><span class="p">(</span><span class="ss">:admin</span><span class="p">)</span> <span class="c1"># Will load another route file located in `config/routes/admin.rb`</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 設定/路由.rb

Rails.application.routes.draw do
  get 'foo', to: 'foo#bar'

  draw(:admin) # Will load another route file located in `config/routes/admin.rb`
end
">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 設定/路由/admin.rb</span>

<span class="n">namespace</span> <span class="ss">:admin</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:comments</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 設定/路由/admin.rb

namespace :admin do
  resources :comments
end
">Copy</button>
</div>
<p>在 <code>Rails.application.routes.draw</code> 塊本身內呼叫 <code>draw(:admin)</code> 將嘗試載入路由
與給定引數同名的檔案（本例中為 <code>admin.rb</code>）。
該檔案需要位於 <code>config/routes</code> 目錄或任何子目錄（即 <code>config/routes/admin.rb</code> 或 <code>config/routes/external/admin.rb</code>）內。</p><p>您可以在 <code>admin.rb</code> 路由檔案中使用普通的路由 DSL，但您<strong>不應該</strong>像在主 <code>config/routes.rb</code> 檔案中那樣用 <code>Rails.application.routes.draw</code> 塊包圍它。</p><h4 id=""><a class="anchorlink" href="#">5.1 不要使用這個功能，除非你真的需要它</a></h4><p>擁有多個路由檔案會使可發現性和可理解性變得更加困難。對於大多數應用程式——即使是那些有幾百條路由的應用程式——開發人員擁有一個路由檔案更容易。 Rails 路由 DSL 已經提供了一種使用 <code>namespace</code> 和 <code>scope</code> 以有組織的方式中斷路由的方法。</p><h3 id=""><a class="anchorlink" href="#">6 檢查和測試路線</a></h3><p>Rails 提供用於檢查和測試您的路線的設施。</p><h4 id=""><a class="anchorlink" href="#">6.1 列出現有路線</a></h4><p>要獲取應用程式中可用路由的完整列表，請在伺服器在 <strong>development</strong> 環境中執行時在瀏覽器中訪問 <a href="http://localhost:3000/rails/info/routes">http://localhost:3000/rails/info/routes</a>。您還可以在終端中執行 <code>bin/rails routes</code> 命令以產生相同的輸出。</p><p>這兩種方法都將列出您的所有路線，其順序與它們出現在 <code>config/routes.rb</code> 中的順序相同。對於每條路線，您將看到：</p>
<ul>
<li>路線名稱（如果有）</li>
<li>使用的 HTTP 動詞（如果路由不回應所有動詞）</li>
<li>要匹配的 URL 模式</li>
<li>路由的路由引數</li>
</ul>
<p>例如，這是 RESTful 路由的 <code>bin/rails routes</code> 輸出的一小部分：</p><div class="code_container">
<pre><code class="highlight plaintext">    users GET    /users(.:format)          users#index
          POST   /users(.:format)          users#create
 new_user GET    /users/new(.:format)      users#new
edit_user GET    /users/:id/edit(.:format) users#edit
</code></pre>
<button class="clipboard-button" data-clipboard-text="    users GET    /users(.:format)          users#index
          POST   /users(.:format)          users#create
 new_user GET    /users/new(.:format)      users#new
edit_user GET    /users/:id/edit(.:format) users#edit
">Copy</button>
</div>
<p>您還可以使用 <code>--expanded</code> 選項開啟擴充套件表格式模式。</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">--expanded</span>
<span class="go">
--[ Route 1 ]----------------------------------------------------
Prefix            | users
Verb              | GET
URI               | /users(.:format)
</span><span class="gp">Controller#</span>Action | <span class="nb">users</span><span class="c">#index</span>
<span class="go">--[ Route 2 ]----------------------------------------------------
Prefix            |
Verb              | POST
URI               | /users(.:format)
</span><span class="gp">Controller#</span>Action | <span class="nb">users</span><span class="c">#create</span>
<span class="go">--[ Route 3 ]----------------------------------------------------
Prefix            | new_user
Verb              | GET
URI               | /users/new(.:format)
</span><span class="gp">Controller#</span>Action | <span class="nb">users</span><span class="c">#new</span>
<span class="go">--[ Route 4 ]----------------------------------------------------
Prefix            | edit_user
Verb              | GET
URI               | /users/:id/edit(.:format)
</span><span class="gp">Controller#</span>Action | <span class="nb">users</span><span class="c">#edit</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails routes --expanded
">Copy</button>
</div>
<p>您可以使用 grep 選項搜尋您的路線：-g。這將輸出與 URL helper 方法名稱、HTTP 動詞或 URL 路徑部分匹配的任何路由。</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-g</span> new_comment
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-g</span> POST
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-g</span> admin
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails routes -g new_comment
bin/rails routes -g POST
bin/rails routes -g admin
">Copy</button>
</div>
<p>如果您只想檢視對映到特定 controller 的路由，可以使用 -c 選項。</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-c</span> <span class="nb">users</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-c</span> admin/users
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-c</span> Comments
<span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes <span class="nt">-c</span> Articles::CommentsController
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails routes -c users
bin/rails routes -c admin/users
bin/rails routes -c Comments
bin/rails routes -c Articles::CommentsController
">Copy</button>
</div>
<p>提示：如果您擴大終端視窗直到輸出行不換行，您會發現 <code>bin/rails routes</code> 的輸出更具可讀性。</p><h4 id=""><a class="anchorlink" href="#">6.2 測試路線</a></h4><p>路由應該包含在您的測試策略中（就像應用程式的其餘部分一樣）。 Rails 提供了三個內建斷言，的目標在於使測試路由更簡單：</p>
<ul>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Assertions/RoutingAssertions.html#method-i-assert_generates"><code>assert_generates</code></a></li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Assertions/RoutingAssertions.html#method-i-assert_recognizes"><code>assert_recognizes</code></a></li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Assertions/RoutingAssertions.html#method-i-assert_routing"><code>assert_routing</code></a></li>
</ul>
<h5 id="assert-generates"><a class="anchorlink" href="#assert-generates">6.2.1 <code>assert_generates</code> 斷言</a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Assertions/RoutingAssertions.html#method-i-assert_generates"><code>assert_generates</code></a> 斷言一組特定的選項產生特定的路徑，並且可以與預設路由或自定義路由一起使用。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">assert_generates</span> <span class="s1">'/photos/1'</span><span class="p">,</span> <span class="p">{</span> <span class="ss">controller: </span><span class="s1">'photos'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'show'</span><span class="p">,</span> <span class="ss">id: </span><span class="s1">'1'</span> <span class="p">}</span>
<span class="n">assert_generates</span> <span class="s1">'/about'</span><span class="p">,</span> <span class="ss">controller: </span><span class="s1">'pages'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'about'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="assert_generates '/photos/1', { controller: 'photos', action: 'show', id: '1' }
assert_generates '/about', controller: 'pages', action: 'about'
">Copy</button>
</div>
<h5 id="assert-recognizes"><a class="anchorlink" href="#assert-recognizes">6.2.2 <code>assert_recognizes</code> 斷言</a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Assertions/RoutingAssertions.html#method-i-assert_recognizes"><code>assert_recognizes</code></a> 是 <code>assert_generates</code> 的倒數。它斷言已識別給定路徑並將其路由到應用程式中的特定位置。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">assert_recognizes</span><span class="p">({</span> <span class="ss">controller: </span><span class="s1">'photos'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'show'</span><span class="p">,</span> <span class="ss">id: </span><span class="s1">'1'</span> <span class="p">},</span> <span class="s1">'/photos/1'</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="assert_recognizes({ controller: 'photos', action: 'show', id: '1' }, '/photos/1')
">Copy</button>
</div>
<p>您可以提供 <code>:method</code> 引數來指定 HTTP 動詞：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">assert_recognizes</span><span class="p">({</span> <span class="ss">controller: </span><span class="s1">'photos'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'create'</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">path: </span><span class="s1">'photos'</span><span class="p">,</span> <span class="ss">method: :post</span> <span class="p">})</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="assert_recognizes({ controller: 'photos', action: 'create' }, { path: 'photos', method: :post })
">Copy</button>
</div>
<h5 id="assert-routing"><a class="anchorlink" href="#assert-routing">6.2.3 <code>assert_routing</code> 斷言</a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActionDispatch/Assertions/RoutingAssertions.html#method-i-assert_routing"><code>assert_routing</code></a> 斷言以兩種方式檢查路由：它測試路徑產生選項，以及選項產生路徑。因此，它結合了 <code>assert_generates</code> 和 <code>assert_recognizes</code> 的功能：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">assert_routing</span><span class="p">({</span> <span class="ss">path: </span><span class="s1">'photos'</span><span class="p">,</span> <span class="ss">method: :post</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">controller: </span><span class="s1">'photos'</span><span class="p">,</span> <span class="ss">action: </span><span class="s1">'create'</span> <span class="p">})</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="assert_routing({ path: 'photos', method: :post }, { controller: 'photos', action: 'create' })
">Copy</button>
</div>


        <h3>回饋</h3>
        <p>
          我們鼓勵您幫助提高本指南的品質。
        </p>
        <p>
          如果您發現任何拼寫錯誤或資訊錯誤，請提供回饋。
          要開始回饋，您可以閱讀我們的 <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">回饋</a> 部分。
        </p>
        <p>
          您還可能會發現不完整的內容或不是最新的內容。
          請務必為 main 新增任何遺漏的文件。假設是
          <a href="https://edgeguides.rubyonrails.org">非穩定版指南(edge guides)</a> 請先驗證問題是否已經在主分支上解決。
          請前往 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南寫作準則</a> 查看寫作風格和慣例。
        </p>
        <p>
          如果由於某種原因您發現要修復的內容但無法自行修補，請您 <a href="https://github.com/rails/rails/issues">提出 issue</a>。
        </p>
        <p>關於 Ruby on Rails 的任何類型的討論歡迎提供任何文件至 <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">rubyonrails-docs 討論區</a>。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品已獲得<a href="https://creativecommons.org/licenses/by-sa/4.0/">知識共享署名-相同方式共享 4.0 國際</a>許可</p>
<p>“Rails”、“Ruby on Rails”和 Rails 標誌是 David Heinemeier Hansson 的商標。 保留所有權利。</p>
    </div>
  </div>
</body>
</html>
