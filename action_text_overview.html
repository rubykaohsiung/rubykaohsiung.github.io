<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Action 文字概覽 — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Action 文字概覽 — Ruby on Rails Guides" />
  <meta name="description" content="不要在 GITHUB 上閱讀此檔案，指南釋出在 https://guides.rubyonrails.org.Action 文字概覽本指南為您提供開始處理所需的一切 豐富的文字內容。閱讀本指南後，您將瞭解： 如何配置Action 文字。 如何處理富文字內容。 如何設定富文字內容和附件的樣式。" />
  <meta property="og:description" content="不要在 GITHUB 上閱讀此檔案，指南釋出在 https://guides.rubyonrails.org.Action 文字概覽本指南為您提供開始處理所需的一切 豐富的文字內容。閱讀本指南後，您將瞭解： 如何配置Action 文字。 如何處理富文字內容。 如何設定富文字內容和附件的樣式。" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v6.1.4</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多訊息請訪問 <a href="https://rubyonrails.org/">rubyonrails.org：</a> </strong>
      <span class="red-button more-info-button">
        更多 Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">部落格</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">論壇</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 上做出貢獻</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南索引</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>從這裡開始</dt>
                  <dd><a href="getting_started.html">Rails 入門</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record 基礎知識</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 驗證</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查詢介面</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 中的佈局和渲染</a></dd>
                  <dd><a href="form_helpers.html">Action View 表單 Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller結束view</a></dd>
                  <dd><a href="routing.html">Rails 從外到內路由</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他元件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心擴充套件</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基礎知識</a></dd>
                  <dd><a href="active_job_basics.html">現役工作基礎</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 結束view</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 結束 view</a></dd>
                  <dd><a href="webpacker.html">打包機</a></dd>
                </div>
                <div class="guides-section">
                  <dt>深層發掘</dt>
                  <dd><a href="i18n.html">Rails 國際化 (I18n) API</a></dd>
                  <dd><a href="testing.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="security.html">保護 Rails 應用程式</a></dd>
                  <dd><a href="debugging_rails_applications.html">除錯 Rails 應用程式</a></dd>
                  <dd><a href="configuring.html">配置 Rails 應用程式</a></dd>
                  <dd><a href="command_line.html">Rails 命令列</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自動載入和重新載入常量</a></dd>
                  <dd><a href="caching_with_rails.html">使用 Rails 快取：結束view</a></dd>
                  <dd><a href="api_app.html">將 Rails 用於僅 API 的應用程式</a></dd>
                </div>
                <div class="guides-section">
                  <dt>延伸導軌</dt>
                  <dd><a href="rails_on_rack.html">機架上的導軌</a></dd>
                  <dd><a href="generators.html">建立和自定義 Rails 生成器和模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>貢獻</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文件指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南指南</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策</dt>
                  <dd><a href="maintenance_policy.html">維修政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>發行說明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</a></dd>
                  <dd><a href="6_1_release_notes.html">版本 6.1 - 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版 - 2019 年 8 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版 - 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版 - 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版 - 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版 - 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版 - 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版 - 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版 - 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版 - 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版 - 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版 - 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版 - 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南索引</option>
              <optgroup label="從這裡開始">
                  <option value="getting_started.html">Rails 入門</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎知識</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record 驗證</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record 查詢介面</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 中的佈局和渲染</option>
                  <option value="form_helpers.html">Action View 表單 Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller結束view</option>
                  <option value="routing.html">Rails 從外到內路由</option>
              </optgroup>
              <optgroup label="其他元件">
                  <option value="active_support_core_extensions.html">Active Support 核心擴充套件</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎知識</option>
                  <option value="active_job_basics.html">現役工作基礎</option>
                  <option value="active_storage_overview.html">Active Storage 結束view</option>
                  <option value="action_cable_overview.html">Action Cable 結束 view</option>
                  <option value="webpacker.html">打包機</option>
              </optgroup>
              <optgroup label="深層發掘">
                  <option value="i18n.html">Rails 國際化 (I18n) API</option>
                  <option value="testing.html">測試 Rails 應用程式</option>
                  <option value="security.html">保護 Rails 應用程式</option>
                  <option value="debugging_rails_applications.html">除錯 Rails 應用程式</option>
                  <option value="configuring.html">配置 Rails 應用程式</option>
                  <option value="command_line.html">Rails 命令列</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="autoloading_and_reloading_constants.html">自動載入和重新載入常量</option>
                  <option value="caching_with_rails.html">使用 Rails 快取：結束view</option>
                  <option value="api_app.html">將 Rails 用於僅 API 的應用程式</option>
              </optgroup>
              <optgroup label="延伸導軌">
                  <option value="rails_on_rack.html">機架上的導軌</option>
                  <option value="generators.html">建立和自定義 Rails 生成器和模板</option>
              </optgroup>
              <optgroup label="貢獻">
                  <option value="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</option>
                  <option value="api_documentation_guidelines.html">API 文件指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南指南</option>
              </optgroup>
              <optgroup label="政策">
                  <option value="maintenance_policy.html">維修政策</option>
              </optgroup>
              <optgroup label="發行說明">
                  <option value="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</option>
                  <option value="6_1_release_notes.html">版本 6.1 - 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版 - 2019 年 8 月</option>
                  <option value="5_2_release_notes.html">5.2 版 - 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版 - 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版 - 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版 - 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版 - 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版 - 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版 - 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版 - 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版 - 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版 - 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版 - 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <p><strong>不要在 GITHUB 上閱讀此檔案，指南釋出在 <a href="https://guides.rubyonrails.org">https://guides.rubyonrails.org</a>.</strong></p><h2>Action 文字概覽</h2><p>本指南為您提供開始處理所需的一切
豐富的文字內容。</p><p>閱讀本指南後，您將瞭解：</p>
<ul>
<li>如何配置Action 文字。</li>
<li>如何處理富文字內容。</li>
<li>如何設定富文字內容和附件的樣式。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#action">什麼是Action 文字？</a></li>
<li><a href="#trix">Trix 與其他富文字編輯器相比</a></li>
<li><a href="#">建立富文字內容</a></li>
<li>
<a href="#">呈現富文字內容</a>

<ul>
<li><a href="#">渲染附件</a></li>
</ul>
</li>
<li><a href="#n-1">避免 N+1 查詢</a></li>
<li><a href="#api">API / 後端開發</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="action"><a class="anchorlink" href="#action">1 什麼是Action 文字？</a></h3><p>Action Text 為 Rails 帶來富文字內容和編輯功能。這包括
<a href="https://trix-editor.org">Trix 編輯器</a> 處理所有格式
到引用的連結到嵌入影象和畫廊的列表。
Trix編輯器生成的富文字內容儲存在自己的
與應用程式中任何現有 Active Record 模型相關聯的 RichText 模型。
任何嵌入的影象（或其他附件）都會使用
Active Storage 並與包含的 RichText 模型相關聯。</p><h3 id="trix"><a class="anchorlink" href="#trix">2 Trix 與其他富文字編輯器相比</a></h3><p>大多數 WYSIWYG 編輯器都是 HTML 的 <code>contenteditable</code> 和 <code>execCommand</code> API 的包裝器，
由 Microsoft 設計，支援在 Internet Explorer 5.5 中實時編輯網頁，
和 <a href="https://blog.whatwg.org/the-road-to-html-5-contenteditable#history">最終逆向工程</a>
並被其他瀏覽器複製。</p><p>因為這些 API 從未被完全指定或記錄，
並且由於 WYSIWYG HTML 編輯器的範圍很大，每個
瀏覽器的實現有它自己的一套錯誤和怪癖，
JavaScript 開發人員需要解決不一致的問題。</p><p>Trix 透過處理 contenteditable 來避免這些不一致
作為 I/O 裝置：當輸入進入編輯器時，Trix 轉換該輸入
對其內部文件模型進行編輯操作，然後重新渲染
將該檔案放回編輯器中。這使 Trix 可以完全控制什麼
每次擊鍵後都會發生，完全不需要使用 execCommand。</p><p>＃＃ 安裝</p><p>執行<code>bin/rails action_text:install</code> 來新增 Yarn 包並複製必要的遷移。此外，您需要為嵌入的影象和其他附件設定Active Storage。請參閱 <a href="active_storage_overview.html">Active Storage 概述</a> 指南。</p><p>注意：ActionText 使用與 <code>action_text_rich_texts</code> 表的多型關係，以便它可以與具有富文字屬性的所有模型共享。如果具有 ActionText 內容的模型使用 UUID 值作為識別符號，則所有使用 ActionText 屬性的模型都需要使用 UUID 值作為其唯一識別符號。為ActionText 生成的遷移也需要更新，以便為 <code>:record</code> <code>references</code> 行指定 <code>type: :uuid</code>。</p><p>安裝完成後，Rails 應用程式應該有以下變化：</p>
<ol>
<li>
<p>在你的 JavaScript 入口點中應該需要 <code>trix</code> 和 <code>@rails/actiontext</code>。</p>
<div class="code_container">
<pre><code class="highlight js"><span class="c1">// 應用程式.js</span>
<span class="nx">匯入</span><span class="err">“</span><span class="nx">trix</span><span class="err">”</span>
<span class="nx">匯入</span><span class="err">“</span><span class="p">@</span><span class="nd">rails</span><span class="sr">/actiontext</span><span class="err">”
</span><span class="s2">``</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="// 應用程式.js
匯入“trix”
匯入“@rails/actiontext”
``
">Copy</button>
</div>
</li>
</ol>

<ol>
<li>
<code>trix</code> 樣式表將與 Action 文字樣式一起包含在您的 <code>application.css</code> 檔案中。</li>
</ol>
<h3 id=""><a class="anchorlink" href="#">3 建立富文字內容</a></h3><p>向現有模型新增富文字欄位：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># app/models/message.rb</span>
<span class="k">class</span> <span class="nc">Message</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_rich_text</span> <span class="ss">:content</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# app/models/message.rb
class Message &lt; ApplicationRecord
  has_rich_text :content
end
">Copy</button>
</div>
<p>或在使用以下方法建立新模型時新增富文字欄位：</p><div class="code_container">
<pre><code class="highlight plaintext">bin/rails generate model Message content:rich_text
</code></pre>
<button class="clipboard-button" data-clipboard-text="bin/rails generate model Message content:rich_text
">Copy</button>
</div>
<p><strong>注意：</strong> 您不需要在您的“訊息”表中新增“內容”欄位。</p><p>然後使用 [<code>rich_text_area</code>] 在模型的表單中引用此欄位：</p><div class="code_container">
<pre><code class="highlight erb"><span class="c">&lt;%# app/views/messages/_form.html.erb %&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="n">message</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"field"</span><span class="nt">&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:content</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">rich_text_area</span> <span class="ss">:content</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%# app/views/messages/_form.html.erb %&gt;
&lt;%= form_with model: message do |form| %&gt;
  &lt;div class="field"&gt;
    &lt;%= form.label :content %&gt;
    &lt;%= form.rich_text_area :content %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
'>Copy</button>
</div>
<p>最後，在頁面上顯示經過消毒的富文字：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="vi">@message</span><span class="p">.</span><span class="nf">content</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= @message.content %&gt;
">Copy</button>
</div>
<p>要接受富文字內容，您所要做的就是允許引用屬性：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MessagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">message</span> <span class="o">=</span> <span class="no">Message</span><span class="p">.</span><span class="nf">create!</span> <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:message</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">message</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MessagesController &lt; ApplicationController
  def create
    message = Message.create! params.require(:message).permit(:title, :content)
    redirect_to message
  end
end
">Copy</button>
</div>
<p>[<code>rich_text_area</code>]：<a href="https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-rich_text_area">https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-rich_text_area</a></p><h3 id=""><a class="anchorlink" href="#">4 呈現富文字內容</a></h3><p>Action 文字將代表您清理和呈現豐富的內容。</p><p>預設情況下，Action 文字編輯器和內容採用 Trix 預設設定。</p><p>如果要更改這些預設值，請刪除 <code>// require "actiontext.scss"</code>
從你的<code>application.scss</code>行省略[內容
檔案]（<a href="https://raw.githubusercontent.com/basecamp/trix/master/dist/trix.css%EF%BC%89%E3%80%82">https://raw.githubusercontent.com/basecamp/trix/master/dist/trix.css）。</a></p><p>預設情況下，Action Text 會將富文字內容呈現到一個元素中
宣告 <code>.trix-content</code> 類：</p><div class="code_container">
<pre><code class="highlight erb"><span class="c">&lt;%# app/views/layouts/action_text/contents/_content.html.erb %&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"trix-content"</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;%# app/views/layouts/action_text/contents/_content.html.erb %&gt;
&lt;div class="trix-content"&gt;
  &lt;%= yield %&gt;
&lt;/div&gt;
'>Copy</button>
</div>
<p>如果您想使用自己的佈局更改富文本週圍的 HTML，
宣告你自己的<code>app/views/layouts/action_text/contents/_content.html.erb</code>
模板並呼叫 <code>yield</code> 代替內容。</p><p>您還可以設定用於嵌入影象和其他附件的 HTML 樣式
（稱為斑點）。安裝時，Action 文字將複製到
<code>app/views/active_storage/blobs/_blob.html.erb</code>，你可以專門研究它。</p><h4 id=""><a class="anchorlink" href="#">4.1 渲染附件</a></h4><p>除了透過Active Storage 上傳的附件，Action 文字還可以
嵌入任何可以由 <a href="https://github.com/rails/globalid#signed-global-ids">Signed
GlobalID</a>。</p><p>Action 文字透過解析呈現嵌入的 <code>&lt;action-text-attachment&gt;</code> 元素
他們的 <code>sgid</code> 屬性變成了一個例項。一旦解決，該例項就被傳遞
沿著
<a href="https://edgeapi.rubyonrails.org/classes/ActionView/Helpers/RenderingHelper.html#method-i-render"><code>render</code></a>。
生成的 HTML 被嵌入為 <code>&lt;action-text-attachment&gt;</code> 的後代
元素。</p><p>例如，考慮一個“使用者”模型：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># app/models/user.rb</span>
<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one_attached</span> <span class="ss">:avatar</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">user</span><span class="p">.</span><span class="nf">to_global_id</span><span class="p">.</span><span class="nf">to_s</span> <span class="c1">#=&gt; gid://MyRailsApp/User/1</span>
<span class="n">user</span><span class="p">.</span><span class="nf">to_signed_global_id</span><span class="p">.</span><span class="nf">to_s</span> <span class="c1">#=&gt; BAh7CEkiCG…</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# app/models/user.rb
class User &lt; ApplicationRecord
  has_one_attached :avatar
end

user = User.find(1)
user.to_global_id.to_s #=&gt; gid://MyRailsApp/User/1
user.to_signed_global_id.to_s #=&gt; BAh7CEkiCG…
">Copy</button>
</div>
<p>接下來，考慮一些嵌入 <code>&lt;action-text-attachment&gt;</code> 的富文字內容
引用 <code>User</code> 例項的簽名 GlobalID 的元素：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;p&gt;</span>Hello, <span class="nt">&lt;action-text-attachment</span> <span class="na">sgid=</span><span class="s">"BAh7CEkiCG…"</span><span class="nt">&gt;&lt;/action-text-attachment&gt;</span>.<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;p&gt;Hello, &lt;action-text-attachment sgid="BAh7CEkiCG…"&gt;&lt;/action-text-attachment&gt;.&lt;/p&gt;
'>Copy</button>
</div>
<p>Action 文字解析使用“BAh7CEkiCG...”字串解析<code>User</code>
例項。接下來，考慮應用程式的 <code>users/user</code> 部分：</p><div class="code_container">
<pre><code class="highlight erb"><span class="c">&lt;%# app/views/users/_user.html.erb %&gt;</span>
<span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">user</span><span class="p">.</span><span class="nf">avatar</span> <span class="cp">%&gt;</span> <span class="cp">&lt;%=</span> <span class="n">user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%# app/views/users/_user.html.erb %&gt;
&lt;span&gt;&lt;%= image_tag user.avatar %&gt; &lt;%= user.name %&gt;&lt;/span&gt;
">Copy</button>
</div>
<p>由 Action Text 呈現的結果 HTML 如下所示：</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;p&gt;</span>Hello, <span class="nt">&lt;action-text-attachment</span> <span class="na">sgid=</span><span class="s">"BAh7CEkiCG…"</span><span class="nt">&gt;&lt;span&gt;&lt;img</span> <span class="na">src=</span><span class="s">"..."</span><span class="nt">&gt;</span> Jane Doe<span class="nt">&lt;/span&gt;&lt;/action-text-attachment&gt;</span>.<span class="nt">&lt;/p&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;p&gt;Hello, &lt;action-text-attachment sgid="BAh7CEkiCG…"&gt;&lt;span&gt;&lt;img src="..."&gt; Jane Doe&lt;/span&gt;&lt;/action-text-attachment&gt;.&lt;/p&gt;
'>Copy</button>
</div>
<p>要渲染不同的部分，請定義<code>User#to_attachable_partial_path</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="k">def</span> <span class="nf">to_attachable_partial_path</span>
    <span class="s2">"users/attachable"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User &lt; ApplicationRecord
  def to_attachable_partial_path
    "users/attachable"
  end
end
'>Copy</button>
</div>
<p>然後宣告部分。 <code>User</code> 例項將作為 <code>user</code> 可用
區域性區域性變數：</p><div class="code_container">
<pre><code class="highlight erb"><span class="c">&lt;%# app/views/users/_attachable.html.erb %&gt;</span>
<span class="nt">&lt;span&gt;</span><span class="cp">&lt;%=</span> <span class="n">image_tag</span> <span class="n">user</span><span class="p">.</span><span class="nf">avatar</span> <span class="cp">%&gt;</span> <span class="cp">&lt;%=</span> <span class="n">user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/span&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%# app/views/users/_attachable.html.erb %&gt;
&lt;span&gt;&lt;%= image_tag user.avatar %&gt; &lt;%= user.name %&gt;&lt;/span&gt;
">Copy</button>
</div>
<p>要與Action Text <code>&lt;action-text-attachment&gt;</code> 元素渲染整合，
班級必須：</p>
<ul>
<li>包含 <code>ActionText::Attachable</code> 模組</li>
<li>實現 <code>#to_sgid(**options)</code>（透過 [<code>GlobalID::Identification</code> 關注點][global-id] 提供）
*（可選）宣告<code>#to_attachable_partial_path</code>
</li>
</ul>
<p>預設情況下，所有<code>ActiveRecord::Base</code> 後代都混入
[<code>GlobalID::Identification</code> 關注點][global-id]，因此
<code>ActionText::Attachable</code> 相容。</p><p>[全域性 ID]：<a href="https://github.com/rails/globalid#usage">https://github.com/rails/globalid#usage</a></p><h3 id="n-1"><a class="anchorlink" href="#n-1">5 避免 N+1 查詢</a></h3><p>如果您希望預載入依賴的 <code>ActionText::RichText</code> 模型，假設您的富文字欄位名為 <code>content</code>，您可以使用命名範圍：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Message</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">with_rich_text_content</span> <span class="c1"># Preload the body without attachments.</span>
<span class="no">Message</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">with_rich_text_content_and_embeds</span> <span class="c1"># Preload both body and attachments.</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Message.all.with_rich_text_content # Preload the body without attachments.
Message.all.with_rich_text_content_and_embeds # Preload both body and attachments.
">Copy</button>
</div>
<h3 id="api"><a class="anchorlink" href="#api">6 API / 後端開發</a></h3>
<ol>
<li>
<p>後端 API（例如，使用 JSON）需要一個單獨的端點來上傳檔案，該端點建立一個 <code>ActiveStorage::Blob</code> 並返回其 <code>attachable_sgid</code>：</p>
<div class="code_container">
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="nl">"attachable_sgid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BAh7CEkiCG..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">``</span><span class="w">
</span></code></pre>
<button class="clipboard-button" data-clipboard-text='{
  "attachable_sgid": "BAh7CEkiCG..."
}
``
'>Copy</button>
</div>
</li>
</ol>

<ol>
<li>
<p>取那個 <code>attachable_sgid</code> 並讓你的前端使用 <code>&lt;action-text-attachment&gt;</code> 標籤將它插入到富文字內容中：</p>
<div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;action-text-attachment</span> <span class="na">sgid=</span><span class="s">"BAh7CEkiCG…"</span><span class="nt">&gt;&lt;/action-text-attachment&gt;</span>
``
</code></pre>
<button class="clipboard-button" data-clipboard-text='&lt;action-text-attachment sgid="BAh7CEkiCG…"&gt;&lt;/action-text-attachment&gt;
``
'>Copy</button>
</div>
</li>
</ol>
<p>這是基於 Basecamp，所以如果你仍然找不到你要找的東西，檢查這個 [Basecamp Doc](<a href="https://github.com/basecamp/bc3-api/blob/master/sections/rich_text.md">https://github.com/basecamp/bc3-api/blob/master/sections/rich_text.md</a> ）。</p>

        <h3>反饋</h3>
        <p>
          我們鼓勵您幫助提高本指南的質量。
        </p>
        <p>
          如果您發現任何拼寫錯誤或事實錯誤，請貢獻。
          首先，您可以閱讀我們的 <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">文檔貢獻</a> 部分。
        </p>
        <p>
          您還可能會發現不完整的內容或不是最新的內容。
          請務必為 main 添加任何缺失的文檔。確保檢查
          <a href="https://edgeguides.rubyonrails.org">Edge Guides</a> 先驗證
          如果問題已經在主分支上解決。
          檢查 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南指南</a>
          風格和慣例。
        </p>
        <p>
          如果由於某種原因您發現需要修復但無法自行修補的內容，請
          <a href="https://github.com/rails/rails/issues">open an issue</a>。
        </p>
        <p>最後但並非最不重要的是，關於 Ruby on Rails 的任何討論
          <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">rubyonrails-docs 郵件列表</a> 上的文檔非常受歡迎。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品已獲得<a href="https://creativecommons.org/licenses/by-sa/4.0/">知識共享署名-相同方式共享 4.0 國際</a>許可</p>
<p>“Rails”、“Ruby on Rails”和 Rails 標誌是 David Heinemeier Hansson 的商標。 保留所有權利。</p>
    </div>
  </div>
</body>
</html>
