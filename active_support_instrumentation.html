<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Active Support 儀表 — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Active Support 儀表 — Ruby on Rails Guides" />
  <meta name="description" content="Active Support 儀表Active Support 是核心 Rails 的一部分，它提供 Ruby 語言擴充套件、實用程式和其他東西。它包含的其中一件事是一個檢測 API，可以在應用程式內部使用它來測量發生在 Ruby 程式碼中的某些 actions，例如在 Rails 應用程式或框架本身內部。然而，它不僅限於 Rails。如果需要，它可以在其他 Ruby 指令碼中獨立使用。在本指南中，您將學習如何使用 Active Support 內部的檢測 API 來測量 Rails 和其他 Ruby 程式碼內部的事件。閱讀本指南後，您將瞭解： 什麼儀器可以提供。 如何向掛載機制新增訂閱者。 用於檢測的 Rails 框架內的掛載機制。 如何構建自定義檢測實現。" />
  <meta property="og:description" content="Active Support 儀表Active Support 是核心 Rails 的一部分，它提供 Ruby 語言擴充套件、實用程式和其他東西。它包含的其中一件事是一個檢測 API，可以在應用程式內部使用它來測量發生在 Ruby 程式碼中的某些 actions，例如在 Rails 應用程式或框架本身內部。然而，它不僅限於 Rails。如果需要，它可以在其他 Ruby 指令碼中獨立使用。在本指南中，您將學習如何使用 Active Support 內部的檢測 API 來測量 Rails 和其他 Ruby 程式碼內部的事件。閱讀本指南後，您將瞭解： 什麼儀器可以提供。 如何向掛載機制新增訂閱者。 用於檢測的 Rails 框架內的掛載機制。 如何構建自定義檢測實現。" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v7.0.0</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多資訊請前往 <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多在 Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">部落格</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">論壇</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 上做出貢獻</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">手冊目錄</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>從這裡開始</dt>
                  <dd><a href="getting_started.html">Rails 入門</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record 遷移 (Migrations)</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 驗證 (Validations)</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record 回呼 (Callbacks)</a></dd>
                  <dd><a href="association_basics.html">Active Record 關聯 (Associations)</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查詢介面</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 中的版面配置(Layouts)和算繪(Rendering)</a></dd>
                  <dd><a href="form_helpers.html">Action View 表單 Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller 概述</a></dd>
                  <dd><a href="routing.html">Rails 從外到內路由</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他元件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心擴充套件</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基礎知識</a></dd>
                  <dd><a href="active_job_basics.html">Active Job 基礎</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 概述</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 概述</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>深入研究</dt>
                  <dd><a href="i18n.html">Rails 國際化 (I18n) API</a></dd>
                  <dd><a href="testing.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="security.html">保護 Rails 應用程式</a></dd>
                  <dd><a href="debugging_rails_applications.html">除錯 Rails 應用程式</a></dd>
                  <dd><a href="configuring.html">設定 Rails 應用程式</a></dd>
                  <dd><a href="command_line.html">Rails 命令列</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自動載入和重新載入常量</a></dd>
                  <dd><a href="caching_with_rails.html">使用 Rails 快取</a></dd>
                  <dd><a href="api_app.html">將 Rails 用於僅 API 的應用程式</a></dd>
                </div>
                <div class="guides-section">
                  <dt>擴充 rails</dt>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">建立和自定義 Rails 產生器和模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>貢獻</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文件指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南指南</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策</dt>
                  <dd><a href="maintenance_policy.html">維修政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>發行說明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</a></dd>
                  <dd><a href="6_1_release_notes.html">6.1 版 - 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版 - 2019 年 8 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版 - 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版 - 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版 - 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版 - 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版 - 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版 - 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版 - 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版 - 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版 - 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版 - 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版 - 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">手冊目錄</option>
              <optgroup label="從這裡開始">
                  <option value="getting_started.html">Rails 入門</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="active_record_migrations.html">Active Record 遷移 (Migrations)</option>
                  <option value="active_record_validations.html">Active Record 驗證 (Validations)</option>
                  <option value="active_record_callbacks.html">Active Record 回呼 (Callbacks)</option>
                  <option value="association_basics.html">Active Record 關聯 (Associations)</option>
                  <option value="active_record_querying.html">Active Record 查詢介面</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 中的版面配置(Layouts)和算繪(Rendering)</option>
                  <option value="form_helpers.html">Action View 表單 Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller 概述</option>
                  <option value="routing.html">Rails 從外到內路由</option>
              </optgroup>
              <optgroup label="其他元件">
                  <option value="active_support_core_extensions.html">Active Support 核心擴充套件</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎知識</option>
                  <option value="active_job_basics.html">Active Job 基礎</option>
                  <option value="active_storage_overview.html">Active Storage 概述</option>
                  <option value="action_cable_overview.html">Action Cable 概述</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="深入研究">
                  <option value="i18n.html">Rails 國際化 (I18n) API</option>
                  <option value="testing.html">測試 Rails 應用程式</option>
                  <option value="security.html">保護 Rails 應用程式</option>
                  <option value="debugging_rails_applications.html">除錯 Rails 應用程式</option>
                  <option value="configuring.html">設定 Rails 應用程式</option>
                  <option value="command_line.html">Rails 命令列</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="autoloading_and_reloading_constants.html">自動載入和重新載入常量</option>
                  <option value="caching_with_rails.html">使用 Rails 快取</option>
                  <option value="api_app.html">將 Rails 用於僅 API 的應用程式</option>
              </optgroup>
              <optgroup label="擴充 rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">建立和自定義 Rails 產生器和模板</option>
              </optgroup>
              <optgroup label="貢獻">
                  <option value="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</option>
                  <option value="api_documentation_guidelines.html">API 文件指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南指南</option>
              </optgroup>
              <optgroup label="政策">
                  <option value="maintenance_policy.html">維修政策</option>
              </optgroup>
              <optgroup label="發行說明">
                  <option value="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</option>
                  <option value="6_1_release_notes.html">6.1 版 - 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版 - 2019 年 8 月</option>
                  <option value="5_2_release_notes.html">5.2 版 - 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版 - 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版 - 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版 - 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版 - 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版 - 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版 - 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版 - 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版 - 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版 - 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版 - 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Support 儀表</h2><p>Active Support 是核心 Rails 的一部分，它提供 Ruby 語言擴充套件、實用程式和其他東西。它包含的其中一件事是一個檢測 API，可以在應用程式內部使用它來測量發生在 Ruby 程式碼中的某些 actions，例如在 Rails 應用程式或框架本身內部。然而，它不僅限於 Rails。如果需要，它可以在其他 Ruby 指令碼中獨立使用。</p><p>在本指南中，您將學習如何使用 Active Support 內部的檢測 API 來測量 Rails 和其他 Ruby 程式碼內部的事件。</p><p>閱讀本指南後，您將瞭解：</p>
<ul>
<li>什麼儀器可以提供。</li>
<li>如何向掛載機制新增訂閱者。</li>
<li>用於檢測的 Rails 框架內的掛載機制。</li>
<li>如何構建自定義檢測實現。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#">儀器簡介</a></li>
<li><a href="#">訂閱事件</a></li>
<li>
<a href="#rails">Rails 框架掛載機制</a>

<ul>
<li><a href="#action-controller">Action Controller</a></li>
<li><a href="#action">Action 排程</a></li>
<li><a href="#action-view">Action View</a></li>
<li><a href="#active-record">Active Record</a></li>
<li><a href="#action-mailer">Action Mailer</a></li>
<li><a href="#active-support">Active Support</a></li>
<li><a href="#active-job">Active Job</a></li>
<li><a href="#action-cable">Action Cable</a></li>
<li><a href="#active-storage">Active Storage</a></li>
<li><a href="#rails">Rails</a></li>
<li><a href="#">導軌</a></li>
</ul>
</li>
<li><a href="#">例外</a></li>
<li><a href="#">建立自定義事件</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id=""><a class="anchorlink" href="#">1 儀器簡介</a></h3><p>Active Support 提供的檢測 API 允許開發人員提供其他開發人員可以掛鉤的掛載機制。 <a href="#rails-framework-hooks">Rails 框架</a> 中有幾個。使用此 API，開發人員可以選擇在他們的應用程式或另一段 Ruby 程式碼中發生某些事件時收到通知。</p><p>例如，在 Active Record 中提供了一個掛載機制，每次 Active Record 在資料庫上使用 SQL 查詢時都會呼叫該掛載機制。這個掛載機制可以被<strong>訂閱</strong>，並用於跟蹤某個 action 期間的查詢數量。圍繞 controller 的 action 的處理還有另一個掛載機制。例如，這可以用於跟蹤特定 action 花費了多長時間。</p><p>您甚至可以在您的應用程式中<a href="#creating-custom-events">建立您自己的事件</a>，您可以稍後訂閱。</p><h3 id=""><a class="anchorlink" href="#">2 訂閱事件</a></h3><p>訂閱事件很容易。將 <code>ActiveSupport::Notifications.subscribe</code> 與塊一起使用
收聽任何通知。</p><p>該塊接收以下引數：</p>
<ul>
<li>事件名稱</li>
<li>開始的時間</li>
<li>完成時間</li>
<li>觸發事件的檢測器的唯一 ID</li>
<li>有效載荷（在以後的部分中描述）</li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="s2">"process_action.action_controller"</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">started</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">data</span><span class="o">|</span>
  <span class="c1"># your own custom stuff</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> Received! (started: </span><span class="si">#{</span><span class="n">started</span><span class="si">}</span><span class="s2">, finished: </span><span class="si">#{</span><span class="n">finished</span><span class="si">}</span><span class="s2">)"</span> <span class="c1"># process_action.action_controller Received (started: 2019-05-05 13:43:57 -0800, finished: 2019-05-05 13:43:58 -0800)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.subscribe "process_action.action_controller" do |name, started, finished, unique_id, data|
  # your own custom stuff
  Rails.logger.info "#{name} Received! (started: #{started}, finished: #{finished})" # process_action.action_controller Received (started: 2019-05-05 13:43:57 -0800, finished: 2019-05-05 13:43:58 -0800)
end
'>Copy</button>
</div>
<p>如果您擔心 <code>started</code> 和 <code>finished</code> 計算精確經過時間的準確性，請使用 <code>ActiveSupport::Notifications.monotonic_subscribe</code>。給定的塊將接收與上述相同的引數，但 <code>started</code> 和 <code>finished</code> 將具有 values 具有準確的單調時間而不是掛鐘時間。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">monotonic_subscribe</span> <span class="s2">"process_action.action_controller"</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">started</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">data</span><span class="o">|</span>
  <span class="c1"># your own custom stuff</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> Received! (started: </span><span class="si">#{</span><span class="n">started</span><span class="si">}</span><span class="s2">, finished: </span><span class="si">#{</span><span class="n">finished</span><span class="si">}</span><span class="s2">)"</span> <span class="c1"># process_action.action_controller Received (started: 1560978.425334, finished: 1560979.429234)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.monotonic_subscribe "process_action.action_controller" do |name, started, finished, unique_id, data|
  # your own custom stuff
  Rails.logger.info "#{name} Received! (started: #{started}, finished: #{finished})" # process_action.action_controller Received (started: 1560978.425334, finished: 1560979.429234)
end
'>Copy</button>
</div>
<p>每次定義所有這些塊引數可能很乏味。您可以輕鬆建立 <code>ActiveSupport::Notifications::Event</code>
從像這樣的塊引數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="s2">"process_action.action_controller"</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
  <span class="n">event</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="o">::</span><span class="no">Event</span><span class="p">.</span><span class="nf">new</span> <span class="o">*</span><span class="n">args</span>

  <span class="n">event</span><span class="p">.</span><span class="nf">name</span>      <span class="c1"># =&gt; "process_action.action_controller"</span>
  <span class="n">event</span><span class="p">.</span><span class="nf">duration</span>  <span class="c1"># =&gt; 10 (in milliseconds)</span>
  <span class="n">event</span><span class="p">.</span><span class="nf">payload</span>   <span class="c1"># =&gt; {:extra=&gt;information}</span>

  <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"</span><span class="si">#{</span><span class="n">event</span><span class="si">}</span><span class="s2"> Received!"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.subscribe "process_action.action_controller" do |*args|
  event = ActiveSupport::Notifications::Event.new *args

  event.name      # =&gt; "process_action.action_controller"
  event.duration  # =&gt; 10 (in milliseconds)
  event.payload   # =&gt; {:extra=&gt;information}

  Rails.logger.info "#{event} Received!"
end
'>Copy</button>
</div>
<p>你也可以傳遞一個只接受一個引數的塊，它會接收一個事件物件：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="s2">"process_action.action_controller"</span> <span class="k">do</span> <span class="o">|</span><span class="n">event</span><span class="o">|</span>
  <span class="n">event</span><span class="p">.</span><span class="nf">name</span>      <span class="c1"># =&gt; "process_action.action_controller"</span>
  <span class="n">event</span><span class="p">.</span><span class="nf">duration</span>  <span class="c1"># =&gt; 10 (in milliseconds)</span>
  <span class="n">event</span><span class="p">.</span><span class="nf">payload</span>   <span class="c1"># =&gt; {:extra=&gt;information}</span>

  <span class="no">Rails</span><span class="p">.</span><span class="nf">logger</span><span class="p">.</span><span class="nf">info</span> <span class="s2">"</span><span class="si">#{</span><span class="n">event</span><span class="si">}</span><span class="s2"> Received!"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.subscribe "process_action.action_controller" do |event|
  event.name      # =&gt; "process_action.action_controller"
  event.duration  # =&gt; 10 (in milliseconds)
  event.payload   # =&gt; {:extra=&gt;information}

  Rails.logger.info "#{event} Received!"
end
'>Copy</button>
</div>
<p>大多數時候你只關心資料本身。這是獲取資料的快捷方式。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="s2">"process_action.action_controller"</span> <span class="k">do</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="n">data</span> <span class="c1"># { extra: :information }</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.subscribe "process_action.action_controller" do |*args|
  data = args.extract_options!
  data # { extra: :information }
end
'>Copy</button>
</div>
<p>您還可以訂閱與正則表示式匹配的事件。這使您能夠訂閱
一次多個事件。以下是從 <code>ActionController</code> 訂閱所有內容的方法。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="sr">/action_controller/</span><span class="err"> d</span><span class="sr">o</span> <span class="o">|*</span><span class="n">args</span><span class="o">|</span>
  <span class="c1"># inspect all ActionController events</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport::Notifications.subscribe /action_controller/ do |*args|
  # inspect all ActionController events
end
">Copy</button>
</div>
<h3 id="rails"><a class="anchorlink" href="#rails">3 Rails 框架掛載機制</a></h3><p>在 Ruby on Rails 框架中，為常見事件提供了許多掛載機制。下面詳細介紹了這些。</p><h4 id="action-controller"><a class="anchorlink" href="#action-controller">3.1 Action Controller</a></h4><h5 id="write-fragment-action-controller"><a class="anchorlink" href="#write-fragment-action-controller">3.1.1 write_fragment.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>完整的key</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s1">'posts/1-dashboard-view'</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  key: 'posts/1-dashboard-view'
}
">Copy</button>
</div>
<h5 id="read-fragment-action-controller"><a class="anchorlink" href="#read-fragment-action-controller">3.1.2 read_fragment.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>完整的key</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s1">'posts/1-dashboard-view'</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  key: 'posts/1-dashboard-view'
}
">Copy</button>
</div>
<h5 id="expire-fragment-action-controller"><a class="anchorlink" href="#expire-fragment-action-controller">3.1.3 expire_fragment.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>完整的key</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s1">'posts/1-dashboard-view'</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  key: 'posts/1-dashboard-view'
}
">Copy</button>
</div>
<h5 id="actioncontroller"><a class="anchorlink" href="#actioncontroller">3.1.4 存在<em>片段？.action</em>controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>完整的key</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s1">'posts/1-dashboard-view'</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  key: 'posts/1-dashboard-view'
}
">Copy</button>
</div>
<h5 id="write-page-action-controller"><a class="anchorlink" href="#write-page-action-controller">3.1.5 write_page.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:path</code></td>
<td>完整路徑</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">path: </span><span class="s1">'/users/1'</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  path: '/users/1'
}
">Copy</button>
</div>
<h5 id="expire-page-action-controller"><a class="anchorlink" href="#expire-page-action-controller">3.1.6 expire_page.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:path</code></td>
<td>完整路徑</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">path: </span><span class="s1">'/users/1'</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{
  path: '/users/1'
}
">Copy</button>
</div>
<h5 id="start-processing-action-controller"><a class="anchorlink" href="#start-processing-action-controller">3.1.7 start_processing.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:controller</code></td>
<td>controller 名稱</td>
</tr>
<tr>
<td><code>:action</code></td>
<td>action</td>
</tr>
<tr>
<td><code>:params</code></td>
<td>沒有任何過濾引數的請求引數的雜湊值</td>
</tr>
<tr>
<td><code>:headers</code></td>
<td>請求頭</td>
</tr>
<tr>
<td><code>:format</code></td>
<td>html/js/json/xml 等</td>
</tr>
<tr>
<td><code>:method</code></td>
<td>HTTP 請求動詞</td>
</tr>
<tr>
<td><code>:path</code></td>
<td>請求路徑</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">controller: </span><span class="s2">"PostsController"</span><span class="p">,</span>
  <span class="ss">action: </span><span class="s2">"new"</span><span class="p">,</span>
  <span class="ss">params: </span><span class="p">{</span> <span class="s2">"action"</span> <span class="o">=&gt;</span> <span class="s2">"new"</span><span class="p">,</span> <span class="s2">"controller"</span> <span class="o">=&gt;</span> <span class="s2">"posts"</span> <span class="p">},</span>
  <span class="ss">headers: </span><span class="c1">#&lt;ActionDispatch::Http::Headers:0x0055a67a519b88&gt;,</span>
  <span class="ss">format: :html</span><span class="p">,</span>
  <span class="ss">method: </span><span class="s2">"GET"</span><span class="p">,</span>
  <span class="ss">path: </span><span class="s2">"/posts/new"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  controller: "PostsController",
  action: "new",
  params: { "action" =&gt; "new", "controller" =&gt; "posts" },
  headers: #&lt;ActionDispatch::Http::Headers:0x0055a67a519b88&gt;,
  format: :html,
  method: "GET",
  path: "/posts/new"
}
'>Copy</button>
</div>
<h5 id="action-actioncontroller"><a class="anchorlink" href="#action-actioncontroller">3.1.8 程序<em>action.action</em>controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:controller</code></td>
<td>controller 名稱</td>
</tr>
<tr>
<td><code>:action</code></td>
<td>action</td>
</tr>
<tr>
<td><code>:params</code></td>
<td>沒有任何過濾引數的請求引數的雜湊值</td>
</tr>
<tr>
<td><code>:headers</code></td>
<td>請求頭</td>
</tr>
<tr>
<td><code>:format</code></td>
<td>html/js/json/xml 等</td>
</tr>
<tr>
<td><code>:method</code></td>
<td>HTTP 請求動詞</td>
</tr>
<tr>
<td><code>:path</code></td>
<td>請求路徑</td>
</tr>
<tr>
<td><code>:request</code></td>
<td><code>ActionDispatch::Request</code></td>
</tr>
<tr>
<td><code>:response</code></td>
<td><code>ActionDispatch::Response</code></td>
</tr>
<tr>
<td><code>:status</code></td>
<td>HTTP 狀態碼</td>
</tr>
<tr>
<td><code>:view_runtime</code></td>
<td>view 中花費的金額（以毫秒為單位）</td>
</tr>
<tr>
<td><code>:db_runtime</code></td>
<td>以毫秒為單位執行資料庫查詢所花費的金額</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">controller: </span><span class="s2">"PostsController"</span><span class="p">,</span>
  <span class="ss">action: </span><span class="s2">"index"</span><span class="p">,</span>
  <span class="ss">params: </span><span class="p">{</span><span class="s2">"action"</span> <span class="o">=&gt;</span> <span class="s2">"index"</span><span class="p">,</span> <span class="s2">"controller"</span> <span class="o">=&gt;</span> <span class="s2">"posts"</span><span class="p">},</span>
  <span class="ss">headers: </span><span class="c1">#&lt;ActionDispatch::Http::Headers:0x0055a67a519b88&gt;,</span>
  <span class="ss">format: :html</span><span class="p">,</span>
  <span class="ss">method: </span><span class="s2">"GET"</span><span class="p">,</span>
  <span class="ss">path: </span><span class="s2">"/posts"</span><span class="p">,</span>
  <span class="ss">request: </span><span class="c1">#&lt;ActionDispatch::Request:0x00007ff1cb9bd7b8&gt;,</span>
  <span class="ss">response: </span><span class="c1">#&lt;ActionDispatch::Response:0x00007f8521841ec8&gt;,</span>
  <span class="ss">status: </span><span class="mi">200</span><span class="p">,</span>
  <span class="ss">view_runtime: </span><span class="mf">46.848</span><span class="p">,</span>
  <span class="ss">db_runtime: </span><span class="mf">0.157</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  controller: "PostsController",
  action: "index",
  params: {"action" =&gt; "index", "controller" =&gt; "posts"},
  headers: #&lt;ActionDispatch::Http::Headers:0x0055a67a519b88&gt;,
  format: :html,
  method: "GET",
  path: "/posts",
  request: #&lt;ActionDispatch::Request:0x00007ff1cb9bd7b8&gt;,
  response: #&lt;ActionDispatch::Response:0x00007f8521841ec8&gt;,
  status: 200,
  view_runtime: 46.848,
  db_runtime: 0.157
}
'>Copy</button>
</div>
<h5 id="send-file-action-controller"><a class="anchorlink" href="#send-file-action-controller">3.1.9 send_file.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:path</code></td>
<td>檔案的完整路徑</td>
</tr>
</tbody>
</table>
<p>資訊。呼叫者可以新增額外的 keys。</p><h5 id="send-data-action-controller"><a class="anchorlink" href="#send-data-action-controller">3.1.10 send_data.action_controller</a></h5><p><code>ActionController</code> 不會向有效負載新增任何特定資訊。所有選項都傳遞給有效負載。</p><h5 id="redirect-to-action-controller"><a class="anchorlink" href="#redirect-to-action-controller">3.1.11 redirect_to.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:status</code></td>
<td>HTTP 回應程式碼</td>
</tr>
<tr>
<td><code>:location</code></td>
<td>重定向到的 URL</td>
</tr>
<tr>
<td><code>:request</code></td>
<td><code>ActionDispatch::Request</code></td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">status: </span><span class="mi">302</span><span class="p">,</span>
  <span class="ss">location: </span><span class="s2">"http://localhost:3000/posts/new"</span><span class="p">,</span>
  <span class="ss">request: </span><span class="c1">#&lt;ActionDispatch::Request:0x00007ff1cb9bd7b8&gt;</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  status: 302,
  location: "http://localhost:3000/posts/new",
  request: #&lt;ActionDispatch::Request:0x00007ff1cb9bd7b8&gt;
}
'>Copy</button>
</div>
<h5 id="callback-actioncontroller"><a class="anchorlink" href="#callback-actioncontroller">3.1.12 停止<em>callback.action</em>controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:filter</code></td>
<td>停止 action 的過濾器</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">filter: </span><span class="s2">":halting_filter"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  filter: ":halting_filter"
}
'>Copy</button>
</div>
<h5 id="unpermitted-pa-rameters-action-controller"><a class="anchorlink" href="#unpermitted-pa-rameters-action-controller">3.1.13 unpermitted_pa​​rameters.action_controller</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:keys</code></td>
<td>未經許可的keys</td>
</tr>
<tr>
<td><code>:context</code></td>
<td>使用以下 keys 雜湊： :controller, :action, :params, :request</td>
</tr>
</tbody>
</table>
<h4 id="action"><a class="anchorlink" href="#action">3.2 Action 排程</a></h4><h5 id="process-middleware-action-dispatch"><a class="anchorlink" href="#process-middleware-action-dispatch">3.2.1 process_middleware.action_dispatch</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:middleware</code></td>
<td>中介軟體名稱</td>
</tr>
</tbody>
</table>
<h4 id="action-view"><a class="anchorlink" href="#action-view">3.3 Action View</a></h4><h5 id="render-template-action-view"><a class="anchorlink" href="#render-template-action-view">3.3.1 render_template.action_view</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:identifier</code></td>
<td>模板的完整路徑</td>
</tr>
<tr>
<td><code>:layout</code></td>
<td>適用佈局</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">identifier: </span><span class="s2">"/Users/adam/projects/notifications/app/views/posts/index.html.erb"</span><span class="p">,</span>
  <span class="ss">layout: </span><span class="s2">"layouts/application"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  identifier: "/Users/adam/projects/notifications/app/views/posts/index.html.erb",
  layout: "layouts/application"
}
'>Copy</button>
</div>
<h5 id="render-partial-action-view"><a class="anchorlink" href="#render-partial-action-view">3.3.2 render_partial.action_view</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:identifier</code></td>
<td>模板的完整路徑</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">identifier: </span><span class="s2">"/Users/adam/projects/notifications/app/views/posts/_form.html.erb"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  identifier: "/Users/adam/projects/notifications/app/views/posts/_form.html.erb"
}
'>Copy</button>
</div>
<h5 id="render-collection-action-view"><a class="anchorlink" href="#render-collection-action-view">3.3.3 render_collection.action_view</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:identifier</code></td>
<td>模板的完整路徑</td>
</tr>
<tr>
<td><code>:count</code></td>
<td>收藏尺寸</td>
</tr>
<tr>
<td><code>:cache_hits</code></td>
<td>從快取中獲取的部分數</td>
</tr>
</tbody>
</table>
<p><code>:cache_hits</code> 僅在使用 <code>cached: true</code> 呈現集合時才包括在內。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">identifier: </span><span class="s2">"/Users/adam/projects/notifications/app/views/posts/_post.html.erb"</span><span class="p">,</span>
  <span class="ss">count: </span><span class="mi">3</span><span class="p">,</span>
  <span class="ss">cache_hits: </span><span class="mi">0</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  identifier: "/Users/adam/projects/notifications/app/views/posts/_post.html.erb",
  count: 3,
  cache_hits: 0
}
'>Copy</button>
</div>
<h4 id="active-record"><a class="anchorlink" href="#active-record">3.4 Active Record</a></h4><h5 id="sql-active-record"><a class="anchorlink" href="#sql-active-record">3.4.1 sql.active_record</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:sql</code></td>
<td>SQL 語句</td>
</tr>
<tr>
<td><code>:name</code></td>
<td>操作名稱</td>
</tr>
<tr>
<td><code>:connection</code></td>
<td>連線物件</td>
</tr>
<tr>
<td><code>:binds</code></td>
<td>繫結引數</td>
</tr>
<tr>
<td><code>:type_casted_binds</code></td>
<td>型別轉換繫結引數</td>
</tr>
<tr>
<td><code>:statement_name</code></td>
<td>SQL 語句名稱</td>
</tr>
<tr>
<td><code>:cached</code></td>
<td>使用快取查詢時新增 <code>true</code>
</td>
</tr>
</tbody>
</table>
<p>資訊。介面卡也會新增它們自己的資料。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">sql: </span><span class="s2">"SELECT </span><span class="se">\"</span><span class="s2">posts</span><span class="se">\"</span><span class="s2">.* FROM </span><span class="se">\"</span><span class="s2">posts</span><span class="se">\"</span><span class="s2"> "</span><span class="p">,</span>
  <span class="ss">name: </span><span class="s2">"Post Load"</span><span class="p">,</span>
  <span class="ss">connection: </span><span class="c1">#&lt;ActiveRecord::ConnectionAdapters::SQLite3Adapter:0x00007f9f7a838850&gt;,</span>
  <span class="ss">binds: </span><span class="p">[</span><span class="c1">#&lt;ActiveModel::Attribute::WithCastValue:0x00007fe19d15dc00&gt;],</span>
  <span class="ss">type_casted_binds: </span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
  <span class="ss">statement_name: </span><span class="kp">nil</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  sql: "SELECT \"posts\".* FROM \"posts\" ",
  name: "Post Load",
  connection: #&lt;ActiveRecord::ConnectionAdapters::SQLite3Adapter:0x00007f9f7a838850&gt;,
  binds: [#&lt;ActiveModel::Attribute::WithCastValue:0x00007fe19d15dc00&gt;],
  type_casted_binds: [11],
  statement_name: nil
}
'>Copy</button>
</div>
<h5 id="active-record"><a class="anchorlink" href="#active-record">3.4.2 實例化.active_record</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:record_count</code></td>
<td>實例化的記錄數</td>
</tr>
<tr>
<td><code>:class_name</code></td>
<td>記錄類</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">record_count: </span><span class="mi">1</span><span class="p">,</span>
  <span class="ss">class_name: </span><span class="s2">"User"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  record_count: 1,
  class_name: "User"
}
'>Copy</button>
</div>
<h4 id="action-mailer"><a class="anchorlink" href="#action-mailer">3.5 Action Mailer</a></h4><h5 id="action-mailer"><a class="anchorlink" href="#action-mailer">3.5.1 投遞。action_mailer</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:mailer</code></td>
<td>郵件程式類的名稱</td>
</tr>
<tr>
<td><code>:message_id</code></td>
<td>郵件 ID，由 Mail gem 生成</td>
</tr>
<tr>
<td><code>:subject</code></td>
<td>郵件主題</td>
</tr>
<tr>
<td><code>:to</code></td>
<td>到郵件地址</td>
</tr>
<tr>
<td><code>:from</code></td>
<td>來自郵件地址</td>
</tr>
<tr>
<td><code>:bcc</code></td>
<td>郵件的密件抄送地址</td>
</tr>
<tr>
<td><code>:cc</code></td>
<td>郵件的抄送地址</td>
</tr>
<tr>
<td><code>:date</code></td>
<td>郵件日期</td>
</tr>
<tr>
<td><code>:mail</code></td>
<td>郵件的編碼形式</td>
</tr>
<tr>
<td><code>:perform_deliveries</code></td>
<td>是否執行此訊息的傳遞</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">mailer: </span><span class="s2">"Notification"</span><span class="p">,</span>
  <span class="ss">message_id: </span><span class="s2">"4f5b5491f1774_181b23fc3d4434d38138e5@mba.local.mail"</span><span class="p">,</span>
  <span class="ss">subject: </span><span class="s2">"Rails Guides"</span><span class="p">,</span>
  <span class="ss">to: </span><span class="p">[</span><span class="s2">"users@rails.com"</span><span class="p">,</span> <span class="s2">"dhh@rails.com"</span><span class="p">],</span>
  <span class="ss">from: </span><span class="p">[</span><span class="s2">"me@rails.com"</span><span class="p">],</span>
  <span class="ss">date: </span><span class="no">Sat</span><span class="p">,</span> <span class="mi">10</span> <span class="no">Mar</span> <span class="mi">2012</span> <span class="mi">14</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">09</span> <span class="o">+</span><span class="mo">0100</span><span class="p">,</span>
  <span class="ss">mail: </span><span class="s2">"..."</span><span class="p">,</span> <span class="c1"># omitted for brevity</span>
  <span class="ss">perform_deliveries: </span><span class="kp">true</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  mailer: "Notification",
  message_id: "4f5b5491f1774_181b23fc3d4434d38138e5@mba.local.mail",
  subject: "Rails Guides",
  to: ["users@rails.com", "dhh@rails.com"],
  from: ["me@rails.com"],
  date: Sat, 10 Mar 2012 14:18:09 +0100,
  mail: "...", # omitted for brevity
  perform_deliveries: true
}
'>Copy</button>
</div>
<h5 id="action-mailer"><a class="anchorlink" href="#action-mailer">3.5.2 程序.action_mailer</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:mailer</code></td>
<td>郵件程式類的名稱</td>
</tr>
<tr>
<td><code>:action</code></td>
<td>action</td>
</tr>
<tr>
<td><code>:args</code></td>
<td>論據</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">mailer: </span><span class="s2">"Notification"</span><span class="p">,</span>
  <span class="ss">action: </span><span class="s2">"welcome_email"</span><span class="p">,</span>
  <span class="ss">args: </span><span class="p">[]</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  mailer: "Notification",
  action: "welcome_email",
  args: []
}
'>Copy</button>
</div>
<h4 id="active-support"><a class="anchorlink" href="#active-support">3.6 Active Support</a></h4><h5 id="cache-read-active-support"><a class="anchorlink" href="#cache-read-active-support">3.6.1 cache_read.active_support</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>店內使用的Key</td>
</tr>
<tr>
<td><code>:store</code></td>
<td>商店類名稱</td>
</tr>
<tr>
<td><code>:hit</code></td>
<td>如果此閱讀很受歡迎</td>
</tr>
<tr>
<td><code>:super_operation</code></td>
<td>:fetch 與 <code>#fetch</code> 一起使用讀取時新增</td>
</tr>
</tbody>
</table>
<h5 id="cache-generate-active-support"><a class="anchorlink" href="#cache-generate-active-support">3.6.2 cache_generate.active_support</a></h5><p>此事件僅在使用塊呼叫 <code>#fetch</code> 時使用。</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>店內使用的Key</td>
</tr>
<tr>
<td><code>:store</code></td>
<td>商店類名稱</td>
</tr>
</tbody>
</table>
<p>資訊。傳遞給 fetch 的選項將在寫入儲存時與有效負載合併</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s2">"name-of-complicated-computation"</span><span class="p">,</span>
  <span class="ss">store: </span><span class="s2">"ActiveSupport::Cache::MemCacheStore"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  key: "name-of-complicated-computation",
  store: "ActiveSupport::Cache::MemCacheStore"
}
'>Copy</button>
</div>
<h5 id="cache-fetch-hit-active-support"><a class="anchorlink" href="#cache-fetch-hit-active-support">3.6.3 cache_fetch_hit.active_support</a></h5><p>此事件僅在使用塊呼叫 <code>#fetch</code> 時使用。</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>店內使用的Key</td>
</tr>
<tr>
<td><code>:store</code></td>
<td>商店類名稱</td>
</tr>
</tbody>
</table>
<p>資訊。傳遞給 fetch 的選項將與有效負載合併。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s2">"name-of-complicated-computation"</span><span class="p">,</span>
  <span class="ss">store: </span><span class="s2">"ActiveSupport::Cache::MemCacheStore"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  key: "name-of-complicated-computation",
  store: "ActiveSupport::Cache::MemCacheStore"
}
'>Copy</button>
</div>
<h5 id="cache-write-active-support"><a class="anchorlink" href="#cache-write-active-support">3.6.4 cache_write.active_support</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>店內使用的Key</td>
</tr>
<tr>
<td><code>:store</code></td>
<td>商店類名稱</td>
</tr>
</tbody>
</table>
<p>資訊。快取儲存可以新增自己的 keys</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s2">"name-of-complicated-computation"</span><span class="p">,</span>
  <span class="ss">store: </span><span class="s2">"ActiveSupport::Cache::MemCacheStore"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  key: "name-of-complicated-computation",
  store: "ActiveSupport::Cache::MemCacheStore"
}
'>Copy</button>
</div>
<h5 id="cache-delete-active-support"><a class="anchorlink" href="#cache-delete-active-support">3.6.5 cache_delete.active_support</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>店內使用的Key</td>
</tr>
<tr>
<td><code>:store</code></td>
<td>商店類名稱</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s2">"name-of-complicated-computation"</span><span class="p">,</span>
  <span class="ss">store: </span><span class="s2">"ActiveSupport::Cache::MemCacheStore"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  key: "name-of-complicated-computation",
  store: "ActiveSupport::Cache::MemCacheStore"
}
'>Copy</button>
</div>
<h5 id="cache-exist-questionmark-active-support"><a class="anchorlink" href="#cache-exist-questionmark-active-support">3.6.6 cache_exist?.active_support</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>店內使用的Key</td>
</tr>
<tr>
<td><code>:store</code></td>
<td>商店類名稱</td>
</tr>
</tbody>
</table>
<div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span>
  <span class="ss">key: </span><span class="s2">"name-of-complicated-computation"</span><span class="p">,</span>
  <span class="ss">store: </span><span class="s2">"ActiveSupport::Cache::MemCacheStore"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{
  key: "name-of-complicated-computation",
  store: "ActiveSupport::Cache::MemCacheStore"
}
'>Copy</button>
</div>
<h4 id="active-job"><a class="anchorlink" href="#active-job">3.7 Active Job</a></h4><h5 id="enqueue-at-active-job"><a class="anchorlink" href="#enqueue-at-active-job">3.7.1 enqueue_at.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
</tbody>
</table>
<h5 id="enqueue-active-job"><a class="anchorlink" href="#enqueue-active-job">3.7.2 enqueue.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
</tbody>
</table>
<h5 id="enqueue-retry-active-job"><a class="anchorlink" href="#enqueue-retry-active-job">3.7.3 enqueue_retry.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:error</code></td>
<td>導致重試的錯誤</td>
</tr>
<tr>
<td><code>:wait</code></td>
<td>重試的延遲</td>
</tr>
</tbody>
</table>
<h5 id="perform-start-active-job"><a class="anchorlink" href="#perform-start-active-job">3.7.4 perform_start.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
</tbody>
</table>
<h5 id="perform-active-job"><a class="anchorlink" href="#perform-active-job">3.7.5 perform.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
</tbody>
</table>
<h5 id="retry-stopped-active-job"><a class="anchorlink" href="#retry-stopped-active-job">3.7.6 retry_stopped.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
<tr>
<td><code>:error</code></td>
<td>導致重試的錯誤</td>
</tr>
</tbody>
</table>
<h5 id="discard-active-job"><a class="anchorlink" href="#discard-active-job">3.7.7 discard.active_job</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:adapter</code></td>
<td>處理作業的 QueueAdapter 物件</td>
</tr>
<tr>
<td><code>:job</code></td>
<td>工作物件</td>
</tr>
<tr>
<td><code>:error</code></td>
<td>導致丟棄的錯誤</td>
</tr>
</tbody>
</table>
<h4 id="action-cable"><a class="anchorlink" href="#action-cable">3.8 Action Cable</a></h4><h5 id="perform-action-action-cable"><a class="anchorlink" href="#perform-action-action-cable">3.8.1 perform_action.action_cable</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:channel_class</code></td>
<td>通道類名稱</td>
</tr>
<tr>
<td><code>:action</code></td>
<td>action</td>
</tr>
<tr>
<td><code>:data</code></td>
<td>資料雜湊</td>
</tr>
</tbody>
</table>
<h5 id="action-cable"><a class="anchorlink" href="#action-cable">3.8.2 傳輸.action_cable</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:channel_class</code></td>
<td>通道類名稱</td>
</tr>
<tr>
<td><code>:data</code></td>
<td>資料雜湊</td>
</tr>
<tr>
<td><code>:via</code></td>
<td>透過</td>
</tr>
</tbody>
</table>
<h5 id="transmit-subscription-confirmation-action-cable"><a class="anchorlink" href="#transmit-subscription-confirmation-action-cable">3.8.3 transmit_subscription_confirmation.action_cable</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:channel_class</code></td>
<td>通道類名稱</td>
</tr>
</tbody>
</table>
<h5 id="transmit-subscription-rejection-action-cable"><a class="anchorlink" href="#transmit-subscription-rejection-action-cable">3.8.4 transmit_subscription_rejection.action_cable</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:channel_class</code></td>
<td>通道類名稱</td>
</tr>
</tbody>
</table>
<h5 id="action-cable"><a class="anchorlink" href="#action-cable">3.8.5 廣播。action_cable</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:broadcasting</code></td>
<td>一個命名廣播</td>
</tr>
<tr>
<td><code>:message</code></td>
<td>訊息雜湊</td>
</tr>
<tr>
<td><code>:coder</code></td>
<td>編碼器</td>
</tr>
</tbody>
</table>
<h4 id="active-storage"><a class="anchorlink" href="#active-storage">3.9 Active Storage</a></h4><h5 id="service-upload-active-storage"><a class="anchorlink" href="#service-upload-active-storage">3.9.1 service_upload.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
<tr>
<td><code>:checksum</code></td>
<td>校驗和以確保完整性</td>
</tr>
</tbody>
</table>
<h5 id="service-streaming-download-active-storage"><a class="anchorlink" href="#service-streaming-download-active-storage">3.9.2 service_streaming_download.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
</tbody>
</table>
<h5 id="service-download-chunk-active-storage"><a class="anchorlink" href="#service-download-chunk-active-storage">3.9.3 service_download_chunk.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
<tr>
<td><code>:range</code></td>
<td>試圖讀取的位元組範圍</td>
</tr>
</tbody>
</table>
<h5 id="service-download-active-storage"><a class="anchorlink" href="#service-download-active-storage">3.9.4 service_download.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
</tbody>
</table>
<h5 id="service-delete-active-storage"><a class="anchorlink" href="#service-delete-active-storage">3.9.5 service_delete.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
</tbody>
</table>
<h5 id="service-delete-prefixed-active-storage"><a class="anchorlink" href="#service-delete-prefixed-active-storage">3.9.6 service_delete_prefixed.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:prefix</code></td>
<td>Key 字首</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
</tbody>
</table>
<h5 id="service-exist-active-storage"><a class="anchorlink" href="#service-exist-active-storage">3.9.7 service_exist.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
<tr>
<td><code>:exist</code></td>
<td>檔案或 blob 是否存在</td>
</tr>
</tbody>
</table>
<h5 id="service-url-active-storage"><a class="anchorlink" href="#service-url-active-storage">3.9.8 service_url.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
<tr>
<td><code>:url</code></td>
<td>生成的網址</td>
</tr>
</tbody>
</table>
<h5 id="service-update-metadata-active-storage"><a class="anchorlink" href="#service-update-metadata-active-storage">3.9.9 service_update_metadata.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
<tr>
<td><code>:service</code></td>
<td>服務名稱</td>
</tr>
<tr>
<td><code>:content_type</code></td>
<td>HTTP 內容型別欄位</td>
</tr>
<tr>
<td><code>:disposition</code></td>
<td>HTTP Content-Disposition 欄位</td>
</tr>
</tbody>
</table>
<p>資訊。到目前為止，唯一提供此掛載機制的 ActiveStorage 服務是 GCS。</p><h5 id="preview-active-storage"><a class="anchorlink" href="#preview-active-storage">3.9.10 preview.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:key</code></td>
<td>保護token</td>
</tr>
</tbody>
</table>
<h5 id="transform-active-storage"><a class="anchorlink" href="#transform-active-storage">3.9.11 transform.active_storage</a></h5><h5 id="analyze-active-storage"><a class="anchorlink" href="#analyze-active-storage">3.9.12 analyze.active_storage</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:analyzer</code></td>
<td>分析器的名稱，例如 ffprobe</td>
</tr>
</tbody>
</table>
<h4 id="rails"><a class="anchorlink" href="#rails">3.10 Rails</a></h4><h5 id="load-config-initializer-railties"><a class="anchorlink" href="#load-config-initializer-railties">3.10.1 load_config_initializer.railties</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:initializer</code></td>
<td>從 <code>config/initializers</code> 載入初始化程式的路徑</td>
</tr>
</tbody>
</table>
<h4 id=""><a class="anchorlink" href="#">3.11 導軌</a></h4><h5 id="deprecation-rails"><a class="anchorlink" href="#deprecation-rails">3.11.1 deprecation.rails</a></h5>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:message</code></td>
<td>棄用警告</td>
</tr>
<tr>
<td><code>:callstack</code></td>
<td>棄用從何而來</td>
</tr>
</tbody>
</table>
<h3 id=""><a class="anchorlink" href="#">4 例外</a></h3><p>如果在任何檢測期間發生異常，有效負載將包括
關於它的資訊。</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:exception</code></td>
<td>兩個元素的陣列。異常類名和訊息</td>
</tr>
<tr>
<td><code>:exception_object</code></td>
<td>異常物件</td>
</tr>
</tbody>
</table>
<h3 id=""><a class="anchorlink" href="#">5 建立自定義事件</a></h3><p>新增您自己的事件也很容易。 <code>ActiveSupport::Notifications</code> 會照顧
為您完成所有繁重的工作。只需使用 <code>name</code>、<code>payload</code> 和一個塊呼叫 <code>instrument</code>。
該通知將在塊返回後傳送。 <code>ActiveSupport</code> 將生成開始和結束時間
並新增檢測器的唯一 ID。傳入 <code>instrument</code> 呼叫的所有資料將使
它進入有效載荷。</p><p>下面是一個例子：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">instrument</span> <span class="s2">"my.custom.event"</span><span class="p">,</span> <span class="ss">this: :data</span> <span class="k">do</span>
  <span class="c1"># do your custom stuff here</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.instrument "my.custom.event", this: :data do
  # do your custom stuff here
end
'>Copy</button>
</div>
<p>現在您可以透過以下方式收聽此事件：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="s2">"my.custom.event"</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">started</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">data</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">data</span><span class="p">.</span><span class="nf">inspect</span> <span class="c1"># {:this=&gt;:data}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.subscribe "my.custom.event" do |name, started, finished, unique_id, data|
  puts data.inspect # {:this=&gt;:data}
end
'>Copy</button>
</div>
<p>您還可以選擇在不傳遞塊的情況下呼叫儀器。這讓您可以利用
用於其他訊息傳遞用途的檢測基礎設施。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">instrument</span> <span class="s2">"my.custom.event"</span><span class="p">,</span> <span class="ss">this: :data</span>

<span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Notifications</span><span class="p">.</span><span class="nf">subscribe</span> <span class="s2">"my.custom.event"</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">started</span><span class="p">,</span> <span class="n">finished</span><span class="p">,</span> <span class="n">unique_id</span><span class="p">,</span> <span class="n">data</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">data</span><span class="p">.</span><span class="nf">inspect</span> <span class="c1"># {:this=&gt;:data}</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='ActiveSupport::Notifications.instrument "my.custom.event", this: :data

ActiveSupport::Notifications.subscribe "my.custom.event" do |name, started, finished, unique_id, data|
  puts data.inspect # {:this=&gt;:data}
end
'>Copy</button>
</div>
<p>在定義自己的事件時，您應該遵循 Rails 約定。格式為：<code>event.library</code>。
如果您的應用程式正在傳送推文，您應該建立一個名為 <code>tweet.twitter</code> 的事件。</p>

        <h3>回饋</h3>
        <p>
          我們鼓勵您幫助提高本指南的品質。
        </p>
        <p>
          如果您發現任何拼寫錯誤或資訊錯誤，請提供回饋。
          要開始回饋，您可以閱讀我們的 <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">回饋</a> 部分。
        </p>
        <p>
          您還可能會發現不完整的內容或不是最新的內容。
          請務必為 main 新增任何遺漏的文件。假設是
          <a href="https://edgeguides.rubyonrails.org">非穩定版指南(edge guides)</a> 請先驗證問題是否已經在主分支上解決。
          請前往 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南寫作準則</a> 查看寫作風格和慣例。
        </p>
        <p>
          如果由於某種原因您發現要修復的內容但無法自行修補，請您 <a href="https://github.com/rails/rails/issues">提出 issue</a>。
        </p>
        <p>關於 Ruby on Rails 的任何類型的討論歡迎提供任何文件至 <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">rubyonrails-docs 討論區</a>。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品已獲得<a href="https://creativecommons.org/licenses/by-sa/4.0/">知識共享署名-相同方式共享 4.0 國際</a>許可</p>
<p>“Rails”、“Ruby on Rails”和 Rails 標誌是 David Heinemeier Hansson 的商標。 保留所有權利。</p>
    </div>
  </div>
</body>
</html>
