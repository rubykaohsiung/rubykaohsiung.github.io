<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Working with JavaScript in Rails — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Working with JavaScript in Rails — Ruby on Rails Guides" />
  <meta name="description" content="Working with JavaScript in RailsThis guide covers the built-in Ajax/JavaScript functionality of Rails (and more); it will enable you to create rich and dynamic Ajax applications with ease!After reading this guide, you will know: The basics of Ajax. Unobtrusive JavaScript. How Rails&#39; built-in helpers assist you. How to handle Ajax on the server side. The Turbolinks gem. How to include your Cross-Site Request Forgery token in request headers" />
  <meta property="og:description" content="Working with JavaScript in RailsThis guide covers the built-in Ajax/JavaScript functionality of Rails (and more); it will enable you to create rich and dynamic Ajax applications with ease!After reading this guide, you will know: The basics of Ajax. Unobtrusive JavaScript. How Rails&#39; built-in helpers assist you. How to handle Ajax on the server side. The Turbolinks gem. How to include your Cross-Site Request Forgery token in request headers" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多在 <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多關於 Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">部落格</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">手冊</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">討論</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">貢獻</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">手冊索引</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>從這裡開始</dt>
                  <dd><a href="getting_started.html">Rails 入門</a></dd>
                </div>
                <div class="guides-section">
                  <dt>模型（Models）</dt>
                  <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record 遷移</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 驗證</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record 回呼</a></dd>
                  <dd><a href="association_basics.html">Active Record 關聯</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查詢介面</a></dd>
                </div>
                <div class="guides-section">
                  <dt>畫面（Views）</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 中的佈局和渲染</a></dd>
                  <dd><a href="form_helpers.html">Action View 表單 Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>控制器（Controllers）</dt>
                  <dd><a href="action_controller_overview.html">Action Controller 概述</a></dd>
                  <dd><a href="routing.html">Routing 路由</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他元件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基礎</a></dd>
                  <dd><a href="active_job_basics.html">Active Job 基礎</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 概述</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 概述</a></dd>
                </div>
                <div class="guides-section">
                  <dt>進階功能</dt>
                  <dd><a href="i18n.html">Rails 國際化（I18n）API</a></dd>
                  <dd><a href="testing.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="security.html">保護 Rails 應用程式</a></dd>
                  <dd><a href="debugging_rails_applications.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="configuration.html">設定 Rails 應用程式</a></dd>
                  <dd><a href="command_line.html">Rails 命令列</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline 資產管道</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自動執行和重新讀取變數（Zeitwerk模式）</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">自動執行和重新執行常數（經典模式）</a></dd>
                  <dd><a href="caching_with_rails.html">使用Rails進行快取: 概述</a></dd>
                  <dd><a href="api_app.html">將 Rails 用於僅 API 的應用程式</a></dd>
                </div>
                <div class="guides-section">
                  <dt>延伸閱讀</dt>
                  <dd><a href="rails_on_rack.html">Rack 上的 Rails</a></dd>
                  <dd><a href="generators.html">建立客製化的 Rails 產生器和樣板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>捐款</dt>
                  <dd><a href="tribution_to_ruby_on_rails.html">為 Ruby on Rails 貢獻</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API文檔準則</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南指南</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策</dt>
                  <dd><a href="maintenance_policy.html">維修政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>發行說明</dt>
                  <dd><a href="upgrade_ruby_on_rails.html">升級 Ruby on Rails</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0版-2019年8月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2版-2018年4月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1版-2017年4月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0版-2016年6月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2版-2014年12月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1版-2014年4月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0版-2013年6月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2版-2012年1月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1版-2011年8月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0版-2010年8月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3版-2009年3月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2版-2008年11月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">手冊索引</option>
              <optgroup label="從這裡開始">
                  <option value="getting_started.html">Rails 入門</option>
              </optgroup>
              <optgroup label="模型（Models）">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="active_record_migrations.html">Active Record 遷移</option>
                  <option value="active_record_validations.html">Active Record 驗證</option>
                  <option value="active_record_callbacks.html">Active Record 回呼</option>
                  <option value="association_basics.html">Active Record 關聯</option>
                  <option value="active_record_querying.html">Active Record 查詢介面</option>
              </optgroup>
              <optgroup label="畫面（Views）">
                  <option value="layouts_and_rendering.html">Rails 中的佈局和渲染</option>
                  <option value="form_helpers.html">Action View 表單 Helpers</option>
              </optgroup>
              <optgroup label="控制器（Controllers）">
                  <option value="action_controller_overview.html">Action Controller 概述</option>
                  <option value="routing.html">Routing 路由</option>
              </optgroup>
              <optgroup label="其他元件">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎</option>
                  <option value="active_job_basics.html">Active Job 基礎</option>
                  <option value="active_storage_overview.html">Active Storage 概述</option>
                  <option value="action_cable_overview.html">Action Cable 概述</option>
              </optgroup>
              <optgroup label="進階功能">
                  <option value="i18n.html">Rails 國際化（I18n）API</option>
                  <option value="testing.html">測試 Rails 應用程式</option>
                  <option value="security.html">保護 Rails 應用程式</option>
                  <option value="debugging_rails_applications.html">測試 Rails 應用程式</option>
                  <option value="configuration.html">設定 Rails 應用程式</option>
                  <option value="command_line.html">Rails 命令列</option>
                  <option value="asset_pipeline.html">Asset Pipeline 資產管道</option>
                  <option value="autoloading_and_reloading_constants.html">自動執行和重新讀取變數（Zeitwerk模式）</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">自動執行和重新執行常數（經典模式）</option>
                  <option value="caching_with_rails.html">使用Rails進行快取: 概述</option>
                  <option value="api_app.html">將 Rails 用於僅 API 的應用程式</option>
              </optgroup>
              <optgroup label="延伸閱讀">
                  <option value="rails_on_rack.html">Rack 上的 Rails</option>
                  <option value="generators.html">建立客製化的 Rails 產生器和樣板</option>
              </optgroup>
              <optgroup label="捐款">
                  <option value="tribution_to_ruby_on_rails.html">為 Ruby on Rails 貢獻</option>
                  <option value="api_documentation_guidelines.html">API文檔準則</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南指南</option>
              </optgroup>
              <optgroup label="政策">
                  <option value="maintenance_policy.html">維修政策</option>
              </optgroup>
              <optgroup label="發行說明">
                  <option value="upgrade_ruby_on_rails.html">升級 Ruby on Rails</option>
                  <option value="6_0_release_notes.html">6.0版-2019年8月</option>
                  <option value="5_2_release_notes.html">5.2版-2018年4月</option>
                  <option value="5_1_release_notes.html">5.1版-2017年4月</option>
                  <option value="5_0_release_notes.html">5.0版-2016年6月</option>
                  <option value="4_2_release_notes.html">4.2版-2014年12月</option>
                  <option value="4_1_release_notes.html">4.1版-2014年4月</option>
                  <option value="4_0_release_notes.html">4.0版-2013年6月</option>
                  <option value="3_2_release_notes.html">3.2版-2012年1月</option>
                  <option value="3_1_release_notes.html">3.1版-2011年8月</option>
                  <option value="3_0_release_notes.html">3.0版-2010年8月</option>
                  <option value="2_3_release_notes.html">2.3版-2009年3月</option>
                  <option value="2_2_release_notes.html">2.2版-2008年11月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Working with JavaScript in Rails</h2><p>This guide covers the built-in Ajax/JavaScript functionality of Rails (and
more); it will enable you to create rich and dynamic Ajax applications with
ease!</p><p>After reading this guide, you will know:</p>
<ul>
<li>The basics of Ajax.</li>
<li>Unobtrusive JavaScript.</li>
<li>How Rails&#39; built-in helpers assist you.</li>
<li>How to handle Ajax on the server side.</li>
<li>The Turbolinks gem.</li>
<li>How to include your Cross-Site Request Forgery token in request headers</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#an-introduction-to-ajax">An Introduction to Ajax</a></li>
<li><a href="#unobtrusive-javascript">Unobtrusive JavaScript</a></li>
<li>
<a href="#built-in-helpers">Built-in Helpers</a>

<ul>
<li><a href="#remote-elements">Remote Elements</a></li>
<li><a href="#customize-remote-elements">Customize Remote Elements</a></li>
<li><a href="#confirmations">Confirmations</a></li>
<li><a href="#automatic-disabling">Automatic disabling</a></li>
<li><a href="#rails-ujs-event-handlers">Rails-ujs event handlers</a></li>
<li><a href="#stoppable-events">Stoppable events</a></li>
</ul>
</li>
<li>
<a href="#server-side-concerns">Server-Side Concerns</a>

<ul>
<li><a href="#a-simple-example">A Simple Example</a></li>
</ul>
</li>
<li>
<a href="#turbolinks">Turbolinks</a>

<ul>
<li><a href="#how-turbolinks-works">How Turbolinks Works</a></li>
<li><a href="#page-change-events">Page Change Events</a></li>
</ul>
</li>
<li><a href="#cross-site-request-forgery-csrf-token-in-ajax">Cross-Site Request Forgery (CSRF) token in Ajax</a></li>
<li><a href="#other-resources">Other Resources</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="an-introduction-to-ajax"><a class="anchorlink" href="#an-introduction-to-ajax">1 An Introduction to Ajax</a></h3><p>In order to understand Ajax, you must first understand what a web browser does
normally.</p><p>When you type <code>http://localhost:3000</code> into your browser's address bar and hit
'Go', the browser (your 'client') makes a request to the server. It parses the
response, then fetches all associated assets, like JavaScript files,
stylesheets and images. It then assembles the page. If you click a link, it
does the same process: fetch the page, fetch the assets, put it all together,
show you the results. This is called the 'request response cycle'.</p><p>JavaScript can also make requests to the server, and parse the response. It
also has the ability to update information on the page. Combining these two
powers, a JavaScript writer can make a web page that can update just parts of
itself, without needing to get the full page data from the server. This is a
powerful technique that we call Ajax.</p><p>As an example, here's some JavaScript code that makes an Ajax request:</p><div class="code_container">
<pre><code class="highlight js"><span class="nx">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">/test</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">html</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#results</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">results</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">"</span><span class="s2">beforeend</span><span class="dl">"</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8d9138735288733151098081465e1f00">fetch("/test")
  .then((data) =&gt; data.text())
  .then((html) =&gt; {
    const results = document.querySelector("#results");
    results.insertAdjacentHTML("beforeend", data);
  });
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8d9138735288733151098081465e1f00">Copy</button>
</div>
<p>This code fetches data from "/test", and then appends the result to the element
with an id of <code>results</code>.</p><p>Rails provides quite a bit of built-in support for building web pages with this
technique. You rarely have to write this code yourself. The rest of this guide
will show you how Rails can help you write websites in this way, but it's
all built on top of this fairly simple technique.</p><h3 id="unobtrusive-javascript"><a class="anchorlink" href="#unobtrusive-javascript">2 Unobtrusive JavaScript</a></h3><p>Rails uses a technique called "Unobtrusive JavaScript" to handle attaching
JavaScript to the DOM. This is generally considered to be a best-practice
within the frontend community, but you may occasionally read tutorials that
demonstrate other ways.</p><p>Here's the simplest way to write JavaScript. You may see it referred to as
'inline JavaScript':</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"this.style.backgroundColor='#990000';event.preventDefault();"</span><span class="nt">&gt;</span>Paint it red<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0f14dc6e857c4486958a1eceb08d1d2d">&lt;a href="#" onclick="this.style.backgroundColor='#990000';event.preventDefault();"&gt;Paint it red&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0f14dc6e857c4486958a1eceb08d1d2d">Copy</button>
</div>
<p>When clicked, the link background will become red. Here's the problem: what
happens when we have lots of JavaScript we want to execute on a click?</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"this.style.backgroundColor='#009900';this.style.color='#FFFFFF';event.preventDefault();"</span><span class="nt">&gt;</span>Paint it green<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ebf9bd715071894cb217175a8b174a83">&lt;a href="#" onclick="this.style.backgroundColor='#009900';this.style.color='#FFFFFF';event.preventDefault();"&gt;Paint it green&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ebf9bd715071894cb217175a8b174a83">Copy</button>
</div>
<p>Awkward, right? We could pull the function definition out of the click handler,
and turn it a function:</p><div class="code_container">
<pre><code class="highlight js"><span class="nb">window</span><span class="p">.</span><span class="nx">paintIt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">backgroundColor</span><span class="p">,</span> <span class="nx">textColor</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">backgroundColor</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">textColor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">textColor</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b07a9cf56abce179201f35995d1bdda2">window.paintIt = function(event, backgroundColor, textColor) {
  event.preventDefault();
  event.target.style.backgroundColor = backgroundColor;
  if (textColor) {
    event.target.style.color = textColor;
  }
}
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b07a9cf56abce179201f35995d1bdda2">Copy</button>
</div>
<p>And then on our page:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"paintIt(event, '#990000')"</span><span class="nt">&gt;</span>Paint it red<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-389572842902b0f3e2bd65364bf8ed75">&lt;a href="#" onclick="paintIt(event, '#990000')"&gt;Paint it red&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-389572842902b0f3e2bd65364bf8ed75">Copy</button>
</div>
<p>That's a little bit better, but what about multiple links that have the same
effect?</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"paintIt(event, '#990000')"</span><span class="nt">&gt;</span>Paint it red<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"paintIt(event, '#009900', '#FFFFFF')"</span><span class="nt">&gt;</span>Paint it green<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">onclick=</span><span class="s">"paintIt(event, '#000099', '#FFFFFF')"</span><span class="nt">&gt;</span>Paint it blue<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f73ca216b8727ab6f423b9a1bd7c2b70">&lt;a href="#" onclick="paintIt(event, '#990000')"&gt;Paint it red&lt;/a&gt;
&lt;a href="#" onclick="paintIt(event, '#009900', '#FFFFFF')"&gt;Paint it green&lt;/a&gt;
&lt;a href="#" onclick="paintIt(event, '#000099', '#FFFFFF')"&gt;Paint it blue&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f73ca216b8727ab6f423b9a1bd7c2b70">Copy</button>
</div>
<p>Not very DRY, eh? We can fix this by using events instead. We'll add a <code>data-*</code>
attribute to our link, and then bind a handler to the click event of every link
that has that attribute:</p><div class="code_container">
<pre><code class="highlight js"><span class="kd">function</span> <span class="nx">paintIt</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">backgroundColor</span><span class="p">,</span> <span class="nx">textColor</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">backgroundColor</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">textColor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">textColor</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">a[data-background-color]</span><span class="dl">"</span>
  <span class="p">);</span>
  <span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

      <span class="kd">const</span> <span class="p">{</span><span class="nx">backgroundColor</span><span class="p">,</span> <span class="nx">textColor</span><span class="p">}</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">dataset</span><span class="p">;</span>
      <span class="nx">paintIt</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">backgroundColor</span><span class="p">,</span> <span class="nx">textColor</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4f9968e8e6a37599835d607e7295cbae">function paintIt(element, backgroundColor, textColor) {
  element.style.backgroundColor = backgroundColor;
  if (textColor) {
    element.style.color = textColor;
  }
}

window.addEventListener("load", () =&gt; {
  const links = document.querySelectorAll(
    "a[data-background-color]"
  );
  links.forEach((element) =&gt; {
    element.addEventListener("click", (event) =&gt; {
      event.preventDefault();

      const {backgroundColor, textColor} = element.dataset;
      paintIt(element, backgroundColor, textColor);
    });
  });
});
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4f9968e8e6a37599835d607e7295cbae">Copy</button>
</div>
<div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">data-background-color=</span><span class="s">"#990000"</span><span class="nt">&gt;</span>Paint it red<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">data-background-color=</span><span class="s">"#009900"</span> <span class="na">data-text-color=</span><span class="s">"#FFFFFF"</span><span class="nt">&gt;</span>Paint it green<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">data-background-color=</span><span class="s">"#000099"</span> <span class="na">data-text-color=</span><span class="s">"#FFFFFF"</span><span class="nt">&gt;</span>Paint it blue<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-eaf0123ef80b5c2be876ce998a4f36c4">&lt;a href="#" data-background-color="#990000"&gt;Paint it red&lt;/a&gt;
&lt;a href="#" data-background-color="#009900" data-text-color="#FFFFFF"&gt;Paint it green&lt;/a&gt;
&lt;a href="#" data-background-color="#000099" data-text-color="#FFFFFF"&gt;Paint it blue&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-eaf0123ef80b5c2be876ce998a4f36c4">Copy</button>
</div>
<p>We call this 'unobtrusive' JavaScript because we're no longer mixing our
JavaScript into our HTML. We've properly separated our concerns, making future
change easy. We can easily add behavior to any link by adding the data
attribute. We can run all of our JavaScript through a minimizer and
concatenator. We can serve our entire JavaScript bundle on every page, which
means that it'll get downloaded on the first page load and then be cached on
every page after that. Lots of little benefits really add up.</p><h3 id="built-in-helpers"><a class="anchorlink" href="#built-in-helpers">3 Built-in Helpers</a></h3><h4 id="remote-elements"><a class="anchorlink" href="#remote-elements">3.1 Remote Elements</a></h4><p>Rails provides a bunch of view helper methods written in Ruby to assist you
in generating HTML. Sometimes, you want to add a little Ajax to those elements,
and Rails has got your back in those cases.</p><p>Because of Unobtrusive JavaScript, the Rails "Ajax helpers" are actually in two
parts: the JavaScript half and the Ruby half.</p><p>Unless you have disabled the Asset Pipeline,
<a href="https://github.com/rails/rails/tree/master/actionview/app/assets/javascripts">rails-ujs</a>
provides the JavaScript half, and the regular Ruby view helpers add appropriate
tags to your DOM.</p><p>You can read below about the different events that are fired dealing with
remote elements inside your application.</p><h5 id="form-with"><a class="anchorlink" href="#form-with">3.1.1 form_with</a></h5><p><a href="https://api.rubyonrails.org/v6.0.3.4/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>
is a helper that assists with writing forms. By default, <code>form_with</code> assumes that
your form will be using Ajax. You can opt out of this behavior by
passing the <code>:local</code> option to <code>form_with</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="vi">@article</span><span class="p">,</span> <span class="ss">id: </span><span class="s2">"new-article"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  ...
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d22140a443a65825f27fa44c66feeb7a">&lt;%= form_with(model: @article, id: "new-article") do |form| %&gt;
  ...
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d22140a443a65825f27fa44c66feeb7a">Copy</button>
</div>
<p>This will generate the following HTML:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"new-article"</span> <span class="na">action=</span><span class="s">"/articles"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">data-remote=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bf47bacc5e121f3a4b822e647cc7e72d">&lt;form id="new-article" action="/articles" accept-charset="UTF-8" method="post" data-remote="true"&gt;
  ...
&lt;/form&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bf47bacc5e121f3a4b822e647cc7e72d">Copy</button>
</div>
<p>Note the <code>data-remote="true"</code>. Now, the form will be submitted by Ajax rather
than by the browser's normal submit mechanism.</p><p>You probably don't want to just sit there with a filled out <code>&lt;form&gt;</code>, though.
You probably want to do something upon a successful submission. To do that,
bind to the <code>ajax:success</code> event. On failure, use <code>ajax:error</code>. Check it out:</p><div class="code_container">
<pre><code class="highlight js"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#new-article</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">ajax:success</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">_data</span><span class="p">,</span> <span class="nx">_status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">;</span>
    <span class="nx">element</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">"</span><span class="s2">beforeend</span><span class="dl">"</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">ajax:error</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">element</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">"</span><span class="s2">beforeend</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&lt;p&gt;ERROR&lt;/p&gt;</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5f2d802b46e3cd8505b388314881e0bb">window.addEventListener("load", () =&gt; {
  const element = document.querySelector("#new-article");
  element.addEventListener("ajax:success", (event) =&gt; {
    const [_data, _status, xhr] = event.detail;
    element.insertAdjacentHTML("beforeend", xhr.responseText);
  });
  element.addEventListener("ajax:error", () =&gt; {
    element.insertAdjacentHTML("beforeend", "&lt;p&gt;ERROR&lt;/p&gt;");
  });
});
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5f2d802b46e3cd8505b388314881e0bb">Copy</button>
</div>
<p>Obviously, you'll want to be a bit more sophisticated than that, but it's a
start.</p><h5 id="link-to"><a class="anchorlink" href="#link-to">3.1.2 link_to</a></h5><p><a href="https://api.rubyonrails.org/v6.0.3.4/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to"><code>link_to</code></a>
is a helper that assists with generating links. It has a <code>:remote</code> option you
can use like this:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"an article"</span><span class="p">,</span> <span class="vi">@article</span><span class="p">,</span> <span class="ss">remote: </span><span class="kp">true</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-92adf1f9afa5fca1a159b40acb5dc2cd">&lt;%= link_to "an article", @article, remote: true %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-92adf1f9afa5fca1a159b40acb5dc2cd">Copy</button>
</div>
<p>which generates</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/articles/1"</span> <span class="na">data-remote=</span><span class="s">"true"</span><span class="nt">&gt;</span>an article<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-631100d631ec739d7f8237204bd7e67e">&lt;a href="/articles/1" data-remote="true"&gt;an article&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-631100d631ec739d7f8237204bd7e67e">Copy</button>
</div>
<p>You can bind to the same Ajax events as <code>form_with</code>. Here's an example. Let's
assume that we have a list of articles that can be deleted with just one
click. We would generate some HTML like this:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Delete article"</span><span class="p">,</span> <span class="vi">@article</span><span class="p">,</span> <span class="ss">remote: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">method: :delete</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8ea38f71e2ef783220e5871650f3925a">&lt;%= link_to "Delete article", @article, remote: true, method: :delete %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8ea38f71e2ef783220e5871650f3925a">Copy</button>
</div>
<p>and write some JavaScript like this:</p><div class="code_container">
<pre><code class="highlight js"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">a[data-remote]</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">element</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">ajax:success</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">The article was deleted.</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2b553be6e9094afc53577a262897a8c6">window.addEventListener("load", () =&gt; {
  const links = document.querySelectorAll("a[data-remote]");
  links.forEach((element) =&gt; {
    element.addEventListener("ajax:success", () =&gt; {
      alert("The article was deleted.");
    });
  });
});
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2b553be6e9094afc53577a262897a8c6">Copy</button>
</div>
<h5 id="button-to"><a class="anchorlink" href="#button-to">3.1.3 button_to</a></h5><p><a href="https://api.rubyonrails.org/v6.0.3.4/classes/ActionView/Helpers/UrlHelper.html#method-i-button_to"><code>button_to</code></a> is a helper that helps you create buttons. It has a <code>:remote</code> option that you can call like this:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">button_to</span> <span class="s2">"An article"</span><span class="p">,</span> <span class="vi">@article</span><span class="p">,</span> <span class="ss">remote: </span><span class="kp">true</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-18efc75dfec6f364369a6d1749033b72">&lt;%= button_to "An article", @article, remote: true %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-18efc75dfec6f364369a6d1749033b72">Copy</button>
</div>
<p>this generates</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles/1"</span> <span class="na">class=</span><span class="s">"button_to"</span> <span class="na">data-remote=</span><span class="s">"true"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"An article"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-535df6a9168254215113e7eed4b9dd87">&lt;form action="/articles/1" class="button_to" data-remote="true" method="post"&gt;
  &lt;input type="submit" value="An article" /&gt;
&lt;/form&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-535df6a9168254215113e7eed4b9dd87">Copy</button>
</div>
<p>Since it's just a <code>&lt;form&gt;</code>, all of the information on <code>form_with</code> also applies.</p><h4 id="customize-remote-elements"><a class="anchorlink" href="#customize-remote-elements">3.2 Customize Remote Elements</a></h4><p>It is possible to customize the behavior of elements with a <code>data-remote</code>
attribute without writing a line of JavaScript. You can specify extra <code>data-</code>
attributes to accomplish this.</p><h5 id="data-method"><a class="anchorlink" href="#data-method">3.2.1 <code>data-method</code></a></h5><p>Activating hyperlinks always results in an HTTP GET request. However, if your
application is <a href="https://en.wikipedia.org/wiki/Representational_State_Transfer">RESTful</a>,
some links are in fact actions that change data on the server, and must be
performed with non-GET requests. This attribute allows marking up such links
with an explicit method such as "post", "put" or "delete".</p><p>The way it works is that, when the link is activated, it constructs a hidden form
in the document with the "action" attribute corresponding to "href" value of the
link, and the method corresponding to <code>data-method</code> value, and submits that form.</p><div class="note"><p>Because submitting forms with HTTP methods other than GET and POST isn't
widely supported across browsers, all other HTTP methods are actually sent over
POST with the intended method indicated in the <code>_method</code> parameter. Rails
automatically detects and compensates for this.</p></div><h5 id="data-url-and-data-params"><a class="anchorlink" href="#data-url-and-data-params">3.2.2 <code>data-url</code> and <code>data-params</code></a></h5><p>Certain elements of your page aren't actually referring to any URL, but you may want
them to trigger Ajax calls. Specifying the <code>data-url</code> attribute along with
the <code>data-remote</code> one will trigger an Ajax call to the given URL. You can also
specify extra parameters through the <code>data-params</code> attribute.</p><p>This can be useful to trigger an action on check-boxes for instance:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">data-remote=</span><span class="s">"true"</span>
    <span class="na">data-url=</span><span class="s">"/update"</span> <span class="na">data-params=</span><span class="s">"id=10"</span> <span class="na">data-method=</span><span class="s">"put"</span><span class="nt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-21fe87cb5a92777320bbff8de99cb0b0">&lt;input type="checkbox" data-remote="true"
    data-url="/update" data-params="id=10" data-method="put"&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-21fe87cb5a92777320bbff8de99cb0b0">Copy</button>
</div>
<h5 id="data-type"><a class="anchorlink" href="#data-type">3.2.3 <code>data-type</code></a></h5><p>It is also possible to define the Ajax <code>dataType</code> explicitly while performing
requests for <code>data-remote</code> elements, by way of the <code>data-type</code> attribute.</p><h4 id="confirmations"><a class="anchorlink" href="#confirmations">3.3 Confirmations</a></h4><p>You can ask for an extra confirmation of the user by adding a <code>data-confirm</code>
attribute on links and forms. The user will be presented with a JavaScript <code>confirm()</code>
dialog containing the attribute's text. If the user chooses to cancel, the action
doesn't take place.</p><p>Adding this attribute on links will trigger the dialog on click, and adding it
on forms will trigger it on submit. For example:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Dangerous zone"</span><span class="p">,</span> <span class="n">dangerous_zone_path</span><span class="p">,</span>
  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s1">'Are you sure?'</span> <span class="p">}</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e0406edd9b76040f4030391e9b4003aa">&lt;%= link_to "Dangerous zone", dangerous_zone_path,
  data: { confirm: 'Are you sure?' } %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e0406edd9b76040f4030391e9b4003aa">Copy</button>
</div>
<p>This generates:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"..."</span> <span class="na">data-confirm=</span><span class="s">"Are you sure?"</span><span class="nt">&gt;</span>Dangerous zone<span class="nt">&lt;/a&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1caa5c9e51f925fe42df7b8d5b3d283b">&lt;a href="..." data-confirm="Are you sure?"&gt;Dangerous zone&lt;/a&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1caa5c9e51f925fe42df7b8d5b3d283b">Copy</button>
</div>
<p>The attribute is also allowed on form submit buttons. This allows you to customize
the warning message depending on the button which was activated. In this case,
you should <strong>not</strong> have <code>data-confirm</code> on the form itself.</p><p>The default confirmation uses a JavaScript confirm dialog, but you can customize
this by listening to the <code>confirm</code> event, which is fired just before the confirmation
window appears to the user. To cancel this default confirmation, have the confirm
handler return <code>false</code>.</p><h4 id="automatic-disabling"><a class="anchorlink" href="#automatic-disabling">3.4 Automatic disabling</a></h4><p>It is also possible to automatically disable an input while the form is submitting
by using the <code>data-disable-with</code> attribute. This is to prevent accidental
double-clicks from the user, which could result in duplicate HTTP requests that
the backend may not detect as such. The value of the attribute is the text that will
become the new value of the button in its disabled state.</p><p>This also works for links with <code>data-method</code> attribute.</p><p>For example:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span><span class="p">(</span><span class="ss">model: </span><span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="ss">data: </span><span class="p">{</span> <span class="ss">disable_with: </span><span class="s2">"Saving..."</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-46b1ae6d468f24c94028c58091352a28">&lt;%= form_with(model: Article.new) do |form| %&gt;
  &lt;%= form.submit data: { disable_with: "Saving..." } %&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-46b1ae6d468f24c94028c58091352a28">Copy</button>
</div>
<p>This generates a form with:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;input</span> <span class="na">data-disable-with=</span><span class="s">"Saving..."</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-e12fa94a75448b63c75c6085018d2c70">&lt;input data-disable-with="Saving..." type="submit"&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-e12fa94a75448b63c75c6085018d2c70">Copy</button>
</div>
<h4 id="rails-ujs-event-handlers"><a class="anchorlink" href="#rails-ujs-event-handlers">3.5 Rails-ujs event handlers</a></h4><p>Rails 5.1 introduced rails-ujs and dropped jQuery as a dependency.
As a result the Unobtrusive JavaScript (UJS) driver has been rewritten to operate without jQuery.
These introductions cause small changes to <code>custom events</code> fired during the request:</p><div class="note"><p>Signature of calls to UJS's event handlers has changed.
Unlike the version with jQuery, all custom events return only one parameter: <code>event</code>.
In this parameter, there is an additional attribute <code>detail</code> which contains an array of extra parameters.
For information about the previously used <code>jquery-ujs</code> in Rails 5 and earlier, read the <a href="https://github.com/rails/jquery-ujs/wiki/ajax"><code>jquery-ujs</code> wiki</a>.</p></div>
<table>
<thead>
<tr>
<th>Event name</th>
<th>Extra parameters (event.detail)</th>
<th>Fired</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ajax:before</code></td>
<td></td>
<td>Before the whole ajax business.</td>
</tr>
<tr>
<td><code>ajax:beforeSend</code></td>
<td>[xhr, options]</td>
<td>Before the request is sent.</td>
</tr>
<tr>
<td><code>ajax:send</code></td>
<td>[xhr]</td>
<td>When the request is sent.</td>
</tr>
<tr>
<td><code>ajax:stopped</code></td>
<td></td>
<td>When the request is stopped.</td>
</tr>
<tr>
<td><code>ajax:success</code></td>
<td>[response, status, xhr]</td>
<td>After completion, if the response was a success.</td>
</tr>
<tr>
<td><code>ajax:error</code></td>
<td>[response, status, xhr]</td>
<td>After completion, if the response was an error.</td>
</tr>
<tr>
<td><code>ajax:complete</code></td>
<td>[xhr, status]</td>
<td>After the request has been completed, no matter the outcome.</td>
</tr>
</tbody>
</table>
<p>Example usage:</p><div class="code_container">
<pre><code class="highlight js"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">ajax:success</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">;</span>
<span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6ee700f863adead1bdb8989bbf819993">document.body.addEventListener("ajax:success", (event) =&gt; {
  const [data, status, xhr] = event.detail;
});
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6ee700f863adead1bdb8989bbf819993">Copy</button>
</div>
<h4 id="stoppable-events"><a class="anchorlink" href="#stoppable-events">3.6 Stoppable events</a></h4><p>You can stop execution of the Ajax request by running <code>event.preventDefault()</code>
from the handlers methods <code>ajax:before</code> or <code>ajax:beforeSend</code>.
The <code>ajax:before</code> event can manipulate form data before serialization and the
<code>ajax:beforeSend</code> event is useful for adding custom request headers.</p><p>If you stop the <code>ajax:aborted:file</code> event, the default behavior of allowing the
browser to submit the form via normal means (i.e. non-Ajax submission) will be
canceled and the form will not be submitted at all. This is useful for
implementing your own Ajax file upload workaround.</p><p>Note, you should use <code>return false</code> to prevent an event for <code>jquery-ujs</code> and
<code>event.preventDefault()</code> for <code>rails-ujs</code>.</p><h3 id="server-side-concerns"><a class="anchorlink" href="#server-side-concerns">4 Server-Side Concerns</a></h3><p>Ajax isn't just client-side, you also need to do some work on the server
side to support it. Often, people like their Ajax requests to return JSON
rather than HTML. Let's discuss what it takes to make that happen.</p><h4 id="a-simple-example"><a class="anchorlink" href="#a-simple-example">4.1 A Simple Example</a></h4><p>Imagine you have a series of users that you would like to display and provide a
form on that same page to create a new user. The index action of your
controller looks like this:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">all</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-75640dddfcd2cf9d26e90b32a6bb7cca">class UsersController &lt; ApplicationController
  def index
    @users = User.all
    @user = User.new
  end
  # ...
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-75640dddfcd2cf9d26e90b32a6bb7cca">Copy</button>
</div>
<p>The index view (<code>app/views/users/index.html.erb</code>) contains:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;b&gt;</span>Users<span class="nt">&lt;/b&gt;</span>

<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"users"</span><span class="nt">&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@users</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;br&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@user</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:name</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-105c4b056bdcb08f2ed7eee68ecf04e2">&lt;b&gt;Users&lt;/b&gt;

&lt;ul id="users"&gt;
&lt;%= render @users %&gt;
&lt;/ul&gt;

&lt;br&gt;

&lt;%= form_with model: @user do |form| %&gt;
  &lt;%= form.label :name %&gt;&lt;br&gt;
  &lt;%= form.text_field :name %&gt;
  &lt;%= form.submit %&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-105c4b056bdcb08f2ed7eee68ecf04e2">Copy</button>
</div>
<p>The <code>app/views/users/_user.html.erb</code> partial contains the following:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-af4b1e00d84bf6014f57b4cf14e16723">&lt;li&gt;&lt;%= user.name %&gt;&lt;/li&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-af4b1e00d84bf6014f57b4cf14e16723">Copy</button>
</div>
<p>The top portion of the index page displays the users. The bottom portion
provides a form to create a new user.</p><p>The bottom form will call the <code>create</code> action on the <code>UsersController</code>. Because
the form's remote option is set to true, the request will be posted to the
<code>UsersController</code> as an Ajax request, looking for JavaScript. In order to
serve that request, the <code>create</code> action of your controller would look like
this:</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="c1"># app/controllers/users_controller.rb</span>
  <span class="c1"># ......</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">])</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">if</span> <span class="vi">@user</span><span class="p">.</span><span class="nf">save</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="vi">@user</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'User was successfully created.'</span> <span class="p">}</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">js</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@user</span><span class="p">,</span> <span class="ss">status: :created</span><span class="p">,</span> <span class="ss">location: </span><span class="vi">@user</span> <span class="p">}</span>
      <span class="k">else</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">action: </span><span class="s2">"new"</span> <span class="p">}</span>
        <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json: </span><span class="vi">@user</span><span class="p">.</span><span class="nf">errors</span><span class="p">,</span> <span class="ss">status: :unprocessable_entity</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-474151b3558d9efcb4aa85cd9b879946">  # app/controllers/users_controller.rb
  # ......
  def create
    @user = User.new(params[:user])

    respond_to do |format|
      if @user.save
        format.html { redirect_to @user, notice: 'User was successfully created.' }
        format.js
        format.json { render json: @user, status: :created, location: @user }
      else
        format.html { render action: "new" }
        format.json { render json: @user.errors, status: :unprocessable_entity }
      end
    end
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-474151b3558d9efcb4aa85cd9b879946">Copy</button>
</div>
<p>Notice the <code>format.js</code> in the <code>respond_to</code> block: that allows the controller to
respond to your Ajax request. You then have a corresponding
<code>app/views/users/create.js.erb</code> view file that generates the actual JavaScript
code that will be sent and executed on the client side.</p><div class="code_container">
<pre><code class="highlight js"><span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#users</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">users</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">"</span><span class="s2">beforeend</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&lt;%= j render(@user) %&gt;</span><span class="dl">"</span><span class="p">);</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-a9f59a2fb15b63b484339ea58bc59d26">var users = document.querySelector("#users");
users.insertAdjacentHTML("beforeend", "&lt;%= j render(@user) %&gt;");
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a9f59a2fb15b63b484339ea58bc59d26">Copy</button>
</div>
<div class="note"><p>JavaScript view rendering doesn't do any preprocessing, so you shouldn't use ES6 syntax here.</p></div><h3 id="turbolinks"><a class="anchorlink" href="#turbolinks">5 Turbolinks</a></h3><p>Rails ships with the <a href="https://github.com/turbolinks/turbolinks">Turbolinks library</a>,
which uses Ajax to speed up page rendering in most applications.</p><h4 id="how-turbolinks-works"><a class="anchorlink" href="#how-turbolinks-works">5.1 How Turbolinks Works</a></h4><p>Turbolinks attaches a click handler to all <code>&lt;a&gt;</code> tags on the page. If your browser
supports
<a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history#The_pushState%28%29_method">PushState</a>,
Turbolinks will make an Ajax request for the page, parse the response, and
replace the entire <code>&lt;body&gt;</code> of the page with the <code>&lt;body&gt;</code> of the response. It
will then use PushState to change the URL to the correct one, preserving
refresh semantics and giving you pretty URLs.</p><p>If you want to disable Turbolinks for certain links, add a <code>data-turbolinks="false"</code>
attribute to the tag:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"..."</span> <span class="na">data-turbolinks=</span><span class="s">"false"</span><span class="nt">&gt;</span>No turbolinks here<span class="nt">&lt;/a&gt;</span>.
</code></pre>
<textarea class="clipboard-content" id="clipboard-18a8e37453d0bebae24c9874b79d7447">&lt;a href="..." data-turbolinks="false"&gt;No turbolinks here&lt;/a&gt;.
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-18a8e37453d0bebae24c9874b79d7447">Copy</button>
</div>
<h4 id="page-change-events"><a class="anchorlink" href="#page-change-events">5.2 Page Change Events</a></h4><p>You'll often want to do some sort of processing upon
page load. Using the DOM, you'd write something like this:</p><div class="code_container">
<pre><code class="highlight js"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">page has loaded!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f35eee57f9f45749555e144253d7ec9c">window.addEventListener("load", () =&gt; {
  alert("page has loaded!");
});
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f35eee57f9f45749555e144253d7ec9c">Copy</button>
</div>
<p>However, because Turbolinks overrides the normal page loading process, the
event that this relies upon will not be fired. If you have code that looks like
this, you must change your code to do this instead:</p><div class="code_container">
<pre><code class="highlight js"><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">turbolinks:load</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">page has loaded!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-fecb8dee08f73873f1f9e76e6b7d3015">document.addEventListener("turbolinks:load", () =&gt; {
  alert("page has loaded!");
});
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-fecb8dee08f73873f1f9e76e6b7d3015">Copy</button>
</div>
<p>For more details, including other events you can bind to, check out <a href="https://github.com/turbolinks/turbolinks/blob/master/README.md">the
Turbolinks
README</a>.</p><h3 id="cross-site-request-forgery-csrf-token-in-ajax"><a class="anchorlink" href="#cross-site-request-forgery-csrf-token-in-ajax">6 Cross-Site Request Forgery (CSRF) token in Ajax</a></h3><p>When using another library to make Ajax calls, it is necessary to add
the security token as a default header for Ajax calls in your library. To get
the token:</p><div class="code_container">
<pre><code class="highlight js"><span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">csrf-token</span><span class="dl">"</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">content</span><span class="p">;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-83696af887fc4c34dfada2e8d41e418b">const token = document.getElementsByName(
  "csrf-token"
)[0].content;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-83696af887fc4c34dfada2e8d41e418b">Copy</button>
</div>
<p>You can then submit this token as a <code>X-CSRF-Token</code> header for your
Ajax request. You do not need to add a CSRF token for GET requests,
only non-GET ones.</p><p>You can read more about about Cross-Site Request Forgery in the <a href="https://guides.rubyonrails.org/security.html#cross-site-request-forgery-csrf">Security guide</a>.</p><h3 id="other-resources"><a class="anchorlink" href="#other-resources">7 Other Resources</a></h3><p>Here are some helpful links to help you learn even more:</p>
<ul>
<li><a href="https://github.com/rails/rails/tree/master/actionview/app/assets/javascripts">rails-ujs wiki</a></li>
<li><a href="http://railscasts.com/episodes/205-unobtrusive-javascript">Railscasts: Unobtrusive JavaScript</a></li>
<li><a href="http://railscasts.com/episodes/390-turbolinks">Railscasts: Turbolinks</a></li>
</ul>


        <h3>回饋</h3>
        <p>
          我們鼓勵您幫助提高本指南的質量。
        </p>
        <p>
          如果您發現任何錯別字或事實錯誤，請做出貢獻。
          首先，您可以閱讀我們的 <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">文件貢獻</a> 部分。
        </p>
        <p>
          您可能還會發現內容不完整或不是最新的內容。請為母版添加任何缺少的文檔。確保首先檢查
          <a href="https://edgeguides.rubyonrails.org">Edge Guides</a> 以驗證問題是否已在master分支上解決。
          查看 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a> 的樣式和約定。
        </p>
        <p>
          如果出於任何原因您發現了要修復的東西但自己無法修補，請 <a href="https://github.com/rails/rails/issues">建立一個 issue</a>.
        </p>
        <p>最後但並非最不重要的一點是，在 <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">rubyonrails-docs 郵件列表</a> 上非常歡迎進行有關Ruby on Rails文檔的任何討論。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>該著作已根據 <a href="https://creativecommons.org/licenses/by-sa/4.0/">知識共享署名-相同方式共享 4.0 國際版</a> 許可</ p>
<p> “Rails”、“Ruby on Rails” 和 “Rails 標誌” 是 David Heinemeier Hansson 的註冊商標。保留所有權利。</ p>
    </div>
  </div>
</body>
</html>
