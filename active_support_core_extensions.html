<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Active Support 核心擴充套件 — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Active Support 核心擴充套件 — Ruby on Rails Guides" />
  <meta name="description" content="Active Support 核心擴充套件Active Support 是負責提供 Ruby 的 Rails 元件上的 Ruby 語言擴充套件和實用程式。它在語言級別提供了更豐富的底線，既針對 Rails 應用程式的開發，也針對在 Rails 本身上開發 Ruby。閱讀本指南後，您將瞭解： 什麼是核心擴充套件。 如何載入所有擴充套件。 如何挑選你想要的擴充套件。 Active Support 提供哪些擴充套件。" />
  <meta property="og:description" content="Active Support 核心擴充套件Active Support 是負責提供 Ruby 的 Rails 元件上的 Ruby 語言擴充套件和實用程式。它在語言級別提供了更豐富的底線，既針對 Rails 應用程式的開發，也針對在 Rails 本身上開發 Ruby。閱讀本指南後，您將瞭解： 什麼是核心擴充套件。 如何載入所有擴充套件。 如何挑選你想要的擴充套件。 Active Support 提供哪些擴充套件。" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v7.0.0</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多資訊請前往 <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多在 Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">部落格</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">論壇</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 上做出貢獻</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">手冊目錄</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>從這裡開始</dt>
                  <dd><a href="getting_started.html">Rails 入門</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record 遷移 (Migrations)</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 驗證 (Validations)</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record 回呼 (Callbacks)</a></dd>
                  <dd><a href="association_basics.html">Active Record 關聯 (Associations)</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查詢介面</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 中的版面配置(Layouts)和算繪(Rendering)</a></dd>
                  <dd><a href="form_helpers.html">Action View 表單 Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller 概述</a></dd>
                  <dd><a href="routing.html">Rails 從外到內路由</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他元件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心擴充套件</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基礎知識</a></dd>
                  <dd><a href="active_job_basics.html">Active Job 基礎</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 概述</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 概述</a></dd>
                  <dd><a href="webpacker.html">Webpacker</a></dd>
                </div>
                <div class="guides-section">
                  <dt>深入研究</dt>
                  <dd><a href="i18n.html">Rails 國際化 (I18n) API</a></dd>
                  <dd><a href="testing.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="security.html">保護 Rails 應用程式</a></dd>
                  <dd><a href="debugging_rails_applications.html">除錯 Rails 應用程式</a></dd>
                  <dd><a href="configuring.html">設定 Rails 應用程式</a></dd>
                  <dd><a href="command_line.html">Rails 命令列</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自動載入和重新載入常量</a></dd>
                  <dd><a href="caching_with_rails.html">使用 Rails 快取</a></dd>
                  <dd><a href="api_app.html">將 Rails 用於僅 API 的應用程式</a></dd>
                </div>
                <div class="guides-section">
                  <dt>擴充 rails</dt>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">建立和自定義 Rails 產生器和模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>貢獻</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文件指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南指南</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策</dt>
                  <dd><a href="maintenance_policy.html">維修政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>發行說明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</a></dd>
                  <dd><a href="6_1_release_notes.html">6.1 版 - 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版 - 2019 年 8 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版 - 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版 - 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版 - 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版 - 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版 - 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版 - 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版 - 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版 - 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版 - 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版 - 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版 - 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">手冊目錄</option>
              <optgroup label="從這裡開始">
                  <option value="getting_started.html">Rails 入門</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="active_record_migrations.html">Active Record 遷移 (Migrations)</option>
                  <option value="active_record_validations.html">Active Record 驗證 (Validations)</option>
                  <option value="active_record_callbacks.html">Active Record 回呼 (Callbacks)</option>
                  <option value="association_basics.html">Active Record 關聯 (Associations)</option>
                  <option value="active_record_querying.html">Active Record 查詢介面</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 中的版面配置(Layouts)和算繪(Rendering)</option>
                  <option value="form_helpers.html">Action View 表單 Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller 概述</option>
                  <option value="routing.html">Rails 從外到內路由</option>
              </optgroup>
              <optgroup label="其他元件">
                  <option value="active_support_core_extensions.html">Active Support 核心擴充套件</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎知識</option>
                  <option value="active_job_basics.html">Active Job 基礎</option>
                  <option value="active_storage_overview.html">Active Storage 概述</option>
                  <option value="action_cable_overview.html">Action Cable 概述</option>
                  <option value="webpacker.html">Webpacker</option>
              </optgroup>
              <optgroup label="深入研究">
                  <option value="i18n.html">Rails 國際化 (I18n) API</option>
                  <option value="testing.html">測試 Rails 應用程式</option>
                  <option value="security.html">保護 Rails 應用程式</option>
                  <option value="debugging_rails_applications.html">除錯 Rails 應用程式</option>
                  <option value="configuring.html">設定 Rails 應用程式</option>
                  <option value="command_line.html">Rails 命令列</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="autoloading_and_reloading_constants.html">自動載入和重新載入常量</option>
                  <option value="caching_with_rails.html">使用 Rails 快取</option>
                  <option value="api_app.html">將 Rails 用於僅 API 的應用程式</option>
              </optgroup>
              <optgroup label="擴充 rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">建立和自定義 Rails 產生器和模板</option>
              </optgroup>
              <optgroup label="貢獻">
                  <option value="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</option>
                  <option value="api_documentation_guidelines.html">API 文件指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南指南</option>
              </optgroup>
              <optgroup label="政策">
                  <option value="maintenance_policy.html">維修政策</option>
              </optgroup>
              <optgroup label="發行說明">
                  <option value="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</option>
                  <option value="6_1_release_notes.html">6.1 版 - 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版 - 2019 年 8 月</option>
                  <option value="5_2_release_notes.html">5.2 版 - 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版 - 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版 - 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版 - 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版 - 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版 - 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版 - 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版 - 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版 - 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版 - 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版 - 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Support 核心擴充套件</h2><p>Active Support 是負責提供 Ruby 的 Rails 元件上的 Ruby
語言擴充套件和實用程式。</p><p>它在語言級別提供了更豐富的底線，既針對 Rails 應用程式的開發，也針對在 Rails 本身上開發 Ruby。</p><p>閱讀本指南後，您將瞭解：</p>
<ul>
<li>什麼是核心擴充套件。</li>
<li>如何載入所有擴充套件。</li>
<li>如何挑選你想要的擴充套件。</li>
<li>Active Support 提供哪些擴充套件。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#">如何載入核心擴充套件</a>

<ul>
<li><a href="#active-support">獨立式 Active Support</a></li>
<li><a href="#active-support-ruby-on-rails">Active Support 在 Ruby on Rails 應用程式中</a></li>
</ul>
</li>
<li>
<a href="#">所有物件的擴充套件</a>

<ul>
<li><a href="#blank-questionmark-present-questionmark"><code>blank?</code> 和 <code>present?</code></a></li>
<li><a href="#presence"><code>presence</code></a></li>
<li><a href="#duplicable-questionmark"><code>duplicable?</code></a></li>
<li><a href="#deep-dup"><code>deep_dup</code></a></li>
<li><a href="#try"><code>try</code></a></li>
<li><a href="#class-eval-args-block"><code>class_eval(*args, &amp;block)</code></a></li>
<li><a href="#acts-like-questionmark-duck"><code>acts_like?(duck)</code></a></li>
<li><a href="#to-param"><code>to_param</code></a></li>
<li><a href="#to-query"><code>to_query</code></a></li>
<li><a href="#with-options"><code>with_options</code></a></li>
<li><a href="#json">JSON 支援</a></li>
<li><a href="#">實例變數</a></li>
<li><a href="#">靜默警告和異常</a></li>
<li><a href="#in-questionmark"><code>in?</code></a></li>
</ul>
</li>
<li>
<a href="#module"><code>Module</code> 的擴充套件</a>

<ul>
<li><a href="#">屬性</a></li>
<li><a href="#">家長</a></li>
<li><a href="#">匿名</a></li>
<li><a href="#">方法委託</a></li>
<li><a href="#">重新定義方法</a></li>
</ul>
</li>
<li>
<a href="#class"><code>Class</code> 的擴充套件</a>

<ul>
<li><a href="#">類屬性</a></li>
<li><a href="#">子類和後代</a></li>
</ul>
</li>
<li>
<a href="#string"><code>String</code> 的擴充套件</a>

<ul>
<li><a href="#">輸出安全</a></li>
<li><a href="#remove"><code>remove</code></a></li>
<li><a href="#squish"><code>squish</code></a></li>
<li><a href="#truncate"><code>truncate</code></a></li>
<li><a href="#truncate-bytes"><code>truncate_bytes</code></a></li>
<li><a href="#truncate-words"><code>truncate_words</code></a></li>
<li><a href="#inquiry"><code>inquiry</code></a></li>
<li><a href="#string-starts-with-questionmark-ends-with-questionmark"><code>starts_with?</code> 和 <code>ends_with?</code></a></li>
<li><a href="#strip-heredoc"><code>strip_heredoc</code></a></li>
<li><a href="#indent"><code>indent</code></a></li>
<li><a href="#string-">訪問</a></li>
<li><a href="#">拐點</a></li>
<li><a href="#string-">轉換</a></li>
</ul>
</li>
<li>
<a href="#symbol"><code>Symbol</code> 的擴充套件</a>

<ul>
<li><a href="#symbol-starts-with-questionmark-ends-with-questionmark"><code>starts_with?</code> 和 <code>ends_with?</code></a></li>
</ul>
</li>
<li>
<a href="#numeric"><code>Numeric</code> 的擴充套件</a>

<ul>
<li><a href="#">位元組</a></li>
<li><a href="#numeric-">時間</a></li>
<li><a href="#">格式</a></li>
</ul>
</li>
<li>
<a href="#integer"><code>Integer</code> 的擴充套件</a>

<ul>
<li><a href="#multiple-of-questionmark"><code>multiple_of?</code></a></li>
<li><a href="#ordinal"><code>ordinal</code></a></li>
<li><a href="#ordinalize"><code>ordinalize</code></a></li>
<li><a href="#integer">時間</a></li>
</ul>
</li>
<li>
<a href="#bigdecimal"><code>BigDecimal</code> 的擴充套件</a>

<ul>
<li><a href="#bigdecimal-to-s"><code>to_s</code></a></li>
</ul>
</li>
<li>
<a href="#enumerable"><code>Enumerable</code> 的擴充套件</a>

<ul>
<li><a href="#sum"><code>sum</code></a></li>
<li><a href="#index-by"><code>index_by</code></a></li>
<li><a href="#index-with"><code>index_with</code></a></li>
<li><a href="#many-questionmark"><code>many?</code></a></li>
<li><a href="#exclude-questionmark"><code>exclude?</code></a></li>
<li><a href="#including"><code>including</code></a></li>
<li><a href="#excluding"><code>excluding</code></a></li>
<li><a href="#pluck"><code>pluck</code></a></li>
<li><a href="#pick"><code>pick</code></a></li>
</ul>
</li>
<li>
<a href="#array"><code>Array</code> 的擴充套件</a>

<ul>
<li><a href="#array">訪問</a></li>
<li><a href="#array-">提取</a></li>
<li><a href="#extraction">期權 Extraction</a></li>
<li><a href="#array">轉換</a></li>
<li><a href="#">包裝</a></li>
<li><a href="#array">複製</a></li>
<li><a href="#">分組</a></li>
</ul>
</li>
<li>
<a href="#hash"><code>Hash</code> 的擴充套件</a>

<ul>
<li><a href="#hash-">轉換</a></li>
<li><a href="#">合併</a></li>
<li><a href="#">深度複製</a></li>
<li><a href="#keys">使用 Keys</a></li>
<li><a href="#values">使用 Values</a></li>
<li><a href="#">切片</a></li>
<li><a href="#hash">提取</a></li>
<li><a href="#">無差別訪問</a></li>
</ul>
</li>
<li>
<a href="#regexp"><code>Regexp</code> 的擴充套件</a>

<ul>
<li><a href="#multiline-questionmark"><code>multiline?</code></a></li>
</ul>
</li>
<li>
<a href="#range"><code>Range</code> 的擴充套件</a>

<ul>
<li><a href="#range-to-s"><code>to_s</code></a></li>
<li><a href="#include-questionmark"><code>===</code> 和 <code>include?</code></a></li>
<li><a href="#overlaps-questionmark"><code>overlaps?</code></a></li>
</ul>
</li>
<li>
<a href="#date"><code>Date</code> 的擴充套件</a>

<ul>
<li><a href="#date-">計算</a></li>
<li><a href="#date">轉換</a></li>
</ul>
</li>
<li>
<a href="#datetime"><code>DateTime</code> 的擴充套件</a>

<ul>
<li><a href="#datetime">計算</a></li>
</ul>
</li>
<li>
<a href="#time"><code>Time</code> 的擴充套件</a>

<ul>
<li><a href="#">計算</a></li>
<li><a href="#">時間建構函式</a></li>
</ul>
</li>
<li>
<a href="#file"><code>File</code> 的擴充套件</a>

<ul>
<li><a href="#atomic-write"><code>atomic_write</code></a></li>
</ul>
</li>
<li><a href="#nameerror"><code>NameError</code> 的擴充套件</a></li>
<li><a href="#loaderror"><code>LoadError</code> 的擴充套件</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id=""><a class="anchorlink" href="#">1 如何載入核心擴充套件</a></h3><h4 id="active-support"><a class="anchorlink" href="#active-support">1.1 獨立式 Active Support</a></h4><p>為了儘可能減少預設佔用空間，Active Support 預設載入最小依賴項。它被分成小塊，以便只能載入所需的擴充套件。它還具有一些方便的入口點，可以一次性載入相關擴充套件，甚至是所有內容。</p><p>因此，在一個簡單的要求之後：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
'>Copy</button>
</div>
<p>僅載入 Active Support 框架所需的擴充套件。</p><h5 id=""><a class="anchorlink" href="#">1.1.1 挑選定義</a></h5><p>此示例顯示如何載入 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-with_indifferent_access"><code>Hash#with_indifferent_access</code></a>。此擴充套件允許將 <code>Hash</code> 轉換為 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActiveSupport/HashWithIndifferentAccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a>，允許以字串或 symbols 的形式訪問 keys。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.with_indifferent_access["a"] # =&gt; 1
'>Copy</button>
</div>
<p>對於定義為核心擴充套件的每個方法，本指南都有一個註釋，說明在哪裡定義了這樣的方法。在 <code>with_indifferent_access</code> 的情況下，註釋如下：</p><div class="note"><p>在 <code>active_support/core_ext/hash/indifferent_access.rb</code> 中定義。</p></div><p>這意味著您可以像這樣要求它：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/hash/indifferent_access"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
require "active_support/core_ext/hash/indifferent_access"
'>Copy</button>
</div>
<p>Active Support 已經過仔細修改，以便挑選檔案僅載入嚴格需要的依賴項（如果有）。</p><h5 id=""><a class="anchorlink" href="#">1.1.2 載入分組核心擴充套件</a></h5><p>下一級是簡單地將所有擴充套件載入到 <code>Hash</code>。根據經驗，可以透過載入 <code>active_support/core_ext/some_class</code> 一次性獲得對 <code>SomeClass</code> 的擴充套件。</p><p>因此，要將所有擴充套件載入到 <code>Hash</code>（包括 <code>with_indifferent_access</code>）：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext/hash"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
require "active_support/core_ext/hash"
'>Copy</button>
</div>
<h5 id=""><a class="anchorlink" href="#">1.1.3 載入所有核心擴充套件</a></h5><p>你可能更喜歡只加載所有核心擴充套件，有一個檔案：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support"</span>
<span class="nb">require</span> <span class="s2">"active_support/core_ext"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
require "active_support/core_ext"
'>Copy</button>
</div>
<h5 id="active-support"><a class="anchorlink" href="#active-support">1.1.4 載入所有 Active Support</a></h5><p>最後，如果您想讓所有 Active Support 可用，只需發出：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s2">"active_support/all"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support/all"
'>Copy</button>
</div>
<p>這甚至沒有將整個 Active Support 預先放在記憶體中，有些東西是透過 <code>autoload</code> 設定的，所以只有在使用時才會載入。</p><h4 id="active-support-ruby-on-rails"><a class="anchorlink" href="#active-support-ruby-on-rails">1.2 Active Support 在 Ruby on Rails 應用程式中</a></h4><p>除非 <code>config.active_support.bare</code> 為真，否則 Rails 應用程式上的 Ruby 會載入所有 Active Support。在這種情況下，應用程式將只加載框架本身根據自己的需要挑選的內容，並且仍然可以在任何粒度級別挑選自己，如上一節所述。</p><h3 id=""><a class="anchorlink" href="#">2 所有物件的擴充套件</a></h3><h4 id="blank-questionmark-present-questionmark"><a class="anchorlink" href="#blank-questionmark-present-questionmark">2.1 <code>blank?</code> 和 <code>present?</code></a></h4><p>以下 values 在 Rails 應用程式中被視為空白：</p>
<ul>
<li><p><code>nil</code> 和 <code>false</code>，</p></li>
<li><p>僅由空格組成的字串（見下面的註釋），</p></li>
<li><p>空陣列和雜湊，以及</p></li>
<li><p>任何其他回應 <code>empty?</code> 且為空的物件。</p></li>
</ul>
<p>資訊：字串的謂詞使用可識別 Unicode 的字元類 <code>[:space:]</code>，因此例如 U+2029（段落分隔符）被認為是空格。</p><p>警告：請注意，未提及數字。特別是，0 和 0.0 是 <strong>not</strong> 空白。</p><p>例如，來自 <code>ActionController::HttpAuthentication::Token::ControllerMethods</code> 的這個方法使用 [<code>blank?</code>][Object#blank?] 來檢查 token 是否存在：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">login_procedure</span><span class="p">)</span>
  <span class="n">token</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">token_and_options</span><span class="p">(</span><span class="n">controller</span><span class="p">.</span><span class="nf">request</span><span class="p">)</span>
  <span class="k">unless</span> <span class="n">token</span><span class="p">.</span><span class="nf">blank?</span>
    <span class="n">login_procedure</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def authenticate(controller, &amp;login_procedure)
  token, options = token_and_options(controller.request)
  unless token.blank?
    login_procedure.call(token, options)
  end
end
">Copy</button>
</div>
<p>方法 [<code>present?</code>][Object#present?] 等價於 <code>!blank?</code>。此示例取自 <code>ActionDispatch::Http::Cache::Response</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">set_conditional_cache_control!</span>
  <span class="k">return</span> <span class="k">if</span> <span class="nb">self</span><span class="p">[</span><span class="s2">"Cache-Control"</span><span class="p">].</span><span class="nf">present?</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def set_conditional_cache_control!
  return if self["Cache-Control"].present?
  # ...
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/blank.rb</code> 中定義。</p></div><h4 id="presence"><a class="anchorlink" href="#presence">2.2 <code>presence</code></a></h4><p>如果 <code>present?</code>，則 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-presence"><code>presence</code></a> 方法返回其接收者，否則返回 <code>nil</code>。它對像這樣的習語很有用：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">host</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="ss">:host</span><span class="p">].</span><span class="nf">presence</span> <span class="o">||</span> <span class="s1">'localhost'</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="host = config[:host].presence || 'localhost'
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/blank.rb</code> 中定義。</p></div><h4 id="duplicable-questionmark"><a class="anchorlink" href="#duplicable-questionmark">2.3 <code>duplicable?</code></a></h4><p>從 Ruby 2.5 開始，大多數物件都可以透過 <code>dup</code> 或 <code>clone</code> 複製：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">dup</span>           <span class="c1"># =&gt; "foo"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">dup</span>              <span class="c1"># =&gt; ""</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">dup</span>     <span class="c1"># =&gt; (1/1)</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nf">dup</span>      <span class="c1"># =&gt; (0+0i)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">dup</span>    <span class="c1"># =&gt; TypeError (allocator undefined for Method)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo".dup           # =&gt; "foo"
"".dup              # =&gt; ""
Rational(1).dup     # =&gt; (1/1)
Complex(0).dup      # =&gt; (0+0i)
1.method(:+).dup    # =&gt; TypeError (allocator undefined for Method)
'>Copy</button>
</div>
<p>Active Support 提供 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-duplicable-3F"><code>duplicable?</code></a> 來查詢一個物件：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">duplicable?</span>           <span class="c1"># =&gt; true</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">duplicable?</span>              <span class="c1"># =&gt; true</span>
<span class="no">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>     <span class="c1"># =&gt; true</span>
<span class="no">Complex</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">duplicable?</span>      <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">method</span><span class="p">(:</span><span class="o">+</span><span class="p">).</span><span class="nf">duplicable?</span>    <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo".duplicable?           # =&gt; true
"".duplicable?              # =&gt; true
Rational(1).duplicable?     # =&gt; true
Complex(1).duplicable?      # =&gt; true
1.method(:+).duplicable?    # =&gt; false
'>Copy</button>
</div>
<p>警告：任何類都可以透過刪除 <code>dup</code> 和 <code>clone</code> 或從中引發異常來禁止重複。因此只有 <code>rescue</code> 可以判斷給定的任意物件是否可複製。 <code>duplicable?</code> 依賴於上面的硬編碼列表，但它比 <code>rescue</code> 快得多。僅當您知道硬編碼列表在您的用例中就足夠了時才使用它。</p><div class="note"><p>在 <code>active_support/core_ext/object/duplicable.rb</code> 中定義。</p></div><h4 id="deep-dup"><a class="anchorlink" href="#deep-dup">2.4 <code>deep_dup</code></a></h4><p>[<code>deep_dup</code>][Object#deep_dup] 方法返回給定物件的深層副本。通常，當您在 <code>dup</code> 一個物件中包含其他物件時，Ruby 不會 <code>dup</code> 它們，因此它會建立該物件的淺複製。例如，如果您有一個帶有字串的陣列，它將如下所示：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">'string'</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">push</span> <span class="s1">'another-string'</span>

<span class="c1"># 物件被複制，所以元素只新增到副本中</span>
<span class="n">array</span>     <span class="c1"># =&gt; ['string']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['string', 'another-string']</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'string'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>

<span class="c1"># 第一個元素沒有重複，它將在兩個陣列中更改</span>
<span class="n">array</span>     <span class="c1"># =&gt; ['foo']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['foo', 'another-string']</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="array     = ['string']
duplicate = array.dup

duplicate.push 'another-string'

# 物件被複制，所以元素只新增到副本中
array     # =&gt; ['string']
duplicate # =&gt; ['string', 'another-string']

duplicate.first.gsub!('string', 'foo')

# 第一個元素沒有重複，它將在兩個陣列中更改
array     # =&gt; ['foo']
duplicate # =&gt; ['foo', 'another-string']
">Copy</button>
</div>
<p>如您所見，複製 <code>Array</code> 實例後，我們得到了另一個物件，因此我們可以對其進行修改，原始物件保持不變。然而，對於陣列的元素而言，情況並非如此。由於 <code>dup</code> 沒有做深複製，數組裡面的字串還是同一個物件。</p><p>如果你需要一個物件的深複製，你應該使用 <code>deep_dup</code>。下面是一個例子：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">array</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">'string'</span><span class="p">]</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>

<span class="n">duplicate</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">gsub!</span><span class="p">(</span><span class="s1">'string'</span><span class="p">,</span> <span class="s1">'foo'</span><span class="p">)</span>

<span class="n">array</span>     <span class="c1"># =&gt; ['string']</span>
<span class="n">duplicate</span> <span class="c1"># =&gt; ['foo']</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="array     = ['string']
duplicate = array.deep_dup

duplicate.first.gsub!('string', 'foo')

array     # =&gt; ['string']
duplicate # =&gt; ['foo']
">Copy</button>
</div>
<p>如果物件不可複製，<code>deep_dup</code> 只會返回它：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">duplicate</span> <span class="o">=</span> <span class="n">number</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="n">number</span><span class="p">.</span><span class="nf">object_id</span> <span class="o">==</span> <span class="n">duplicate</span><span class="p">.</span><span class="nf">object_id</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="number = 1
duplicate = number.deep_dup
number.object_id == duplicate.object_id   # =&gt; true
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/deep_dup.rb</code> 中定義。</p></div><h4 id="try"><a class="anchorlink" href="#try">2.5 <code>try</code></a></h4><p>當您想僅在物件不是 <code>nil</code> 時呼叫該物件的方法時，實現它的最簡單方法是使用條件語句，從而增加不必要的混亂。另一種方法是使用 [<code>try</code>][Object#try]。 <code>try</code> 與 <code>Object#send</code> 類似，只是它如果傳送到 <code>nil</code> 則返回 <code>nil</code>。</p><p>下面是一個例子：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 沒有嘗試</span>
<span class="k">unless</span> <span class="vi">@number</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="vi">@number</span><span class="p">.</span><span class="nf">next</span>
<span class="k">end</span>

<span class="c1"># 嘗試</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:next</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 沒有嘗試
unless @number.nil?
  @number.next
end

# 嘗試
@number.try(:next)
">Copy</button>
</div>
<p>另一個例子是來自 <code>ActiveRecord::ConnectionAdapters::AbstractAdapter</code> 的這段程式碼，其中 <code>@logger</code> 可以是 <code>nil</code>。可以看到程式碼使用了<code>try</code>，避免了不必要的檢查。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">log_info</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
  <span class="k">if</span> <span class="vi">@logger</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:debug?</span><span class="p">)</span>
    <span class="nb">name</span> <span class="o">=</span> <span class="s1">'%s (%.1fms)'</span> <span class="o">%</span> <span class="p">[</span><span class="nb">name</span> <span class="o">||</span> <span class="s1">'SQL'</span><span class="p">,</span> <span class="n">ms</span><span class="p">]</span>
    <span class="vi">@logger</span><span class="p">.</span><span class="nf">debug</span><span class="p">(</span><span class="n">format_log_entry</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">sql</span><span class="p">.</span><span class="nf">squeeze</span><span class="p">(</span><span class="s1">' '</span><span class="p">)))</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def log_info(sql, name, ms)
  if @logger.try(:debug?)
    name = '%s (%.1fms)' % [name || 'SQL', ms]
    @logger.debug(format_log_entry(name, sql.squeeze(' ')))
  end
end
">Copy</button>
</div>
<p><code>try</code> 也可以不帶引數呼叫，只調用一個塊，只有當物件不為 nil 時才會執行：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@person</span><span class="p">.</span><span class="nf">try</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="nb">p</span><span class="p">.</span><span class="nf">last_name</span><span class="si">}</span><span class="s2">"</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='@person.try { |p| "#{p.first_name} #{p.last_name}" }
'>Copy</button>
</div>
<p>請注意，<code>try</code> 將吞下無方法錯誤，而是返回 nil。如果您想防止輸入錯誤，請改用 [<code>try!</code>][Object#try!]:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@number</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span>  <span class="c1"># =&gt; nil</span>
<span class="vi">@number</span><span class="p">.</span><span class="nf">try!</span><span class="p">(</span><span class="ss">:nest</span><span class="p">)</span> <span class="c1"># NoMethodError: undefined method `nest' for 1:Integer</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="@number.try(:nest)  # =&gt; nil
@number.try!(:nest) # NoMethodError: undefined method `nest' for 1:Integer
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/try.rb</code> 中定義。</p></div><h4 id="class-eval-args-block"><a class="anchorlink" href="#class-eval-args-block">2.6 <code>class_eval(*args, &amp;block)</code></a></h4><p>您可以使用 [<code>class_eval</code>][Kernel#class_eval] 在任何物件的單例類的上下文中評估程式碼：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Proc</span>
  <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="n">block</span><span class="p">,</span> <span class="n">time</span> <span class="o">=</span> <span class="nb">self</span><span class="p">,</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
    <span class="n">object</span><span class="p">.</span><span class="nf">class_eval</span> <span class="k">do</span>
      <span class="n">method_name</span> <span class="o">=</span> <span class="s2">"__bind_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">to_i</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">usec</span><span class="si">}</span><span class="s2">"</span>
      <span class="n">define_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
      <span class="nb">method</span> <span class="o">=</span> <span class="nb">instance_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="n">remove_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
      <span class="nb">method</span>
    <span class="k">end</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class Proc
  def bind(object)
    block, time = self, Time.current
    object.class_eval do
      method_name = "__bind_#{time.to_i}_#{time.usec}"
      define_method(method_name, &amp;block)
      method = instance_method(method_name)
      remove_method(method_name)
      method
    end.bind(object)
  end
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/kernel/singleton_class.rb</code> 中定義。</p></div><h4 id="acts-like-questionmark-duck"><a class="anchorlink" href="#acts-like-questionmark-duck">2.7 <code>acts_like?(duck)</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-acts_like-3F"><code>acts_like?</code></a> 提供了一種根據簡單約定來檢查某個類是否像其他類一樣的方法：提供與 <code>String</code> 定義的相同介面的類</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">acts_like_string?</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def acts_like_string?
end
">Copy</button>
</div>
<p>這只是一個標記，它的主體或返回 value 無關緊要。然後，客戶端程式碼可以透過這種方式查詢duck-type-safeness：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">some_klass</span><span class="p">.</span><span class="nf">acts_like?</span><span class="p">(</span><span class="ss">:string</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="some_klass.acts_like?(:string)
">Copy</button>
</div>
<p>Rails 有類似 <code>Date</code> 或 <code>Time</code> 的類，並遵循這個契約。</p><div class="note"><p>在 <code>active_support/core_ext/object/acts_like.rb</code> 中定義。</p></div><h4 id="to-param"><a class="anchorlink" href="#to-param">2.8 <code>to_param</code></a></h4><p>Rails 中的所有物件都回應方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-to_param"><code>to_param</code></a>，該方法的目標在於返回將它們表示為查詢字串中的 values 或 URL 片段的內容。</p><p>預設情況下，<code>to_param</code> 只調用 <code>to_s</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">7</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "7"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='7.to_param # =&gt; "7"
'>Copy</button>
</div>
<p><code>to_param</code> 的返回 value 應該<strong>不</strong>被轉義：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Tom &amp; Jerry"</span><span class="p">.</span><span class="nf">to_param</span> <span class="c1"># =&gt; "Tom &amp; Jerry"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Tom &amp; Jerry".to_param # =&gt; "Tom &amp; Jerry"
'>Copy</button>
</div>
<p>Rails 中的幾個類覆蓋了這個方法。</p><p>例如 <code>nil</code>、<code>true</code> 和 <code>false</code> 返回自身。 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-to_param"><code>Array#to_param</code></a> 對元素呼叫 <code>to_param</code> 並將結果與​​“/”連線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="no">String</span><span class="p">].</span><span class="nf">to_param</span> <span class="c1"># =&gt; "0/true/String"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[0, true, String].to_param # =&gt; "0/true/String"
'>Copy</button>
</div>
<p>值得注意的是，Rails 路由系統在 models 上呼叫 <code>to_param</code> 以獲得 <code>:id</code> 佔位符的 value。 <code>ActiveRecord::Base#to_param</code> 返回模型的 <code>id</code>，但您可以在 models 中重新定義該方法。例如，給定</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
'>Copy</button>
</div>
<p>我們得到：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">user_path</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="c1"># =&gt; "/users/357-john-smith"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='user_path(@user) # =&gt; "/users/357-john-smith"
'>Copy</button>
</div>
<p>警告。 Controller 需要注意對 <code>to_param</code> 的任何重新定義，因為當這樣的請求進入“357-john-smith”時是 <code>params[:id]</code> 的 value。</p><div class="note"><p>在 <code>active_support/core_ext/object/to_param.rb</code> 中定義。</p></div><h4 id="to-query"><a class="anchorlink" href="#to-query">2.9 <code>to_query</code></a></h4><p><a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-to_query"><code>to_query</code></a> 方法構造一個查詢字串，該字串將給定的 <code>key</code> 與 <code>to_param</code> 的返回 value 相關聯。例如，使用以下 <code>to_param</code> 定義：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">to_param</span>
    <span class="s2">"</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">parameterize</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
'>Copy</button>
</div>
<p>我們得到：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">current_user</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span> <span class="c1"># =&gt; "user=357-john-smith"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="current_user.to_query('user') # =&gt; &quot;user=357-john-smith&quot;
">Copy</button>
</div>
<p>此方法轉義了 key 和 value 所需的任何內容：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">account</span><span class="p">.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'company[name]'</span><span class="p">)</span>
<span class="c1"># =&gt; "company%5Bname%5D=Johnson+%26+Johnson"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="account.to_query('company[name]')
# =&gt; &quot;company%5Bname%5D=Johnson+%26+Johnson&quot;
">Copy</button>
</div>
<p>因此它的輸出已準備好用於查詢字串。</p><p>陣列返回將<code>to_query</code>應用於每個帶有<code>key[]</code>的元素的結果為key，並用“&amp;”連線結果：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mf">3.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.6</span><span class="p">].</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'sample'</span><span class="p">)</span>
<span class="c1"># =&gt; "樣本%5B%5D=3.4&amp;樣本%5B%5D=-45.6"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[3.4, -45.6].to_query('sample')
# =&gt; &quot;樣本%5B%5D=3.4&amp;樣本%5B%5D=-45.6&quot;
">Copy</button>
</div>
<p>雜湊也回應 <code>to_query</code>，但具有不同的簽名。如果沒有傳遞引數，呼叫會生成一系列排序的 key/值分配，在其 values 上呼叫 <code>to_query(key)</code>。然後用“&amp;”連線結果：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">c: </span><span class="mi">3</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">to_query</span> <span class="c1"># =&gt; "a=1&amp;b=2&amp;c=3"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{c: 3, b: 2, a: 1}.to_query # =&gt; "a=1&amp;b=2&amp;c=3"
'>Copy</button>
</div>
<p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-to_query"><code>Hash#to_query</code></a> 接受 keys 的可選名稱空間：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">id: </span><span class="mi">89</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"John Smith"</span><span class="p">}.</span><span class="nf">to_query</span><span class="p">(</span><span class="s1">'user'</span><span class="p">)</span>
<span class="c1"># =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{id: 89, name: &quot;John Smith&quot;}.to_query('user')
# =&gt; &quot;user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith&quot;
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/to_query.rb</code> 中定義。</p></div><h4 id="with-options"><a class="anchorlink" href="#with-options">2.10 <code>with_options</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-with_options"><code>with_options</code></a> 提供了一種在一系列方法呼叫中提取常見選項的方法。</p><p>給定預設選項雜湊，<code>with_options</code> 為塊生成代理物件。在塊內，代理上呼叫的方法被轉發到接收器，併合並了它們的選項。例如，你擺脫了重複：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:customers</span><span class="p">,</span> <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:products</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:invoices</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
  <span class="n">has_many</span> <span class="ss">:expenses</span><span class="p">,</span>  <span class="ss">dependent: :destroy</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account &lt; ApplicationRecord
  has_many :customers, dependent: :destroy
  has_many :products,  dependent: :destroy
  has_many :invoices,  dependent: :destroy
  has_many :expenses,  dependent: :destroy
end
">Copy</button>
</div>
<p>這邊走：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Account</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">with_options</span> <span class="ss">dependent: :destroy</span> <span class="k">do</span> <span class="o">|</span><span class="n">assoc</span><span class="o">|</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:customers</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:products</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:invoices</span>
    <span class="n">assoc</span><span class="p">.</span><span class="nf">has_many</span> <span class="ss">:expenses</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account &lt; ApplicationRecord
  with_options dependent: :destroy do |assoc|
    assoc.has_many :customers
    assoc.has_many :products
    assoc.has_many :invoices
    assoc.has_many :expenses
  end
end
">Copy</button>
</div>
<p>這個習語也可以向讀者傳達<em>分組</em>。例如，假設您要傳送其語言取決於使用者的時事通訊。在郵件程式的某個地方，您可以像這樣對依賴於語言環境的位進行分組：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">I18n</span><span class="p">.</span><span class="nf">with_options</span> <span class="ss">locale: </span><span class="n">user</span><span class="p">.</span><span class="nf">locale</span><span class="p">,</span> <span class="ss">scope: </span><span class="s2">"newsletter"</span> <span class="k">do</span> <span class="o">|</span><span class="n">i18n</span><span class="o">|</span>
  <span class="n">subject</span> <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:subject</span>
  <span class="n">body</span>    <span class="n">i18n</span><span class="p">.</span><span class="nf">t</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">user_name: </span><span class="n">user</span><span class="p">.</span><span class="nf">name</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='I18n.with_options locale: user.locale, scope: "newsletter" do |i18n|
  subject i18n.t :subject
  body    i18n.t :body, user_name: user.name
end
'>Copy</button>
</div>
<p>提示：由於 <code>with_options</code> 將呼叫轉發給其接收者，因此它們可以巢狀。除了自己的巢狀級別外，每個巢狀級別還將合併繼承的預設值。</p><div class="note"><p>在 <code>active_support/core_ext/object/with_options.rb</code> 中定義。</p></div><h4 id="json"><a class="anchorlink" href="#json">2.11 JSON 支援</a></h4><p>Active Support 提供了比 <code>json</code> gem 通常為 Ruby 物件提供的更好的 <code>to_json</code> 實現。這是因為某些類，如 <code>Hash</code> 和 <code>Process::Status</code> 需要特殊處理才能提供正確的 JSON 表示。</p><div class="note"><p>在 <code>active_support/core_ext/object/json.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">2.12 實例變數</a></h4><p>Active Support 提供了幾種方法來簡化對實例變數的訪問。</p><h5 id="instance-values"><a class="anchorlink" href="#instance-values">2.12.1 <code>instance_values</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-instance_values"><code>instance_values</code></a> 返回一個雜湊值，將沒有“@”的實例變數名稱對映到它們的
對應的 values。 Keys 是字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_values</span> <span class="c1"># =&gt; {"x" =&gt; 0, "y" =&gt; 1}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_values # =&gt; {"x" =&gt; 0, "y" =&gt; 1}
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/instance_variables.rb</code> 中定義。</p></div><h5 id="instance-variable-names"><a class="anchorlink" href="#instance-variable-names">2.12.2 <code>instance_variable_names</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Object.html#method-i-instance_variable_names"><code>instance_variable_names</code></a> 返回一個數組。每個名稱都包含“@”符號。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">C</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">instance_variable_names</span> <span class="c1"># =&gt; ["@x", "@y"]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_variable_names # =&gt; ["@x", "@y"]
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/instance_variables.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">2.13 靜默警告和異常</a></h4><p>方法 [<code>silence_warnings</code>][Kernel#silence_warnings] 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Kernel.html#method-i-enable_warnings"><code>enable_warnings</code></a> 相應地更改了 <code>$VERBOSE</code> 的 value 的塊持續時間，然後將其重置：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">silence_warnings</span> <span class="p">{</span> <span class="no">Object</span><span class="p">.</span><span class="nf">const_set</span> <span class="s2">"RAILS_DEFAULT_LOGGER"</span><span class="p">,</span> <span class="n">logger</span> <span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='silence_warnings { Object.const_set "RAILS_DEFAULT_LOGGER", logger }
'>Copy</button>
</div>
<p>[<code>suppress</code>][Kernel#suppress] 也可以消除異常。此方法接收任意數量的異常類。如果在塊執行期間引發異常並且是 <code>kind_of?</code> 的任何引數，則 <code>suppress</code> 捕獲它並靜默返回。否則不捕獲異常：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 如果使用者被鎖定，增量丟失，沒什麼大不了的。</span>
<span class="n">suppress</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">StaleObjectError</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_user</span><span class="p">.</span><span class="nf">increment!</span> <span class="ss">:visits</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 如果使用者被鎖定，增量丟失，沒什麼大不了的。
suppress(ActiveRecord::StaleObjectError) do
  current_user.increment! :visits
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/kernel/reporting.rb</code> 中定義。</p></div><h4 id="in-questionmark"><a class="anchorlink" href="#in-questionmark">2.14 <code>in?</code></a></h4><p>謂詞 [<code>in?</code>][Object#in?] 測試一個物件是否包含在另一個物件中。如果傳遞的引數沒有回應 <code>include?</code>，則會引發 <code>ArgumentError</code> 異常。</p><p><code>in?</code> 的示例：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>        <span class="c1"># =&gt; true</span>
<span class="s2">"lo"</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="mi">25</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">30</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span>      <span class="c1"># =&gt; false</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">in?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>            <span class="c1"># =&gt; ArgumentError</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='1.in?([1,2])        # =&gt; true
"lo".in?("hello")   # =&gt; true
25.in?(30..50)      # =&gt; false
1.in?(1)            # =&gt; ArgumentError
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/inclusion.rb</code> 中定義。</p></div><h3 id="module"><a class="anchorlink" href="#module">3 <code>Module</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">3.1 屬性</a></h4><h5 id="alias-attribute"><a class="anchorlink" href="#alias-attribute">3.1.1 <code>alias_attribute</code></a></h5><p>Model 屬性有一個讀者、一個作者和一個謂詞。您可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-alias_attribute"><code>alias_attribute</code></a> 為模型屬性設定別名，該屬性為您定義了相應的三種方法。與其他別名方法一樣，新名稱是第一個引數，舊名稱是第二個引數（一個助記符是它們的順序與您進行賦值的順序相同）：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># You can refer to the email column as "login".</span>
  <span class="c1"># This can be meaningful for authentication code.</span>
  <span class="n">alias_attribute</span> <span class="ss">:login</span><span class="p">,</span> <span class="ss">:email</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User &lt; ApplicationRecord
  # You can refer to the email column as "login".
  # This can be meaningful for authentication code.
  alias_attribute :login, :email
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/module/aliasing.rb</code> 中定義。</p></div><h5 id=""><a class="anchorlink" href="#">3.1.2 內部屬性</a></h5><p>當您在一個的目標在於被子類化的類中定義屬性時，名稱衝突是一種風險。這對圖書館來說非常重要。</p><p>Active Support 定義了宏 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-attr_internal_reader"><code>attr_internal_reader</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-attr_internal_writer"><code>attr_internal_writer</code></a> 和 [<code>attr_internal_accessor</code>][<code>attr_internal_accessor</code>][ZHTW_WTHZ#][ZHTW_internal_attr#]它們的行為與 Ruby 內建的 <code>attr_*</code> 對應物類似，只是它們以一種降低衝突可能性的方式命名底層實例變數。</p><p>宏 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-attr_internal"><code>attr_internal</code></a> 是 <code>attr_internal_accessor</code> 的同義詞：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="err">＃</span> <span class="err">圖書館</span>
<span class="k">class</span> <span class="nc">ThirdPartyLibrary::Crawler</span>
  <span class="n">attr_internal</span> <span class="ss">:log_level</span>
<span class="k">end</span>

<span class="c1"># 客戶端程式碼</span>
<span class="k">class</span> <span class="nc">MyCrawler</span> <span class="o">&lt;</span> <span class="no">ThirdPartyLibrary</span><span class="o">::</span><span class="no">Crawler</span>
  <span class="nb">attr_accessor</span> <span class="ss">:log_level</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="＃ 圖書館
class ThirdPartyLibrary::Crawler
  attr_internal :log_level
end

# 客戶端程式碼
class MyCrawler &lt; ThirdPartyLibrary::Crawler
  attr_accessor :log_level
end
">Copy</button>
</div>
<p>在前面的例子中，可能是 <code>:log_level</code> 不屬於庫的公共介面，它只用於開發。客戶端程式碼不知道潛在的衝突，子類化並定義了自己的 <code>:log_level</code>。感謝 <code>attr_internal</code> 沒有碰撞。</p><p>預設情況下，內部實例變數使用前導下劃線命名，在上例中為 <code>@_log_level</code>。不過，這可以透過 <code>Module.attr_internal_naming_format</code> 進行設定，您可以傳遞任何類似 <code>sprintf</code> 的格式字串，並在某處使用前導 <code>@</code> 和 <code>%s</code>，這是放置名稱的位置。預設值為 <code>"@_%s"</code>。</p><p>Rails 在一些地方使用內部屬性，例如 views：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">attr_internal</span> <span class="ss">:captures</span>
    <span class="n">attr_internal</span> <span class="ss">:request</span><span class="p">,</span> <span class="ss">:layout</span>
    <span class="n">attr_internal</span> <span class="ss">:controller</span><span class="p">,</span> <span class="ss">:template</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module ActionView
  class Base
    attr_internal :captures
    attr_internal :request, :layout
    attr_internal :controller, :template
  end
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/module/attr_internal.rb</code> 中定義。</p></div><h5 id="module"><a class="anchorlink" href="#module">3.1.3 Module 屬性</a></h5><p>宏 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-mattr_reader"><code>mattr_reader</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-mattr_writer"><code>mattr_writer</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-mattr_accessor"><code>mattr_accessor</code></a> 與 ZTH_3W 類定義的宏相同。事實上，<code>cattr_*</code> 宏只是 <code>mattr_*</code> 宏的別名。檢查<a href="#class-attributes">類屬性</a>。</p><p>比如Active Storage的logger的API是用<code>mattr_accessor</code>生成的：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActiveStorage</span>
  <span class="n">mattr_accessor</span> <span class="ss">:logger</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module ActiveStorage
  mattr_accessor :logger
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/module/attribute_accessors.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">3.2 家長</a></h4><h5 id="module-parent"><a class="anchorlink" href="#module-parent">3.2.1 <code>module_parent</code></a></h5><p>巢狀命名模組上的 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-module_parent"><code>module_parent</code></a> 方法返回包含其相應常量的模組：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent</span> <span class="c1"># =&gt; X::Y</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent</span>       <span class="c1"># =&gt; X::Y</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent # =&gt; X::Y
M.module_parent       # =&gt; X::Y
">Copy</button>
</div>
<p>如果 module 是匿名的或屬於頂級，則 <code>module_parent</code> 返回 <code>Object</code>。</p><p>警告：請注意，在這種情況下 <code>module_parent_name</code> 返回 <code>nil</code>。</p><div class="note"><p>在 <code>active_support/core_ext/module/introspection.rb</code> 中定義。</p></div><h5 id="module-parent-name"><a class="anchorlink" href="#module-parent-name">3.2.2 <code>module_parent_name</code></a></h5><p>巢狀命名模組上的 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-module_parent_name"><code>module_parent_name</code></a> 方法返回包含其相應常量的模組的完全限定名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parent_name</span> <span class="c1"># =&gt; "X::Y"</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parent_name</span>       <span class="c1"># =&gt; "X::Y"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent_name # =&gt; "X::Y"
M.module_parent_name       # =&gt; "X::Y"
'>Copy</button>
</div>
<p>對於頂級或匿名 modules <code>module_parent_name</code> 返回 <code>nil</code>。</p><p>警告：請注意，在這種情況下 <code>module_parent</code> 返回 <code>Object</code>。</p><div class="note"><p>在 <code>active_support/core_ext/module/introspection.rb</code> 中定義。</p></div><h5 id="module-parents"><a class="anchorlink" href="#module-parents">3.2.3 <code>module_parents</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-module_parents"><code>module_parents</code></a> 在接收器上呼叫 <code>module_parent</code> 並向上呼叫，直到達到 <code>Object</code>。鏈以陣列形式返回，從下到上：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">X</span>
  <span class="k">module</span> <span class="nn">Y</span>
    <span class="k">module</span> <span class="nn">Z</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="no">M</span> <span class="o">=</span> <span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span>

<span class="no">X</span><span class="o">::</span><span class="no">Y</span><span class="o">::</span><span class="no">Z</span><span class="p">.</span><span class="nf">module_parents</span> <span class="c1"># =&gt; [X::Y, X, Object]</span>
<span class="no">M</span><span class="p">.</span><span class="nf">module_parents</span>       <span class="c1"># =&gt; [X::Y, X, Object]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parents # =&gt; [X::Y, X, Object]
M.module_parents       # =&gt; [X::Y, X, Object]
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/module/introspection.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">3.3 匿名</a></h4><p>module 可能有也可能沒有名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "M"</span>

<span class="no">N</span> <span class="o">=</span> <span class="no">Module</span><span class="p">.</span><span class="nf">new</span>
<span class="no">N</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; "N"</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='module M
end
M.name # =&gt; "M"

N = Module.new
N.name # =&gt; "N"

Module.new.name # =&gt; nil
'>Copy</button>
</div>
<p>您可以檢查模組是否具有帶有謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-anonymous-3F"><code>anonymous?</code></a> 的名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>
<span class="no">M</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>

<span class="no">Module</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module M
end
M.anonymous? # =&gt; false

Module.new.anonymous? # =&gt; true
">Copy</button>
</div>
<p>請注意，無法訪問並不意味著匿名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">M</span>
<span class="k">end</span>

<span class="n">m</span> <span class="o">=</span> <span class="no">Object</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="ss">:remove_const</span><span class="p">,</span> <span class="ss">:M</span><span class="p">)</span>

<span class="n">m</span><span class="p">.</span><span class="nf">anonymous?</span> <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module M
end

m = Object.send(:remove_const, :M)

m.anonymous? # =&gt; false
">Copy</button>
</div>
<p>儘管根據定義無法訪問匿名 module。</p><div class="note"><p>在 <code>active_support/core_ext/module/anonymous.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">3.4 方法委託</a></h4><h5 id="delegate"><a class="anchorlink" href="#delegate">3.4.1 <code>delegate</code></a></h5><p>宏 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-delegate"><code>delegate</code></a> 提供了一種簡單的方法來轉發方法。</p><p>假設某些應用程式中的使用者在 <code>User</code> model 中有登入資訊，但在單獨的 <code>Profile</code> model 中有姓名和其他資料：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile
end
">Copy</button>
</div>
<p>使用該設定，您可以透過使用者的個人資料 <code>user.profile.name</code> 獲得使用者名稱，但仍然能夠直接訪問此類屬性可能會很方便：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="n">profile</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile

  def name
    profile.name
  end
end
">Copy</button>
</div>
<p>這就是 <code>delegate</code> 為您所做的：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile

  delegate :name, to: :profile
end
">Copy</button>
</div>
<p>它更短，意圖更明顯。</p><p>該方法在目標中必須是公共的。</p><p><code>delegate</code> 宏接受幾種方法：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:twitter</span><span class="p">,</span> <span class="ss">to: :profile</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :name, :age, :address, :twitter, to: :profile
">Copy</button>
</div>
<p>當插入到一個字串中時，<code>:to</code> 選項應該成為一個表示式，該表示式計算方法被委託給的物件。通常是一個字串或 symbol。這樣的表示式是在接收者的上下文中計算的：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 委託給 Rails 常量</span>
<span class="n">delegate</span> <span class="ss">:logger</span><span class="p">,</span> <span class="ss">to: :Rails</span>

<span class="c1"># 委託給接收者的類</span>
<span class="n">delegate</span> <span class="ss">:table_name</span><span class="p">,</span> <span class="ss">to: :class</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 委託給 Rails 常量
delegate :logger, to: :Rails

# 委託給接收者的類
delegate :table_name, to: :class
">Copy</button>
</div>
<p>警告：如果 <code>:prefix</code> 選項是 <code>true</code>，這不太通用，請參見下文。</p><p>預設情況下，如果委託引發 <code>NoMethodError</code> 並且目標是 <code>nil</code>，則傳播異常。您可以使用 <code>:allow_nil</code> 選項要求返回 <code>nil</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">allow_nil: </span><span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :name, to: :profile, allow_nil: true
">Copy</button>
</div>
<p>如果使用者沒有設定檔案，則使用 <code>:allow_nil</code> 呼叫 <code>user.name</code> 返回 <code>nil</code>。</p><p>選項 <code>:prefix</code> 為生成的方法的名稱新增字首。例如，這可能有助於獲得更好的名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:street</span><span class="p">,</span> <span class="ss">to: :address</span><span class="p">,</span> <span class="ss">prefix: </span><span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :street, to: :address, prefix: true
">Copy</button>
</div>
<p>前面的示例生成 <code>address_street</code> 而不是 <code>street</code>。</p><p>警告：由於在這種情況下生成的方法的名稱由目標物件和目標方法名稱組成，因此 <code>:to</code> 選項必須是方法名稱。</p><p>也可以設定自定義字首：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">to: :attachment</span><span class="p">,</span> <span class="ss">prefix: :avatar</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :size, to: :attachment, prefix: :avatar
">Copy</button>
</div>
<p>在前面的示例中，宏生成 <code>avatar_size</code> 而不是 <code>size</code>。</p><p>選項 <code>:private</code> 更改方法範圍：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">delegate</span> <span class="ss">:date_of_birth</span><span class="p">,</span> <span class="ss">to: :profile</span><span class="p">,</span> <span class="ss">private: </span><span class="kp">true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :date_of_birth, to: :profile, private: true
">Copy</button>
</div>
<p>預設情況下，委託方法是公共的。透過 <code>private: true</code> 來改變它。</p><div class="note"><p>定義在 <code>active_support/core_ext/module/delegation.rb</code></p></div><h5 id="delegate-missing-to"><a class="anchorlink" href="#delegate-missing-to">3.4.2 <code>delegate_missing_to</code></a></h5><p>想象一下，您想委託 <code>User</code> 物件中缺少的所有內容，
到 <code>Profile</code> 之一。 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-delegate_missing_to"><code>delegate_missing_to</code></a> 宏讓你實現這個
在微風中：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_one</span> <span class="ss">:profile</span>

  <span class="n">delegate_missing_to</span> <span class="ss">:profile</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile

  delegate_missing_to :profile
end
">Copy</button>
</div>
<p>目標可以是物件內的任何可呼叫物件，例如實例變數，
方法、常量等。僅委託目標的公共方法。</p><div class="note"><p>在 <code>active_support/core_ext/module/delegation.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">3.5 重新定義方法</a></h4><p>在某些情況下，您需要使用 <code>define_method</code> 定義一個方法，但不知道該名稱的方法是否已經存在。如果是，則在啟用它們時發出警告。沒什麼大不了的，但也不乾淨。</p><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-redefine_method"><code>redefine_method</code></a> 可以防止這種潛在的警告，如果需要，在之前刪除現有方法。</p><p>如果需要定義，也可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-silence_redefinition_of_method"><code>silence_redefinition_of_method</code></a>
自己的替換方法（因為您使用的是 <code>delegate</code>，對於
例子）。</p><div class="note"><p>在 <code>active_support/core_ext/module/redefine_method.rb</code> 中定義。</p></div><h3 id="class"><a class="anchorlink" href="#class">4 <code>Class</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">4.1 類屬性</a></h4><h5 id="class-attribute"><a class="anchorlink" href="#class-attribute">4.1.1 <code>class_attribute</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Class.html#method-i-class_attribute"><code>class_attribute</code></a> 聲明瞭一個或多個可繼承的類屬性，這些屬性可以在層次結構的任何級別被覆蓋。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">A</span><span class="p">;</span> <span class="k">end</span>

<span class="k">class</span> <span class="nc">C</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>

<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:b</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>

<span class="no">C</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="ss">:c</span>
<span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :a</span>
<span class="no">B</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; :b</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class A
  class_attribute :x
end

class B &lt; A; end

class C &lt; B; end

A.x = :a
B.x # =&gt; :a
C.x # =&gt; :a

B.x = :b
A.x # =&gt; :a
C.x # =&gt; :b

C.x = :c
A.x # =&gt; :a
B.x # =&gt; :b
">Copy</button>
</div>
<p>例如 <code>ActionMailer::Base</code> 定義：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">class_attribute</span> <span class="ss">:default_params</span>
<span class="nb">self</span><span class="p">.</span><span class="nf">default_params</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">mime_version: </span><span class="s2">"1.0"</span><span class="p">,</span>
  <span class="ss">charset: </span><span class="s2">"UTF-8"</span><span class="p">,</span>
  <span class="ss">content_type: </span><span class="s2">"text/plain"</span><span class="p">,</span>
  <span class="ss">parts_order: </span><span class="p">[</span> <span class="s2">"text/plain"</span><span class="p">,</span> <span class="s2">"text/enriched"</span><span class="p">,</span> <span class="s2">"text/html"</span> <span class="p">]</span>
<span class="p">}.</span><span class="nf">freeze</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='class_attribute :default_params
self.default_params = {
  mime_version: "1.0",
  charset: "UTF-8",
  content_type: "text/plain",
  parts_order: [ "text/plain", "text/enriched", "text/html" ]
}.freeze
'>Copy</button>
</div>
<p>也可以在實例級別訪問和覆蓋它們。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">A</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">a1</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">a1</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 1, comes from A</span>
<span class="n">a2</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># =&gt; 2, overridden in a2</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="A.x = 1

a1 = A.new
a2 = A.new
a2.x = 2

a1.x # =&gt; 1, comes from A
a2.x # =&gt; 2, overridden in a2
">Copy</button>
</div>
<p>可以透過將選項 <code>:instance_writer</code> 設定為 <code>false</code> 來阻止編寫器實例方法的生成。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActiveRecord</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">class_attribute</span> <span class="ss">:table_name_prefix</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">default: </span><span class="s2">"my"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='module ActiveRecord
  class Base
    class_attribute :table_name_prefix, instance_writer: false, default: "my"
  end
end
'>Copy</button>
</div>
<p>model 可能會發現該選項可用作防止批次分配設定屬性的方法。</p><p>可以透過將選項 <code>:instance_reader</code> 設定為 <code>false</code> 來阻止讀取器實例方法的生成。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">A</span>
  <span class="n">class_attribute</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
<span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="no">A</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">x</span> <span class="c1"># NoMethodError</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class A
  class_attribute :x, instance_reader: false
end

A.new.x = 1
A.new.x # NoMethodError
">Copy</button>
</div>
<p>為方便起見，<code>class_attribute</code> 還定義了一個實例謂詞，它是實例讀取器返回內容的雙重否定。在上面的例子中，它被稱為 <code>x?</code>。</p><p>當 <code>:instance_reader</code> 為 <code>false</code> 時，實例謂詞返回一個 <code>NoMethodError</code>，就像 reader 方法一樣。</p><p>如果你不想要實例謂詞，傳遞 <code>instance_predicate: false</code> 並且它不會被定義。</p><div class="note"><p>在 <code>active_support/core_ext/class/attribute.rb</code> 中定義。</p></div><h5 id="cattr-reader-cattr-writer-cattr-accessor"><a class="anchorlink" href="#cattr-reader-cattr-writer-cattr-accessor">4.1.2 <code>cattr_reader</code>、<code>cattr_writer</code> 和 <code>cattr_accessor</code></a></h5><p>宏 <a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-cattr_reader"><code>cattr_reader</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/Module.html#method-i-cattr_writer"><code>cattr_writer</code></a> 和 [<code>cattr_accessor</code>][Module#cattr_accessor 類] 類似於 ZTH_W 類。他們將一個類變數初始化為 <code>nil</code> 除非它已經存在，並生成相應的類方法來訪問它：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Generates class methods to access @@emulate_booleans.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans.
  cattr_accessor :emulate_booleans
end
">Copy</button>
</div>
<p>此外，您可以將塊傳遞給 <code>cattr_*</code> 以使用預設的 value 設定屬性：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">MysqlAdapter</span> <span class="o">&lt;</span> <span class="no">AbstractAdapter</span>
  <span class="c1"># Generates class methods to access @@emulate_booleans with default value of true.</span>
  <span class="n">cattr_accessor</span> <span class="ss">:emulate_booleans</span><span class="p">,</span> <span class="ss">default: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans with default value of true.
  cattr_accessor :emulate_booleans, default: true
end
">Copy</button>
</div>
<p>實例方法也是為了方便而建立的，它們只是類屬性的代理。因此，實例可以更改類屬性，但不能像 <code>class_attribute</code> 那樣覆蓋它（見上文）。例如給出</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">ActionView</span>
  <span class="k">class</span> <span class="nc">Base</span>
    <span class="n">cattr_accessor</span> <span class="ss">:field_error_proc</span><span class="p">,</span> <span class="ss">default: </span><span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module ActionView
  class Base
    cattr_accessor :field_error_proc, default: Proc.new { ... }
  end
end
">Copy</button>
</div>
<p>我們可以在 views 中訪問 <code>field_error_proc</code>。</p><p>可以透過將 <code>:instance_reader</code> 設定為 <code>false</code> 來阻止讀取器實例方法的生成，可以透過將 <code>:instance_writer</code> 設定為 <code>false</code> 來阻止寫入器實例方法的生成。可以透過將 <code>:instance_accessor</code> 設定為 <code>false</code> 來阻止這兩種方法的生成。在所有情況下，value 必須完全是 <code>false</code> 而不是任何虛假的 value。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">A</span>
  <span class="k">class</span> <span class="nc">B</span>
    <span class="c1"># No first_name instance reader is generated.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">instance_reader: </span><span class="kp">false</span>
    <span class="c1"># No last_name= instance writer is generated.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">instance_writer: </span><span class="kp">false</span>
    <span class="c1"># No surname instance reader or surname= writer is generated.</span>
    <span class="n">cattr_accessor</span> <span class="ss">:surname</span><span class="p">,</span> <span class="ss">instance_accessor: </span><span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="module A
  class B
    # No first_name instance reader is generated.
    cattr_accessor :first_name, instance_reader: false
    # No last_name= instance writer is generated.
    cattr_accessor :last_name, instance_writer: false
    # No surname instance reader or surname= writer is generated.
    cattr_accessor :surname, instance_accessor: false
  end
end
">Copy</button>
</div>
<p>model 可能會發現將 <code>:instance_accessor</code> 設定為 <code>false</code> 作為防止批次分配設定屬性的方法很有用。</p><div class="note"><p>在 <code>active_support/core_ext/module/attribute_accessors.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">4.2 子類和後代</a></h4><h5 id="subclasses"><a class="anchorlink" href="#subclasses">4.2.1 <code>subclasses</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/Class.html#method-i-subclasses"><code>subclasses</code></a> 方法返回接收者的子類：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">subclasses</span> <span class="c1"># =&gt; [B, D]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class C; end
C.subclasses # =&gt; []

class B &lt; C; end
C.subclasses # =&gt; [B]

class A &lt; B; end
C.subclasses # =&gt; [B]

class D &lt; C; end
C.subclasses # =&gt; [B, D]
">Copy</button>
</div>
<p>未指定這些類的返回順序。</p><div class="note"><p>在 <code>active_support/core_ext/class/subclasses.rb</code> 中定義。</p></div><h5 id="descendants"><a class="anchorlink" href="#descendants">4.2.2 <code>descendants</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/Class.html#method-i-descendants"><code>descendants</code></a> 方法返回所有比其接收者為 <code>&lt;</code> 的類：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; []</span>

<span class="k">class</span> <span class="nc">B</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B]</span>

<span class="k">class</span> <span class="nc">A</span> <span class="o">&lt;</span> <span class="no">B</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A]</span>

<span class="k">class</span> <span class="nc">D</span> <span class="o">&lt;</span> <span class="no">C</span><span class="p">;</span> <span class="k">end</span>
<span class="no">C</span><span class="p">.</span><span class="nf">descendants</span> <span class="c1"># =&gt; [B, A, D]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="class C; end
C.descendants # =&gt; []

class B &lt; C; end
C.descendants # =&gt; [B]

class A &lt; B; end
C.descendants # =&gt; [B, A]

class D &lt; C; end
C.descendants # =&gt; [B, A, D]
">Copy</button>
</div>
<p>未指定這些類的返回順序。</p><div class="note"><p>在 <code>active_support/core_ext/class/subclasses.rb</code> 中定義。</p></div><h3 id="string"><a class="anchorlink" href="#string">5 <code>String</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">5.1 輸出安全</a></h4><h5 id=""><a class="anchorlink" href="#">5.1.1 動機</a></h5><p>將資料插入 HTML 模板需要格外小心。例如，您不能將 <code>@review.title</code> 逐字插入 HTML 頁面。一方面，如果 review 的標題是“Flanagan &amp; Matz 規則！”輸出不會是格式正確的，因為必須將與號轉義為“&amp;”。此外，根據應用程式，這可能是一個很大的安全漏洞，因為使用者可以將惡意 HTML 設定為手工製作的 review 標題。檢視<a href="security.html#cross-site-scripting-xss">安全指南</a> 中有關跨站點指令碼的部分，瞭解有關風險的更多資訊。</p><h5 id=""><a class="anchorlink" href="#">5.1.2 安全字串</a></h5><p>Active Support 有<em>(html) 安全</em>字串的概念。安全字串是標記為可按原樣插入 HTML 的字串。它是可信的，不管它是否被逃脫。</p><p>預設情況下，字串被認為是 <em>unsafe</em> ：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"".html_safe? # =&gt; false
'>Copy</button>
</div>
<p>您可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-html_safe"><code>html_safe</code></a> 方法從給定的字串中獲取安全字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">s</span> <span class="o">=</span> <span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='s = "".html_safe
s.html_safe? # =&gt; true
'>Copy</button>
</div>
<p>重要的是要理解 <code>html_safe</code> 不執行任何轉義，它只是一個斷言：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">s</span> <span class="o">=</span> <span class="s2">"&lt;script&gt;...&lt;/script&gt;"</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="n">s</span><span class="p">.</span><span class="nf">html_safe?</span> <span class="c1"># =&gt; true</span>
<span class="n">s</span>            <span class="c1"># =&gt; "&lt;script&gt;...&lt;/script&gt;"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='s = "&lt;script&gt;...&lt;/script&gt;".html_safe
s.html_safe? # =&gt; true
s            # =&gt; "&lt;script&gt;...&lt;/script&gt;"
'>Copy</button>
</div>
<p>您有責任確保在特定字串上呼叫 <code>html_safe</code> 沒有問題。</p><p>如果您附加到安全字串，無論是使用 <code>concat</code>/<code>&lt;&lt;</code> 就地，還是使用 <code>+</code>，結果都是安全字串。不安全的引數被轉義：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span> <span class="c1"># =&gt; "&amp;lt;"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"".html_safe + "&lt;" # =&gt; "&amp;lt;"
'>Copy</button>
</div>
<p>直接附加安全引數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">""</span><span class="p">.</span><span class="nf">html_safe</span> <span class="o">+</span> <span class="s2">"&lt;"</span><span class="p">.</span><span class="nf">html_safe</span> <span class="c1"># =&gt; "&lt;"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"".html_safe + "&lt;".html_safe # =&gt; "&lt;"
'>Copy</button>
</div>
<p>這些方法不應該在普通的views中使用。不安全的 values 會自動轉義：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="vi">@review</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# fine, escaped if needed %&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= @review.title %&gt; &lt;%# fine, escaped if needed %&gt;
">Copy</button>
</div>
<p>要逐字插入內容，請使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActionView/Helpers/OutputSafetyHelper.html#method-i-raw"><code>raw</code></a> helper 而不是呼叫 <code>html_safe</code>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# inserts @cms.current_template as is %&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= raw @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
">Copy</button>
</div>
<p>或者，等效地，使用 <code>&lt;%==</code>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span><span class="o">=</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# inserts @cms.current_template as is %&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%== @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
">Copy</button>
</div>
<p><code>raw</code> helper 為您呼叫 <code>html_safe</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">raw</span><span class="p">(</span><span class="n">stringish</span><span class="p">)</span>
  <span class="n">stringish</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">html_safe</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def raw(stringish)
  stringish.to_s.html_safe
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/output_safety.rb</code> 中定義。</p></div><h5 id=""><a class="anchorlink" href="#">5.1.3 改造</a></h5><p>根據經驗，除了上面解釋的連線之外，任何可能改變字串的方法都會給你一個不安全的字串。它們是 <code>downcase</code>、<code>gsub</code>、<code>strip</code>、<code>chomp</code>、<code>underscore</code> 等。</p><p>在像 <code>gsub!</code> 這樣的就地轉換的情況下，接收器本身變得不安全。</p><p>資訊：安全位總是丟失，無論轉換是否真的改變了某些東西。</p><h5 id=""><a class="anchorlink" href="#">5.1.4 轉換和強制</a></h5><p>對安全字串呼叫 <code>to_s</code> 返回安全字串，但對 <code>to_str</code> 進行強制返回不安全字串。</p><h5 id="-"><a class="anchorlink" href="#-">5.1.5 複製</a></h5><p>在安全字串上呼叫 <code>dup</code> 或 <code>clone</code> 會產生安全字串。</p><h4 id="remove"><a class="anchorlink" href="#remove">5.2 <code>remove</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-remove"><code>remove</code></a> 將刪除所有出現的模式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Hello World"</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="sr">/Hello /</span><span class="err">) # =&gt; "W</span><span class="sr">o</span><span class="n">rld</span><span class="s2">"
</span></code></pre>
<button class="clipboard-button" data-clipboard-text='"Hello World".remove(/Hello /) # =&gt; "World"
'>Copy</button>
</div>
<p>還有破壞性版本<code>String#remove!</code>。</p><div class="note"><p>在 <code>active_support/core_ext/string/filters.rb</code> 中定義。</p></div><h4 id="squish"><a class="anchorlink" href="#squish">5.3 <code>squish</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-squish"><code>squish</code></a> 去除前導和尾隨空格，並用一個空格替換一行空格：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">" </span><span class="se">\n</span><span class="s2">  foo</span><span class="se">\n\r</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> bar </span><span class="se">\n</span><span class="s2">"</span><span class="p">.</span><span class="nf">squish</span> <span class="c1"># =&gt; "foo bar"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='" \n  foo\n\r \t bar \n".squish # =&gt; "foo bar"
'>Copy</button>
</div>
<p>還有破壞性版本<code>String#squish!</code>。</p><p>請注意，它同時處理 ASCII 和 Unicode 空格。</p><div class="note"><p>在 <code>active_support/core_ext/string/filters.rb</code> 中定義。</p></div><h4 id="truncate"><a class="anchorlink" href="#truncate">5.4 <code>truncate</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-truncate"><code>truncate</code></a> 返回在給定的 <code>length</code> 之後截斷的接收者的副本：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># =&gt; “哦，天哪！天哪！...”</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate(20)
# =&gt; “哦，天哪！天哪！...”
'>Copy</button>
</div>
<p>可以使用 <code>:omission</code> 選項自定義省略號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="ss">omission: </span><span class="s1">'&amp;hellip;'</span><span class="p">)</span>
<span class="c1"># =&gt; “哦，天哪！哦……”</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(20, omission: '&amp;hellip;')
# =&gt; “哦，天哪！哦……”
">Copy</button>
</div>
<p>請特別注意，截斷考慮了省略字串的長度。</p><p>傳遞一個 <code>:separator</code> 以在自然中斷處截斷字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>
<span class="c1"># =&gt; “哦，天哪！哦，死……”</span>
<span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">' '</span><span class="p">)</span>
<span class="c1"># =&gt; “哦，天哪！哦……”</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(18)
# =&gt; “哦，天哪！哦，死……”
&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(18, separator: ' ')
# =&gt; “哦，天哪！哦……”
">Copy</button>
</div>
<p>選項 <code>:separator</code> 可以是正則表示式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="err">)
# =&gt; “哦，天哪！哦……”
</span></code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate(18, separator: /\s/)
# =&gt; “哦，天哪！哦……”
'>Copy</button>
</div>
<p>在上面的例子中，“親愛的”首先被切斷，但隨後 <code>:separator</code> 阻止了它。</p><div class="note"><p>在 <code>active_support/core_ext/string/filters.rb</code> 中定義。</p></div><h4 id="truncate-bytes"><a class="anchorlink" href="#truncate-bytes">5.5 <code>truncate_bytes</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-truncate_bytes"><code>truncate_bytes</code></a> 返回其接收器的副本，最多被截斷為 <code>bytesize</code> 位元組：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍👍…"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"👍👍👍👍".truncate_bytes(15)
# =&gt; "👍👍👍…"
'>Copy</button>
</div>
<p>可以使用 <code>:omission</code> 選項自定義省略號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"👍👍👍👍"</span><span class="p">.</span><span class="nf">truncate_bytes</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"🖖"</span><span class="p">)</span>
<span class="c1"># =&gt; "👍👍🖖"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"👍👍👍👍".truncate_bytes(15, omission: "🖖")
# =&gt; "👍👍🖖"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/filters.rb</code> 中定義。</p></div><h4 id="truncate-words"><a class="anchorlink" href="#truncate-words">5.6 <code>truncate_words</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-truncate_words"><code>truncate_words</code></a> 返回在給定單詞數後截斷的接收者副本：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># =&gt; “哦，天哪！天哪！...”</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate_words(4)
# =&gt; “哦，天哪！天哪！...”
'>Copy</button>
</div>
<p>可以使用 <code>:omission</code> 選項自定義省略號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">omission: </span><span class="s1">'&amp;hellip;'</span><span class="p">)</span>
<span class="c1"># =&gt; “天哪！天哪！……”</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate_words(4, omission: '&amp;hellip;')
# =&gt; “天哪！天哪！……”
">Copy</button>
</div>
<p>傳遞一個 <code>:separator</code> 以在自然中斷處截斷字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">'!'</span><span class="p">)</span>
<span class="c1"># =&gt; “哦，天哪！天哪！我要遲到了……”</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate_words(3, separator: '!')
# =&gt; “哦，天哪！天哪！我要遲到了……”
">Copy</button>
</div>
<p>選項 <code>:separator</code> 可以是正則表示式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Oh dear! Oh dear! I shall be late!"</span><span class="p">.</span><span class="nf">truncate_words</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="ss">separator: </span><span class="sr">/\s/</span><span class="err">)
# =&gt; “哦，天哪！天哪！...”
</span></code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate_words(4, separator: /\s/)
# =&gt; “哦，天哪！天哪！...”
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/filters.rb</code> 中定義。</p></div><h4 id="inquiry"><a class="anchorlink" href="#inquiry">5.7 <code>inquiry</code></a></h4><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-inquiry"><code>inquiry</code></a> 方法將字串轉換為 <code>StringInquirer</code> 物件，使相等性檢查更漂亮。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"production"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">production?</span> <span class="c1"># =&gt; true</span>
<span class="s2">"active"</span><span class="p">.</span><span class="nf">inquiry</span><span class="p">.</span><span class="nf">inactive?</span>       <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"production".inquiry.production? # =&gt; true
"active".inquiry.inactive?       # =&gt; false
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inquiry.rb</code> 中定義。</p></div><h4 id="string-starts-with-questionmark-ends-with-questionmark"><a class="anchorlink" href="#string-starts-with-questionmark-ends-with-questionmark">5.8 <code>starts_with?</code> 和 <code>ends_with?</code></a></h4><p>Active Support 定義了 <code>String#start_with?</code> 和 <code>String#end_with?</code> 的第三人稱別名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo"</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo".starts_with?("f") # =&gt; true
"foo".ends_with?("o")   # =&gt; true
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/starts_ends_with.rb</code> 中定義。</p></div><h4 id="strip-heredoc"><a class="anchorlink" href="#strip-heredoc">5.9 <code>strip_heredoc</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-strip_heredoc"><code>strip_heredoc</code></a> 去除了heredocs 中的縮排。</p><p>例如在</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:usage</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="o">&lt;&lt;-</span><span class="no">USAGE</span><span class="p">.</span><span class="nf">strip_heredoc</span><span class="sh">
    This command does such and such.

    Supported options are:
      -h         This message
      ...
</span><span class="no">  USAGE</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="if options[:usage]
  puts &lt;&lt;-USAGE.strip_heredoc
    This command does such and such.

    Supported options are:
      -h         This message
      ...
  USAGE
end
">Copy</button>
</div>
<p>使用者將看到與左邊距對齊的使用訊息。</p><p>從技術上講，它會查詢整個字串中縮排最少的行，並刪除
大量的領先空白。</p><div class="note"><p>在 <code>active_support/core_ext/string/strip.rb</code> 中定義。</p></div><h4 id="indent"><a class="anchorlink" href="#indent">5.10 <code>indent</code></a></h4><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-indent"><code>indent</code></a> 方法縮排接收器中的行：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="o">&lt;&lt;</span><span class="no">EOS</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="sh">
def some_method
  some_code
end
</span><span class="no">EOS</span>
<span class="c1"># =&gt;</span>
  <span class="k">def</span> <span class="nf">some_method</span>
    <span class="n">some_code</span>
  <span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;&lt;EOS.indent(2)
def some_method
  some_code
end
EOS
# =&gt;
  def some_method
    some_code
  end
">Copy</button>
</div>
<p>第二個引數 <code>indent_string</code> 指定要使用的縮排字串。預設值是 <code>nil</code>，它告訴方法在第一個縮排的行中進行有根據的猜測，如果沒有，則回退到一個空格。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"  foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>        <span class="c1"># =&gt; "    foo"</span>
<span class="s2">"foo</span><span class="se">\n\t\t</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "\t\tfoo\n\t\t\t\tbar"</span>
<span class="s2">"foo"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>    <span class="c1"># =&gt; "\t\tfoo"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"  foo".indent(2)        # =&gt; "    foo"
"foo\n\t\tbar".indent(2) # =&gt; "\t\tfoo\n\t\t\t\tbar"
"foo".indent(2, "\t")    # =&gt; "\t\tfoo"
'>Copy</button>
</div>
<p>雖然 <code>indent_string</code> 通常是一個空格或製表符，但它可以是任何字串。</p><p>第三個引數 <code>indent_empty_lines</code> 是一個標誌，表示是否應該縮排空行。預設為假。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>            <span class="c1"># =&gt; "  foo\n\n  bar"</span>
<span class="s2">"foo</span><span class="se">\n\n</span><span class="s2">bar"</span><span class="p">.</span><span class="nf">indent</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "  foo\n  \n  bar"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo\n\nbar".indent(2)            # =&gt; "  foo\n\n  bar"
"foo\n\nbar".indent(2, nil, true) # =&gt; "  foo\n  \n  bar"
'>Copy</button>
</div>
<p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-indent-21"><code>indent!</code></a> 方法執行就地縮排。</p><div class="note"><p>在 <code>active_support/core_ext/string/indent.rb</code> 中定義。</p></div><h4 id="string-"><a class="anchorlink" href="#string-">5.11 訪問</a></h4><h5 id="at-position"><a class="anchorlink" href="#at-position">5.11.1 <code>at(position)</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-at"><code>at</code></a> 方法返回字串在 <code>position</code> 位置的字元：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "o"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"hello".at(0)  # =&gt; "h"
"hello".at(4)  # =&gt; "o"
"hello".at(-1) # =&gt; "o"
"hello".at(10) # =&gt; nil
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/access.rb</code> 中定義。</p></div><h5 id="from-position"><a class="anchorlink" href="#from-position">5.11.2 <code>from(position)</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-from"><code>from</code></a> 方法返回從位置 <code>position</code> 開始的字串的子字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "hello"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "llo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "lo"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"hello".from(0)  # =&gt; "hello"
"hello".from(2)  # =&gt; "llo"
"hello".from(-2) # =&gt; "lo"
"hello".from(10) # =&gt; nil
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/access.rb</code> 中定義。</p></div><h5 id="to-position"><a class="anchorlink" href="#to-position">5.11.3 <code>to(position)</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-to"><code>to</code></a> 方法返回字串的子字串，直到位置 <code>position</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; "h"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; "hel"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "hell"</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; "hello"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"hello".to(0)  # =&gt; "h"
"hello".to(2)  # =&gt; "hel"
"hello".to(-2) # =&gt; "hell"
"hello".to(10) # =&gt; "hello"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/access.rb</code> 中定義。</p></div><h5 id="first-limit-1"><a class="anchorlink" href="#first-limit-1">5.11.4 <code>first(limit = 1)</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-first"><code>first</code></a> 方法返回包含字串的第一個 <code>limit</code> 字元的子字串。</p><p>如果 <code>n</code> &gt; 0，則呼叫 <code>str.first(n)</code> 等價於 <code>str.to(n-1)</code>，如果 <code>n</code> == 0，則返回空字串。</p><div class="note"><p>在 <code>active_support/core_ext/string/access.rb</code> 中定義。</p></div><h5 id="last-limit-1"><a class="anchorlink" href="#last-limit-1">5.11.5 <code>last(limit = 1)</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-last"><code>last</code></a> 方法返回包含字串的最後一個 <code>limit</code> 字元的子字串。</p><p>如果 <code>n</code> &gt; 0，則呼叫 <code>str.last(n)</code> 等價於 <code>str.from(-n)</code>，如果 <code>n</code> == 0，則返回空字串。</p><div class="note"><p>在 <code>active_support/core_ext/string/access.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">5.12 拐點</a></h4><h5 id="pluralize"><a class="anchorlink" href="#pluralize">5.12.1 <code>pluralize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-pluralize"><code>pluralize</code></a> 返回其接收者的複數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"table"</span><span class="p">.</span><span class="nf">pluralize</span>     <span class="c1"># =&gt; "tables"</span>
<span class="s2">"ruby"</span><span class="p">.</span><span class="nf">pluralize</span>      <span class="c1"># =&gt; "rubies"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">pluralize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"table".pluralize     # =&gt; "tables"
"ruby".pluralize      # =&gt; "rubies"
"equipment".pluralize # =&gt; "equipment"
'>Copy</button>
</div>
<p>如上例所示，Active Support 知道一些不規則複數和不可數名詞。內建規則可以在 <code>config/initializers/inflections.rb</code> 中擴充套件。預設情況下，該檔案由 <code>rails new</code> 命令生成，並在註釋中包含說明。</p><p><code>pluralize</code> 也可以採用可選的 <code>count</code> 引數。如果 <code>count == 1</code> 將返回單數形式。對於 <code>count</code> 的任何其他 value，將返回複數形式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; "dude"</span>
<span class="s2">"dude"</span><span class="p">.</span><span class="nf">pluralize</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; "dudes"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"dude".pluralize(0) # =&gt; "dudes"
"dude".pluralize(1) # =&gt; "dude"
"dude".pluralize(2) # =&gt; "dudes"
'>Copy</button>
</div>
<p>Active Record 使用此方法計算對應於 model 的預設表名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/model_schema.rb</span>
<span class="k">def</span> <span class="nf">undecorated_table_name</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
  <span class="n">table_name</span> <span class="o">=</span> <span class="n">model_name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">pluralize_table_names</span> <span class="p">?</span> <span class="n">table_name</span><span class="p">.</span><span class="nf">pluralize</span> <span class="p">:</span> <span class="n">table_name</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_record/model_schema.rb
def undecorated_table_name(model_name)
  table_name = model_name.to_s.demodulize.underscore
  pluralize_table_names ? table_name.pluralize : table_name
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="singularize"><a class="anchorlink" href="#singularize">5.12.2 <code>singularize</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-singularize"><code>singularize</code></a> 方法是 <code>pluralize</code> 的逆方法：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"tables"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "table"</span>
<span class="s2">"rubies"</span><span class="p">.</span><span class="nf">singularize</span>    <span class="c1"># =&gt; "ruby"</span>
<span class="s2">"equipment"</span><span class="p">.</span><span class="nf">singularize</span> <span class="c1"># =&gt; "equipment"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"tables".singularize    # =&gt; "table"
"rubies".singularize    # =&gt; "ruby"
"equipment".singularize # =&gt; "equipment"
'>Copy</button>
</div>
<p>Associations 使用此方法計算相應預設關聯類的名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">derive_class_name</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span>
  <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="p">.</span><span class="nf">singularize</span> <span class="k">if</span> <span class="n">collection?</span>
  <span class="n">class_name</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_record/reflection.rb
def derive_class_name
  class_name = name.to_s.camelize
  class_name = class_name.singularize if collection?
  class_name
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="camelize"><a class="anchorlink" href="#camelize">5.12.3 <code>camelize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-camelize"><code>camelize</code></a> 以駝峰形式返回其接收器：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"product"</span><span class="p">.</span><span class="nf">camelize</span>    <span class="c1"># =&gt; "Product"</span>
<span class="s2">"admin_user"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "AdminUser"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"product".camelize    # =&gt; "Product"
"admin_user".camelize # =&gt; "AdminUser"
'>Copy</button>
</div>
<p>根據經驗，您可以將此方法視為將路徑轉換為 ​​Ruby 類或 module 名稱的方法，其中斜線分隔名稱空間：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"backoffice/session"</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "Backoffice::Session"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"backoffice/session".camelize # =&gt; "Backoffice::Session"
'>Copy</button>
</div>
<p>例如，Action Pack 使用此方法載入提供某個 session 儲存的類：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># action_controller/metal/session_management.rb</span>
<span class="k">def</span> <span class="nf">session_store</span><span class="o">=</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
  <span class="vc">@@session_store</span> <span class="o">=</span> <span class="n">store</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Symbol</span><span class="p">)</span> <span class="p">?</span>
    <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">Session</span><span class="p">.</span><span class="nf">const_get</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">camelize</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">store</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# action_controller/metal/session_management.rb
def session_store=(store)
  @@session_store = store.is_a?(Symbol) ?
    ActionDispatch::Session.const_get(store.to_s.camelize) :
    store
end
">Copy</button>
</div>
<p><code>camelize</code> 接受一個可選引數，它可以是 <code>:upper</code>（預設）或 <code>:lower</code>。對於後者，第一個字母變為小寫：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"visual_effect"</span><span class="p">.</span><span class="nf">camelize</span><span class="p">(</span><span class="ss">:lower</span><span class="p">)</span> <span class="c1"># =&gt; "visualEffect"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"visual_effect".camelize(:lower) # =&gt; "visualEffect"
'>Copy</button>
</div>
<p>這對於以遵循該約定的語言（例如 JavaScript）計算方法名稱可能很方便。</p><p>資訊：根據經驗，您可以將 <code>camelize</code> 視為 <code>underscore</code> 的倒數，儘管在某些情況下不成立：<code>"SSLError".underscore.camelize</code> 返回 <code>"SslError"</code>。為了支援這種情況，Active Support 允許您在 <code>config/initializers/inflections.rb</code> 中指定首字母縮略詞：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="p">.</span><span class="nf">inflections</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
  <span class="n">inflect</span><span class="p">.</span><span class="nf">acronym</span> <span class="s1">'SSL'</span>
<span class="k">end</span>

<span class="s2">"SSLError"</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">camelize</span> <span class="c1"># =&gt; "SSLError"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport::Inflector.inflections do |inflect|
  inflect.acronym 'SSL'
end

&quot;SSLError&quot;.underscore.camelize # =&gt; &quot;SSLError&quot;
">Copy</button>
</div>
<p><code>camelize</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-camelcase"><code>camelcase</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="underscore"><a class="anchorlink" href="#underscore">5.12.4 <code>underscore</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-underscore"><code>underscore</code></a> 反過來，從駝峰式到路徑：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">underscore</span>   <span class="c1"># =&gt; "product"</span>
<span class="s2">"AdminUser"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "admin_user"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Product".underscore   # =&gt; "product"
"AdminUser".underscore # =&gt; "admin_user"
'>Copy</button>
</div>
<p>還將 "::" 轉換回 "/"：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Backoffice::Session"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "backoffice/session"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Backoffice::Session".underscore # =&gt; "backoffice/session"
'>Copy</button>
</div>
<p>並理解以小寫字母開頭的字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"visualEffect"</span><span class="p">.</span><span class="nf">underscore</span> <span class="c1"># =&gt; "visual_effect"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"visualEffect".underscore # =&gt; "visual_effect"
'>Copy</button>
</div>
<p><code>underscore</code> 不接受任何引數。</p><p>Rails 使用 <code>underscore</code> 來獲取 controller 類的小寫名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># actionpack/lib/abstract_controller/base.rb</span>
<span class="k">def</span> <span class="nf">controller_path</span>
  <span class="vi">@controller_path</span> <span class="o">||=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">).</span><span class="nf">underscore</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='# actionpack/lib/abstract_controller/base.rb
def controller_path
  @controller_path ||= name.delete_suffix("Controller").underscore
end
'>Copy</button>
</div>
<p>例如，value 就是您在 <code>params[:controller]</code> 中得到的那個。</p><p>資訊：根據經驗，您可以將 <code>underscore</code> 視為 <code>camelize</code> 的倒數，儘管在某些情況下並不成立。例如，<code>"SSLError".underscore.camelize</code> 返還 <code>"SslError"</code>。</p><div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="titleize"><a class="anchorlink" href="#titleize">5.12.5 <code>titleize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-titleize"><code>titleize</code></a> 將接收器中的單詞大寫：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"alice in wonderland"</span><span class="p">.</span><span class="nf">titleize</span> <span class="c1"># =&gt; "Alice In Wonderland"</span>
<span class="s2">"fermat's enigma"</span><span class="p">.</span><span class="nf">titleize</span>     <span class="c1"># =&gt; "Fermat's Enigma"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;alice in wonderland&quot;.titleize # =&gt; &quot;Alice In Wonderland&quot;
&quot;fermat's enigma&quot;.titleize     # =&gt; &quot;Fermat's Enigma&quot;
">Copy</button>
</div>
<p><code>titleize</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-titlecase"><code>titlecase</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="dasherize"><a class="anchorlink" href="#dasherize">5.12.6 <code>dasherize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-dasherize"><code>dasherize</code></a> 用破折號替換接收器中的下劃線：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"name"</span><span class="p">.</span><span class="nf">dasherize</span>         <span class="c1"># =&gt; "name"</span>
<span class="s2">"contact_data"</span><span class="p">.</span><span class="nf">dasherize</span> <span class="c1"># =&gt; "contact-data"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"name".dasherize         # =&gt; "name"
"contact_data".dasherize # =&gt; "contact-data"
'>Copy</button>
</div>
<p>models 的 XML 序列化程式使用此方法對節點名稱進行破折：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_model/serializers/xml.rb</span>
<span class="k">def</span> <span class="nf">reformat_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">camelize</span> <span class="k">if</span> <span class="n">camelize?</span>
  <span class="n">dasherize?</span> <span class="p">?</span> <span class="nb">name</span><span class="p">.</span><span class="nf">dasherize</span> <span class="p">:</span> <span class="nb">name</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_model/serializers/xml.rb
def reformat_name(name)
  name = name.camelize if camelize?
  dasherize? ? name.dasherize : name
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="demodulize"><a class="anchorlink" href="#demodulize">5.12.7 <code>demodulize</code></a></h5><p>給定一個帶有限定常量名的字串，<a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-demodulize"><code>demodulize</code></a> 返回常量名，即最右邊的部分：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">demodulize</span>                        <span class="c1"># =&gt; "Product"</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">demodulize</span>    <span class="c1"># =&gt; "UsersController"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">demodulize</span> <span class="c1"># =&gt; "ReservationUtils"</span>
<span class="s2">"::Inflections"</span><span class="p">.</span><span class="nf">demodulize</span>                  <span class="c1"># =&gt; "Inflections"</span>
<span class="s2">""</span><span class="p">.</span><span class="nf">demodulize</span>                               <span class="c1"># =&gt; ""</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Product".demodulize                        # =&gt; "Product"
"Backoffice::UsersController".demodulize    # =&gt; "UsersController"
"Admin::Hotel::ReservationUtils".demodulize # =&gt; "ReservationUtils"
"::Inflections".demodulize                  # =&gt; "Inflections"
"".demodulize                               # =&gt; ""
'>Copy</button>
</div>
<p>例如，Active Record 使用此方法計算計數器快取列的名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/reflection.rb</span>
<span class="k">def</span> <span class="nf">counter_cache_column</span>
  <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="s2">"</span><span class="si">#{</span><span class="n">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">demodulize</span><span class="p">.</span><span class="nf">underscore</span><span class="p">.</span><span class="nf">pluralize</span><span class="si">}</span><span class="s2">_count"</span>
  <span class="k">elsif</span> <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
    <span class="n">options</span><span class="p">[</span><span class="ss">:counter_cache</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='# active_record/reflection.rb
def counter_cache_column
  if options[:counter_cache] == true
    "#{active_record.name.demodulize.underscore.pluralize}_count"
  elsif options[:counter_cache]
    options[:counter_cache]
  end
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="deconstantize"><a class="anchorlink" href="#deconstantize">5.12.8 <code>deconstantize</code></a></h5><p>給定一個帶有限定常量引用表示式的字串，<a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-deconstantize"><code>deconstantize</code></a> 刪除最右邊的部分，通常保留常量容器的名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Product"</span><span class="p">.</span><span class="nf">deconstantize</span>                        <span class="c1"># =&gt; ""</span>
<span class="s2">"Backoffice::UsersController"</span><span class="p">.</span><span class="nf">deconstantize</span>    <span class="c1"># =&gt; "Backoffice"</span>
<span class="s2">"Admin::Hotel::ReservationUtils"</span><span class="p">.</span><span class="nf">deconstantize</span> <span class="c1"># =&gt; "Admin::Hotel"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Product".deconstantize                        # =&gt; ""
"Backoffice::UsersController".deconstantize    # =&gt; "Backoffice"
"Admin::Hotel::ReservationUtils".deconstantize # =&gt; "Admin::Hotel"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="parameterize"><a class="anchorlink" href="#parameterize">5.12.9 <code>parameterize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-parameterize"><code>parameterize</code></a> 以一種可用於漂亮 URL 的方式標準化其接收器。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "john-smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span> <span class="c1"># =&gt; "kurt-godel"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"John Smith".parameterize # =&gt; "john-smith"
"Kurt Gödel".parameterize # =&gt; "kurt-godel"
'>Copy</button>
</div>
<p>要保留字串的大小寫，請將 <code>preserve_case</code> 引數設定為 true。預設情況下，<code>preserve_case</code> 設定為 false。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "John-Smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">preserve_case: </span><span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; "Kurt-Godel"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"John Smith".parameterize(preserve_case: true) # =&gt; "John-Smith"
"Kurt Gödel".parameterize(preserve_case: true) # =&gt; "Kurt-Godel"
'>Copy</button>
</div>
<p>要使用自定義分隔符，請覆蓋 <code>separator</code> 引數。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"John Smith"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "john\_smith"</span>
<span class="s2">"Kurt Gödel"</span><span class="p">.</span><span class="nf">parameterize</span><span class="p">(</span><span class="ss">separator: </span><span class="s2">"_"</span><span class="p">)</span> <span class="c1"># =&gt; "kurt\_godel"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"John Smith".parameterize(separator: "_") # =&gt; "john\_smith"
"Kurt Gödel".parameterize(separator: "_") # =&gt; "kurt\_godel"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="tableize"><a class="anchorlink" href="#tableize">5.12.10 <code>tableize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-tableize"><code>tableize</code></a> 是 <code>underscore</code> 後跟 <code>pluralize</code>。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Person"</span><span class="p">.</span><span class="nf">tableize</span>      <span class="c1"># =&gt; "people"</span>
<span class="s2">"Invoice"</span><span class="p">.</span><span class="nf">tableize</span>     <span class="c1"># =&gt; "invoices"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">tableize</span> <span class="c1"># =&gt; "invoice_lines"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Person".tableize      # =&gt; "people"
"Invoice".tableize     # =&gt; "invoices"
"InvoiceLine".tableize # =&gt; "invoice_lines"
'>Copy</button>
</div>
<p>根據經驗，對於簡單的情況，<code>tableize</code> 返回對應於給定 model 的表名。 Active Record 中的實際實現確實不是直接的 <code>tableize</code>，因為它還解調了類名並檢查了一些可能影響返回字串的選項。</p><div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="classify"><a class="anchorlink" href="#classify">5.12.11 <code>classify</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-classify"><code>classify</code></a> 是 <code>tableize</code> 的逆方法。它為您提供與表名對應的類名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"people"</span><span class="p">.</span><span class="nf">classify</span>        <span class="c1"># =&gt; "Person"</span>
<span class="s2">"invoices"</span><span class="p">.</span><span class="nf">classify</span>      <span class="c1"># =&gt; "Invoice"</span>
<span class="s2">"invoice_lines"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "InvoiceLine"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"people".classify        # =&gt; "Person"
"invoices".classify      # =&gt; "Invoice"
"invoice_lines".classify # =&gt; "InvoiceLine"
'>Copy</button>
</div>
<p>該方法理解限定的表名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"highrise_production.companies"</span><span class="p">.</span><span class="nf">classify</span> <span class="c1"># =&gt; "Company"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"highrise_production.companies".classify # =&gt; "Company"
'>Copy</button>
</div>
<p>請注意，<code>classify</code> 將類名作為字串返回。您可以透過在其上呼叫 <code>constantize</code> 來獲取實際的類物件，接下來解釋。</p><div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="constantize"><a class="anchorlink" href="#constantize">5.12.12 <code>constantize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-constantize"><code>constantize</code></a> 解析其接收器中的常量引用表示式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"Integer"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; Integer</span>

<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>
<span class="s2">"M::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Integer".constantize # =&gt; Integer

module M
  X = 1
end
"M::X".constantize # =&gt; 1
'>Copy</button>
</div>
<p>如果字串評估為沒有已知常量，或者其內容甚至不是有效的常量名稱，則 <code>constantize</code> 引發 <code>NameError</code>。</p><p>即使沒有前導“::”，由 <code>constantize</code> 進行的常量名稱解析也始終從頂級 <code>Object</code> 開始。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">X</span> <span class="o">=</span> <span class="ss">:in_Object</span>
<span class="k">module</span> <span class="nn">M</span>
  <span class="no">X</span> <span class="o">=</span> <span class="ss">:in_M</span>

  <span class="no">X</span>                 <span class="c1"># =&gt; :in_M</span>
  <span class="s2">"::X"</span><span class="p">.</span><span class="nf">constantize</span> <span class="c1"># =&gt; :in_Object</span>
  <span class="s2">"X"</span><span class="p">.</span><span class="nf">constantize</span>   <span class="c1"># =&gt; :in_Object (!)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='X = :in_Object
module M
  X = :in_M

  X                 # =&gt; :in_M
  "::X".constantize # =&gt; :in_Object
  "X".constantize   # =&gt; :in_Object (!)
end
'>Copy</button>
</div>
<p>所以，它通常不等同於 Ruby 在同一地點所做的，有一個真正的常數被評估。</p><p>郵件程式測試用例使用 <code>constantize</code> 從測試類的名稱中獲取被測試的郵件程式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># action_mailer/test_case.rb</span>
<span class="k">def</span> <span class="nf">determine_default_mailer</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Test"</span><span class="p">).</span><span class="nf">constantize</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="no">NonInferrableMailerError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='# action_mailer/test_case.rb
def determine_default_mailer(name)
  name.delete_suffix("Test").constantize
rescue NameError =&gt; e
  raise NonInferrableMailerError.new(name)
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="humanize"><a class="anchorlink" href="#humanize">5.12.13 <code>humanize</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-humanize"><code>humanize</code></a> 調整屬性名稱以顯示給終端使用者。</p><p>具體來說，它執行這些轉換：</p>
<ul>
<li>將人為屈折規則應用於論證。</li>
<li>刪除前導下劃線，如果有的話。</li>
<li>刪除“_id”字尾（如果存在）。</li>
<li>用空格替換下劃線（如果有）。</li>
<li>將除首字母縮略詞以外的所有單詞小寫。</li>
<li>首字母大寫。</li>
</ul>
<p>可以透過設定關閉第一個單詞的大寫
<code>:capitalize</code> 選項為 false（預設為 true）。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"name"</span><span class="p">.</span><span class="nf">humanize</span>                         <span class="c1"># =&gt; "Name"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span>                    <span class="c1"># =&gt; "Author"</span>
<span class="s2">"author_id"</span><span class="p">.</span><span class="nf">humanize</span><span class="p">(</span><span class="ss">capitalize: </span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "author"</span>
<span class="s2">"comments_count"</span><span class="p">.</span><span class="nf">humanize</span>               <span class="c1"># =&gt; "Comments count"</span>
<span class="s2">"_id"</span><span class="p">.</span><span class="nf">humanize</span>                          <span class="c1"># =&gt; "Id"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"name".humanize                         # =&gt; "Name"
"author_id".humanize                    # =&gt; "Author"
"author_id".humanize(capitalize: false) # =&gt; "author"
"comments_count".humanize               # =&gt; "Comments count"
"_id".humanize                          # =&gt; "Id"
'>Copy</button>
</div>
<p>如果將“SSL”定義為首字母縮寫詞：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s1">'ssl_error'</span><span class="p">.</span><span class="nf">humanize</span> <span class="c1"># =&gt; "SSL error"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="'ssl_error'.humanize # =&gt; &quot;SSL error&quot;
">Copy</button>
</div>
<p>helper 方法 <code>full_messages</code> 使用 <code>humanize</code> 作為後備以包含
屬性名稱：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">full_messages</span>
  <span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="n">full_message</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">full_message</span>
  <span class="c1"># ...</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attribute</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">tr</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">).</span><span class="nf">humanize</span>
  <span class="n">attr_name</span> <span class="o">=</span> <span class="vi">@base</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">human_attribute_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">default: </span><span class="n">attr_name</span><span class="p">)</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def full_messages
  map { |attribute, message| full_message(attribute, message) }
end

def full_message
  # ...
  attr_name = attribute.to_s.tr('.', '_').humanize
  attr_name = @base.class.human_attribute_name(attribute, default: attr_name)
  # ...
end
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h5 id="foreign-key"><a class="anchorlink" href="#foreign-key">5.12.14 <code>foreign_key</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-foreign_key"><code>foreign_key</code></a> 給出來自類名的外部 key 列名。為此，它會解調、下劃線並新增“_id”：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span>           <span class="c1"># =&gt; "user_id"</span>
<span class="s2">"InvoiceLine"</span><span class="p">.</span><span class="nf">foreign_key</span>    <span class="c1"># =&gt; "invoice_line_id"</span>
<span class="s2">"Admin::Session"</span><span class="p">.</span><span class="nf">foreign_key</span> <span class="c1"># =&gt; "session_id"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"User".foreign_key           # =&gt; "user_id"
"InvoiceLine".foreign_key    # =&gt; "invoice_line_id"
"Admin::Session".foreign_key # =&gt; "session_id"
'>Copy</button>
</div>
<p>如果您不想在“_id”中使用下劃線，則傳遞一個錯誤引數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"User"</span><span class="p">.</span><span class="nf">foreign_key</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; "userid"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"User".foreign_key(false) # =&gt; "userid"
'>Copy</button>
</div>
<p>Associations 使用這個方法來推斷國外的 keys，例如 <code>has_one</code> 和 <code>has_many</code> 這樣做：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># active_record/associations.rb</span>
<span class="n">foreign_key</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:foreign_key</span><span class="p">]</span> <span class="o">||</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">active_record</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">foreign_key</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_record/associations.rb
foreign_key = options[:foreign_key] || reflection.active_record.name.foreign_key
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/string/inflections.rb</code> 中定義。</p></div><h4 id="string-"><a class="anchorlink" href="#string-">5.13 轉換</a></h4><h5 id="to-date-to-time-to-datetime"><a class="anchorlink" href="#to-date-to-time-to-datetime">5.13.1 <code>to_date</code>、<code>to_time</code>、<code>to_datetime</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-to_date"><code>to_date</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-to_time"><code>to_time</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/String.html#method-i-to_datetime"><code>to_datetime</code></a> 基本上是對 <code>Date._parse</code> 的便利包裝：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"2010-07-27"</span><span class="p">.</span><span class="nf">to_date</span>              <span class="c1"># =&gt; Tue, 27 Jul 2010</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_time</span>     <span class="c1"># =&gt; 2010-07-27 23:37:00 +0200</span>
<span class="s2">"2010-07-27 23:37:00"</span><span class="p">.</span><span class="nf">to_datetime</span> <span class="c1"># =&gt; Tue, 27 Jul 2010 23:37:00 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"2010-07-27".to_date              # =&gt; Tue, 27 Jul 2010
"2010-07-27 23:37:00".to_time     # =&gt; 2010-07-27 23:37:00 +0200
"2010-07-27 23:37:00".to_datetime # =&gt; Tue, 27 Jul 2010 23:37:00 +0000
'>Copy</button>
</div>
<p><code>to_time</code> 接收可選引數 <code>:utc</code> 或 <code>:local</code>，以指示您希望時間在哪個時區：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:utc</span><span class="p">)</span>   <span class="c1"># =&gt; 2010-07-27 23:42:00 UTC</span>
<span class="s2">"2010-07-27 23:42:00"</span><span class="p">.</span><span class="nf">to_time</span><span class="p">(</span><span class="ss">:local</span><span class="p">)</span> <span class="c1"># =&gt; 2010-07-27 23:42:00 +0200</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='"2010-07-27 23:42:00".to_time(:utc)   # =&gt; 2010-07-27 23:42:00 UTC
"2010-07-27 23:42:00".to_time(:local) # =&gt; 2010-07-27 23:42:00 +0200
'>Copy</button>
</div>
<p>預設為 <code>:local</code>。</p><p>有關詳細資訊，請參閱 <code>Date._parse</code> 的文件。</p><p>資訊：他們三個為空白接收者返回 <code>nil</code>。</p><div class="note"><p>在 <code>active_support/core_ext/string/conversions.rb</code> 中定義。</p></div><h3 id="symbol"><a class="anchorlink" href="#symbol">6 <code>Symbol</code> 的擴充套件</a></h3><h4 id="symbol-starts-with-questionmark-ends-with-questionmark"><a class="anchorlink" href="#symbol-starts-with-questionmark-ends-with-questionmark">6.1 <code>starts_with?</code> 和 <code>ends_with?</code></a></h4><p>Active Support 定義了 <code>Symbol#start_with?</code> 和 <code>Symbol#end_with?</code> 的第三人稱別名：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="ss">:foo</span><span class="p">.</span><span class="nf">starts_with?</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="ss">:foo</span><span class="p">.</span><span class="nf">ends_with?</span><span class="p">(</span><span class="s2">"o"</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text=':foo.starts_with?("f") # =&gt; true
:foo.ends_with?("o")   # =&gt; true
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/symbol/starts_ends_with.rb</code> 中定義。</p></div><h3 id="numeric"><a class="anchorlink" href="#numeric">7 <code>Numeric</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">7.1 位元組</a></h4><p>所有數字都回應這些方法：</p>
<ul>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Numeric.html#method-i-bytes"><code>bytes</code></a></li>
<li>[<code>kilobytes</code>][數字#千位元組]</li>
<li>[<code>megabytes</code>][數字#兆位元組]</li>
<li>[<code>gigabytes</code>][數字#gigabytes]</li>
<li>[<code>terabytes</code>][數字#TB]</li>
<li>[<code>petabytes</code>][數字#petabytes]</li>
<li>[<code>exabytes</code>][數字#exabytes]</li>
</ul>
<p>它們使用 1024 的轉換因子返回相應的位元組數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">2</span><span class="p">.</span><span class="nf">kilobytes</span>   <span class="c1"># =&gt; 2048</span>
<span class="mi">3</span><span class="p">.</span><span class="nf">megabytes</span>   <span class="c1"># =&gt; 3145728</span>
<span class="mf">3.5</span><span class="p">.</span><span class="nf">gigabytes</span> <span class="c1"># =&gt; 3758096384</span>
<span class="o">-</span><span class="mi">4</span><span class="p">.</span><span class="nf">exabytes</span>   <span class="c1"># =&gt; -4611686018427387904</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="2.kilobytes   # =&gt; 2048
3.megabytes   # =&gt; 3145728
3.5.gigabytes # =&gt; 3758096384
-4.exabytes   # =&gt; -4611686018427387904
">Copy</button>
</div>
<p>單數形式具有別名，因此您可以說：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">megabyte</span> <span class="c1"># =&gt; 1048576</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="1.megabyte # =&gt; 1048576
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/numeric/bytes.rb</code> 中定義。</p></div><h4 id="numeric-"><a class="anchorlink" href="#numeric-">7.2 時間</a></h4><p>以下方法：</p>
<ul>
<li>[<code>seconds</code>][數字#秒]</li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Numeric.html#method-i-minutes"><code>minutes</code></a></li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Numeric.html#method-i-hours"><code>hours</code></a></li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Numeric.html#method-i-days"><code>days</code></a></li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Numeric.html#method-i-weeks"><code>weeks</code></a></li>
<li>[<code>fortnights</code>][數字#fortnights]</li>
</ul>
<p>啟用時間宣告和計算，如 <code>45.minutes + 2.hours + 4.weeks</code>。它們的返回值 values 也可以新增到 Time 物件或從中減去。</p><p>這些方法可以結合 [<code>from_now</code>][Duration#from_now]、[<code>ago</code>][Duration#ago] 等進行精確的日期計算。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 相當於 Time.current.advance(days: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># 相當於 Time.current.advance(weeks: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">weeks</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># 相當於 Time.current.advance(days: 4, week: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">days</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">weeks</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 相當於 Time.current.advance(days: 1)
1.day.from_now

# 相當於 Time.current.advance(weeks: 2)
2.weeks.from_now

# 相當於 Time.current.advance(days: 4, week: 5)
(4.days + 5.weeks).from_now
">Copy</button>
</div>
<p>警告。其他時長請參考 <code>Integer</code> 的時間擴充套件。</p><div class="note"><p>在 <code>active_support/core_ext/numeric/time.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">7.3 格式</a></h4><p>以多種方式啟用數字格式。</p><p>生成一個數字的字串表示作為電話號碼：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">5551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">)</span>
<span class="c1"># =&gt; 123-555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">" "</span><span class="p">)</span>
<span class="c1"># =&gt; 123 555 1234</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">area_code: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">extension: </span><span class="mi">555</span><span class="p">)</span>
<span class="c1"># =&gt; (123) 555-1234 x 555</span>
<span class="mi">1235551234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:phone</span><span class="p">,</span> <span class="ss">country_code: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; +1-123-555-1234</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='5551234.to_s(:phone)
# =&gt; 555-1234
1235551234.to_s(:phone)
# =&gt; 123-555-1234
1235551234.to_s(:phone, area_code: true)
# =&gt; (123) 555-1234
1235551234.to_s(:phone, delimiter: " ")
# =&gt; 123 555 1234
1235551234.to_s(:phone, area_code: true, extension: 555)
# =&gt; (123) 555-1234 x 555
1235551234.to_s(:phone, country_code: 1)
# =&gt; +1-123-555-1234
'>Copy</button>
</div>
<p>生成一個數字的字串表示作為貨幣：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mf">1234567890.50</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                 <span class="c1"># =&gt; $1,234,567,890.50</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:currency</span><span class="p">)</span>                <span class="c1"># =&gt; $1,234,567,890.51</span>
<span class="mf">1234567890.506</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:currency</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># =&gt; $1,234,567,890.506</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="1234567890.50.to_s(:currency)                 # =&gt; $1,234,567,890.50
1234567890.506.to_s(:currency)                # =&gt; $1,234,567,890.51
1234567890.506.to_s(:currency, precision: 3)  # =&gt; $1,234,567,890.506
">Copy</button>
</div>
<p>以百分比形式生成數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">100</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">)</span>
<span class="c1"># =&gt; 100.000%</span>
<span class="mi">100</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; 100%</span>
<span class="mi">1000</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s1">'.'</span><span class="p">,</span> <span class="ss">separator: </span><span class="s1">','</span><span class="p">)</span>
<span class="c1"># =&gt; 1.000,000%</span>
<span class="mf">302.24398923423</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:percentage</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># =&gt; 302.24399%</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="100.to_s(:percentage)
# =&gt; 100.000%
100.to_s(:percentage, precision: 0)
# =&gt; 100%
1000.to_s(:percentage, delimiter: '.', separator: ',')
# =&gt; 1.000,000%
302.24398923423.to_s(:percentage, precision: 5)
# =&gt; 302.24399%
">Copy</button>
</div>
<p>以分隔形式生成數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">12345678</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">)</span>                  <span class="c1"># =&gt; 12,345,678.05</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">"."</span><span class="p">)</span>     <span class="c1"># =&gt; 12.345.678</span>
<span class="mi">12345678</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">delimiter: </span><span class="s2">","</span><span class="p">)</span>     <span class="c1"># =&gt; 12,345,678</span>
<span class="mf">12345678.05</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:delimited</span><span class="p">,</span> <span class="ss">separator: </span><span class="s2">" "</span><span class="p">)</span>  <span class="c1"># =&gt; 12,345,678 05</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='12345678.to_s(:delimited)                     # =&gt; 12,345,678
12345678.05.to_s(:delimited)                  # =&gt; 12,345,678.05
12345678.to_s(:delimited, delimiter: ".")     # =&gt; 12.345.678
12345678.to_s(:delimited, delimiter: ",")     # =&gt; 12,345,678
12345678.05.to_s(:delimited, separator: " ")  # =&gt; 12,345,678 05
'>Copy</button>
</div>
<p>生成四捨五入到精度的數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">)</span>                     <span class="c1"># =&gt; 111.235</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># =&gt; 111.23</span>
<span class="mi">13</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">5</span><span class="p">)</span>             <span class="c1"># =&gt; 13.00000</span>
<span class="mf">389.32314</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">precision: </span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># =&gt; 389</span>
<span class="mf">111.2345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:rounded</span><span class="p">,</span> <span class="ss">significant: </span><span class="kp">true</span><span class="p">)</span>  <span class="c1"># =&gt; 111</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="111.2345.to_s(:rounded)                     # =&gt; 111.235
111.2345.to_s(:rounded, precision: 2)       # =&gt; 111.23
13.to_s(:rounded, precision: 5)             # =&gt; 13.00000
389.32314.to_s(:rounded, precision: 0)      # =&gt; 389
111.2345.to_s(:rounded, significant: true)  # =&gt; 111
">Copy</button>
</div>
<p>生成一個數字的字串表示，作為人類可讀的位元組數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                  <span class="c1"># =&gt; 123 Bytes</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                 <span class="c1"># =&gt; 1.21 KB</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>                <span class="c1"># =&gt; 12.1 KB</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>              <span class="c1"># =&gt; 1.18 MB</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>           <span class="c1"># =&gt; 1.15 GB</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>        <span class="c1"># =&gt; 1.12 TB</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>     <span class="c1"># =&gt; 1.1 PB</span>
<span class="mi">1234567890123456789</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human_size</span><span class="p">)</span>  <span class="c1"># =&gt; 1.07 EB</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="123.to_s(:human_size)                  # =&gt; 123 Bytes
1234.to_s(:human_size)                 # =&gt; 1.21 KB
12345.to_s(:human_size)                # =&gt; 12.1 KB
1234567.to_s(:human_size)              # =&gt; 1.18 MB
1234567890.to_s(:human_size)           # =&gt; 1.15 GB
1234567890123.to_s(:human_size)        # =&gt; 1.12 TB
1234567890123456.to_s(:human_size)     # =&gt; 1.1 PB
1234567890123456789.to_s(:human_size)  # =&gt; 1.07 EB
">Copy</button>
</div>
<p>以人類可讀的單詞生成數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>               <span class="c1"># =&gt; "123"</span>
<span class="mi">1234</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>              <span class="c1"># =&gt; "1.23 Thousand"</span>
<span class="mi">12345</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>             <span class="c1"># =&gt; "12.3 Thousand"</span>
<span class="mi">1234567</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>           <span class="c1"># =&gt; "1.23 Million"</span>
<span class="mi">1234567890</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>        <span class="c1"># =&gt; "1.23 Billion"</span>
<span class="mi">1234567890123</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>     <span class="c1"># =&gt; "1.23 Trillion"</span>
<span class="mi">1234567890123456</span><span class="p">.</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:human</span><span class="p">)</span>  <span class="c1"># =&gt; "1.23 Quadrillion"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='123.to_s(:human)               # =&gt; "123"
1234.to_s(:human)              # =&gt; "1.23 Thousand"
12345.to_s(:human)             # =&gt; "12.3 Thousand"
1234567.to_s(:human)           # =&gt; "1.23 Million"
1234567890.to_s(:human)        # =&gt; "1.23 Billion"
1234567890123.to_s(:human)     # =&gt; "1.23 Trillion"
1234567890123456.to_s(:human)  # =&gt; "1.23 Quadrillion"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/numeric/conversions.rb</code> 中定義。</p></div><h3 id="integer"><a class="anchorlink" href="#integer">8 <code>Integer</code> 的擴充套件</a></h3><h4 id="multiple-of-questionmark"><a class="anchorlink" href="#multiple-of-questionmark">8.1 <code>multiple_of?</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Integer.html#method-i-multiple_of-3F"><code>multiple_of?</code></a> 測試一個整數是否是引數的倍數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">2</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="2.multiple_of?(1) # =&gt; true
1.multiple_of?(2) # =&gt; false
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/integer/multiple.rb</code> 中定義。</p></div><h4 id="ordinal"><a class="anchorlink" href="#ordinal">8.2 <code>ordinal</code></a></h4><p>[<code>ordinal</code>][Integer#ordinal]方法返回接收者整數對應的序數字尾字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinal</span>    <span class="c1"># =&gt; "nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinal</span>   <span class="c1"># =&gt; "rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinal</span>  <span class="c1"># =&gt; "st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinal</span> <span class="c1"># =&gt; "th"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='1.ordinal    # =&gt; "st"
2.ordinal    # =&gt; "nd"
53.ordinal   # =&gt; "rd"
2009.ordinal # =&gt; "th"
-21.ordinal  # =&gt; "st"
-134.ordinal # =&gt; "th"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/integer/inflections.rb</code> 中定義。</p></div><h4 id="ordinalize"><a class="anchorlink" href="#ordinalize">8.3 <code>ordinalize</code></a></h4><p><a href="https://api.rubyonrails.org/v7.0.0/classes/Integer.html#method-i-ordinalize"><code>ordinalize</code></a> 方法返回接收者整數對應的序數字符串。相比之下，請注意 <code>ordinal</code> 方法返回<strong>僅</strong>字尾字串。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="mi">1</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "1st"</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">ordinalize</span>    <span class="c1"># =&gt; "2nd"</span>
<span class="mi">53</span><span class="p">.</span><span class="nf">ordinalize</span>   <span class="c1"># =&gt; "53rd"</span>
<span class="mi">2009</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "2009th"</span>
<span class="o">-</span><span class="mi">21</span><span class="p">.</span><span class="nf">ordinalize</span>  <span class="c1"># =&gt; "-21st"</span>
<span class="o">-</span><span class="mi">134</span><span class="p">.</span><span class="nf">ordinalize</span> <span class="c1"># =&gt; "-134th"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='1.ordinalize    # =&gt; "1st"
2.ordinalize    # =&gt; "2nd"
53.ordinalize   # =&gt; "53rd"
2009.ordinalize # =&gt; "2009th"
-21.ordinalize  # =&gt; "-21st"
-134.ordinalize # =&gt; "-134th"
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/integer/inflections.rb</code> 中定義。</p></div><h4 id="integer"><a class="anchorlink" href="#integer">8.4 時間</a></h4><p>以下方法：</p>
<ul>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Integer.html#method-i-months"><code>months</code></a></li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/Integer.html#method-i-years"><code>years</code></a></li>
</ul>
<p>啟用時間宣告和計算，如 <code>4.months + 5.years</code>。它們的返回值 values 也可以新增到 Time 物件或從中減去。</p><p>這些方法可以結合 [<code>from_now</code>][Duration#from_now]、[<code>ago</code>][Duration#ago] 等進行精確的日期計算。例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="c1"># 相當於 Time.current.advance(months: 1)</span>
<span class="mi">1</span><span class="p">.</span><span class="nf">month</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># 相當於 Time.current.advance(years: 2)</span>
<span class="mi">2</span><span class="p">.</span><span class="nf">years</span><span class="p">.</span><span class="nf">from_now</span>

<span class="c1"># 相當於 Time.current.advance(月: 4, 年: 5)</span>
<span class="p">(</span><span class="mi">4</span><span class="p">.</span><span class="nf">months</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">years</span><span class="p">).</span><span class="nf">from_now</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="# 相當於 Time.current.advance(months: 1)
1.month.from_now

# 相當於 Time.current.advance(years: 2)
2.years.from_now

# 相當於 Time.current.advance(月: 4, 年: 5)
(4.months + 5.years).from_now
">Copy</button>
</div>
<p>警告。其他時長請參考 <code>Numeric</code> 的時間擴充套件。</p><div class="note"><p>在 <code>active_support/core_ext/integer/time.rb</code> 中定義。</p></div><h3 id="bigdecimal"><a class="anchorlink" href="#bigdecimal">9 <code>BigDecimal</code> 的擴充套件</a></h3><h4 id="bigdecimal-to-s"><a class="anchorlink" href="#bigdecimal-to-s">9.1 <code>to_s</code></a></h4><p><code>to_s</code> 方法提供了預設說明符“F”。這意味著對 <code>to_s</code> 的簡單呼叫將導致浮點表示而不是工程符號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span>       <span class="c1"># =&gt; "5.0"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='BigDecimal(5.00, 6).to_s       # =&gt; "5.0"
'>Copy</button>
</div>
<p>並且還支援 symbol 說明符：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>  <span class="c1"># =&gt; "5.0"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='BigDecimal(5.00, 6).to_s(:db)  # =&gt; "5.0"
'>Copy</button>
</div>
<p>仍然支援工程符號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">BigDecimal</span><span class="p">(</span><span class="mf">5.00</span><span class="p">,</span> <span class="mi">6</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>  <span class="c1"># =&gt; "0.5E1"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='BigDecimal(5.00, 6).to_s("e")  # =&gt; "0.5E1"
'>Copy</button>
</div>
<h3 id="enumerable"><a class="anchorlink" href="#enumerable">10 <code>Enumerable</code> 的擴充套件</a></h3><h4 id="sum"><a class="anchorlink" href="#sum">10.1 <code>sum</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-sum"><code>sum</code></a> 新增可列舉的元素：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">sum</span> <span class="c1"># =&gt; 6</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">).</span><span class="nf">sum</span>  <span class="c1"># =&gt; 5050</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].sum # =&gt; 6
(1..100).sum  # =&gt; 5050
">Copy</button>
</div>
<p>新增僅假設元素回應 <code>+</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]].</span><span class="nf">sum</span>    <span class="c1"># =&gt; [1, 2, 2, 3, 3, 4]</span>
<span class="sx">%w(foo bar baz)</span><span class="p">.</span><span class="nf">sum</span>             <span class="c1"># =&gt; "foobarbaz"</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">3</span><span class="p">}.</span><span class="nf">sum</span>          <span class="c1"># =&gt; [:a, 1, :b, 2, :c, 3]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[[1, 2], [2, 3], [3, 4]].sum    # =&gt; [1, 2, 2, 3, 3, 4]
%w(foo bar baz).sum             # =&gt; "foobarbaz"
{a: 1, b: 2, c: 3}.sum          # =&gt; [:a, 1, :b, 2, :c, 3]
'>Copy</button>
</div>
<p>預設情況下，空集合的總和為零，但這是可自定義的：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">sum</span>    <span class="c1"># =&gt; 0</span>
<span class="p">[].</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[].sum    # =&gt; 0
[].sum(1) # =&gt; 1
">Copy</button>
</div>
<p>如果給出了一個塊，則 <code>sum</code> 成為一個迭代器，它產生集合的元素並對返回的 values 求和：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">sum</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span> <span class="c1"># =&gt; 30</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">].</span><span class="nf">sum</span>    <span class="c1"># =&gt; 30</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(1..5).sum {|n| n * 2 } # =&gt; 30
[2, 4, 6, 8, 10].sum    # =&gt; 30
">Copy</button>
</div>
<p>空接收器的總和也可以用這種形式定製：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">**</span><span class="mi">3</span><span class="p">}</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[].sum(1) {|n| n**3} # =&gt; 1
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="index-by"><a class="anchorlink" href="#index-by">10.2 <code>index_by</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-index_by"><code>index_by</code></a> 生成一個雜湊，其中包含由某些 key 索引的可列舉元素。</p><p>它遍歷集合並將每個元素傳遞給一個塊。該元素將被塊返回的 value 處理為 key：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">invoices</span><span class="p">.</span><span class="nf">index_by</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:number</span><span class="p">)</span>
<span class="c1"># =&gt; {'2009-032' =&gt; &lt;發票 ...&gt;, '2009-008' =&gt; &lt;發票 ...&gt;, ...}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="invoices.index_by(&amp;:number)
# =&gt; {'2009-032' =&gt; &lt;發票 ...&gt;, '2009-008' =&gt; &lt;發票 ...&gt;, ...}
">Copy</button>
</div>
<p>警告。 Keys 通常應該是唯一的。如果塊為不同的元素返回相同的 value，則不會為該鍵構建集合。最後一項將獲勝。</p><div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="index-with"><a class="anchorlink" href="#index-with">10.3 <code>index_with</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-index_with"><code>index_with</code></a> 使用可列舉的元素作為 keys 生成雜湊。 value
是傳遞的預設值或在塊中返回。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"hey there"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"what's up?"</span><span class="p">)</span>

<span class="sx">%i( title body )</span><span class="p">.</span><span class="nf">index_with</span> <span class="p">{</span> <span class="o">|</span><span class="n">attr_name</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">public_send</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; { title: "嘿嘿", body: "怎麼了？" }</span>

<span class="no">WEEKDAYS</span><span class="p">.</span><span class="nf">index_with</span><span class="p">(</span><span class="no">Interval</span><span class="p">.</span><span class="nf">all_day</span><span class="p">)</span>
<span class="c1"># =&gt; { 星期一: [ 0, 1440 ], ... }</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="post = Post.new(title: &quot;hey there&quot;, body: &quot;what's up?&quot;)

%i( title body ).index_with { |attr_name| post.public_send(attr_name) }
# =&gt; { title: &quot;嘿嘿&quot;, body: &quot;怎麼了？&quot; }

WEEKDAYS.index_with(Interval.all_day)
# =&gt; { 星期一: [ 0, 1440 ], ... }
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="many-questionmark"><a class="anchorlink" href="#many-questionmark">10.4 <code>many?</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-many-3F"><code>many?</code></a> 是 <code>collection.size &gt; 1</code> 的簡寫：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">pages</span><span class="p">.</span><span class="nf">many?</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">pagination_links</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% if pages.many? %&gt;
  &lt;%= pagination_links %&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>如果給出了一個可選塊，<code>many?</code> 只考慮那些返回 true 的元素：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="vi">@see_more</span> <span class="o">=</span> <span class="n">videos</span><span class="p">.</span><span class="nf">many?</span> <span class="p">{</span><span class="o">|</span><span class="n">video</span><span class="o">|</span> <span class="n">video</span><span class="p">.</span><span class="nf">category</span> <span class="o">==</span> <span class="n">params</span><span class="p">[</span><span class="ss">:category</span><span class="p">]}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="@see_more = videos.many? {|video| video.category == params[:category]}
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="exclude-questionmark"><a class="anchorlink" href="#exclude-questionmark">10.5 <code>exclude?</code></a></h4><p>謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-exclude-3F"><code>exclude?</code></a> 測試給定的物件是否<strong>不</strong>屬於集合。它是對內建 <code>include?</code> 的否定：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">to_visit</span> <span class="o">&lt;&lt;</span> <span class="n">node</span> <span class="k">if</span> <span class="n">visited</span><span class="p">.</span><span class="nf">exclude?</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="to_visit &lt;&lt; node if visited.exclude?(node)
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="including"><a class="anchorlink" href="#including">10.6 <code>including</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-%E5%8C%85%E6%8B%AC"><code>including</code></a> 返回一個包含傳遞元素的新列舉：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>                    <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">].</span><span class="nf">including</span> <span class="sx">%w[ Aaron Todd ]</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron", "Todd"]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[ 1, 2, 3 ].including(4, 5)                    # =&gt; [ 1, 2, 3, 4, 5 ]
["David", "Rafael"].including %w[ Aaron Todd ] # =&gt; ["David", "Rafael", "Aaron", "Todd"]
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="excluding"><a class="anchorlink" href="#excluding">10.7 <code>excluding</code></a></h4><p>方法 [<code>excluding</code>][Enumerable# exclude] 返回具有指定元素的可列舉的副本
移除：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
'>Copy</button>
</div>
<p><code>excluding</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-without"><code>without</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><p>[可列舉#排除]:<a href="https://api.rubyonrails.org/classes/Enumerable.html#method-i-">https://api.rubyonrails.org/classes/Enumerable.html#method-i-</a> exclude</p><h4 id="pluck"><a class="anchorlink" href="#pluck">10.8 <code>pluck</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-pluck"><code>pluck</code></a> 從每個元素中提取給定的 key：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael", "Aaron"]</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pluck</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [[1, "David"], [2, "Rafael"]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pluck(:name) # =&gt; ["David", "Rafael", "Aaron"]
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pluck(:id, :name) # =&gt; [[1, "David"], [2, "Rafael"]]
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h4 id="pick"><a class="anchorlink" href="#pick">10.9 <code>pick</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Enumerable.html#method-i-pick"><code>pick</code></a> 從第一個元素中提取給定的 key：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[{</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">name: </span><span class="s2">"Aaron"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; "David"</span>
<span class="p">[{</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"David"</span> <span class="p">},</span> <span class="p">{</span> <span class="ss">id: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">name: </span><span class="s2">"Rafael"</span> <span class="p">}].</span><span class="nf">pick</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; [1, "David"]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pick(:name) # =&gt; "David"
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pick(:id, :name) # =&gt; [1, "David"]
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/enumerable.rb</code> 中定義。</p></div><h3 id="array"><a class="anchorlink" href="#array">11 <code>Array</code> 的擴充套件</a></h3><h4 id="array"><a class="anchorlink" href="#array">11.1 訪問</a></h4><p>Active Support 增加了陣列的 API 以簡化訪問它們的某些方式。例如， <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-to"><code>to</code></a> 返回元素的子陣列，直到傳遞的索引處的元素：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">to</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; ["a", "b", "c"]</span>
<span class="p">[].</span><span class="nf">to</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>          <span class="c1"># =&gt; []</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(a b c d).to(2) # =&gt; ["a", "b", "c"]
[].to(7)          # =&gt; []
'>Copy</button>
</div>
<p>類似地， [<code>from</code>][Array#from] 返回從傳遞索引處的元素到結尾的尾部。如果索引大於陣列的長度，則返回一個空陣列。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; ["c", "d"]</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; []</span>
<span class="p">[].</span><span class="nf">from</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           <span class="c1"># =&gt; []</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(a b c d).from(2)  # =&gt; ["c", "d"]
%w(a b c d).from(10) # =&gt; []
[].from(0)           # =&gt; []
'>Copy</button>
</div>
<p>方法 [<code>including</code>][Array#include] 返回一個包含傳遞元素的新陣列：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">].</span><span class="nf">including</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>          <span class="c1"># =&gt; [ 1, 2, 3, 4, 5 ]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">].</span><span class="nf">including</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span> <span class="c1"># =&gt; [ [ 0, 1 ], [ 1, 0 ] ]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[ 1, 2, 3 ].including(4, 5)          # =&gt; [ 1, 2, 3, 4, 5 ]
[ [ 0, 1 ] ].including([ [ 1, 0 ] ]) # =&gt; [ [ 0, 1 ], [ 1, 0 ] ]
">Copy</button>
</div>
<p>方法 [<code>excluding</code>][Array# exclude] 返回不包括指定元素的 Array 的副本。
這是對使用 <code>Array#-</code> 的 <code>Enumerable#excluding</code> 的最佳化
出於效能原因而不是 <code>Array#reject</code>。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="s2">"David"</span><span class="p">,</span> <span class="s2">"Rafael"</span><span class="p">,</span> <span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">].</span><span class="nf">excluding</span><span class="p">(</span><span class="s2">"Aaron"</span><span class="p">,</span> <span class="s2">"Todd"</span><span class="p">)</span> <span class="c1"># =&gt; ["David", "Rafael"]</span>
<span class="p">[</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">].</span><span class="nf">excluding</span><span class="p">([</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span> <span class="p">])</span>                  <span class="c1"># =&gt; [ [ 0, 1 ] ]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
[ [ 0, 1 ], [ 1, 0 ] ].excluding([ [ 1, 0 ] ])                  # =&gt; [ [ 0, 1 ] ]
'>Copy</button>
</div>
<p>方法 [<code>second</code>][Array#second]、<a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-third"><code>third</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-fourth"><code>fourth</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-fifth"><code>fifth</code></a> 返回相應的元素，[<code>second_to_last</code>][Array 也是如此#second_to_last] 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-third_to_last"><code>third_to_last</code></a>（<code>first</code> 和 <code>last</code> 是內建的）。由於社會智慧和積極的建設性，<a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-forty_two"><code>forty_two</code></a> 也可用。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">third</span> <span class="c1"># =&gt; "c"</span>
<span class="sx">%w(a b c d)</span><span class="p">.</span><span class="nf">fifth</span> <span class="c1"># =&gt; nil</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(a b c d).third # =&gt; "c"
%w(a b c d).fifth # =&gt; nil
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/array/access.rb</code> 中定義。</p></div><p>[陣列#排除]:<a href="https://api.rubyonrails.org/classes/Array.html#method-i-">https://api.rubyonrails.org/classes/Array.html#method-i-</a> exclude</p><h4 id="array-"><a class="anchorlink" href="#array-">11.2 提取</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-extract-21"><code>extract!</code></a> 移除並返回塊返回真 value 的元素。
如果沒有給出塊，則返回一個列舉器。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">odd_numbers</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">.</span><span class="nf">extract!</span> <span class="p">{</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span> <span class="n">number</span><span class="p">.</span><span class="nf">odd?</span> <span class="p">}</span> <span class="c1"># =&gt; [1, 3, 5, 7, 9]</span>
<span class="n">numbers</span> <span class="c1"># =&gt; [0, 2, 4, 6, 8]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
odd_numbers = numbers.extract! { |number| number.odd? } # =&gt; [1, 3, 5, 7, 9]
numbers # =&gt; [0, 2, 4, 6, 8]
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/array/extract.rb</code> 中定義。</p></div><h4 id="extraction"><a class="anchorlink" href="#extraction">11.3 期權 Extraction</a></h4><p>當方法呼叫中的最後一個引數是雜湊時，除了 <code>&amp;block</code> 引數，Ruby 允許您省略括號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">User</span><span class="p">.</span><span class="nf">exists?</span><span class="p">(</span><span class="ss">email: </span><span class="n">params</span><span class="p">[</span><span class="ss">:email</span><span class="p">])</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="User.exists?(email: params[:email])
">Copy</button>
</div>
<p>這種語法糖在 Rails 中被大量使用，以避免出現過多的位置引數，而是提供模擬命名引數的介面。特別是使用尾隨雜湊作為選項是非常慣用的。</p><p>然而，如果一個方法需要可變數量的引數並在其宣告中使用 <code>*</code>，那麼這樣的選項雜湊最終會成為引數陣列的一個專案，在那裡它失去了它的作用。</p><p>在這些情況下，您可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-extract_options-21"><code>extract_options!</code></a> 對選項雜湊進行特殊處理。此方法檢查陣列最後一項的型別。如果它是一個雜湊，它彈出它並返回它，否則它返回一個空的雜湊。</p><p>例如，讓我們看看 <code>caches_action</code> controller 宏的定義：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">caches_action</span><span class="p">(</span><span class="o">*</span><span class="n">actions</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">unless</span> <span class="n">cache_configured?</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">actions</span><span class="p">.</span><span class="nf">extract_options!</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="def caches_action(*actions)
  return unless cache_configured?
  options = actions.extract_options!
  # ...
end
">Copy</button>
</div>
<p>此方法接收任意數量的 action 名稱，以及作為最後一個引數的可選雜湊選項。透過呼叫 <code>extract_options!</code>，您可以獲得選項雜湊並以簡單而明確的方式將其從 <code>actions</code> 中刪除。</p><div class="note"><p>在 <code>active_support/core_ext/array/extract_options.rb</code> 中定義。</p></div><h4 id="array"><a class="anchorlink" href="#array">11.4 轉換</a></h4><h5 id="to-sentence"><a class="anchorlink" href="#to-sentence">11.4.1 <code>to_sentence</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-to_sentence"><code>to_sentence</code></a> 將陣列轉換為包含列舉其專案的句子的字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w()</span><span class="p">.</span><span class="nf">to_sentence</span>                <span class="c1"># =&gt; ""</span>
<span class="sx">%w(Earth)</span><span class="p">.</span><span class="nf">to_sentence</span>           <span class="c1"># =&gt; "Earth"</span>
<span class="sx">%w(Earth Wind)</span><span class="p">.</span><span class="nf">to_sentence</span>      <span class="c1"># =&gt; "Earth and Wind"</span>
<span class="sx">%w(Earth Wind Fire)</span><span class="p">.</span><span class="nf">to_sentence</span> <span class="c1"># =&gt; "Earth, Wind, and Fire"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w().to_sentence                # =&gt; ""
%w(Earth).to_sentence           # =&gt; "Earth"
%w(Earth Wind).to_sentence      # =&gt; "Earth and Wind"
%w(Earth Wind Fire).to_sentence # =&gt; "Earth, Wind, and Fire"
'>Copy</button>
</div>
<p>此方法接受三個選項：</p>
<ul>
<li>
<code>:two_words_connector</code>：用於長度為2的陣列。預設為“和”。</li>
<li>
<code>:words_connector</code>：用於連線3個或更多元素的陣列元素，除了最後兩個。預設為“,”。</li>
<li>
<code>:last_word_connector</code>：用於連線具有 3 個或更多元素的陣列的最後一項。預設為“，和”。</li>
</ul>
<p>這些選項的預設值可以本地化，它們的 keys 是：</p>
<table>
<thead>
<tr>
<th>選項</th>
<th>I18n key</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:two_words_connector</code></td>
<td><code>support.array.two_words_connector</code></td>
</tr>
<tr>
<td><code>:words_connector</code></td>
<td><code>support.array.words_connector</code></td>
</tr>
<tr>
<td><code>:last_word_connector</code></td>
<td><code>support.array.last_word_connector</code></td>
</tr>
</tbody>
</table>
<div class="note"><p>在 <code>active_support/core_ext/array/conversions.rb</code> 中定義。</p></div><h5 id="to-formatted-s"><a class="anchorlink" href="#to-formatted-s">11.4.2 <code>to_formatted_s</code></a></h5><p>預設情況下，方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-to_formatted_s"><code>to_formatted_s</code></a> 的作用類似於 <code>to_s</code>。</p><p>但是，如果陣列包含回應 <code>id</code> 的專案，則 symbol
<code>:db</code> 可以作為引數傳遞。這通常與
Active Record 物件的集合。返回的字串是：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[].</span><span class="nf">to_formatted_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>            <span class="c1"># =&gt; "null"</span>
<span class="p">[</span><span class="n">user</span><span class="p">].</span><span class="nf">to_formatted_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>        <span class="c1"># =&gt; "8456"</span>
<span class="n">invoice</span><span class="p">.</span><span class="nf">lines</span><span class="p">.</span><span class="nf">to_formatted_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span> <span class="c1"># =&gt; "23,567,556,12"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[].to_formatted_s(:db)            # =&gt; "null"
[user].to_formatted_s(:db)        # =&gt; "8456"
invoice.lines.to_formatted_s(:db) # =&gt; "23,567,556,12"
'>Copy</button>
</div>
<p>上面示例中的整數應該來自對 <code>id</code> 的相應呼叫。</p><div class="note"><p>在 <code>active_support/core_ext/array/conversions.rb</code> 中定義。</p></div><h5 id="array-to-xml"><a class="anchorlink" href="#array-to-xml">11.4.3 <code>to_xml</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-to_xml"><code>to_xml</code></a> 返回一個包含其接收者的 XML 表示的字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;contributors type="array"&gt;</span>
<span class="c1"># &lt;貢獻者&gt;</span>
<span class="c1"># &lt;id type="integer"&gt;4356&lt;/id&gt;</span>
<span class="c1"># &lt;name&gt;傑瑞米·肯珀&lt;/name&gt;</span>
<span class="c1"># &lt;rank type="integer"&gt;1&lt;/rank&gt;</span>
<span class="c1"># &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1"># &lt;/貢獻者&gt;</span>
<span class="c1"># &lt;貢獻者&gt;</span>
<span class="c1"># &lt;id type="integer"&gt;4404&lt;/id&gt;</span>
<span class="c1"># &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1"># &lt;rank type="integer"&gt;2&lt;/rank&gt;</span>
<span class="c1"># &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1"># &lt;/貢獻者&gt;</span>
<span class="c1"># &lt;/貢獻者&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Contributor.limit(2).order(:rank).to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors type="array"&gt;
# &lt;貢獻者&gt;
# &lt;id type="integer"&gt;4356&lt;/id&gt;
# &lt;name&gt;傑瑞米·肯珀&lt;/name&gt;
# &lt;rank type="integer"&gt;1&lt;/rank&gt;
# &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
# &lt;/貢獻者&gt;
# &lt;貢獻者&gt;
# &lt;id type="integer"&gt;4404&lt;/id&gt;
# &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
# &lt;rank type="integer"&gt;2&lt;/rank&gt;
# &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
# &lt;/貢獻者&gt;
# &lt;/貢獻者&gt;
'>Copy</button>
</div>
<p>為此，它依次將 <code>to_xml</code> 傳送到每個專案，並在根節點下收集結果。所有專案都必須回應 <code>to_xml</code>，否則會引發異常。</p><p>預設情況下，根元素的名稱是第一項的類名稱的下劃線和破折號複數形式，前提是其餘元素屬於該型別（使用 <code>is_a?</code> 檢查）並且它們不是雜湊。在上面的例子中是“貢獻者”。</p><p>如果有任何元素不屬於第一個元素的型別，則根節點將成為“物件”：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="no">Contributor</span><span class="p">.</span><span class="nf">first</span><span class="p">,</span> <span class="no">Commit</span><span class="p">.</span><span class="nf">first</span><span class="p">].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1"># &lt;物件&gt;</span>
<span class="c1"># &lt;id type="integer"&gt;4583&lt;/id&gt;</span>
<span class="c1"># &lt;name&gt;Aaron Batalion&lt;/name&gt;</span>
<span class="c1"># &lt;rank type="integer"&gt;53&lt;/rank&gt;</span>
<span class="c1"># &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;</span>
<span class="c1"># &lt;/物件&gt;</span>
<span class="c1"># &lt;物件&gt;</span>
<span class="c1"># &lt;author&gt;Joshua Peek&lt;/author&gt;</span>
<span class="c1"># &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;</span>
<span class="c1"># &lt;branch&gt;起源/主&lt;/branch&gt;</span>
<span class="c1"># &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;</span>
<span class="c1"># &lt;committer&gt;Joshua Peek&lt;/committer&gt;</span>
<span class="c1"># &lt;git-show nil="true"&gt;&lt;/git-show&gt;</span>
<span class="c1"># &lt;id type="integer"&gt;190316&lt;/id&gt;</span>
<span class="c1"># &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;</span>
<span class="c1"># &lt;message&gt;殺死 AMo 觀察 wrap_with_notifications 因為 ARes 只使用它&lt;/message&gt;</span>
<span class="c1"># &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;</span>
<span class="c1"># &lt;/物件&gt;</span>
<span class="c1"># &lt;/物件&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[Contributor.first, Commit.first].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
# &lt;物件&gt;
# &lt;id type="integer"&gt;4583&lt;/id&gt;
# &lt;name&gt;Aaron Batalion&lt;/name&gt;
# &lt;rank type="integer"&gt;53&lt;/rank&gt;
# &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;
# &lt;/物件&gt;
# &lt;物件&gt;
# &lt;author&gt;Joshua Peek&lt;/author&gt;
# &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;
# &lt;branch&gt;起源/主&lt;/branch&gt;
# &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;
# &lt;committer&gt;Joshua Peek&lt;/committer&gt;
# &lt;git-show nil="true"&gt;&lt;/git-show&gt;
# &lt;id type="integer"&gt;190316&lt;/id&gt;
# &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;
# &lt;message&gt;殺死 AMo 觀察 wrap_with_notifications 因為 ARes 只使用它&lt;/message&gt;
# &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;
# &lt;/物件&gt;
# &lt;/物件&gt;
'>Copy</button>
</div>
<p>如果接收者是雜湊陣列，則根元素預設也是“物件”：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="ss">c: </span><span class="mi">3</span><span class="p">}].</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;objects type="array"&gt;</span>
<span class="c1"># &lt;物件&gt;</span>
<span class="c1"># &lt;b type="integer"&gt;2&lt;/b&gt;</span>
<span class="c1"># &lt;a type="integer"&gt;1&lt;/a&gt;</span>
<span class="c1"># &lt;/物件&gt;</span>
<span class="c1"># &lt;物件&gt;</span>
<span class="c1"># &lt;c type="integer"&gt;3&lt;/c&gt;</span>
<span class="c1"># &lt;/物件&gt;</span>
<span class="c1"># &lt;/物件&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[{a: 1, b: 2}, {c: 3}].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
# &lt;物件&gt;
# &lt;b type="integer"&gt;2&lt;/b&gt;
# &lt;a type="integer"&gt;1&lt;/a&gt;
# &lt;/物件&gt;
# &lt;物件&gt;
# &lt;c type="integer"&gt;3&lt;/c&gt;
# &lt;/物件&gt;
# &lt;/物件&gt;
'>Copy</button>
</div>
<p>警告。如果集合為空，則根元素預設為“nil-classes”。這是一個問題，例如，如果集合為空，則上述貢獻者列表的根元素將不是“貢獻者”，而是“nil-classes”。您可以使用 <code>:root</code> 選項來確保一致的根元素。</p><p>預設情況下，子節點的名稱是單數化的根節點的名稱。在上面的例子中，我們已經看到了“貢獻者”和“物件”。選項 <code>:children</code> 允許您設定這些節點名稱。</p><p>預設的 XML 構建器是 <code>Builder::XmlMarkup</code> 的新實例。您可以透過 <code>:builder</code> 選項設定您自己的構建器。該方法還接受諸如 <code>:dasherize</code> 和朋友之類的選項，將它們轉發給構建器：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Contributor</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">order</span><span class="p">(</span><span class="ss">:rank</span><span class="p">).</span><span class="nf">to_xml</span><span class="p">(</span><span class="ss">skip_types: </span><span class="kp">true</span><span class="p">)</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;貢獻者&gt;</span>
<span class="c1"># &lt;貢獻者&gt;</span>
<span class="c1"># &lt;id&gt;4356&lt;/id&gt;</span>
<span class="c1"># &lt;name&gt;傑瑞米·肯珀&lt;/name&gt;</span>
<span class="c1"># &lt;rank&gt;1&lt;/rank&gt;</span>
<span class="c1"># &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;</span>
<span class="c1"># &lt;/貢獻者&gt;</span>
<span class="c1"># &lt;貢獻者&gt;</span>
<span class="c1"># &lt;id&gt;4404&lt;/id&gt;</span>
<span class="c1"># &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;</span>
<span class="c1"># &lt;rank&gt;2&lt;/rank&gt;</span>
<span class="c1"># &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;</span>
<span class="c1"># &lt;/貢獻者&gt;</span>
<span class="c1"># &lt;/貢獻者&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Contributor.limit(2).order(:rank).to_xml(skip_types: true)
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;貢獻者&gt;
# &lt;貢獻者&gt;
# &lt;id&gt;4356&lt;/id&gt;
# &lt;name&gt;傑瑞米·肯珀&lt;/name&gt;
# &lt;rank&gt;1&lt;/rank&gt;
# &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
# &lt;/貢獻者&gt;
# &lt;貢獻者&gt;
# &lt;id&gt;4404&lt;/id&gt;
# &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
# &lt;rank&gt;2&lt;/rank&gt;
# &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
# &lt;/貢獻者&gt;
# &lt;/貢獻者&gt;
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/array/conversions.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">11.5 包裝</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-c-wrap"><code>Array.wrap</code></a> 將其引數包裝在一個數組中，除非它已經是一個數組（或類似陣列）。</p><p>具體來說：</p>
<ul>
<li>如果引數是 <code>nil</code>，則返回一個空陣列。</li>
<li>否則，如果引數回應 <code>to_ary</code> 則呼叫它，如果 <code>to_ary</code> 的 value 不是 <code>nil</code>，則返回。</li>
<li>否則，返回一個以引數為單個元素的陣列。</li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>       <span class="c1"># =&gt; []</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># =&gt; [1, 2, 3]</span>
<span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>         <span class="c1"># =&gt; [0]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Array.wrap(nil)       # =&gt; []
Array.wrap([1, 2, 3]) # =&gt; [1, 2, 3]
Array.wrap(0)         # =&gt; [0]
">Copy</button>
</div>
<p>該方法的目的與 <code>Kernel#Array</code> 類似，但有一些差別：</p>
<ul>
<li>如果引數回應 <code>to_ary</code>，則呼叫該方法。如果返回的 value 是 <code>nil</code>，則 <code>Kernel#Array</code> 繼續嘗試 <code>to_a</code>，但 <code>Array.wrap</code> 立即返回一個以引數作為其單個元素的陣列。</li>
<li>如果從 <code>to_ary</code> 返回的 value 既不是 <code>nil</code> 也不是 <code>Array</code> 物件，則 <code>Kernel#Array</code> 會引發異常，而 <code>Array.wrap</code> 不會，它只會返回 value。</li>
<li>它不會在引數上呼叫 <code>to_a</code>，如果引數不回應 <code>to_ary</code>，它將返回一個以引數為單個元素的陣列。</li>
</ul>
<p>最後一點特別值得對一些可列舉進行比較：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Array</span><span class="p">.</span><span class="nf">wrap</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span> <span class="c1"># =&gt; [{:foo=&gt;:bar}]</span>
<span class="no">Array</span><span class="p">(</span><span class="ss">foo: :bar</span><span class="p">)</span>      <span class="c1"># =&gt; [[:foo, :bar]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Array.wrap(foo: :bar) # =&gt; [{:foo=&gt;:bar}]
Array(foo: :bar)      # =&gt; [[:foo, :bar]]
">Copy</button>
</div>
<p>還有一個使用 splat 運算子的相關成語：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="o">*</span><span class="n">object</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[*object]
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/array/wrap.rb</code> 中定義。</p></div><h4 id="array"><a class="anchorlink" href="#array">11.6 複製</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-deep_dup"><code>Array#deep_dup</code></a> 複製自身和裡面的所有物件
遞迴地使用 Active Support 方法 <code>Object#deep_dup</code>。它的工作原理類似於 <code>Array#map</code>，向內部的每個物件傳送 <code>deep_dup</code> 方法。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="nb">dup</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="array = [1, [2, 3]]
dup = array.deep_dup
dup[1][2] = 4
array[1][2] == nil   # =&gt; true
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/deep_dup.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">11.7 分組</a></h4><h5 id="in-groups-of-number-fill-with-nil"><a class="anchorlink" href="#in-groups-of-number-fill-with-nil">11.7.1 <code>in_groups_of(number, fill_with = nil)</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-in_groups_of"><code>in_groups_of</code></a> 將陣列拆分為特定大小的連續組。它返回一個包含組的陣列：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, nil]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].in_groups_of(2) # =&gt; [[1, 2], [3, nil]]
">Copy</button>
</div>
<p>或者如果傳遞了一個塊，則依次產生它們：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">sample</span><span class="p">.</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">a</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">b</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">c</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% sample.in_groups_of(3) do |a, b, c| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= a %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= b %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= c %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>第一個示例顯示 <code>in_groups_of</code> 如何根據需要使用盡可能多的 <code>nil</code> 元素填充最後一組以具有請求的大小。您可以使用第二個可選引數更改此填充 value：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3, 0]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].in_groups_of(2, 0) # =&gt; [[1, 2], [3, 0]]
">Copy</button>
</div>
<p>您可以透過傳遞 <code>false</code> 來告訴該方法不要填充最後一組：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span> <span class="c1"># =&gt; [[1, 2], [3]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].in_groups_of(2, false) # =&gt; [[1, 2], [3]]
">Copy</button>
</div>
<p>因此，<code>false</code> 不能用作填充 value。</p><div class="note"><p>在 <code>active_support/core_ext/array/grouping.rb</code> 中定義。</p></div><h5 id="in-groups-number-fill-with-nil"><a class="anchorlink" href="#in-groups-number-fill-with-nil">11.7.2 <code>in_groups(number, fill_with = nil)</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-in_groups"><code>in_groups</code></a> 將陣列拆分為一定數量的組。該方法返回一個包含組的陣列：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3)
# =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]
'>Copy</button>
</div>
<p>或者如果傳遞了一個塊，則依次產生它們：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">group</span><span class="o">|</span> <span class="nb">p</span> <span class="n">group</span><span class="p">}</span>
<span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="s2">"2"</span><span class="p">,</span> <span class="s2">"3"</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"4"</span><span class="p">,</span> <span class="s2">"5"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
<span class="p">[</span><span class="s2">"6"</span><span class="p">,</span> <span class="s2">"7"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3) {|group| p group}
["1", "2", "3"]
["4", "5", nil]
["6", "7", nil]
'>Copy</button>
</div>
<p>上面的示例顯示 <code>in_groups</code> 根據需要使用尾隨的 <code>nil</code> 元素填充某些組。一個組最多可以獲得這些額外元素中的一個，如果有的話，最右邊的一個。擁有它們的組總是最後一個。</p><p>您可以使用第二個可選引數更改此填充 value：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3, "0")
# =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]
'>Copy</button>
</div>
<p>您可以透過傳遞 <code>false</code> 來告訴該方法不要填充較小的組：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sx">%w(1 2 3 4 5 6 7)</span><span class="p">.</span><span class="nf">in_groups</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span>
<span class="c1"># =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3, false)
# =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]
'>Copy</button>
</div>
<p>因此，<code>false</code> 不能用作填充 value。</p><div class="note"><p>在 <code>active_support/core_ext/array/grouping.rb</code> 中定義。</p></div><h5 id="split-value-nil"><a class="anchorlink" href="#split-value-nil">11.7.3 <code>split(value = nil)</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Array.html#method-i-split"><code>split</code></a> 將陣列除以分隔符並返回結果塊​​。</p><p>如果傳遞了一個塊，則分隔符是該塊為其返回 true 的陣列元素：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">split</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="p">.</span><span class="nf">multiple_of?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="c1"># =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(-5..5).to_a.split { |i| i.multiple_of?(4) }
# =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]
">Copy</button>
</div>
<p>否則，作為引數接收的 value，預設為 <code>nil</code>，是分隔符：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; [[0], [-5], [], ["foo", "bar"]]</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='[0, 1, -5, 1, 1, "foo", "bar"].split(1)
# =&gt; [[0], [-5], [], ["foo", "bar"]]
'>Copy</button>
</div>
<p>提示：在前面的示例中觀察到，連續的分隔符會導致空陣列。</p><div class="note"><p>在 <code>active_support/core_ext/array/grouping.rb</code> 中定義。</p></div><h3 id="hash"><a class="anchorlink" href="#hash">12 <code>Hash</code> 的擴充套件</a></h3><h4 id="hash-"><a class="anchorlink" href="#hash-">12.1 轉換</a></h4><h5 id="to-xml"><a class="anchorlink" href="#to-xml">12.1.1 <code>to_xml</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-to_xml"><code>to_xml</code></a> 返回一個包含其接收者的 XML 表示的字串：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"foo"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"bar"</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}.</span><span class="nf">to_xml</span>
<span class="c1"># =&gt;</span>
<span class="c1"># &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="c1"># &lt;雜湊&gt;</span>
<span class="c1"># &lt;foo type="integer"&gt;1&lt;/foo&gt;</span>
<span class="c1"># &lt;bar type="integer"&gt;2&lt;/bar&gt;</span>
<span class="c1"># &lt;/雜湊&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{"foo" =&gt; 1, "bar" =&gt; 2}.to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;雜湊&gt;
# &lt;foo type="integer"&gt;1&lt;/foo&gt;
# &lt;bar type="integer"&gt;2&lt;/bar&gt;
# &lt;/雜湊&gt;
'>Copy</button>
</div>
<p>為此，該方法遍歷這些對並構建依賴於 <em>values</em> 的節點。給定一對 <code>key</code>, <code>value</code>：</p>
<ul>
<li><p>如果 <code>value</code> 是一個雜湊，則遞迴呼叫 <code>key</code> 作為 <code>:root</code>。</p></li>
<li><p>如果 <code>value</code> 是一個數組，則遞迴呼叫 <code>key</code> 為 <code>:root</code>，<code>key</code> 單數化為 <code>:children</code>。</p></li>
<li><p>如果 <code>value</code> 是一個可呼叫物件，它必須期待一兩個引數。根據 arity，呼叫可呼叫物件時，將 <code>options</code> 雜湊作為第一個引數，將 <code>key</code> 作為 <code>:root</code>，將 <code>key</code> 作為第二個引數進行單數化。它的返回 value 成為一個新節點。</p></li>
<li><p>如果 <code>value</code> 回應 <code>to_xml</code>，則呼叫該方法時將 <code>key</code> 作為 <code>:root</code>。</p></li>
<li><p>否則，建立一個帶有 <code>key</code> 作為標籤的節點，用字串表示的 <code>value</code> 作為文字節點。如果 <code>value</code> 是 <code>nil</code>，則新增屬性“nil”設定為“true”。除非選項 <code>:skip_types</code> 存在且為真，否則還會根據以下對映新增屬性“type”：</p></li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">XML_TYPE_NAMES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Symbol"</span>     <span class="o">=&gt;</span> <span class="s2">"symbol"</span><span class="p">,</span>
  <span class="s2">"Integer"</span>    <span class="o">=&gt;</span> <span class="s2">"integer"</span><span class="p">,</span>
  <span class="s2">"BigDecimal"</span> <span class="o">=&gt;</span> <span class="s2">"decimal"</span><span class="p">,</span>
  <span class="s2">"Float"</span>      <span class="o">=&gt;</span> <span class="s2">"float"</span><span class="p">,</span>
  <span class="s2">"TrueClass"</span>  <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"FalseClass"</span> <span class="o">=&gt;</span> <span class="s2">"boolean"</span><span class="p">,</span>
  <span class="s2">"Date"</span>       <span class="o">=&gt;</span> <span class="s2">"date"</span><span class="p">,</span>
  <span class="s2">"DateTime"</span>   <span class="o">=&gt;</span> <span class="s2">"datetime"</span><span class="p">,</span>
  <span class="s2">"Time"</span>       <span class="o">=&gt;</span> <span class="s2">"datetime"</span>
<span class="p">}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='XML_TYPE_NAMES = {
  "Symbol"     =&gt; "symbol",
  "Integer"    =&gt; "integer",
  "BigDecimal" =&gt; "decimal",
  "Float"      =&gt; "float",
  "TrueClass"  =&gt; "boolean",
  "FalseClass" =&gt; "boolean",
  "Date"       =&gt; "date",
  "DateTime"   =&gt; "datetime",
  "Time"       =&gt; "datetime"
}
'>Copy</button>
</div>
<p>預設情況下，根節點是“hash”，但可以透過 <code>:root</code> 選項進行設定。</p><p>預設的 XML 構建器是 <code>Builder::XmlMarkup</code> 的新實例。您可以使用 <code>:builder</code> 選項設定您自己的構建器。該方法還接受諸如 <code>:dasherize</code> 和朋友之類的選項，將它們轉發給構建器。</p><div class="note"><p>在 <code>active_support/core_ext/hash/conversions.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">12.2 合併</a></h4><p>Ruby 有一個內建方法 <code>Hash#merge</code> 合併兩個雜湊：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">a: </span><span class="mi">0</span><span class="p">,</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{a: 1, b: 1}.merge(a: 0, c: 2)
# =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}
">Copy</button>
</div>
<p>Active Support 定義了更多可能方便的合併雜湊的方法。</p><h5 id="reverse-merge-reverse-merge-bang"><a class="anchorlink" href="#reverse-merge-reverse-merge-bang">12.2.1 <code>reverse_merge</code> 和 <code>reverse_merge!</code></a></h5><p>在衝突的情況下，引數雜湊中的 key 在 <code>merge</code> 中獲勝。您可以使用以下習慣用法以緊湊的方式支援具有預設 values 的選項雜湊：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">}.</span><span class="nf">merge</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='options = {length: 30, omission: "..."}.merge(options)
'>Copy</button>
</div>
<p>Active Support 定義了 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-reverse_merge"><code>reverse_merge</code></a>，以防您更喜歡這種替代符號：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='options = options.reverse_merge(length: 30, omission: "...")
'>Copy</button>
</div>
<p>還有一個 bang 版本 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-reverse_merge-21"><code>reverse_merge!</code></a> 執行合併：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">options</span><span class="p">.</span><span class="nf">reverse_merge!</span><span class="p">(</span><span class="ss">length: </span><span class="mi">30</span><span class="p">,</span> <span class="ss">omission: </span><span class="s2">"..."</span><span class="p">)</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='options.reverse_merge!(length: 30, omission: "...")
'>Copy</button>
</div>
<p>警告。考慮到 <code>reverse_merge!</code> 可能會改變呼叫者的雜湊值，這可能是也可能不是一個好主意。</p><div class="note"><p>在 <code>active_support/core_ext/hash/reverse_merge.rb</code> 中定義。</p></div><h5 id="reverse-update"><a class="anchorlink" href="#reverse-update">12.2.2 <code>reverse_update</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-reverse_update"><code>reverse_update</code></a> 是 <code>reverse_merge!</code> 的別名，如上所述。</p><p>警告。請注意，<code>reverse_update</code> 沒有爆炸。</p><div class="note"><p>在 <code>active_support/core_ext/hash/reverse_merge.rb</code> 中定義。</p></div><h5 id="deep-merge-deep-merge-bang"><a class="anchorlink" href="#deep-merge-deep-merge-bang">12.2.3 <code>deep_merge</code> 和 <code>deep_merge!</code></a></h5><p>正如您在前面的示例中所看到的，如果在兩個雜湊中都找到了 key，則引數中的一個 value 獲勝。</p><p>Active Support 定義了 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_merge"><code>Hash#deep_merge</code></a>。在深度合併中，如果在兩個雜湊中都找到了 key 並且它們的 values 依次是雜湊，則它們的 <em>merge</em> 成為結果雜湊中的值：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="p">{</span><span class="ss">b: </span><span class="mi">1</span><span class="p">}}.</span><span class="nf">deep_merge</span><span class="p">(</span><span class="ss">a: </span><span class="p">{</span><span class="ss">c: </span><span class="mi">2</span><span class="p">})</span>
<span class="c1"># =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{a: {b: 1}}.deep_merge(a: {c: 2})
# =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}
">Copy</button>
</div>
<p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_merge-21"><code>deep_merge!</code></a> 執行深度合併。</p><div class="note"><p>在 <code>active_support/core_ext/hash/deep_merge.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">12.3 深度複製</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_dup"><code>Hash#deep_dup</code></a> 複製自身和所有 keys 和 values
內部遞迴使用 Active Support 方法 <code>Object#deep_dup</code>。它的工作原理類似於 <code>Enumerator#each_with_object</code>，將 <code>deep_dup</code> 方法傳送到內部的每一對。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="p">{</span> <span class="ss">c: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">d: </span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">dup</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">deep_dup</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="nb">dup</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>

<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:e</span><span class="p">]</span> <span class="o">==</span> <span class="kp">nil</span>      <span class="c1"># =&gt; true</span>
<span class="nb">hash</span><span class="p">[</span><span class="ss">:b</span><span class="p">][</span><span class="ss">:d</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>   <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = { a: 1, b: { c: 2, d: [3, 4] } }

dup = hash.deep_dup
dup[:b][:e] = 5
dup[:b][:d] &lt;&lt; 5

hash[:b][:e] == nil      # =&gt; true
hash[:b][:d] == [3, 4]   # =&gt; true
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/object/deep_dup.rb</code> 中定義。</p></div><h4 id="keys"><a class="anchorlink" href="#keys">12.4 使用 Keys</a></h4><h5 id="except-except-bang"><a class="anchorlink" href="#except-except-bang">12.4.1 <code>except</code> 和 <code>except!</code></a></h5><p>方法 [<code>except</code>][Hash#except] 返回一個雜湊，其中移除了引數列表中的 keys（如果存在）：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="{a: 1, b: 2}.except(:a) # =&gt; {:b=&gt;2}
">Copy</button>
</div>
<p>如果接收者回應 <code>convert_key</code>，則在每個引數上呼叫該方法。這使得 <code>except</code> 可以很好地處理具有無差異訪問的雜湊，例如：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># =&gt; {}</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">.</span><span class="nf">except</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># =&gt; {}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.with_indifferent_access.except(:a)  # =&gt; {}
{a: 1}.with_indifferent_access.except("a") # =&gt; {}
'>Copy</button>
</div>
<p>還有 bang 變體 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-except-21%5B%E9%9B%9C%E6%B9%8A#except%5D:https://api.rubyonrails.org/classes/Hash.html#method-i-except"><code>except!</code></a> 將 keys 刪除到位。</p><div class="note"><p>在 <code>active_support/core_ext/hash/except.rb</code> 中定義。</p></div><h5 id="stringify-keys-stringify-keys-bang"><a class="anchorlink" href="#stringify-keys-stringify-keys-bang">12.4.2 <code>stringify_keys</code> 和 <code>stringify_keys!</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-stringify_keys"><code>stringify_keys</code></a> 返回一個雜湊，該雜湊在接收器中具有 keys 的字串化版本。它透過向他們傳送 <code>to_s</code> 來實現：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: :a</span><span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, a: :a}.stringify_keys
# =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}
'>Copy</button>
</div>
<p>在 key 衝突的情況下，value 將是最近插入雜湊的一個：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">stringify_keys</span>
<span class="c1"># 結果將是</span>
<span class="c1"># =&gt; {"a"=&gt;2}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{"a" =&gt; 1, a: 2}.stringify_keys
# 結果將是
# =&gt; {"a"=&gt;2}
'>Copy</button>
</div>
<p>此方法可能很有用，例如可以輕鬆接受 symbols 和字串作為選項。例如 <code>ActionView::Helpers::FormHelper</code> 定義：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">to_check_box_tag</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">checked_value</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">unchecked_value</span> <span class="o">=</span> <span class="s2">"0"</span><span class="p">)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">stringify_keys</span>
  <span class="n">options</span><span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"checkbox"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def to_check_box_tag(options = {}, checked_value = "1", unchecked_value = "0")
  options = options.stringify_keys
  options["type"] = "checkbox"
  # ...
end
'>Copy</button>
</div>
<p>第二行可以安全地訪問“型別”key，並讓使用者傳遞<code>:type</code>或“型別”。</p><p>還有 bang 變體 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-stringify_keys-21"><code>stringify_keys!</code></a> 將 keys 字串化到位。</p><p>除此之外，可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_stringify_keys"><code>deep_stringify_keys</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_stringify_keys-21"><code>deep_stringify_keys!</code></a> 將給定雜湊中的所有 keys 以及巢狀在其中的所有雜湊字串化。結果的一個例子是：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">nested: </span><span class="p">{</span><span class="ss">a: </span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}}.</span><span class="nf">deep_stringify_keys</span>
<span class="c1"># =&gt; {""=&gt;nil, "1"=&gt;​​1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, nested: {a: 3, 5 =&gt; 5}}.deep_stringify_keys
# =&gt; {""=&gt;nil, "1"=&gt;​​1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/hash/keys.rb</code> 中定義。</p></div><h5 id="symbolize-keys-symbolize-keys-bang"><a class="anchorlink" href="#symbolize-keys-symbolize-keys-bang">12.4.3 <code>symbolize_keys</code> 和 <code>symbolize_keys!</code></a></h5><p>在可能的情況下，方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-symbolize_keys"><code>symbolize_keys</code></a> 返回一個雜湊，該雜湊在接收器中具有 keys 的 symbolized 版本。它透過向他們傳送 <code>to_sym</code> 來實現：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="s2">"a"</span><span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, "a" =&gt; "a"}.symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}
'>Copy</button>
</div>
<p>警告。請注意，在前面的示例中，只有一個 key 被 symbol 化。</p><p>在 key 衝突的情況下，value 將是最近插入雜湊的一個：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">a: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">symbolize_keys</span>
<span class="c1"># =&gt; {:a=&gt;2}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{"a" =&gt; 1, a: 2}.symbolize_keys
# =&gt; {:a=&gt;2}
'>Copy</button>
</div>
<p>此方法可能很有用，例如可以輕鬆接受 symbols 和字串作為選項。例如 <code>ActionText::TagHelper</code> 定義</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">rich_text_area_tag</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="p">.</span><span class="nf">symbolize_keys</span>

  <span class="n">options</span><span class="p">[</span><span class="ss">:input</span><span class="p">]</span> <span class="o">||=</span> <span class="s2">"trix_input_</span><span class="si">#{</span><span class="no">ActionText</span><span class="o">::</span><span class="no">TagHelper</span><span class="p">.</span><span class="nf">id</span> <span class="o">+=</span> <span class="mi">1</span><span class="si">}</span><span class="s2">"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def rich_text_area_tag(name, value = nil, options = {})
  options = options.symbolize_keys

  options[:input] ||= "trix_input_#{ActionText::TagHelper.id += 1}"
  # ...
end
'>Copy</button>
</div>
<p>第三行可以安全地訪問 <code>:input</code> key，讓使用者透過 <code>:input</code> 或“輸入”。</p><p>還有 bang 變體 [<code>symbolize_keys!</code>][Hash#symbolize_keys!] symbolizes keys 到位。</p><p>除此之外，還可以使用 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_symbolize_keys"><code>deep_symbolize_keys</code></a> 和 [<code>deep_symbolize_keys!</code>][Hash#deep_symbolize_keys!] 將所有給定的雜湊值和 ZHTW_230_WTHZ 中的所有給定雜湊值 ZHTZW_236_WHTZ 中的所有巢狀雜湊化。結果的一個例子是：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="kp">nil</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"nested"</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s2">"a"</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}}.</span><span class="nf">deep_symbolize_keys</span>
<span class="c1"># =&gt; {nil=&gt;nil, 1=&gt;1, 巢狀:{a:3, 5=&gt;5}}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, "nested" =&gt; {"a" =&gt; 3, 5 =&gt; 5}}.deep_symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, 巢狀:{a:3, 5=&gt;5}}
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/hash/keys.rb</code> 中定義。</p></div><h5 id="to-options-to-options-bang"><a class="anchorlink" href="#to-options-to-options-bang">12.4.4 <code>to_options</code> 和 <code>to_options!</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-to_options"><code>to_options</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-to_options-21"><code>to_options!</code></a> 分別是 <code>symbolize_keys</code> 和 <code>symbolize_keys!</code> 的別名。</p><div class="note"><p>在 <code>active_support/core_ext/hash/keys.rb</code> 中定義。</p></div><h5 id="assert-valid-keys"><a class="anchorlink" href="#assert-valid-keys">12.4.5 <code>assert_valid_keys</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-assert_valid_keys"><code>assert_valid_keys</code></a> 接收任意數量的引數，並檢查接收者是否有該列表之外的任何鍵。如果是，則 <code>ArgumentError</code> 被提升。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>  <span class="c1"># passes</span>
<span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">assert_valid_keys</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span> <span class="c1"># ArgumentError</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.assert_valid_keys(:a)  # passes
{a: 1}.assert_valid_keys("a") # ArgumentError
'>Copy</button>
</div>
<p>例如，在構建 associations 時，Active Record 不接受未知選項。它透過 <code>assert_valid_keys</code> 實現該控制。</p><div class="note"><p>在 <code>active_support/core_ext/hash/keys.rb</code> 中定義。</p></div><h4 id="values"><a class="anchorlink" href="#values">12.5 使用 Values</a></h4><h5 id="deep-transform-values-deep-transform-values-bang"><a class="anchorlink" href="#deep-transform-values-deep-transform-values-bang">12.5.1 <code>deep_transform_values</code> 和 <code>deep_transform_values!</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_transform_values"><code>deep_transform_values</code></a> 返回一個新的雜湊，其中包含所有由區塊操作轉換的 values。這包括來自根雜湊和所有巢狀雜湊和陣列的 values。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">person: </span><span class="p">{</span> <span class="ss">name: </span><span class="s1">'Rob'</span><span class="p">,</span> <span class="ss">age: </span><span class="s1">'28'</span> <span class="p">}</span> <span class="p">}</span>

<span class="nb">hash</span><span class="p">.</span><span class="nf">deep_transform_values</span><span class="p">{</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span> <span class="n">value</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">upcase</span> <span class="p">}</span>
<span class="c1"># =&gt; {person: {name: "ROB", age: "28"}}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = { person: { name: 'Rob', age: '28' } }

hash.deep_transform_values{ |value| value.to_s.upcase }
# =&gt; {person: {name: &quot;ROB&quot;, age: &quot;28&quot;}}
">Copy</button>
</div>
<p>還有 bang 變體 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-deep_transform_values-21"><code>deep_transform_values!</code></a> 使用塊操作破壞性地轉換所有 values。</p><div class="note"><p>在 <code>active_support/core_ext/hash/deep_transform_values.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">12.6 切片</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-slice-21"><code>slice!</code></a> 僅用給定的 keys 替換雜湊，並返回包含刪除的鍵/value 對的雜湊。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">slice!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:b=&gt;2}</span>
<span class="nb">hash</span>                   <span class="c1"># =&gt; {:a=&gt;1}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = {a: 1, b: 2}
rest = hash.slice!(:a) # =&gt; {:b=&gt;2}
hash                   # =&gt; {:a=&gt;1}
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/hash/slice.rb</code> 中定義。</p></div><h4 id="hash"><a class="anchorlink" href="#hash">12.7 提取</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-extract-21"><code>extract!</code></a> 刪除並返回匹配給定 keys 的鍵/value 對。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span> <span class="c1"># =&gt; {:a=&gt;1}</span>
<span class="nb">hash</span>                     <span class="c1"># =&gt; {:b=&gt;2}</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = {a: 1, b: 2}
rest = hash.extract!(:a) # =&gt; {:a=&gt;1}
hash                     # =&gt; {:b=&gt;2}
">Copy</button>
</div>
<p><code>extract!</code> 方法返回與接收者相同的 Hash 子類。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">b: </span><span class="mi">2</span><span class="p">}.</span><span class="nf">with_indifferent_access</span>
<span class="n">rest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">.</span><span class="nf">extract!</span><span class="p">(</span><span class="ss">:a</span><span class="p">).</span><span class="nf">class</span>
<span class="c1"># =&gt; ActiveSupport::HashWithIndifferentAccess</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = {a: 1, b: 2}.with_indifferent_access
rest = hash.extract!(:a).class
# =&gt; ActiveSupport::HashWithIndifferentAccess
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/hash/slice.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">12.8 無差別訪問</a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Hash.html#method-i-with_indifferent_access"><code>with_indifferent_access</code></a> 從其接收器返回 <a href="https://api.rubyonrails.org/v7.0.0/classes/ActiveSupport/HashWithIndifferentAccess.html"><code>ActiveSupport::HashWithIndifferentAccess</code></a>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">{</span><span class="ss">a: </span><span class="mi">1</span><span class="p">}.</span><span class="nf">with_indifferent_access</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="c1"># =&gt; 1</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.with_indifferent_access["a"] # =&gt; 1
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/hash/indifferent_access.rb</code> 中定義。</p></div><h3 id="regexp"><a class="anchorlink" href="#regexp">13 <code>Regexp</code> 的擴充套件</a></h3><h4 id="multiline-questionmark"><a class="anchorlink" href="#multiline-questionmark">13.1 <code>multiline?</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Regexp.html#method-i-multiline-3F"><code>multiline?</code></a> 表示正則表示式是否設定了 <code>/m</code> 標誌，即點是否與換行符匹配。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="sr">%r{.}</span><span class="err">.</span><span class="sr">mu</span><span class="n">ltiline?</span>  <span class="c1"># =&gt; false</span>
<span class="sr">%r{.}m</span><span class="p">.</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>

<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'.'</span><span class="p">).</span><span class="nf">multiline?</span>                    <span class="c1"># =&gt; false</span>
<span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="no">Regexp</span><span class="o">::</span><span class="no">MULTILINE</span><span class="p">).</span><span class="nf">multiline?</span> <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="%r{.}.multiline?  # =&gt; false
%r{.}m.multiline? # =&gt; true

Regexp.new('.').multiline?                    # =&gt; false
Regexp.new('.', Regexp::MULTILINE).multiline? # =&gt; true
">Copy</button>
</div>
<p>Rails 在一個地方使用這個方法，也在路由程式碼中。路由要求不允許使用多行正則表示式，並且此標誌可以簡化執行該約束。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">verify_regexp_requirements</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span>
  <span class="c1"># ...</span>
  <span class="k">if</span> <span class="n">requirement</span><span class="p">.</span><span class="nf">multiline?</span>
    <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">"Regexp multiline option is not allowed in routing requirements: </span><span class="si">#{</span><span class="n">requirement</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def verify_regexp_requirements(requirements)
  # ...
  if requirement.multiline?
    raise ArgumentError, "Regexp multiline option is not allowed in routing requirements: #{requirement.inspect}"
  end
  # ...
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/regexp.rb</code> 中定義。</p></div><h3 id="range"><a class="anchorlink" href="#range">14 <code>Range</code> 的擴充套件</a></h3><h4 id="range-to-s"><a class="anchorlink" href="#range-to-s">14.1 <code>to_s</code></a></h4><p>Active Support 擴充套件了 <code>Range#to_s</code> 方法，以便它理解可選的格式引數。在撰寫本文時，唯一支援的非預設格式是 <code>:db</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_s</span>
<span class="c1"># =&gt; "2009-10-25..2009-10-26"</span>

<span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">today</span><span class="o">..</span><span class="no">Date</span><span class="p">.</span><span class="nf">tomorrow</span><span class="p">).</span><span class="nf">to_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>
<span class="c1"># =&gt; "在'2009-10-25'和'2009-10-26'之間"</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(Date.today..Date.tomorrow).to_s
# =&gt; &quot;2009-10-25..2009-10-26&quot;

(Date.today..Date.tomorrow).to_s(:db)
# =&gt; &quot;在'2009-10-25'和'2009-10-26'之間&quot;
">Copy</button>
</div>
<p>如示例所示，<code>:db</code> 格式生成一個 <code>BETWEEN</code> SQL 子句。 Active Record 使用它來支援條件中的範圍 values。</p><div class="note"><p>在 <code>active_support/core_ext/range/conversions.rb</code> 中定義。</p></div><h4 id="include-questionmark"><a class="anchorlink" href="#include-questionmark">14.2 <code>===</code> 和 <code>include?</code></a></h4><p>方法 <code>Range#===</code> 和 <code>Range#include?</code> 說明某些 value 是否落在給定實例的兩端之間：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="no">Math</span><span class="o">::</span><span class="no">E</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(2..3).include?(Math::E) # =&gt; true
">Copy</button>
</div>
<p>Active Support 擴充套件了這些方法，以便引數可以依次為另一個範圍。在這種情況下，我們測試引數範圍的末端是否屬於接收器本身：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
<span class="p">(</span><span class="mi">1</span><span class="o">...</span><span class="mi">9</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">9</span><span class="p">)</span>  <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(1..10) === (3..7)  # =&gt; true
(1..10) === (0..7)  # =&gt; false
(1..10) === (3..11) # =&gt; false
(1...9) === (3..9)  # =&gt; false

(1..10).include?(3..7)  # =&gt; true
(1..10).include?(0..7)  # =&gt; false
(1..10).include?(3..11) # =&gt; false
(1...9).include?(3..9)  # =&gt; false
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/range/compare_range.rb</code> 中定義。</p></div><h4 id="overlaps-questionmark"><a class="anchorlink" href="#overlaps-questionmark">14.3 <code>overlaps?</code></a></h4><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/Range.html#method-i-overlaps-3F"><code>Range#overlaps?</code></a> 表示任何兩個給定的範圍是否有非空交集：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">7</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># =&gt; true</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">overlaps?</span><span class="p">(</span><span class="mi">11</span><span class="o">..</span><span class="mi">27</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="(1..10).overlaps?(7..11)  # =&gt; true
(1..10).overlaps?(0..7)   # =&gt; true
(1..10).overlaps?(11..27) # =&gt; false
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/range/overlaps.rb</code> 中定義。</p></div><h3 id="date"><a class="anchorlink" href="#date">15 <code>Date</code> 的擴充套件</a></h3><h4 id="date-"><a class="anchorlink" href="#date-">15.1 計算</a></h4><p>資訊：以下計算方法在 1582 年 10 月存在邊緣情況，因為 5..14 天不存在。為簡潔起見，本指南並未記錄他們當時的行為，但足以說明他們的行為符合您的預期。即，<code>Date.new(1582, 10, 4).tomorrow</code> 返回 <code>Date.new(1582, 10, 15)</code>，依此類推。請檢查 Active Support 測試套件中的 <code>test/core_ext/date_ext_test.rb</code> 以瞭解預期行為。</p><h5 id="date-current"><a class="anchorlink" href="#date-current">15.1.1 <code>Date.current</code></a></h5><p>Active Support 將 <a href="https://api.rubyonrails.org/v7.0.0/classes/Date.html#method-c-current"><code>Date.current</code></a> 定義為當前時區中的今天。這與 <code>Date.today</code> 類似，不同之處在於它尊重使用者時區（如果已定義）。它還定義了 [<code>Date.yesterday</code>][Date.yesterday] 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/Date.html#method-c-tomorrow"><code>Date.tomorrow</code></a>，以及實例謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>today?</code></a> , <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code>tomorrow?</code></a>, <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-next_day-3F"><code>next_day?</code></a>, <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code>yesterday?</code></a>, [<code>prev_day?</code>][DateAndTime::day_day?] ?]、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-future-3F">Active Support</a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-on_weekday-3F"><code>on_weekday?</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-on_weekend-3F"><code>on_weekend?</code></a>，所有這些都相對於 ZHTZW_0_</p><p>使用尊重使用者時區的方法進行日期比較時，請確保使用 <code>Date.current</code> 而不是 <code>Date.today</code>。在某些情況下，使用者時區可能在未來與系統時區相比，<code>Date.today</code> 預設使用系統時區。這意味著 <code>Date.today</code> 可能等於 <code>Date.yesterday</code>。</p><div class="note"><p>在 <code>active_support/core_ext/date/calculations.rb</code> 中定義。</p></div><h5 id=""><a class="anchorlink" href="#">15.1.2 命名日期</a></h5><h6 id="beginning-of-week-end-of-week"><a class="anchorlink" href="#beginning-of-week-end-of-week">15.1.2.1 <code>beginning_of_week</code>, <code>end_of_week</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-beginning_of_week"><code>beginning_of_week</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-end_of_week"><code>end_of_week</code></a> 返回日期
分別是一週的開始和結束。假定周開始於
星期一，但可以透過傳遞引數來更改，將執行緒設定為本地
<code>Date.beginning_of_week</code> 或 <code>config.beginning_of_week</code>。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span>          <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 02 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span>                <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>       <span class="c1"># =&gt; Sat, 08 May 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.beginning_of_week          # =&gt; Mon, 03 May 2010
d.beginning_of_week(:sunday) # =&gt; Sun, 02 May 2010
d.end_of_week                # =&gt; Sun, 09 May 2010
d.end_of_week(:sunday)       # =&gt; Sat, 08 May 2010
">Copy</button>
</div>
<p><code>beginning_of_week</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_week"><code>at_beginning_of_week</code></a>，<code>end_of_week</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_end_of_week"><code>at_end_of_week</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="monday-sunday"><a class="anchorlink" href="#monday-sunday">15.1.2.2 <code>monday</code>, <code>sunday</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-monday"><code>monday</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-sunday"><code>sunday</code></a> 返回前一個星期一的日期和
下週日，分別。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 08 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 03 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 09 May 2010</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">monday</span>                     <span class="c1"># =&gt; Mon, 10 Sep 2012</span>

<span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
<span class="n">d</span><span class="p">.</span><span class="nf">sunday</span>                     <span class="c1"># =&gt; Sun, 16 Sep 2012</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.monday                     # =&gt; Mon, 03 May 2010
d.sunday                     # =&gt; Sun, 09 May 2010

d = Date.new(2012, 9, 10)    # =&gt; Mon, 10 Sep 2012
d.monday                     # =&gt; Mon, 10 Sep 2012

d = Date.new(2012, 9, 16)    # =&gt; Sun, 16 Sep 2012
d.sunday                     # =&gt; Sun, 16 Sep 2012
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="prev-week-next-week"><a class="anchorlink" href="#prev-week-next-week">15.1.2.3 <code>prev_week</code>, <code>next_week</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-next_week"><code>next_week</code></a> 接收一個帶有英文日期名稱的 symbol（預設是執行緒本地 <a href="https://api.rubyonrails.org/v7.0.0/classes/Date.html#method-c-beginning_of_week"><code>Date.beginning_of_week</code></a>，或 <code>config.beginning_of_week</code>，或 <code>:monday</code> 返回對應的日期）那天。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span>              <span class="c1"># =&gt; Mon, 10 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">next_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 15 May 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.next_week              # =&gt; Mon, 10 May 2010
d.next_week(:saturday)   # =&gt; Sat, 15 May 2010
">Copy</button>
</div>
<p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-prev_week"><code>prev_week</code></a> 是類似的：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span>              <span class="c1"># =&gt; Mon, 26 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:saturday</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">prev_week</span><span class="p">(</span><span class="ss">:friday</span><span class="p">)</span>     <span class="c1"># =&gt; Fri, 30 Apr 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d.prev_week              # =&gt; Mon, 26 Apr 2010
d.prev_week(:saturday)   # =&gt; Sat, 01 May 2010
d.prev_week(:friday)     # =&gt; Fri, 30 Apr 2010
">Copy</button>
</div>
<p><code>prev_week</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-last_week"><code>last_week</code></a>。</p><p>當設定了 <code>Date.beginning_of_week</code> 或 <code>config.beginning_of_week</code> 時，<code>next_week</code> 和 <code>prev_week</code> 都按預期工作。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="beginning-of-month-end-of-month"><a class="anchorlink" href="#beginning-of-month-end-of-month">15.1.2.4 <code>beginning_of_month</code>, <code>end_of_month</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-beginning_of_month"><code>beginning_of_month</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-end_of_month"><code>end_of_month</code></a> 返回月份的開始和結束日期：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_month</span>     <span class="c1"># =&gt; Sat, 01 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_month</span>           <span class="c1"># =&gt; Mon, 31 May 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_month     # =&gt; Sat, 01 May 2010
d.end_of_month           # =&gt; Mon, 31 May 2010
">Copy</button>
</div>
<p><code>beginning_of_month</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_month"><code>at_beginning_of_month</code></a>，<code>end_of_month</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_end_of_month"><code>at_end_of_month</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="beginning-of-quarter-end-of-quarter"><a class="anchorlink" href="#beginning-of-quarter-end-of-quarter">15.1.2.5 <code>beginning_of_quarter</code>, <code>end_of_quarter</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-beginning_of_quarter"><code>beginning_of_quarter</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-end_of_quarter"><code>end_of_quarter</code></a> 返回接收方日曆年季度開始和結束的日期：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_quarter</span>   <span class="c1"># =&gt; Thu, 01 Apr 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_quarter</span>         <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_quarter   # =&gt; Thu, 01 Apr 2010
d.end_of_quarter         # =&gt; Wed, 30 Jun 2010
">Copy</button>
</div>
<p><code>beginning_of_quarter</code> 的別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_quarter"><code>at_beginning_of_quarter</code></a>，而 <code>end_of_quarter</code> 的別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_end_of_quarter"><code>at_end_of_quarter</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="beginning-of-year-end-of-year"><a class="anchorlink" href="#beginning-of-year-end-of-year">15.1.2.6 <code>beginning_of_year</code>, <code>end_of_year</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-beginning_of_year"><code>beginning_of_year</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-end_of_year"><code>end_of_year</code></a> 返回年份的開始和結束日期：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 09 May 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">beginning_of_year</span>      <span class="c1"># =&gt; Fri, 01 Jan 2010</span>
<span class="n">d</span><span class="p">.</span><span class="nf">end_of_year</span>            <span class="c1"># =&gt; Fri, 31 Dec 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_year      # =&gt; Fri, 01 Jan 2010
d.end_of_year            # =&gt; Fri, 31 Dec 2010
">Copy</button>
</div>
<p><code>beginning_of_year</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_beginning_of_year"><code>at_beginning_of_year</code></a>，<code>end_of_year</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-at_end_of_year"><code>at_end_of_year</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h5 id=""><a class="anchorlink" href="#">15.1.3 其他日期計算</a></h5><h6 id="years-ago-years-since"><a class="anchorlink" href="#years-ago-years-since">15.1.3.1 <code>years_ago</code>, <code>years_since</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-years_ago"><code>years_ago</code></a> 接收若干年並返回與多年前相同的日期：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 07 Jun 2000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.years_ago(10) # =&gt; Wed, 07 Jun 2000
">Copy</button>
</div>
<p><a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-years_since"><code>years_since</code></a> 時間向前移動：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 07 Jun 2020</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.years_since(10) # =&gt; Sun, 07 Jun 2020
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_ago</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="c1"># =&gt; Sat, 28 Feb 2009</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">).</span><span class="nf">years_since</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c1"># =&gt; Sat, 28 Feb 2015</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2012, 2, 29).years_ago(3)     # =&gt; Sat, 28 Feb 2009
Date.new(2012, 2, 29).years_since(3)   # =&gt; Sat, 28 Feb 2015
">Copy</button>
</div>
<p><a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-last_year"><code>last_year</code></a> 是 <code>#years_ago(1)</code> 的簡寫。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="months-ago-months-since"><a class="anchorlink" href="#months-ago-months-since">15.1.3.2 <code>months_ago</code>, <code>months_since</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-months_ago"><code>months_ago</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-months_since"><code>months_since</code></a> 類似地工作幾個月：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 30 Jun 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 4, 30).months_ago(2)   # =&gt; Sun, 28 Feb 2010
Date.new(2010, 4, 30).months_since(2) # =&gt; Wed, 30 Jun 2010
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">).</span><span class="nf">months_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">months_since</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Sun, 28 Feb 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 4, 30).months_ago(2)    # =&gt; Sun, 28 Feb 2010
Date.new(2009, 12, 31).months_since(2) # =&gt; Sun, 28 Feb 2010
">Copy</button>
</div>
<p><a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-last_month"><code>last_month</code></a> 是 <code>#months_ago(1)</code> 的簡寫。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="weeks-ago"><a class="anchorlink" href="#weeks-ago">15.1.3.3 <code>weeks_ago</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-weeks_ago"><code>weeks_ago</code></a> 類似地工作數週：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 17 May 2010</span>
<span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">24</span><span class="p">).</span><span class="nf">weeks_ago</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># =&gt; Mon, 10 May 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 5, 24).weeks_ago(1)    # =&gt; Mon, 17 May 2010
Date.new(2010, 5, 24).weeks_ago(2)    # =&gt; Mon, 10 May 2010
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h6 id="-advance"><a class="anchorlink" href="#-advance">15.1.3.4 <code>advance</code></a></h6><p>跳轉到其他日期的最通用方法是 [<code>advance</code>][Date#advance]。此方法接收帶有 keys <code>:years</code>、<code>:months</code>、<code>:weeks</code>、<code>:days</code> 的雜湊值，並返回與當前 keys 指示一樣多的日期：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">weeks: </span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># =&gt; Mon, 20 Jun 2011</span>
<span class="n">date</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">days: </span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># =&gt; Wed, 04 Aug 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 6)
date.advance(years: 1, weeks: 2)  # =&gt; Mon, 20 Jun 2011
date.advance(months: 2, days: -2) # =&gt; Wed, 04 Aug 2010
">Copy</button>
</div>
<p>請注意，在前面的示例中，增量可能為負。</p><p>為了執行計算，該方法首先遞增年，然後是月，然後是周，最後是天。這個命令在幾個月結束時很重要。比如說，我們現在是 2010 年 2 月底，我們想向前推進一個月零一天。</p><p><code>advance</code>方法先提前一個月，然後一天，結果是：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; 星期日，2010 年 3 月 29 日</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 2, 28).advance(months: 1, days: 1)
# =&gt; 星期日，2010 年 3 月 29 日
">Copy</button>
</div>
<p>而如果反過來，結果會有所不同：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">days: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; 星期四，2010 年 4 月 1 日</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 2, 28).advance(days: 1).advance(months: 1)
# =&gt; 星期四，2010 年 4 月 1 日
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date/calculations.rb</code> 中定義。</p></div><h5 id="date--"><a class="anchorlink" href="#date--">15.1.4 更改元件</a></h5><p>方法 [<code>change</code>][Date#change] 允許您獲取與接收者相同的新日期，除了給定的年、月或日：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">month: </span><span class="mi">11</span><span class="p">)</span>
<span class="c1"># =&gt; 2011 年 11 月 23 日，星期三</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 12, 23).change(year: 2011, month: 11)
# =&gt; 2011 年 11 月 23 日，星期三
">Copy</button>
</div>
<p>此方法不容忍不存在的日期，如果更改無效 <code>ArgumentError</code> 引發：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: 無效日期</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 1, 31).change(month: 2)
# =&gt; ArgumentError: 無效日期
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date/calculations.rb</code> 中定義。</p></div><h5 id="date--"><a class="anchorlink" href="#date--">15.1.5 持續時間</a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActiveSupport/Duration.html"><code>Duration</code></a> 物件可以新增到日期和從日期中減去：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一</span>
<span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; 2011 年 8 月 9 日，星期二</span>
<span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="nf">hours</span>
<span class="c1"># =&gt; 星期日，2010 年 8 月 8 日 21:00:00 UTC +00:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.current
# =&gt; 2010 年 8 月 9 日星期一
d + 1.year
# =&gt; 2011 年 8 月 9 日，星期二
d - 3.hours
# =&gt; 星期日，2010 年 8 月 8 日 21:00:00 UTC +00:00
">Copy</button>
</div>
<p>它們轉換為對 <code>since</code> 或 <code>advance</code> 的呼叫。例如在這裡我們得到了日曆改革的正確跳轉：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span>
<span class="c1"># =&gt; 1582 年 10 月 15 日，星期五</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(1582, 10, 4) + 1.day
# =&gt; 1582 年 10 月 15 日，星期五
">Copy</button>
</div>
<h5 id=""><a class="anchorlink" href="#">15.1.6 時間戳</a></h5><p>資訊：如果可能，以下方法返回 <code>Time</code> 物件，否則返回 <code>DateTime</code>。如果設定，則它們遵循使用者時區。</p><h6 id="beginning-of-day-end-of-day"><a class="anchorlink" href="#beginning-of-day-end-of-day">15.1.6.1 <code>beginning_of_day</code>, <code>end_of_day</code></a></h6><p>方法 [<code>beginning_of_day</code>][Date#beginning_of_day] 返回一天開始時的時間戳 (00:00:00)：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_day</span> <span class="c1"># =&gt; Mon Jun 07 00:00:00 +0200 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.beginning_of_day # =&gt; Mon Jun 07 00:00:00 +0200 2010
">Copy</button>
</div>
<p>方法 [<code>end_of_day</code>][Date#end_of_day] 返回一天結束時的時間戳（23:59:59）：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_day</span> <span class="c1"># =&gt; Mon Jun 07 23:59:59 +0200 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.end_of_day # =&gt; Mon Jun 07 23:59:59 +0200 2010
">Copy</button>
</div>
<p><code>beginning_of_day</code> 別名為 [<code>at_beginning_of_day</code>][Date#at_beginning_of_day]、[<code>midnight</code>][Date#midnight]、[<code>at_midnight</code>][Date#at_midnight]。</p><div class="note"><p>在 <code>active_support/core_ext/date/calculations.rb</code> 中定義。</p></div><h6 id="beginning-of-hour-end-of-hour"><a class="anchorlink" href="#beginning-of-hour-end-of-hour">15.1.6.2 <code>beginning_of_hour</code>, <code>end_of_hour</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-beginning_of_hour"><code>beginning_of_hour</code></a> 返回小時開始時的時間戳 (hh:00:00)：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:00:00 +0200 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_hour # =&gt; Mon Jun 07 19:00:00 +0200 2010
">Copy</button>
</div>
<p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-end_of_hour"><code>end_of_hour</code></a> 返回小時結束時的時間戳 (hh:59:59)：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_hour</span> <span class="c1"># =&gt; Mon Jun 07 19:59:59 +0200 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_hour # =&gt; Mon Jun 07 19:59:59 +0200 2010
">Copy</button>
</div>
<p><code>beginning_of_hour</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-at_beginning_of_hour"><code>at_beginning_of_hour</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h6 id="beginning-of-minute-end-of-minute"><a class="anchorlink" href="#beginning-of-minute-end-of-minute">15.1.6.3 <code>beginning_of_minute</code>, <code>end_of_minute</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-beginning_of_minute"><code>beginning_of_minute</code></a> 返回分鐘開始時的時間戳 (hh:mm:00)：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">beginning_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:00 +0200 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_minute # =&gt; Mon Jun 07 19:55:00 +0200 2010
">Copy</button>
</div>
<p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-end_of_minute"><code>end_of_minute</code></a> 返回分鐘結束時的時間戳 (hh:mm:59)：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">date</span><span class="p">.</span><span class="nf">end_of_minute</span> <span class="c1"># =&gt; Mon Jun 07 19:55:59 +0200 2010</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_minute # =&gt; Mon Jun 07 19:55:59 +0200 2010
">Copy</button>
</div>
<p><code>beginning_of_minute</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-at_beginning_of_minute"><code>at_beginning_of_minute</code></a>。</p><p>資訊：<code>beginning_of_hour</code>、<code>end_of_hour</code>、<code>beginning_of_minute</code> 和 <code>end_of_minute</code> 是為 <code>Time</code> 和 <code>DateTime</code> 實現的，但<strong>不是</strong> <code>Date</code>，因為在 ZHTZW_6 上請求小時或分鐘的開始或結束沒有意義。</p><div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h6 id="ago-since"><a class="anchorlink" href="#ago-since">15.1.6.4 <code>ago</code>, <code>since</code></a></h6><p>方法 [<code>ago</code>][Date#ago] 接收秒數作為引數，並從午夜返回幾秒前的時間戳：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">ago</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>         <span class="c1"># =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.current # =&gt; Fri, 11 Jun 2010
date.ago(1)         # =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00
">Copy</button>
</div>
<p>同樣， [<code>since</code>][Date#since] 向前移動：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">date</span> <span class="o">=</span> <span class="no">Date</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Fri, 11 Jun 2010</span>
<span class="n">date</span><span class="p">.</span><span class="nf">since</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.current # =&gt; Fri, 11 Jun 2010
date.since(1)       # =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date/calculations.rb</code> 中定義。</p></div><h5 id=""><a class="anchorlink" href="#">15.1.7 其他時間計算</a></h5><h4 id="date"><a class="anchorlink" href="#date">15.2 轉換</a></h4><h3 id="datetime"><a class="anchorlink" href="#datetime">16 <code>DateTime</code> 的擴充套件</a></h3><div class="warning"><p><code>DateTime</code> 不知道 DST 規則，因此當 DST 更改正在進行時，其中一些方法具有邊緣情況。例如 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-seconds_since_midnight"><code>seconds_since_midnight</code></a> 可能不會返回這樣一天的實際金額。</p></div><h4 id="datetime"><a class="anchorlink" href="#datetime">16.1 計算</a></h4><p>類 <code>DateTime</code> 是 <code>Date</code> 的子類，因此透過載入 <code>active_support/core_ext/date/calculations.rb</code>，您可以繼承這些方法及其別名，只是它們將始終返回日期時間。</p><p>重新實現了以下方法，因此您<strong>不需要</strong>為這些方法載入 <code>active_support/core_ext/date/calculations.rb</code>：</p>
<ul>
<li>[<code>beginning_of_day</code>][DateTime#beginning_of_day] / [<code>midnight</code>][DateTime#midnight] / <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-at_midnight"><code>at_midnight</code></a> / <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-at_beginning_of_day"><code>at_beginning_of_day</code></a>
</li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-end_of_day"><code>end_of_day</code></a></li>
<li>[<code>ago</code>][DateTime#ago]</li>
<li>[<code>since</code>][DateTime#since] / [<code>in</code>][DateTime#in]</li>
</ul>
<p>另一方面，<a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-advance"><code>advance</code></a> 和 [<code>change</code>][DateTime#change] 也被定義並支援更多選項，它們在下面記錄。</p><p>以下方法僅在 <code>active_support/core_ext/date_time/calculations.rb</code> 中實現，因為它們僅在與 <code>DateTime</code> 實例一起使用時才有意義：</p>
<ul>
<li>
<a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-beginning_of_hour"><code>beginning_of_hour</code></a> / <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-at_beginning_of_hour"><code>at_beginning_of_hour</code></a>
</li>
<li><a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-end_of_hour"><code>end_of_hour</code></a></li>
</ul>
<h5 id=""><a class="anchorlink" href="#">16.1.1 命名日期時間</a></h5><h6 id="datetime-current"><a class="anchorlink" href="#datetime-current">16.1.1.1 <code>DateTime.current</code></a></h6><p>Active Support 將 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-c-current"><code>DateTime.current</code></a> 定義為類似於 <code>Time.now.to_datetime</code>，除了它遵循使用者時區（如果已定義）。實例謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a> 是相對於 <code>DateTime.current</code> 定義的。</p><div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h5 id=""><a class="anchorlink" href="#">16.1.2 其他擴充套件</a></h5><h6 id="seconds-since-midnight"><a class="anchorlink" href="#seconds-since-midnight">16.1.2.1 <code>seconds_since_midnight</code></a></h6><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-seconds_since_midnight"><code>seconds_since_midnight</code></a> 返回自午夜以來的秒數：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>     <span class="c1"># =&gt; Mon, 07 Jun 2010 20:26:36 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">seconds_since_midnight</span> <span class="c1"># =&gt; 73596</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current     # =&gt; Mon, 07 Jun 2010 20:26:36 +0000
now.seconds_since_midnight # =&gt; 73596
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h6 id="utc"><a class="anchorlink" href="#utc">16.1.2.2 <code>utc</code></a></h6><p>方法 [<code>utc</code>][DateTime#utc] 在接收器中為您提供以 UTC 表示的相同日期時間。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:27:52 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span>                <span class="c1"># =&gt; Mon, 07 Jun 2010 23:27:52 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current # =&gt; Mon, 07 Jun 2010 19:27:52 -0400
now.utc                # =&gt; Mon, 07 Jun 2010 23:27:52 +0000
">Copy</button>
</div>
<p>此方法也別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-getutc"><code>getutc</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h6 id="utc-questionmark"><a class="anchorlink" href="#utc-questionmark">16.1.2.3 <code>utc?</code></a></h6><p>謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-utc-3F"><code>utc?</code></a> 表示接收方是否將 UTC 作為其時區：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">now</span> <span class="c1"># =&gt; Mon, 07 Jun 2010 19:30:47 -0400</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc?</span>           <span class="c1"># =&gt; false</span>
<span class="n">now</span><span class="p">.</span><span class="nf">utc</span><span class="p">.</span><span class="nf">utc?</span>       <span class="c1"># =&gt; true</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.now # =&gt; Mon, 07 Jun 2010 19:30:47 -0400
now.utc?           # =&gt; false
now.utc.utc?       # =&gt; true
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h6 id="advance"><a class="anchorlink" href="#advance">16.1.2.4 <code>advance</code></a></h6><p>跳轉到另一個日期時間的最通用方法是 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateTime.html#method-i-advance"><code>advance</code></a>。此方法接收帶有 keys <code>:years</code>、<code>:months</code>、<code>:weeks</code>、<code>:days</code>、<code>:hours</code>、<code>:minutes</code> 和 <code>:seconds</code> 的雜湊值，並返回與 ZHTW_3 一樣多的當前日期時間。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 5 日星期四 11:33:31 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">years: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">days: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">hours: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">minutes: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; 2011 年 9 月 6 日，星期二 12:34:32 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = DateTime.current
# =&gt; 2010 年 8 月 5 日星期四 11:33:31 +0000
d.advance(years: 1, months: 1, days: 1, hours: 1, minutes: 1, seconds: 1)
# =&gt; 2011 年 9 月 6 日，星期二 12:34:32 +0000
">Copy</button>
</div>
<p>此方法首先計算目標日期，將 <code>:years</code>、<code>:months</code>、<code>:weeks</code> 和 <code>:days</code> 傳遞到上面記錄的 <code>Date#advance</code>。之後，它將呼叫 [<code>since</code>][DateTime#since] 的時間調整為提前的秒數。這個順序是相關的，在某些邊緣情況下，不同的順序會給出不同的日期時間。 <code>Date#advance</code> 中的示例適用，我們可以擴充套件它以顯示與時間位相關的順序相關性。</p><p>如果我們首先移動日期位（也有一個相對的處理順序，如前所述），然後我們得到例如以下計算的時間位：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; 星期日，2010 年 2 月 28 日 23:59:59 +0000</span>
<span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; 2010 年 3 月 29 日星期一 00:00:00 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = DateTime.new(2010, 2, 28, 23, 59, 59)
# =&gt; 星期日，2010 年 2 月 28 日 23:59:59 +0000
d.advance(months: 1, seconds: 1)
# =&gt; 2010 年 3 月 29 日星期一 00:00:00 +0000
">Copy</button>
</div>
<p>但是如果我們反過來計算它們，結果就會不同：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">d</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">).</span><span class="nf">advance</span><span class="p">(</span><span class="ss">months: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; 2010 年 4 月 1 日星期四 00:00:00 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="d.advance(seconds: 1).advance(months: 1)
# =&gt; 2010 年 4 月 1 日星期四 00:00:00 +0000
">Copy</button>
</div>
<div class="warning"><p>由於 <code>DateTime</code> 不是 DST 感知的，因此您可能會在一個不存在的時間點結束，而沒有警告或錯誤告訴您。</p></div><div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h5 id="datetime"><a class="anchorlink" href="#datetime">16.1.3 更改元件</a></h5><p>方法 [<code>change</code>][DateTime#change] 允許您獲得與接收者相同的新日期時間，除了給定的選項，可能包括 <code>:year</code>、<code>:month</code>、<code>:day</code>、<code>:hour</code>、<code>:min</code>、ZTHWZHT_8TH6</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 6 月 8 日，星期二 01:56:22 +0000</span>
<span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">year: </span><span class="mi">2011</span><span class="p">,</span> <span class="ss">offset: </span><span class="no">Rational</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="c1"># =&gt; 2011 年 6 月 8 日，星期三 01:56:22 -0600</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current
# =&gt; 2010 年 6 月 8 日，星期二 01:56:22 +0000
now.change(year: 2011, offset: Rational(-6, 24))
# =&gt; 2011 年 6 月 8 日，星期三 01:56:22 -0600
">Copy</button>
</div>
<p>如果小時歸零，那麼分鐘和秒也歸零（除非他們給出了 values）：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">hour: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; 2010 年 6 月 8 日，星期二 00:00:00 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now.change(hour: 0)
# =&gt; 2010 年 6 月 8 日，星期二 00:00:00 +0000
">Copy</button>
</div>
<p>類似地，如果分鐘歸零，那麼秒也歸零（除非它給出了 value）：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">min: </span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; 2010 年 6 月 8 日，星期二 01:00:00 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now.change(min: 0)
# =&gt; 2010 年 6 月 8 日，星期二 01:00:00 +0000
">Copy</button>
</div>
<p>此方法不容忍不存在的日期，如果更改無效 <code>ArgumentError</code> 引發：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span><span class="p">.</span><span class="nf">change</span><span class="p">(</span><span class="ss">month: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">day: </span><span class="mi">30</span><span class="p">)</span>
<span class="c1"># =&gt; ArgumentError: 無效日期</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="DateTime.current.change(month: 2, day: 30)
# =&gt; ArgumentError: 無效日期
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p></div><h5 id="datetime"><a class="anchorlink" href="#datetime">16.1.4 持續時間</a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActiveSupport/Duration.html"><code>Duration</code></a> 物件可以新增到日期時間和從中減去：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">DateTime</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; 2011 年 8 月 9 日，星期二 23:15:17 +0000</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; 2010 年 8 月 2 日星期一 23:15:17 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current
# =&gt; 2010 年 8 月 9 日星期一 23:15:17 +0000
now + 1.year
# =&gt; 2011 年 8 月 9 日，星期二 23:15:17 +0000
now - 1.week
# =&gt; 2010 年 8 月 2 日星期一 23:15:17 +0000
">Copy</button>
</div>
<p>它們轉換為對 <code>since</code> 或 <code>advance</code> 的呼叫。例如在這裡我們得到了日曆改革的正確跳轉：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">DateTime</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">hour</span>
<span class="c1"># =&gt; 1582 年 10 月 15 日星期五 00:00:00 +0000</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="DateTime.new(1582, 10, 4, 23) + 1.hour
# =&gt; 1582 年 10 月 15 日星期五 00:00:00 +0000
">Copy</button>
</div>
<h3 id="time"><a class="anchorlink" href="#time">17 <code>Time</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">17.1 計算</a></h4><p>它們是類似的。請參閱上面的文件並考慮以下差異：</p>
<ul>
<li>[<code>change</code>][Time#change] 接受額外的 <code>:usec</code> 選項。</li>
<li>
<code>Time</code> 瞭解 DST，因此您可以獲得正確的 DST 計算，如</li>
</ul>
<div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>

<span class="c1"># 在巴塞羅那，由於夏令時，2010/03/28 02:00 +0100 變為 2010/03/28 03:00 +0200。</span>
<span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="c1"># =&gt; 2010 年 3 月 28 日星期日 01:59:59 +0100</span>
<span class="n">t</span><span class="p">.</span><span class="nf">advance</span><span class="p">(</span><span class="ss">seconds: </span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># =&gt; 2010 年 3 月 28 日星期日 03:00:00 +0200</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;

# 在巴塞羅那，由於夏令時，2010/03/28 02:00 +0100 變為 2010/03/28 03:00 +0200。
t = Time.local(2010, 3, 28, 1, 59, 59)
# =&gt; 2010 年 3 月 28 日星期日 01:59:59 +0100
t.advance(seconds: 1)
# =&gt; 2010 年 3 月 28 日星期日 03:00:00 +0200
'>Copy</button>
</div>

<ul>
<li>如果 [<code>since</code>][Time#since] 或 [<code>ago</code>][Time#ago] 跳轉到無法用 <code>Time</code> 表示的時間，則返回 <code>DateTime</code> 物件。</li>
</ul>
<h5 id="time-current"><a class="anchorlink" href="#time-current">17.1.1 <code>Time.current</code></a></h5><p>Active Support 將 <a href="https://api.rubyonrails.org/v7.0.0/classes/Time.html#method-c-current"><code>Time.current</code></a> 定義為當前時區中的今天。這與 <code>Time.now</code> 類似，不同之處在於它尊重使用者時區（如果已定義）。它還定義了實例謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>today?</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-tomorrow-3F"><code>tomorrow?</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-today-3F"><code>next_day?</code></a> ::Calculations#next_day?]、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-yesterday-3F"><code>yesterday?</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-prev_day-3F"><code>prev_day?</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a>，所有這些相對於 <code>Time.current</code>。</p><p>使用尊重使用者時區的方法進行時間比較時，請確保使用 <code>Time.current</code> 而不是 <code>Time.now</code>。在某些情況下，使用者時區可能在未來與系統時區相比，<code>Time.now</code> 預設使用系統時區。這意味著 <code>Time.now.to_date</code> 可能等於 <code>Date.yesterday</code>。</p><div class="note"><p>在 <code>active_support/core_ext/time/calculations.rb</code> 中定義。</p></div><h5 id="all-day-all-week-all-month-all-quarter-all-year"><a class="anchorlink" href="#all-day-all-week-all-month-all-quarter-all-year">17.1.2 <code>all_day</code>, <code>all_week</code>, <code>all_month</code>, <code>all_quarter</code> 和 <code>all_year</code></a></h5><p>方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-all_day"><code>all_day</code></a> 返回一個表示當前時間一整天的範圍。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_day</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一 00:00:00 UTC +00:00.. 2010 年 8 月 9 日星期一 23:59:59 UTC +00:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = Time.current
# =&gt; 2010 年 8 月 9 日星期一 23:20:05 UTC +00:00
now.all_day
# =&gt; 2010 年 8 月 9 日星期一 00:00:00 UTC +00:00.. 2010 年 8 月 9 日星期一 23:59:59 UTC +00:00
">Copy</button>
</div>
<p>類似地，<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-all_week"><code>all_week</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-all_month"><code>all_month</code></a>、<a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-all_quarter"><code>all_quarter</code></a> 和 [<code>all_year</code>][Date#AllTime::year]Calculations服務於生成時間範圍的目的。</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一 23:20:05 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一 00:00:00 UTC +00:00.. 2010 年 8 月 15 日星期日 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_week</span><span class="p">(</span><span class="ss">:sunday</span><span class="p">)</span>
<span class="c1"># =&gt; 2012 年 9 月 16 日星期日 00:00:00 UTC +00:00.. 2012 年 9 月 22 日星期六 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_month</span>
<span class="c1"># =&gt; 2010 年 8 月 1 日星期六 00:00:00 UTC +00:00.. 2010 年 8 月 31 日星期二 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_quarter</span>
<span class="c1"># =&gt; 2010 年 7 月 1 日星期四 00:00:00 UTC +00:00..星期四 2010 年 9 月 30 日 23:59:59 UTC +00:00</span>
<span class="n">now</span><span class="p">.</span><span class="nf">all_year</span>
<span class="c1"># =&gt; 2010 年 1 月 1 日星期五 00:00:00 UTC +00:00..星期五 2010 年 12 月 31 日 23:59:59 UTC +00:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = Time.current
# =&gt; 2010 年 8 月 9 日星期一 23:20:05 UTC +00:00
now.all_week
# =&gt; 2010 年 8 月 9 日星期一 00:00:00 UTC +00:00.. 2010 年 8 月 15 日星期日 23:59:59 UTC +00:00
now.all_week(:sunday)
# =&gt; 2012 年 9 月 16 日星期日 00:00:00 UTC +00:00.. 2012 年 9 月 22 日星期六 23:59:59 UTC +00:00
now.all_month
# =&gt; 2010 年 8 月 1 日星期六 00:00:00 UTC +00:00.. 2010 年 8 月 31 日星期二 23:59:59 UTC +00:00
now.all_quarter
# =&gt; 2010 年 7 月 1 日星期四 00:00:00 UTC +00:00..星期四 2010 年 9 月 30 日 23:59:59 UTC +00:00
now.all_year
# =&gt; 2010 年 1 月 1 日星期五 00:00:00 UTC +00:00..星期五 2010 年 12 月 31 日 23:59:59 UTC +00:00
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h5 id="prev-day-next-day"><a class="anchorlink" href="#prev-day-next-day">17.1.3 <code>prev_day</code>, <code>next_day</code></a></h5><p>[<code>prev_day</code>][Time#prev_day] 和 [<code>next_day</code>][Time#next_day] 返回最後一天或第二天的時間：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_day</span>               <span class="c1"># =&gt; 2010-05-07 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_day</span>               <span class="c1"># =&gt; 2010-05-09 00:00:00 +0900</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_day               # =&gt; 2010-05-07 00:00:00 +0900
t.next_day               # =&gt; 2010-05-09 00:00:00 +0900
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/time/calculations.rb</code> 中定義。</p></div><h5 id="prev-month-next-month"><a class="anchorlink" href="#prev-month-next-month">17.1.4 <code>prev_month</code>, <code>next_month</code></a></h5><p>[<code>prev_month</code>][Time#prev_month] 和 [<code>next_month</code>][Time#next_month] 返回上個月或下個月同一天的時間：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_month</span>             <span class="c1"># =&gt; 2010-04-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_month</span>             <span class="c1"># =&gt; 2010-06-08 00:00:00 +0900</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_month             # =&gt; 2010-04-08 00:00:00 +0900
t.next_month             # =&gt; 2010-06-08 00:00:00 +0900
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-04-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-06-30 00:00:00 +0900</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_month</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Time.new(2000, 5, 31).prev_month # =&gt; 2000-04-30 00:00:00 +0900
Time.new(2000, 3, 31).prev_month # =&gt; 2000-02-29 00:00:00 +0900
Time.new(2000, 5, 31).next_month # =&gt; 2000-06-30 00:00:00 +0900
Time.new(2000, 1, 31).next_month # =&gt; 2000-02-29 00:00:00 +0900
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/time/calculations.rb</code> 中定義。</p></div><h5 id="prev-year-next-year"><a class="anchorlink" href="#prev-year-next-year">17.1.5 <code>prev_year</code>, <code>next_year</code></a></h5><p>[<code>prev_year</code>][Time#prev_year] 和 [<code>next_year</code>][Time#next_year] 返回上一年或下一年同一天/月的時間：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>              <span class="c1"># =&gt; 2009-05-08 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>              <span class="c1"># =&gt; 2011-05-08 00:00:00 +0900</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_year              # =&gt; 2009-05-08 00:00:00 +0900
t.next_year              # =&gt; 2011-05-08 00:00:00 +0900
">Copy</button>
</div>
<p>如果日期是閏年的 2 月 29 日，您將獲得 28 日：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span> <span class="c1"># =&gt; 2000-02-29 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_year</span>               <span class="c1"># =&gt; 1999-02-28 00:00:00 +0900</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_year</span>               <span class="c1"># =&gt; 2001-02-28 00:00:00 +0900</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2000, 2, 29) # =&gt; 2000-02-29 00:00:00 +0900
t.prev_year               # =&gt; 1999-02-28 00:00:00 +0900
t.next_year               # =&gt; 2001-02-28 00:00:00 +0900
">Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/time/calculations.rb</code> 中定義。</p></div><h5 id="prev-quarter-next-quarter"><a class="anchorlink" href="#prev-quarter-next-quarter">17.1.6 <code>prev_quarter</code>, <code>next_quarter</code></a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-prev_quarter"><code>prev_quarter</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-next_quarter"><code>next_quarter</code></a> 返回上一季度或下一季度同一天的日期：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># =&gt; 2010-05-08 00:00:00 +0300</span>
<span class="n">t</span><span class="p">.</span><span class="nf">prev_quarter</span>             <span class="c1"># =&gt; 2010-02-08 00:00:00 +0200</span>
<span class="n">t</span><span class="p">.</span><span class="nf">next_quarter</span>             <span class="c1"># =&gt; 2010-08-08 00:00:00 +0300</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.local(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0300
t.prev_quarter             # =&gt; 2010-02-08 00:00:00 +0200
t.next_quarter             # =&gt; 2010-08-08 00:00:00 +0300
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-04-30 00:00:00 +0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span>  <span class="c1"># =&gt; 2000-02-29 00:00:00 +0200</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">prev_quarter</span> <span class="c1"># =&gt; 2000-07-31 00:00:00 +0300</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">31</span><span class="p">).</span><span class="nf">next_quarter</span> <span class="c1"># =&gt; 2001-03-01 00:00:00 +0200</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Time.local(2000, 7, 31).prev_quarter  # =&gt; 2000-04-30 00:00:00 +0300
Time.local(2000, 5, 31).prev_quarter  # =&gt; 2000-02-29 00:00:00 +0200
Time.local(2000, 10, 31).prev_quarter # =&gt; 2000-07-31 00:00:00 +0300
Time.local(2000, 11, 31).next_quarter # =&gt; 2001-03-01 00:00:00 +0200
">Copy</button>
</div>
<p><code>prev_quarter</code> 別名為 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-last_quarter"><code>last_quarter</code></a>。</p><div class="note"><p>在 <code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p></div><h4 id=""><a class="anchorlink" href="#">17.2 時間建構函式</a></h4><p>如果定義了使用者時區，則 Active Support 將 <a href="https://api.rubyonrails.org/v7.0.0/classes/Time.html#method-c-current"><code>Time.current</code></a> 定義為 <code>Time.zone.now</code>，並回退到 <code>Time.now</code>：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">zone_default</span>
<span class="c1"># =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;</span>
<span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 6 日星期五 17:11:58 CEST +02:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;
Time.current
# =&gt; 2010 年 8 月 6 日星期五 17:11:58 CEST +02:00
'>Copy</button>
</div>
<p>類似於 <code>DateTime</code>，謂詞 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-past-3F"><code>past?</code></a> 和 <a href="https://api.rubyonrails.org/v7.0.0/classes/DateAndTime/Calculations.html#method-i-future-3F"><code>future?</code></a> 與 <code>Time.current</code> 相關。</p><p>如果構建的時間超出了執行時平臺中<code>Time</code>支援的範圍，則丟棄usecs並返回一個<code>DateTime</code>物件。</p><h5 id=""><a class="anchorlink" href="#">17.2.1 持續時間</a></h5><p><a href="https://api.rubyonrails.org/v7.0.0/classes/ActiveSupport/Duration.html"><code>Duration</code></a> 物件可以新增和減去時間物件：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span>
<span class="c1"># =&gt; 2010 年 8 月 9 日星期一 23:20:05 UTC +00:00</span>
<span class="n">now</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># =&gt; 2011 年 8 月 9 日星期二 23:21:11 UTC +00:00</span>
<span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span>
<span class="c1"># =&gt; 2010 年 8 月 2 日星期一 23:21:11 UTC +00:00</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = Time.current
# =&gt; 2010 年 8 月 9 日星期一 23:20:05 UTC +00:00
now + 1.year
# =&gt; 2011 年 8 月 9 日星期二 23:21:11 UTC +00:00
now - 1.week
# =&gt; 2010 年 8 月 2 日星期一 23:21:11 UTC +00:00
">Copy</button>
</div>
<p>它們轉換為對 <code>since</code> 或 <code>advance</code> 的呼叫。例如在這裡我們得到了日曆改革的正確跳轉：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Time</span><span class="p">.</span><span class="nf">utc</span><span class="p">(</span><span class="mi">1582</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">.</span><span class="nf">days</span>
<span class="c1"># =&gt; 10 月 18 日星期一 00:00:00 UTC 1582</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="Time.utc(1582, 10, 3) + 5.days
# =&gt; 10 月 18 日星期一 00:00:00 UTC 1582
">Copy</button>
</div>
<h3 id="file"><a class="anchorlink" href="#file">18 <code>File</code> 的擴充套件</a></h3><h4 id="atomic-write"><a class="anchorlink" href="#atomic-write">18.1 <code>atomic_write</code></a></h4><p>使用類方法 <a href="https://api.rubyonrails.org/v7.0.0/classes/File.html#method-c-atomic_write"><code>File.atomic_write</code></a>，您可以以防止任何讀者看到半寫內容的方式寫入檔案。</p><p>檔名作為引數傳遞，該方法產生一個為寫入而開啟的檔案控制代碼。一旦塊完成 <code>atomic_write</code> 關閉檔案控制代碼並完成其工作。</p><p>比如Action Pack就是用這個方法來寫像<code>all.css</code>這樣的資產快取檔案：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">File</span><span class="p">.</span><span class="nf">atomic_write</span><span class="p">(</span><span class="n">joined_asset_path</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">cache</span><span class="o">|</span>
  <span class="n">cache</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">join_asset_file_contents</span><span class="p">(</span><span class="n">asset_paths</span><span class="p">))</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="File.atomic_write(joined_asset_path) do |cache|
  cache.write(join_asset_file_contents(asset_paths))
end
">Copy</button>
</div>
<p>為了完成這個 <code>atomic_write</code> 建立一個臨時檔案。這是塊中的程式碼實際寫入的檔案。完成後，臨時檔案被重新命名，這是 POSIX 系統上的原子操作。如果目標檔案存在 <code>atomic_write</code> 將覆蓋它並保留所有者和許可權。但是，在少數情況下 <code>atomic_write</code> 無法更改檔案所有權或許可權，此錯誤會被捕獲並跳過信任使用者/檔案系統以確保需要它的程序可以訪問該檔案。</p><p>筆記。由於 <code>atomic_write</code> 執行的 chmod 操作，如果目標檔案上設定了 ACL，則將重新計算/修改此 ACL。</p><p>警告。請注意，您不能附加 <code>atomic_write</code>。</p><p>輔助檔案寫入臨時檔案的標準目錄中，但您可以傳遞您選擇的目錄作為第二個引數。</p><div class="note"><p>在 <code>active_support/core_ext/file/atomic.rb</code> 中定義。</p></div><h3 id="nameerror"><a class="anchorlink" href="#nameerror">19 <code>NameError</code> 的擴充套件</a></h3><p>Active Support 將 <a href="https://api.rubyonrails.org/v7.0.0/classes/NameError.html#method-i-missing_name-3F"><code>missing_name?</code></a> 新增到 <code>NameError</code>，它測試是否由於作為引數傳遞的名稱而引發異常。</p><p>該名稱可以作為 symbol 或字串給出。 symbol 針對裸常量名稱進行測試，字串針對完全限定的常量名稱進行測試。</p><p>提示：符號可以表示完全限定的常量名稱，如 <code>:"ActiveRecord::Base"</code>，因此定義 symbols 的行為是為了方便，而不是因為技術上必須如此。</p><p>例如，當呼叫 <code>ArticlesController</code> 的 action 時，Rails 會樂觀地嘗試使用 <code>ArticlesHelper</code>。 helper module 不存在是可以的，因此如果引發該常量名稱的異常，則應將其靜音。但可能是由於實際未知常數，<code>articles_helper.rb</code> 會引發 <code>NameError</code>。那應該重新加註。 <code>missing_name?</code> 方法提供了一種區分兩種情況的方法：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def default_helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "helpers/#{module_path}_helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/name_error.rb</code> 中定義。</p></div><h3 id="loaderror"><a class="anchorlink" href="#loaderror">20 <code>LoadError</code> 的擴充套件</a></h3><p>Active Support 將 <a href="https://api.rubyonrails.org/v7.0.0/classes/LoadError.html#method-i-is_missing-3F"><code>is_missing?</code></a> 新增到 <code>LoadError</code>。</p><p>給定路徑名 <code>is_missing?</code> 測試是否由於該特定檔案引發異常（“.rb”副檔名除外）。</p><p>例如，當呼叫 <code>ArticlesController</code> 的 action 時，Rails 嘗試載入 <code>articles_helper.rb</code>，但該檔案可能不存在。沒關係，helper module 不是強制性的，因此 Rails 消除了載入錯誤。但也可能是 helper module 確實存在，進而需要另一個缺失的庫。在這種情況下，Rails 必須重新引發異常。 <code>is_missing?</code> 方法提供了一種區分兩種情況的方法：</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">def</span> <span class="nf">default_helper_module!</span>
  <span class="n">module_name</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">delete_suffix</span><span class="p">(</span><span class="s2">"Controller"</span><span class="p">)</span>
  <span class="n">module_path</span> <span class="o">=</span> <span class="n">module_name</span><span class="p">.</span><span class="nf">underscore</span>
  <span class="n">helper</span> <span class="n">module_path</span>
<span class="k">rescue</span> <span class="no">LoadError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">is_missing?</span> <span class="s2">"helpers/</span><span class="si">#{</span><span class="n">module_path</span><span class="si">}</span><span class="s2">_helper"</span>
<span class="k">rescue</span> <span class="no">NameError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="k">raise</span> <span class="n">e</span> <span class="k">unless</span> <span class="n">e</span><span class="p">.</span><span class="nf">missing_name?</span> <span class="s2">"</span><span class="si">#{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">Helper"</span>
<span class="k">end</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text='def default_helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "helpers/#{module_path}_helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
'>Copy</button>
</div>
<div class="note"><p>在 <code>active_support/core_ext/load_error.rb</code> 中定義。</p></div>

        <h3>回饋</h3>
        <p>
          我們鼓勵您幫助提高本指南的品質。
        </p>
        <p>
          如果您發現任何拼寫錯誤或資訊錯誤，請提供回饋。
          要開始回饋，您可以閱讀我們的 <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">回饋</a> 部分。
        </p>
        <p>
          您還可能會發現不完整的內容或不是最新的內容。
          請務必為 main 新增任何遺漏的文件。假設是
          <a href="https://edgeguides.rubyonrails.org">非穩定版指南(edge guides)</a> 請先驗證問題是否已經在主分支上解決。
          請前往 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南寫作準則</a> 查看寫作風格和慣例。
        </p>
        <p>
          如果由於某種原因您發現要修復的內容但無法自行修補，請您 <a href="https://github.com/rails/rails/issues">提出 issue</a>。
        </p>
        <p>關於 Ruby on Rails 的任何類型的討論歡迎提供任何文件至 <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">rubyonrails-docs 討論區</a>。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品已獲得<a href="https://creativecommons.org/licenses/by-sa/4.0/">知識共享署名-相同方式共享 4.0 國際</a>許可</p>
<p>“Rails”、“Ruby on Rails”和 Rails 標誌是 David Heinemeier Hansson 的商標。 保留所有權利。</p>
    </div>
  </div>
</body>
</html>
