<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Active Support 核心擴充套件 — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Active Support 核心擴充套件 — Ruby on Rails Guides" />
  <meta name="description" content="Active Support 核心擴充套件active support 是 rails 元件上的 Ruby，負責提供 Ruby 語言擴充套件和實用程式。它在語言層面提供了更豐富的底線，既針對 rails 應用程式的開發，也針對 rails 本身的 Ruby 開發。閱讀本指南後，您將瞭解： 什麼是核心擴充套件。 如何載入所有擴充套件。 如何挑選你想要的擴充套件。 什麼擴充套件Active Support 提供。" />
  <meta property="og:description" content="Active Support 核心擴充套件active support 是 rails 元件上的 Ruby，負責提供 Ruby 語言擴充套件和實用程式。它在語言層面提供了更豐富的底線，既針對 rails 應用程式的開發，也針對 rails 本身的 Ruby 開發。閱讀本指南後，您將瞭解： 什麼是核心擴充套件。 如何載入所有擴充套件。 如何挑選你想要的擴充套件。 什麼擴充套件Active Support 提供。" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="Ruby on Rails Guides" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v6.1.4</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多訊息請訪問 <a href="https://rubyonrails.org/">rubyonrails.org：</a> </strong>
      <span class="red-button more-info-button">
        更多 Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">部落格</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">指南</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">論壇</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">在 GitHub 上做出貢獻</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="返回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南索引</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>從這裡開始</dt>
                  <dd><a href="getting_started.html">Rails 入門</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record 基礎知識</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record 驗證</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record 查詢介面</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="layouts_and_rendering.html">Rails 中的佈局和渲染</a></dd>
                  <dd><a href="form_helpers.html">Action View 表單 Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller結束view</a></dd>
                  <dd><a href="routing.html">Rails 從外到內路由</a></dd>
                </div>
                <div class="guides-section">
                  <dt>其他元件</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support 核心擴充套件</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer 基礎知識</a></dd>
                  <dd><a href="active_job_basics.html">現役工作基礎</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage 結束view</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable 結束 view</a></dd>
                  <dd><a href="webpacker.html">打包機</a></dd>
                </div>
                <div class="guides-section">
                  <dt>深層發掘</dt>
                  <dd><a href="i18n.html">Rails 國際化 (I18n) API</a></dd>
                  <dd><a href="testing.html">測試 Rails 應用程式</a></dd>
                  <dd><a href="security.html">保護 Rails 應用程式</a></dd>
                  <dd><a href="debugging_rails_applications.html">除錯 Rails 應用程式</a></dd>
                  <dd><a href="configuring.html">配置 Rails 應用程式</a></dd>
                  <dd><a href="command_line.html">Rails 命令列</a></dd>
                  <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">自動載入和重新載入常量</a></dd>
                  <dd><a href="caching_with_rails.html">使用 Rails 快取：結束view</a></dd>
                  <dd><a href="api_app.html">將 Rails 用於僅 API 的應用程式</a></dd>
                </div>
                <div class="guides-section">
                  <dt>延伸導軌</dt>
                  <dd><a href="rails_on_rack.html">機架上的導軌</a></dd>
                  <dd><a href="generators.html">建立和自定義 Rails 生成器和模板</a></dd>
                </div>
                <div class="guides-section">
                  <dt>貢獻</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API 文件指南</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">指南指南</a></dd>
                </div>
                <div class="guides-section">
                  <dt>政策</dt>
                  <dd><a href="maintenance_policy.html">維修政策</a></dd>
                </div>
                <div class="guides-section">
                  <dt>發行說明</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</a></dd>
                  <dd><a href="6_1_release_notes.html">版本 6.1 - 2020 年 12 月</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 版 - 2019 年 8 月</a></dd>
                  <dd><a href="5_2_release_notes.html">5.2 版 - 2018 年 4 月</a></dd>
                  <dd><a href="5_1_release_notes.html">5.1 版 - 2017 年 4 月</a></dd>
                  <dd><a href="5_0_release_notes.html">5.0 版 - 2016 年 6 月</a></dd>
                  <dd><a href="4_2_release_notes.html">4.2 版 - 2014 年 12 月</a></dd>
                  <dd><a href="4_1_release_notes.html">4.1 版 - 2014 年 4 月</a></dd>
                  <dd><a href="4_0_release_notes.html">4.0 版 - 2013 年 6 月</a></dd>
                  <dd><a href="3_2_release_notes.html">3.2 版 - 2012 年 1 月</a></dd>
                  <dd><a href="3_1_release_notes.html">3.1 版 - 2011 年 8 月</a></dd>
                  <dd><a href="3_0_release_notes.html">3.0 版 - 2010 年 8 月</a></dd>
                  <dd><a href="2_3_release_notes.html">2.3 版 - 2009 年 3 月</a></dd>
                  <dd><a href="2_2_release_notes.html">2.2 版 - 2008 年 11 月</a></dd>
                </div>
            </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南索引</option>
              <optgroup label="從這裡開始">
                  <option value="getting_started.html">Rails 入門</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎知識</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record 驗證</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record 查詢介面</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 中的佈局和渲染</option>
                  <option value="form_helpers.html">Action View 表單 Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller結束view</option>
                  <option value="routing.html">Rails 從外到內路由</option>
              </optgroup>
              <optgroup label="其他元件">
                  <option value="active_support_core_extensions.html">Active Support 核心擴充套件</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎知識</option>
                  <option value="active_job_basics.html">現役工作基礎</option>
                  <option value="active_storage_overview.html">Active Storage 結束view</option>
                  <option value="action_cable_overview.html">Action Cable 結束 view</option>
                  <option value="webpacker.html">打包機</option>
              </optgroup>
              <optgroup label="深層發掘">
                  <option value="i18n.html">Rails 國際化 (I18n) API</option>
                  <option value="testing.html">測試 Rails 應用程式</option>
                  <option value="security.html">保護 Rails 應用程式</option>
                  <option value="debugging_rails_applications.html">除錯 Rails 應用程式</option>
                  <option value="configuring.html">配置 Rails 應用程式</option>
                  <option value="command_line.html">Rails 命令列</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="autoloading_and_reloading_constants.html">自動載入和重新載入常量</option>
                  <option value="caching_with_rails.html">使用 Rails 快取：結束view</option>
                  <option value="api_app.html">將 Rails 用於僅 API 的應用程式</option>
              </optgroup>
              <optgroup label="延伸導軌">
                  <option value="rails_on_rack.html">機架上的導軌</option>
                  <option value="generators.html">建立和自定義 Rails 生成器和模板</option>
              </optgroup>
              <optgroup label="貢獻">
                  <option value="contributing_to_ruby_on_rails.html">在 Rails 上為 Ruby 做貢獻</option>
                  <option value="api_documentation_guidelines.html">API 文件指南</option>
                  <option value="ruby_on_rails_guides_guidelines.html">指南指南</option>
              </optgroup>
              <optgroup label="政策">
                  <option value="maintenance_policy.html">維修政策</option>
              </optgroup>
              <optgroup label="發行說明">
                  <option value="upgrading_ruby_on_rails.html">在 Rails 上升級 Ruby</option>
                  <option value="6_1_release_notes.html">版本 6.1 - 2020 年 12 月</option>
                  <option value="6_0_release_notes.html">6.0 版 - 2019 年 8 月</option>
                  <option value="5_2_release_notes.html">5.2 版 - 2018 年 4 月</option>
                  <option value="5_1_release_notes.html">5.1 版 - 2017 年 4 月</option>
                  <option value="5_0_release_notes.html">5.0 版 - 2016 年 6 月</option>
                  <option value="4_2_release_notes.html">4.2 版 - 2014 年 12 月</option>
                  <option value="4_1_release_notes.html">4.1 版 - 2014 年 4 月</option>
                  <option value="4_0_release_notes.html">4.0 版 - 2013 年 6 月</option>
                  <option value="3_2_release_notes.html">3.2 版 - 2012 年 1 月</option>
                  <option value="3_1_release_notes.html">3.1 版 - 2011 年 8 月</option>
                  <option value="3_0_release_notes.html">3.0 版 - 2010 年 8 月</option>
                  <option value="2_3_release_notes.html">2.3 版 - 2009 年 3 月</option>
                  <option value="2_2_release_notes.html">2.2 版 - 2008 年 11 月</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Support 核心擴充套件</h2><p>active support 是 rails 元件上的 Ruby，負責提供 Ruby
語言擴充套件和實用程式。</p><p>它在語言層面提供了更豐富的底線，既針對 rails 應用程式的開發，也針對 rails 本身的 Ruby 開發。</p><p>閱讀本指南後，您將瞭解：</p>
<ul>
<li>什麼是核心擴充套件。</li>
<li>如何載入所有擴充套件。</li>
<li>如何挑選你想要的擴充套件。</li>
<li>什麼擴充套件Active Support 提供。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#">如何載入核心擴充套件</a>

<ul>
<li><a href="#active-support">獨立 active support</a></li>
<li><a href="#active-support-ruby-on-rails">active support 在 ruby on rails 應用程式中</a></li>
</ul>
</li>
<li>
<a href="#">所有物件的擴充套件</a>

<ul>
<li><a href="#"><code>空白？</code> 和<code>存在？</code></a></li>
<li><a href="#"><code>存在</code></a></li>
<li><a href="#"><code>可複製嗎？</code></a></li>
<li><a href="#deep-dup"><code>deep_dup</code></a></li>
<li><a href="#"><code>試試</code></a></li>
<li><a href="#class-eval-args-block"><code>class_eval(*args, &amp;block)</code></a></li>
<li><a href="#acts-like-questionmark-duck"><code>acts_like?(duck)</code></a></li>
<li><a href="#to-param"><code>to_param</code></a></li>
<li><a href="#to-query"><code>to_query</code></a></li>
<li><a href="#with-options"><code>with_options</code></a></li>
<li><a href="#json">json 支援</a></li>
<li><a href="#">例項變數</a></li>
<li><a href="#">靜默警告和異常</a></li>
<li><a href="#"><code>在？</code></a></li>
</ul>
</li>
<li>
<a href="#">“模組”的擴充套件</a>

<ul>
<li><a href="#">屬性</a></li>
<li><a href="#">父母</a></li>
<li><a href="#">匿名</a></li>
<li><a href="#">方法委託</a></li>
<li><a href="#">重新定義方法</a></li>
</ul>
</li>
<li>
<a href="#">“類”的擴充套件</a>

<ul>
<li><a href="#">類屬性</a></li>
<li><a href="#">子類和後代</a></li>
</ul>
</li>
<li>
<a href="#string"><code>String</code> 的擴充套件</a>

<ul>
<li><a href="#">輸出安全</a></li>
<li><a href="#"><code>移除</code></a></li>
<li><a href="#"><code>擠壓</code></a></li>
<li><a href="#"><code>截斷</code></a></li>
<li><a href="#truncate-bytes"><code>truncate_bytes</code></a></li>
<li><a href="#truncate-words"><code>truncate_words</code></a></li>
<li><a href="#"><code>詢價</code></a></li>
<li><a href="#string-starts-with-questionmark-ends-with-questionmark"><code>starts_with?</code> 和 <code>ends_with?</code></a></li>
<li><a href="#strip-heredoc"><code>strip_heredoc</code></a></li>
<li><a href="#"><code>縮排</code></a></li>
<li><a href="#string-">訪問</a></li>
<li><a href="#">曲折</a></li>
<li><a href="#string-">次轉化</a></li>
</ul>
</li>
<li>
<a href="#symbol"><code>Symbol</code> 的擴充套件</a>

<ul>
<li><a href="#symbol-starts-with-questionmark-ends-with-questionmark"><code>starts_with?</code> 和 <code>ends_with?</code></a></li>
</ul>
</li>
<li>
<a href="#numeric"><code>Numeric</code> 的擴充套件</a>

<ul>
<li><a href="#">位元組</a></li>
<li><a href="#numeric-">時間</a></li>
<li><a href="#">格式</a></li>
</ul>
</li>
<li>
<a href="#integer"><code>Integer</code> 的擴充套件</a>

<ul>
<li><a href="#multiple-of-questionmark"><code>multiple_of?</code></a></li>
<li><a href="#"><code>序數</code></a></li>
<li><a href="#"><code>有序化</code></a></li>
<li><a href="#integer">時間</a></li>
</ul>
</li>
<li>
<a href="#bigdecimal"><code>BigDecimal</code> 的擴充套件</a>

<ul>
<li><a href="#bigdecimal-to-s"><code>to_s</code></a></li>
</ul>
</li>
<li>
<a href="#enumerable"><code>Enumerable</code> 的擴充套件</a>

<ul>
<li><a href="#"><code>總和</code></a></li>
<li><a href="#index-by"><code>index_by</code></a></li>
<li><a href="#index-with"><code>index_with</code></a></li>
<li><a href="#"><code>很多？</code></a></li>
<li><a href="#"><code>排除？</code></a></li>
<li><a href="#"><code>包括</code></a></li>
<li><a href="#"><code>排除</code></a></li>
<li><a href="#"><code>採摘</code></a></li>
<li><a href="#"><code>挑選</code></a></li>
</ul>
</li>
<li>
<a href="#array"><code>Array</code> 的擴充套件</a>

<ul>
<li><a href="#array">訪問</a></li>
<li><a href="#array-">提取</a></li>
<li><a href="#action">選項提取action</a></li>
<li><a href="#array">次轉化</a></li>
<li><a href="#">換行</a></li>
<li><a href="#array">複製</a></li>
<li><a href="#">分組</a></li>
</ul>
</li>
<li>
<a href="#hash"><code>Hash</code> 的擴充套件</a>

<ul>
<li><a href="#hash-">次轉化</a></li>
<li><a href="#">合併</a></li>
<li><a href="#">深度複製</a></li>
<li><a href="#">使用金鑰</a></li>
<li><a href="#">處理值</a></li>
<li><a href="#">切片</a></li>
<li><a href="#hash">提取</a></li>
<li><a href="#">無所謂訪問</a></li>
</ul>
</li>
<li>
<a href="#regexp"><code>Regexp</code> 的擴充套件</a>

<ul>
<li><a href="#"><code>多行？</code></a></li>
</ul>
</li>
<li>
<a href="#">“範圍”的擴充套件</a>

<ul>
<li><a href="#to-s"><code>to_s</code></a></li>
<li><a href="#include-questionmark"><code>===</code> 和 <code>include?</code></a></li>
<li><a href="#"><code>重疊？</code></a></li>
</ul>
</li>
<li>
<a href="#">“日期”的擴充套件</a>

<ul>
<li><a href="#-">計算</a></li>
<li><a href="#">次轉化</a></li>
</ul>
</li>
<li>
<a href="#datetime"><code>DateTime</code> 的擴充套件</a>

<ul>
<li><a href="#datetime">計算</a></li>
</ul>
</li>
<li>
<a href="#">“時間”的擴充套件</a>

<ul>
<li><a href="#">計算</a></li>
<li><a href="#">時間建構函式</a></li>
</ul>
</li>
<li>
<a href="#"><code>檔案</code>的擴充套件</a>

<ul>
<li><a href="#atomic-write"><code>atomic_write</code></a></li>
</ul>
</li>
<li><a href="#nameerror"><code>NameError</code> 的擴充套件</a></li>
<li><a href="#loaderror"><code>LoadError</code> 的擴充套件</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id=""><a class="anchorlink" href="#">1 如何載入核心擴充套件</a></h3><h4 id="active-support"><a class="anchorlink" href="#active-support">1.1 獨立 active support</a></h4><p>為了儘可能減少預設佔用空間，Active Support 預設載入最小依賴項。它被分成小塊，以便只能載入所需的擴充套件。它還具有一些方便的入口點，可以一次性載入相關擴充套件，甚至所有內容。</p><p>因此，在一個簡單的要求之後：</p><div class="code_container">
<pre><code class="highlight plaintext">require "active_support"
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
'>Copy</button>
</div>
<p>僅載入Active Support 框架所需的擴充套件。</p><h5 id=""><a class="anchorlink" href="#">1.1.1 挑選定義</a></h5><p>這個例子展示瞭如何載入 [<code>hash#with_indifferent_access</code>][hash#with_indifferent_access]。這個擴充套件可以將一個 <code>hash</code> 轉換成一個 [<code>activesupport::hashwithindifferentaccess</code>][activesupport::hashwithindifferentaccess]，它允許以字串或Symbols 的形式訪問鍵。</p><div class="code_container">
<pre><code class="highlight plaintext">{a: 1}.with_indifferent_access["a"] # =&gt; 1
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.with_indifferent_access["a"] # =&gt; 1
'>Copy</button>
</div>
<p>對於定義為核心擴充套件的每個方法，本指南都有一個註釋，說明在哪裡定義了這樣的方法。在 <code>with_indifferent_access</code> 的情況下，註釋如下：</p><p>注意：在<code>active_support/core_ext/hash/indifferent_access.rb</code> 中定義。</p><p>這意味著您可以像這樣要求它：</p><div class="code_container">
<pre><code class="highlight plaintext">require "active_support"
require "active_support/core_ext/hash/indifferent_access"
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
require "active_support/core_ext/hash/indifferent_access"
'>Copy</button>
</div>
<p>Active Support 已經過仔細修改，以便挑選檔案僅載入嚴格需要的依賴項（如果有）。</p><h5 id=""><a class="anchorlink" href="#">1.1.2 載入分組核心擴充套件</a></h5><p>下一個級別是簡單地將所有擴充套件載入到<code>Hash</code>。根據經驗，透過載入“active_support/core_ext/some_class”，可以一次性獲得對“SomeClass”的擴充套件。</p><p>因此，要將所有擴充套件載入到 <code>Hash</code>（包括 <code>with_indifferent_access</code>）：</p><div class="code_container">
<pre><code class="highlight plaintext">require "active_support"
require "active_support/core_ext/hash"
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
require "active_support/core_ext/hash"
'>Copy</button>
</div>
<h5 id=""><a class="anchorlink" href="#">1.1.3 載入所有核心擴充套件</a></h5><p>您可能更喜歡只加載所有核心擴充套件，有一個檔案：</p><div class="code_container">
<pre><code class="highlight plaintext">require "active_support"
require "active_support/core_ext"
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support"
require "active_support/core_ext"
'>Copy</button>
</div>
<h5 id="active-support"><a class="anchorlink" href="#active-support">1.1.4 載入所有 active support</a></h5><p>最後，如果您想讓所有 Active Support 都可用，只需發出：</p><div class="code_container">
<pre><code class="highlight plaintext">require "active_support/all"
</code></pre>
<button class="clipboard-button" data-clipboard-text='require "active_support/all"
'>Copy</button>
</div>
<p>這甚至沒有將整個Active Support 預先放在記憶體中，有些東西是透過<code>autoload</code>配置的，所以只有在使用時才會載入。</p><h4 id="active-support-ruby-on-rails"><a class="anchorlink" href="#active-support-ruby-on-rails">1.2 active support 在 ruby on rails 應用程式中</a></h4><p>除非 <code>config.active_support.bare</code> 為 true，rails 應用程式上的 Ruby 會載入所有 active support。在這種情況下，應用程式將只加載框架本身根據自己的需要挑選的內容，並且仍然可以在任何粒度級別挑選自己，如上一節所述。</p><h3 id=""><a class="anchorlink" href="#">2 所有物件的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">2.1 <code>空白？</code> 和<code>存在？</code></a></h4><p>以下值在 Rails 應用程式中被視為空白：</p>
<ul>
<li><p><code>nil</code> 和 <code>false</code>，</p></li>
<li><p>僅由空格組成的字串（請參閱下面的註釋），</p></li>
<li><p>空陣列和雜湊，以及</p></li>
<li><p>任何其他響應 <code>empty?</code> 並且為空的物件。</p></li>
</ul>
<p>資訊：字串的謂詞使用可識別 Unicode 的字元類 <code>[:space:]</code>，因此例如 U+2029（段落分隔符）被認為是空格。</p><p>警告：請注意，未提及數字。特別是，0 和 0.0 是 <strong>not</strong> 空白。</p><p>例如，<code>actioncontroller::httpauthentication::Token::controllermethods</code> 中的這個方法使用 [<code>blank?</code>][object#blank?] 來檢查@ {28} 存在：</p><div class="code_container">
<pre><code class="highlight plaintext">def authenticate(Controller, &amp;login_procedure)
  Token, options = Token_and_options(controller.request)
  unless Token.blank?
    login_procedure.call(Token, options)
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="def authenticate(Controller, &amp;login_procedure)
  Token, options = Token_and_options(controller.request)
  unless Token.blank?
    login_procedure.call(Token, options)
  end
end
">Copy</button>
</div>
<p>方法 [<code>present?</code>][object#present?] 等價於 <code>!blank?</code>。此示例取自 <code>Actiondispatch::http::cache::response</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">def set_conditional_cache_control!
  return if self["Cache-Control"].present?
  # ...
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='def set_conditional_cache_control!
  return if self["Cache-Control"].present?
  # ...
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/blank.rb</code> 中定義。</p><p>[object#blank?]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-blank-3f">https://api.Rubyonrails.org/classes/object.html#method-i-blank-3f</a>
[object#present?]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-present-3f">https://api.Rubyonrails.org/classes/object.html#method-i-present-3f</a></p><h4 id=""><a class="anchorlink" href="#">2.2 <code>存在</code></a></h4><p>[<code>presence</code>][Object#presence] 方法在<code>present?</code> 時返回它的接收者，否則返回<code>nil</code>。它對像這樣的習語很有用：</p><div class="code_container">
<pre><code class="highlight plaintext">host = config[:host].presence || 'localhost'
</code></pre>
<button class="clipboard-button" data-clipboard-text="host = config[:host].presence || 'localhost'
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/blank.rb</code> 中定義。</p><p>[object#presence]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-presence">https://api.Rubyonrails.org/classes/object.html#method-i-presence</a></p><h4 id=""><a class="anchorlink" href="#">2.3 <code>可複製嗎？</code></a></h4><p>從Ruby 2.5 開始，大多數物件都可以透過 <code>dup</code> 或 <code>clone</code> 複製：</p><div class="code_container">
<pre><code class="highlight plaintext">"foo".dup           # =&gt; "foo"
"".dup              # =&gt; ""
Rational(1).dup     # =&gt; (1/1)
Complex(0).dup      # =&gt; (0+0i)
1.method(:+).dup    # =&gt; TypeError (allocator undefined for Method)
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo".dup           # =&gt; "foo"
"".dup              # =&gt; ""
Rational(1).dup     # =&gt; (1/1)
Complex(0).dup      # =&gt; (0+0i)
1.method(:+).dup    # =&gt; TypeError (allocator undefined for Method)
'>Copy</button>
</div>
<p>Active Support 提供 [<code>duplicable?</code>][object#duplicable?] 來查詢一個物件：</p><div class="code_container">
<pre><code class="highlight plaintext">"foo".duplicable?           # =&gt; true
"".duplicable?              # =&gt; true
Rational(1).duplicable?     # =&gt; true
Complex(1).duplicable?      # =&gt; true
1.method(:+).duplicable?    # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo".duplicable?           # =&gt; true
"".duplicable?              # =&gt; true
Rational(1).duplicable?     # =&gt; true
Complex(1).duplicable?      # =&gt; true
1.method(:+).duplicable?    # =&gt; false
'>Copy</button>
</div>
<p>警告：任何類都可以透過刪除 <code>dup</code> 和 <code>clone</code> 或從中引發異常來禁止複製。因此，只有“rescue”才能判斷給定的任意物件是否可複製。 <code>duplicable?</code> 取決於上面的硬編碼列表，但它比 <code>rescue</code> 快得多。僅當您知道硬編碼列表在您的用例中就足夠了時才使用它。</p><p>注意：在<code>active_support/core_ext/object/duplicable.rb</code> 中定義。</p><p>[object#duplicable?]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-duplicable-3f">https://api.Rubyonrails.org/classes/object.html#method-i-duplicable-3f</a></p><h4 id="deep-dup"><a class="anchorlink" href="#deep-dup">2.4 <code>deep_dup</code></a></h4><p>[<code>deep_dup</code>][object#deep_dup] 方法返回給定物件的深層副本。通常，當您“複製”一個包含其他物件的物件時，Ruby 不會“複製”它們，因此它會建立該物件的淺複製。例如，如果您有一個帶有字串的陣列，它將如下所示：</p><div class="code_container">
<pre><code class="highlight plaintext">array     = ['string']
duplicate = array.dup

duplicate.push 'another-string'

# the object was duplicated, so the element was added only to the duplicate
array     # =&gt; ['string']
duplicate # =&gt; ['string', 'another-string']

duplicate.first.gsub!('string', 'foo')

# first element was not duplicated, it will be changed in both arrays
array     # =&gt; ['foo']
duplicate # =&gt; ['foo', 'another-string']
</code></pre>
<button class="clipboard-button" data-clipboard-text="array     = ['string']
duplicate = array.dup

duplicate.push 'another-string'

# the object was duplicated, so the element was added only to the duplicate
array     # =&gt; ['string']
duplicate # =&gt; ['string', 'another-string']

duplicate.first.gsub!('string', 'foo')

# first element was not duplicated, it will be changed in both arrays
array     # =&gt; ['foo']
duplicate # =&gt; ['foo', 'another-string']
">Copy</button>
</div>
<p>如您所見，複製<code>Array</code>例項後，我們得到了另一個物件，因此我們可以對其進行修改，原始物件保持不變。然而，對於陣列的元素而言，情況並非如此。由於 <code>dup</code> 不進行深複製，陣列內的字串仍然是同一個物件。</p><p>如果你需要一個物件的深複製，你應該使用<code>deep_dup</code>。下面是一個例子：</p><div class="code_container">
<pre><code class="highlight plaintext">array     = ['string']
duplicate = array.deep_dup

duplicate.first.gsub!('string', 'foo')

array     # =&gt; ['string']
duplicate # =&gt; ['foo']
</code></pre>
<button class="clipboard-button" data-clipboard-text="array     = ['string']
duplicate = array.deep_dup

duplicate.first.gsub!('string', 'foo')

array     # =&gt; ['string']
duplicate # =&gt; ['foo']
">Copy</button>
</div>
<p>如果物件不可複製，<code>deep_dup</code> 只會返回它：</p><div class="code_container">
<pre><code class="highlight plaintext">number = 1
duplicate = number.deep_dup
number.object_id == duplicate.object_id   # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="number = 1
duplicate = number.deep_dup
number.object_id == duplicate.object_id   # =&gt; true
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/deep_dup.rb</code> 中定義。</p><p>[object#deep_dup]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-deep_dup">https://api.Rubyonrails.org/classes/object.html#method-i-deep_dup</a></p><h4 id=""><a class="anchorlink" href="#">2.5 <code>試試</code></a></h4><p>當您只想在物件不為 nil 時呼叫該方法，實現它的最簡單方法是使用條件語句，增加不必要的混亂。另一種方法是使用 [<code>try</code>][Object#try]。 <code>try</code> 與 <code>Object#send</code> 類似，只是它在傳送到 <code>nil</code> 時返回 <code>nil</code>。</p><p>下面是一個例子：</p><div class="code_container">
<pre><code class="highlight plaintext"># without try
unless @number.nil?
  @number.next
end

# with try
@number.try(:next)
</code></pre>
<button class="clipboard-button" data-clipboard-text="# without try
unless @number.nil?
  @number.next
end

# with try
@number.try(:next)
">Copy</button>
</div>
<p>另一個例子是來自 <code>ActiveRecord::ConnectionAdapters::AbstractAdapter</code> 的這段程式碼，其中 <code>@logger</code> 可以是 <code>nil</code>。您可以看到程式碼使用了 <code>try</code> 並避免了不必要的檢查。</p><div class="code_container">
<pre><code class="highlight plaintext">def log_info(sql, name, ms)
  if @logger.try(:debug?)
    name = '%s (%.1fms)' % [name || 'SQL', ms]
    @logger.debug(format_log_entry(name, sql.squeeze(' ')))
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="def log_info(sql, name, ms)
  if @logger.try(:debug?)
    name = '%s (%.1fms)' % [name || 'SQL', ms]
    @logger.debug(format_log_entry(name, sql.squeeze(' ')))
  end
end
">Copy</button>
</div>
<p><code>try</code> 也可以不帶引數呼叫，只在一個塊中呼叫，只有當物件不為 nil 時才會執行：</p><div class="code_container">
<pre><code class="highlight plaintext">@person.try { |p| "#{p.first_name} #{p.last_name}" }
</code></pre>
<button class="clipboard-button" data-clipboard-text='@person.try { |p| "#{p.first_name} #{p.last_name}" }
'>Copy</button>
</div>
<p>請注意，<code>try</code> 將吞下無方法錯誤，而是返回 nil。如果您想防止打字錯誤，請改用 [<code>try!</code>][Object#try!]：</p><div class="code_container">
<pre><code class="highlight plaintext">@number.try(:nest)  # =&gt; nil
@number.try!(:nest) # NoMethodError: undefined method `nest' for 1:Integer
</code></pre>
<button class="clipboard-button" data-clipboard-text="@number.try(:nest)  # =&gt; nil
@number.try!(:nest) # NoMethodError: undefined method `nest' for 1:Integer
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/try.rb</code> 中定義。</p><p>[object#try]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-try">https://api.Rubyonrails.org/classes/object.html#method-i-try</a>
[object#try!]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-try-21">https://api.Rubyonrails.org/classes/object.html#method-i-try-21</a></p><h4 id="class-eval-args-block"><a class="anchorlink" href="#class-eval-args-block">2.6 <code>class_eval(*args, &amp;block)</code></a></h4><p>您可以使用 [<code>class_eval</code>][Kernel#class_eval] 在任何物件的單例類的上下文中評估程式碼：</p><div class="code_container">
<pre><code class="highlight plaintext">class Proc
  def bind(object)
    block, time = self, Time.current
    object.class_eval do
      method_name = "__bind_#{time.to_i}_#{time.usec}"
      define_method(method_name, &amp;block)
      method = instance_method(method_name)
      remove_method(method_name)
      method
    end.bind(object)
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='class Proc
  def bind(object)
    block, time = self, Time.current
    object.class_eval do
      method_name = "__bind_#{time.to_i}_#{time.usec}"
      define_method(method_name, &amp;block)
      method = instance_method(method_name)
      remove_method(method_name)
      method
    end.bind(object)
  end
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/kernel/singleton_class.rb</code> 中定義。</p><p>[kernel#class_eval]：<a href="https://api.Rubyonrails.org/classes/kernel.html#method-i-class_eval">https://api.Rubyonrails.org/classes/kernel.html#method-i-class_eval</a></p><h4 id="acts-like-questionmark-duck"><a class="anchorlink" href="#acts-like-questionmark-duck">2.7 <code>acts_like?(duck)</code></a></h4><p>方法 [<code>acts_like?</code>][Object#acts_like?] 提供了一種基於簡單約定來檢查某個類的行為是否與其他類相同的方法：提供與 String 定義的介面相同的介面的類</p><div class="code_container">
<pre><code class="highlight plaintext">def acts_like_string?
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="def acts_like_string?
end
">Copy</button>
</div>
<p>這只是一個標記，它的主體或返回值是無關緊要的。然後，客戶端程式碼可以透過這種方式查詢duck-type-safeness：</p><div class="code_container">
<pre><code class="highlight plaintext">some_klass.acts_like?(:string)
</code></pre>
<button class="clipboard-button" data-clipboard-text="some_klass.acts_like?(:string)
">Copy</button>
</div>
<p>Rails 的類的行為類似於“Date”或“Time”，並遵循此約定。</p><p>注意：在<code>active_support/core_ext/object/acts_like.rb</code> 中定義。</p><p>[object#acts_like?]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-acts_like-3f">https://api.Rubyonrails.org/classes/object.html#method-i-acts_like-3f</a></p><h4 id="to-param"><a class="anchorlink" href="#to-param">2.8 <code>to_param</code></a></h4><p>Rails 中的所有物件都響應方法 [<code>to_param</code>][Object#to_param]，該方法旨在返回將它們表示為查詢字串中的值或 URL 片段的內容。</p><p>預設情況下，<code>to_param</code> 只調用 <code>to_s</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">7.to_param # =&gt; "7"
</code></pre>
<button class="clipboard-button" data-clipboard-text='7.to_param # =&gt; "7"
'>Copy</button>
</div>
<p><code>to_param</code> 的返回值應該<strong>不</strong>被轉義：</p><div class="code_container">
<pre><code class="highlight plaintext">"Tom &amp; Jerry".to_param # =&gt; "Tom &amp; Jerry"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Tom &amp; Jerry".to_param # =&gt; "Tom &amp; Jerry"
'>Copy</button>
</div>
<p>Rails 中的幾個類覆蓋了這個方法。</p><p>例如 <code>nil</code>、<code>true</code> 和 <code>false</code> 返回自身。 [<code>Array#to_param</code>][Array#to_param] 對元素呼叫 <code>to_param</code> 並用“/”連線結果：</p><div class="code_container">
<pre><code class="highlight plaintext">[0, true, String].to_param # =&gt; "0/true/String"
</code></pre>
<button class="clipboard-button" data-clipboard-text='[0, true, String].to_param # =&gt; "0/true/String"
'>Copy</button>
</div>
<p>值得注意的是，rails 路由系統在Models 上呼叫 <code>to_param</code> 來獲取 <code>:id</code> 佔位符的值。 <code>activerecord::base#to_param</code> 返回Model 的<code>id</code>，但您可以在Model 中重新定義該方法。例如，給定</p><div class="code_container">
<pre><code class="highlight plaintext">class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
'>Copy</button>
</div>
<p>我們得到：</p><div class="code_container">
<pre><code class="highlight plaintext">user_path(@user) # =&gt; "/users/357-john-smith"
</code></pre>
<button class="clipboard-button" data-clipboard-text='user_path(@user) # =&gt; "/users/357-john-smith"
'>Copy</button>
</div>
<p>警告。 Controllers 需要注意對 <code>to_param</code> 的任何重新定義，因為當這樣的請求進入“357-john-smith”時就是 <code>params[:id]</code> 的值。</p><p>注意：在<code>active_support/core_ext/object/to_param.rb</code> 中定義。</p><p>[array#to_param]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-to_param">https://api.Rubyonrails.org/classes/array.html#method-i-to_param</a>
[object#to_param]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-to_param">https://api.Rubyonrails.org/classes/object.html#method-i-to_param</a></p><h4 id="to-query"><a class="anchorlink" href="#to-query">2.9 <code>to_query</code></a></h4><p>[<code>to_query</code>][Object#to_query] 方法構造一個查詢字串，該字串將給定的 <code>key</code> 與 <code>to_param</code> 的返回值相關聯。例如，使用以下 <code>to_param</code> 定義：</p><div class="code_container">
<pre><code class="highlight plaintext">class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User
  def to_param
    "#{id}-#{name.parameterize}"
  end
end
'>Copy</button>
</div>
<p>我們得到：</p><div class="code_container">
<pre><code class="highlight plaintext">current_user.to_query('user') # =&gt; "user=357-john-smith"
</code></pre>
<button class="clipboard-button" data-clipboard-text="current_user.to_query('user') # =&gt; &quot;user=357-john-smith&quot;
">Copy</button>
</div>
<p>此方法轉義鍵和值所需的任何內容：</p><div class="code_container">
<pre><code class="highlight plaintext">account.to_query('company[name]')
# =&gt; "company%5Bname%5D=Johnson+%26+Johnson"
</code></pre>
<button class="clipboard-button" data-clipboard-text="account.to_query('company[name]')
# =&gt; &quot;company%5Bname%5D=Johnson+%26+Johnson&quot;
">Copy</button>
</div>
<p>因此它的輸出已準備好在查詢字串中使用。</p><p>陣列返回將<code>to_query</code>應用於每個以<code>key[]</code>為鍵的元素的結果，並用“&amp;”連線結果：</p><div class="code_container">
<pre><code class="highlight plaintext">[3.4, -45.6].to_query('sample')
# =&gt; "sample%5B%5D=3.4&amp;sample%5B%5D=-45.6"
</code></pre>
<button class="clipboard-button" data-clipboard-text="[3.4, -45.6].to_query('sample')
# =&gt; &quot;sample%5B%5D=3.4&amp;sample%5B%5D=-45.6&quot;
">Copy</button>
</div>
<p>雜湊也響應 <code>to_query</code>，但具有不同的簽名。如果沒有傳遞引數，則呼叫會生成一系列排序的鍵/值分配，對其值呼叫 <code>to_query(key)</code>。然後用“&amp;”連線結果：</p><div class="code_container">
<pre><code class="highlight plaintext">{c: 3, b: 2, a: 1}.to_query # =&gt; "a=1&amp;b=2&amp;c=3"
</code></pre>
<button class="clipboard-button" data-clipboard-text='{c: 3, b: 2, a: 1}.to_query # =&gt; "a=1&amp;b=2&amp;c=3"
'>Copy</button>
</div>
<p>方法 [<code>Hash#to_query</code>][Hash#to_query] 接受鍵的可選名稱空間：</p><div class="code_container">
<pre><code class="highlight plaintext">{id: 89, name: "John Smith"}.to_query('user')
# =&gt; "user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith"
</code></pre>
<button class="clipboard-button" data-clipboard-text="{id: 89, name: &quot;John Smith&quot;}.to_query('user')
# =&gt; &quot;user%5Bid%5D=89&amp;user%5Bname%5D=John+Smith&quot;
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/to_query.rb</code> 中定義。</p><p>[hash#to_query]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-to_query">https://api.Rubyonrails.org/classes/hash.html#method-i-to_query</a>
[object#to_query]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-to_query">https://api.Rubyonrails.org/classes/object.html#method-i-to_query</a></p><h4 id="with-options"><a class="anchorlink" href="#with-options">2.10 <code>with_options</code></a></h4><p>方法 [<code>with_options</code>][Object#with_options] 提供了一種在一系列方法呼叫中提取常見選項的方法。</p><p>給定一個預設的選項雜湊，<code>with_options</code> 為一個塊生成一個代理物件。在塊內，代理上呼叫的方法被轉發到接收器，併合並了它們的選項。例如，你擺脫了重複：</p><div class="code_container">
<pre><code class="highlight plaintext">class Account &lt; ApplicationRecord
  has_many :customers, dependent: :destroy
  has_many :products,  dependent: :destroy
  has_many :invoices,  dependent: :destroy
  has_many :expenses,  dependent: :destroy
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account &lt; ApplicationRecord
  has_many :customers, dependent: :destroy
  has_many :products,  dependent: :destroy
  has_many :invoices,  dependent: :destroy
  has_many :expenses,  dependent: :destroy
end
">Copy</button>
</div>
<p>這邊走：</p><div class="code_container">
<pre><code class="highlight plaintext">class Account &lt; ApplicationRecord
  with_options dependent: :destroy do |assoc|
    assoc.has_many :customers
    assoc.has_many :products
    assoc.has_many :invoices
    assoc.has_many :expenses
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class Account &lt; ApplicationRecord
  with_options dependent: :destroy do |assoc|
    assoc.has_many :customers
    assoc.has_many :products
    assoc.has_many :invoices
    assoc.has_many :expenses
  end
end
">Copy</button>
</div>
<p>這個習語也可以向讀者傳達<em>分組</em>。例如，假設您要傳送其語言取決於使用者的時事通訊。在郵件程式的某個地方，您可以像這樣對依賴於語言環境的位進行分組：</p><div class="code_container">
<pre><code class="highlight plaintext">I18n.with_options locale: user.locale, scope: "newsletter" do |i18n|
  subject i18n.t :subject
  body    i18n.t :body, user_name: user.name
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='I18n.with_options locale: user.locale, scope: "newsletter" do |i18n|
  subject i18n.t :subject
  body    i18n.t :body, user_name: user.name
end
'>Copy</button>
</div>
<p>提示：由於<code>with_options</code> 將呼叫轉發給其接收者，因此它們可以巢狀。除了自己的巢狀級別外，每個巢狀級別還將合併繼承的預設值。</p><p>注意：在<code>active_support/core_ext/object/with_options.rb</code> 中定義。</p><p>[object#with_options]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-with_options">https://api.Rubyonrails.org/classes/object.html#method-i-with_options</a></p><h4 id="json"><a class="anchorlink" href="#json">2.11 json 支援</a></h4><p>active support 提供了比通常為 Ruby 物件提供的 <code>json</code> gem 更好的 <code>to_json</code> 實現。這是因為某些類，如 <code>hash</code> 和 <code>process::status</code> 需要特殊處理才能提供正確的 json 表示。</p><p>注意：在<code>active_support/core_ext/object/json.rb</code> 中定義。</p><h4 id=""><a class="anchorlink" href="#">2.12 例項變數</a></h4><p>Active Support 提供了幾種方法來簡化對例項變數的訪問。</p><h5 id="instance-values"><a class="anchorlink" href="#instance-values">2.12.1 <code>instance_values</code></a></h5><p>方法 [<code>instance_values</code>][Object#instance_values] 返回一個雜湊值，該雜湊值將沒有“@”的例項變數名稱對映到它們的
相應的值。鍵是字串：</p><div class="code_container">
<pre><code class="highlight plaintext">class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_values # =&gt; {"x" =&gt; 0, "y" =&gt; 1}
</code></pre>
<button class="clipboard-button" data-clipboard-text='class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_values # =&gt; {"x" =&gt; 0, "y" =&gt; 1}
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/instance_variables.rb</code> 中定義。</p><p>[object#instance_values]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-instance_values">https://api.Rubyonrails.org/classes/object.html#method-i-instance_values</a></p><h5 id="instance-variable-names"><a class="anchorlink" href="#instance-variable-names">2.12.2 <code>instance_variable_names</code></a></h5><p>方法 [<code>instance_variable_names</code>][Object#instance_variable_names] 返回一個數組。每個名稱都包含“@”符號。</p><div class="code_container">
<pre><code class="highlight plaintext">class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_variable_names # =&gt; ["@x", "@y"]
</code></pre>
<button class="clipboard-button" data-clipboard-text='class C
  def initialize(x, y)
    @x, @y = x, y
  end
end

C.new(0, 1).instance_variable_names # =&gt; ["@x", "@y"]
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/instance_variables.rb</code> 中定義。</p><p>[object#instance_variable_names]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-instance_variable_names">https://api.Rubyonrails.org/classes/object.html#method-i-instance_variable_names</a></p><h4 id=""><a class="anchorlink" href="#">2.13 靜默警告和異常</a></h4><p>方法 [<code>silence_warnings</code>][Kernel#silence_warnings] 和 [<code>enable_warnings</code>][Kernel#enable_warnings] 在它們的阻塞期間相應地改變 <code>$VERBOSE</code> 的值，然後重置它：</p><div class="code_container">
<pre><code class="highlight plaintext">silence_warnings { Object.const_set "RAILS_DEFAULT_LOGGER", logger }
</code></pre>
<button class="clipboard-button" data-clipboard-text='silence_warnings { Object.const_set "RAILS_DEFAULT_LOGGER", logger }
'>Copy</button>
</div>
<p>[<code>suppress</code>][Kernel#suppress] 也可以消除異常。此方法接收任意數量的異常類。如果在塊執行期間引發異常並且是 <code>kind_of?</code> 任何引數，<code>suppress</code> 會捕獲它並靜默返回。否則不捕獲異常：</p><div class="code_container">
<pre><code class="highlight plaintext"># If the user is locked, the increment is lost, no big deal.
suppress(ActiveRecord::StaleObjectError) do
  current_user.increment! :visits
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="# If the user is locked, the increment is lost, no big deal.
suppress(ActiveRecord::StaleObjectError) do
  current_user.increment! :visits
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/kernel/reporting.rb</code> 中定義。</p><p>[kernel#enable_warnings]：<a href="https://api.Rubyonrails.org/classes/kernel.html#method-i-enable_warnings">https://api.Rubyonrails.org/classes/kernel.html#method-i-enable_warnings</a>
[kernel#silence_warnings]：<a href="https://api.Rubyonrails.org/classes/kernel.html#method-i-silence_warnings">https://api.Rubyonrails.org/classes/kernel.html#method-i-silence_warnings</a>
[kernel#suppress]：<a href="https://api.Rubyonrails.org/classes/kernel.html#method-i-suppress">https://api.Rubyonrails.org/classes/kernel.html#method-i-suppress</a></p><h4 id=""><a class="anchorlink" href="#">2.14 <code>在？</code></a></h4><p>謂詞 [<code>in?</code>][Object#in?] 測試一個物件是否包含在另一個物件中。如果傳遞的引數不響應 <code>include?</code>，則會引發 <code>ArgumentError</code> 異常。</p><p><code>in?</code> 的例子：</p><div class="code_container">
<pre><code class="highlight plaintext">1.in?([1,2])        # =&gt; true
"lo".in?("hello")   # =&gt; true
25.in?(30..50)      # =&gt; false
1.in?(1)            # =&gt; ArgumentError
</code></pre>
<button class="clipboard-button" data-clipboard-text='1.in?([1,2])        # =&gt; true
"lo".in?("hello")   # =&gt; true
25.in?(30..50)      # =&gt; false
1.in?(1)            # =&gt; ArgumentError
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/inclusion.rb</code> 中定義。</p><p>[object#in?]：<a href="https://api.Rubyonrails.org/classes/object.html#method-i-in-3f">https://api.Rubyonrails.org/classes/object.html#method-i-in-3f</a></p><h3 id=""><a class="anchorlink" href="#">3 “模組”的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">3.1 屬性</a></h4><h5 id="alias-attribute"><a class="anchorlink" href="#alias-attribute">3.1.1 <code>alias_attribute</code></a></h5><p>Model 屬性有一個讀者、一個作者和一個謂詞。您可以使用 [<code>alias_attribute</code>][module#alias_attribute] 為 Model 屬性設定別名，該屬性為您定義了相應的三個方法。與其他別名方法一樣，新名稱是第一個引數，舊名稱是第二個引數（一個助記符是它們的順序與您進行賦值的順序相同）：</p><div class="code_container">
<pre><code class="highlight plaintext">class User &lt; ApplicationRecord
  # You can refer to the email column as "login".
  # This can be meaningful for authentication code.
  alias_attribute :login, :email
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='class User &lt; ApplicationRecord
  # You can refer to the email column as "login".
  # This can be meaningful for authentication code.
  alias_attribute :login, :email
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/module/aliasing.rb</code> 中定義。</p><p>[module#alias_attribute]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-alias_attribute">https://api.Rubyonrails.org/classes/module.html#method-i-alias_attribute</a></p><h5 id=""><a class="anchorlink" href="#">3.1.2 內部屬性</a></h5><p>當您在一個打算被子類化的類中定義一個屬性時，名稱衝突是一種風險。這對圖書館來說非常重要。</p><p>active support 定義了宏 [<code>attr_internal_reader</code>][module#attr_internal_reader]、[<code>attr_internal_writer</code>][module#attr_internal_writer] 和 [<code>attr_internal_accessor</code>][module#attr_internal_accessor]。它們的行為類似於它們的 Ruby 內建 <code>attr_*</code> 對應物，除了它們以一種降低衝突可能性的方式命名底層例項變數。</p><p>宏 [<code>attr_internal</code>][Module#attr_internal] 是 <code>attr_internal_accessor</code> 的同義詞：</p><div class="code_container">
<pre><code class="highlight plaintext"># library
class ThirdPartyLibrary::Crawler
  attr_internal :log_level
end

# client code
class MyCrawler &lt; ThirdPartyLibrary::Crawler
  attr_accessor :log_level
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="# library
class ThirdPartyLibrary::Crawler
  attr_internal :log_level
end

# client code
class MyCrawler &lt; ThirdPartyLibrary::Crawler
  attr_accessor :log_level
end
">Copy</button>
</div>
<p>在前面的例子中，<code>:log_level</code> 可能不屬於庫的公共介面，它只用於開發。客戶端程式碼不知道潛在的衝突，子類化並定義了自己的<code>:log_level</code>。感謝 <code>attr_internal</code> 沒有衝突。</p><p>預設情況下，內部例項變數使用前導下劃線命名，在上面的示例中，<code>@_log_level</code>。不過，這可以透過<code>Module.attr_internal_naming_format</code> 進行配置，您可以傳遞任何類似<code>sprintf</code> 的格式字串，並在某處以<code>@</code> 和<code>%s</code> 開頭，這是放置名稱的位置。預設值為<code>"@_%s"</code>。</p><p>rails 在一些地方使用內部屬性，例如Views：</p><div class="code_container">
<pre><code class="highlight plaintext">module actionView
  class Base
    attr_internal :captures
    attr_internal :request, :layout
    attr_internal :Controller, :template
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="module actionView
  class Base
    attr_internal :captures
    attr_internal :request, :layout
    attr_internal :Controller, :template
  end
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/module/attr_internal.rb</code> 中定義。</p><p>[module#attr_internal]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal">https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal</a>
[module#attr_internal_accessor]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal_accessor">https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal_accessor</a>
[module#attr_internal_reader]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal_reader">https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal_reader</a>
[module#attr_internal_writer]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal_writer">https://api.Rubyonrails.org/classes/module.html#method-i-attr_internal_writer</a></p><h5 id=""><a class="anchorlink" href="#">3.1.3 模組屬性</a></h5><p>宏 [<code>mattr_reader</code>][Module#mattr_reader]、[<code>mattr_writer</code>][Module#mattr_writer] 和 [<code>mattr_accessor</code>][Module#mattr_accessor] 與為類定義的 <code>cattr_*</code> 宏相同。事實上，<code>cattr_*</code> 宏只是<code>mattr_*</code> 宏的別名。檢查<a href="#class-attributes">類屬性</a>。</p><p>例如，Active Storage 記錄器的 api 是用 <code>mattr_accessor</code> 生成的：</p><div class="code_container">
<pre><code class="highlight plaintext">module ActiveStorage
  mattr_accessor :logger
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="module ActiveStorage
  mattr_accessor :logger
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/module/attribute_accessors.rb</code> 中定義。</p><p>[module#mattr_accessor]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-mattr_accessor">https://api.Rubyonrails.org/classes/module.html#method-i-mattr_accessor</a>
[module#mattr_reader]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-mattr_reader">https://api.Rubyonrails.org/classes/module.html#method-i-mattr_reader</a>
[module#mattr_writer]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-mattr_writer">https://api.Rubyonrails.org/classes/module.html#method-i-mattr_writer</a></p><h4 id=""><a class="anchorlink" href="#">3.2 父母</a></h4><h5 id="module-parent"><a class="anchorlink" href="#module-parent">3.2.1 <code>module_parent</code></a></h5><p>巢狀命名模組上的 [<code>module_parent</code>][Module#module_parent] 方法返回包含其相應常量的模組：</p><div class="code_container">
<pre><code class="highlight plaintext">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent # =&gt; X::Y
M.module_parent       # =&gt; X::Y
</code></pre>
<button class="clipboard-button" data-clipboard-text="module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent # =&gt; X::Y
M.module_parent       # =&gt; X::Y
">Copy</button>
</div>
<p>如果模組是匿名的或屬於頂層，<code>module_parent</code> 返回<code>Object</code>。</p><p>警告：請注意，在這種情況下，<code>module_parent_name</code> 返回 <code>nil</code>。</p><p>注意：在<code>active_support/core_ext/module/introspection.rb</code> 中定義。</p><p>[module#module_parent]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-module_parent">https://api.Rubyonrails.org/classes/module.html#method-i-module_parent</a></p><h5 id="module-parent-name"><a class="anchorlink" href="#module-parent-name">3.2.2 <code>module_parent_name</code></a></h5><p>巢狀命名模組上的 [<code>module_parent_name</code>][Module#module_parent_name] 方法返回包含其相應常量的模組的完全限定名稱：</p><div class="code_container">
<pre><code class="highlight plaintext">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent_name # =&gt; "X::Y"
M.module_parent_name       # =&gt; "X::Y"
</code></pre>
<button class="clipboard-button" data-clipboard-text='module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parent_name # =&gt; "X::Y"
M.module_parent_name       # =&gt; "X::Y"
'>Copy</button>
</div>
<p>對於頂級或匿名模組，<code>module_parent_name</code> 返回 <code>nil</code>。</p><p>警告：請注意，在這種情況下，<code>module_parent</code> 返回<code>Object</code>。</p><p>注意：在<code>active_support/core_ext/module/introspection.rb</code> 中定義。</p><p>[module#module_parent_name]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-module_parent_name">https://api.Rubyonrails.org/classes/module.html#method-i-module_parent_name</a></p><h5 id="module-parents"><a class="anchorlink" href="#module-parents">3.2.3 <code>module_parents</code></a></h5><p>方法 [<code>module_parents</code>][Module#module_parents] 在接收器上呼叫 <code>module_parent</code>，直到到達 <code>Object</code>。鏈以陣列形式返回，從下到上：</p><div class="code_container">
<pre><code class="highlight plaintext">module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parents # =&gt; [X::Y, X, Object]
M.module_parents       # =&gt; [X::Y, X, Object]
</code></pre>
<button class="clipboard-button" data-clipboard-text="module X
  module Y
    module Z
    end
  end
end
M = X::Y::Z

X::Y::Z.module_parents # =&gt; [X::Y, X, Object]
M.module_parents       # =&gt; [X::Y, X, Object]
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/module/introspection.rb</code> 中定義。</p><p>[module#module_parents]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-module_parents">https://api.Rubyonrails.org/classes/module.html#method-i-module_parents</a></p><h4 id=""><a class="anchorlink" href="#">3.3 匿名</a></h4><p>一個模組可能有也可能沒有名字：</p><div class="code_container">
<pre><code class="highlight plaintext">module M
end
M.name # =&gt; "M"

N = Module.new
N.name # =&gt; "N"

Module.new.name # =&gt; nil
</code></pre>
<button class="clipboard-button" data-clipboard-text='module M
end
M.name # =&gt; "M"

N = Module.new
N.name # =&gt; "N"

Module.new.name # =&gt; nil
'>Copy</button>
</div>
<p>您可以檢查模組是否具有帶有謂詞 [<code>anonymous?</code>][Module#anonymous?] 的名稱：</p><div class="code_container">
<pre><code class="highlight plaintext">module M
end
M.anonymous? # =&gt; false

Module.new.anonymous? # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="module M
end
M.anonymous? # =&gt; false

Module.new.anonymous? # =&gt; true
">Copy</button>
</div>
<p>請注意，無法訪問並不意味著匿名：</p><div class="code_container">
<pre><code class="highlight plaintext">module M
end

m = Object.send(:remove_const, :M)

m.anonymous? # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text="module M
end

m = Object.send(:remove_const, :M)

m.anonymous? # =&gt; false
">Copy</button>
</div>
<p>儘管根據定義無法訪問匿名模組。</p><p>注意：在<code>active_support/core_ext/module/anonymous.rb</code> 中定義。</p><p>[module#anonymous?]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-anonymous-3f">https://api.Rubyonrails.org/classes/module.html#method-i-anonymous-3f</a></p><h4 id=""><a class="anchorlink" href="#">3.4 方法委託</a></h4><h5 id=""><a class="anchorlink" href="#">3.4.1 <code>委託</code></a></h5><p>宏 [<code>delegate</code>][Module#delegate] 提供了一種簡單的方法來轉發方法。</p><p>假設某些應用程式中的使用者在 <code>user</code>Model 中有登入資訊，但在單獨的 <code>profile</code>Model 中有姓名和其他資料：</p><div class="code_container">
<pre><code class="highlight plaintext">class User &lt; ApplicationRecord
  has_one :profile
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile
end
">Copy</button>
</div>
<p>使用該配置，您可以透過使用者的個人資料“user.profile.name”獲得使用者名稱，但仍然能夠直接訪問此類屬性可能會很方便：</p><div class="code_container">
<pre><code class="highlight plaintext">class User &lt; ApplicationRecord
  has_one :profile

  def name
    profile.name
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile

  def name
    profile.name
  end
end
">Copy</button>
</div>
<p>這就是 <code>delegate</code> 為你所做的：</p><div class="code_container">
<pre><code class="highlight plaintext">class User &lt; ApplicationRecord
  has_one :profile

  delegate :name, to: :profile
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile

  delegate :name, to: :profile
end
">Copy</button>
</div>
<p>它更短，意圖更明顯。</p><p>該方法在目標中必須是公共的。</p><p><code>delegate</code> 宏接受幾種方法：</p><div class="code_container">
<pre><code class="highlight plaintext">delegate :name, :age, :address, :twitter, to: :profile
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :name, :age, :address, :twitter, to: :profile
">Copy</button>
</div>
<p>當插入到一個字串中時，<code>:to</code> 選項應該成為一個表示式，該表示式計算方法被委託給的物件。通常是字串或Symbol。這樣的表示式是在接收者的上下文中計算的：</p><div class="code_container">
<pre><code class="highlight plaintext"># delegates to the Rails constant
delegate :logger, to: :Rails

# delegates to the receiver's class
delegate :table_name, to: :class
</code></pre>
<button class="clipboard-button" data-clipboard-text="# delegates to the Rails constant
delegate :logger, to: :Rails

# delegates to the receiver's class
delegate :table_name, to: :class
">Copy</button>
</div>
<p>警告：如果<code>:prefix</code> 選項為<code>true</code>，這不是通用的，見下文。</p><p>預設情況下，如果委託引發 <code>NoMethodError</code> 並且目標是 <code>nil</code>，則傳播異常。你可以使用 <code>:allow_nil</code> 選項要求返回 <code>nil</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">delegate :name, to: :profile, allow_nil: true
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :name, to: :profile, allow_nil: true
">Copy</button>
</div>
<p>使用<code>:allow_nil</code> 呼叫<code>user.name</code> 返回<code>nil</code> 如果使用者沒有配置檔案。</p><p>選項<code>:prefix</code> 為生成的方法的名稱新增字首。例如，這可能有助於獲得更好的名稱：</p><div class="code_container">
<pre><code class="highlight plaintext">delegate :street, to: :address, prefix: true
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :street, to: :address, prefix: true
">Copy</button>
</div>
<p>前面的示例生成了 <code>address_street</code> 而不是 <code>street</code>。</p><p>警告：由於在這種情況下生成的方法的名稱由目標物件和目標方法名稱組成，<code>:to</code> 選項必須是方法名稱。</p><p>也可以配置自定義字首：</p><div class="code_container">
<pre><code class="highlight plaintext">delegate :size, to: :attachment, prefix: :avatar
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :size, to: :attachment, prefix: :avatar
">Copy</button>
</div>
<p>在前面的例子中，宏生成了 <code>avatar_size</code> 而不是 <code>size</code>。</p><p>選項<code>:private</code> 改變方法範圍：</p><div class="code_container">
<pre><code class="highlight plaintext">delegate :date_of_birth, to: :profile, private: true
</code></pre>
<button class="clipboard-button" data-clipboard-text="delegate :date_of_birth, to: :profile, private: true
">Copy</button>
</div>
<p>預設情況下，委託方法是公共的。透過 <code>private: true</code> 來改變它。</p><p>注意：在<code>active_support/core_ext/module/delegation.rb</code> 中定義</p><p>[module#delegate]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-delegate">https://api.Rubyonrails.org/classes/module.html#method-i-delegate</a></p><h5 id="delegate-missing-to"><a class="anchorlink" href="#delegate-missing-to">3.4.2 <code>delegate_missing_to</code></a></h5><p>想象一下，你想委託 <code>User</code> 物件中缺少的所有內容，
到“配置檔案”之一。 [<code>delegate_missing_to</code>][Module#delegate_missing_to] 宏讓你實現這個
在微風中：</p><div class="code_container">
<pre><code class="highlight plaintext">class User &lt; ApplicationRecord
  has_one :profile

  delegate_missing_to :profile
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class User &lt; ApplicationRecord
  has_one :profile

  delegate_missing_to :profile
end
">Copy</button>
</div>
<p>目標可以是物件內的任何可呼叫物件，例如例項變數，
方法、常量等。僅委託目標的公共方法。</p><p>注意：在<code>active_support/core_ext/module/delegation.rb</code> 中定義。</p><p>[module#delegate_missing_to]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-delegate_missing_to">https://api.Rubyonrails.org/classes/module.html#method-i-delegate_missing_to</a></p><h4 id=""><a class="anchorlink" href="#">3.5 重新定義方法</a></h4><p>在某些情況下，您需要使用 <code>define_method</code> 定義一個方法，但不知道是否已經存在具有該名稱的方法。如果是，則在啟用它們時發出警告。沒什麼大不了的，但也不乾淨。</p><p>方法 [<code>redefine_method</code>][Module#redefine_method] 可以防止這種潛在的警告，如果需要，刪除之前的現有方法。</p><p>如果需要定義，也可以使用 [<code>silence_redefinition_of_method</code>][Module#silence_redefinition_of_method]
自己的替換方法（因為您使用的是<code>delegate</code>，因為
例子）。</p><p>注意：在<code>active_support/core_ext/module/redefine_method.rb</code> 中定義。</p><p>[module#redefine_method]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-redefine_method">https://api.Rubyonrails.org/classes/module.html#method-i-redefine_method</a>
[module#silence_redefinition_of_method]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-silence_redefinition_of_method">https://api.Rubyonrails.org/classes/module.html#method-i-silence_redefinition_of_method</a></p><h3 id=""><a class="anchorlink" href="#">4 “類”的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">4.1 類屬性</a></h4><h5 id="class-attribute"><a class="anchorlink" href="#class-attribute">4.1.1 <code>class_attribute</code></a></h5><p>[<code>class_attribute</code>][Class#class_attribute] 方法聲明瞭一個或多個可繼承的類屬性，這些屬性可以在層次結構的任何級別被覆蓋。</p><div class="code_container">
<pre><code class="highlight plaintext">class A
  class_attribute :x
end

class B &lt; A; end

class C &lt; B; end

A.x = :a
B.x # =&gt; :a
C.x # =&gt; :a

B.x = :b
A.x # =&gt; :a
C.x # =&gt; :b

C.x = :c
A.x # =&gt; :a
B.x # =&gt; :b
</code></pre>
<button class="clipboard-button" data-clipboard-text="class A
  class_attribute :x
end

class B &lt; A; end

class C &lt; B; end

A.x = :a
B.x # =&gt; :a
C.x # =&gt; :a

B.x = :b
A.x # =&gt; :a
C.x # =&gt; :b

C.x = :c
A.x # =&gt; :a
B.x # =&gt; :b
">Copy</button>
</div>
<p>例如<code>Actionmailer::base</code> 定義：</p><div class="code_container">
<pre><code class="highlight plaintext">class_attribute :default_params
self.default_params = {
  mime_version: "1.0",
  charset: "UTF-8",
  content_type: "text/plain",
  parts_order: [ "text/plain", "text/enriched", "text/html" ]
}.freeze
</code></pre>
<button class="clipboard-button" data-clipboard-text='class_attribute :default_params
self.default_params = {
  mime_version: "1.0",
  charset: "UTF-8",
  content_type: "text/plain",
  parts_order: [ "text/plain", "text/enriched", "text/html" ]
}.freeze
'>Copy</button>
</div>
<p>也可以在例項級別訪問和覆蓋它們。</p><div class="code_container">
<pre><code class="highlight plaintext">A.x = 1

a1 = A.new
a2 = A.new
a2.x = 2

a1.x # =&gt; 1, comes from A
a2.x # =&gt; 2, overridden in a2
</code></pre>
<button class="clipboard-button" data-clipboard-text="A.x = 1

a1 = A.new
a2 = A.new
a2.x = 2

a1.x # =&gt; 1, comes from A
a2.x # =&gt; 2, overridden in a2
">Copy</button>
</div>
<p>可以透過將選項 <code>:instance_writer</code> 設定為 <code>false</code> 來阻止編寫器例項方法的生成。</p><div class="code_container">
<pre><code class="highlight plaintext">module ActiveRecord
  class Base
    class_attribute :table_name_prefix, instance_writer: false, default: "my"
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='module ActiveRecord
  class Base
    class_attribute :table_name_prefix, instance_writer: false, default: "my"
  end
end
'>Copy</button>
</div>
<p>Model 可能會發現該選項可用作防止批次賦值設定屬性的方法。</p><p>可以透過將選項 <code>:instance_reader</code> 設定為 <code>false</code> 來阻止讀取器例項方法的生成。</p><div class="code_container">
<pre><code class="highlight plaintext">class A
  class_attribute :x, instance_reader: false
end

A.new.x = 1
A.new.x # NoMethodError
</code></pre>
<button class="clipboard-button" data-clipboard-text="class A
  class_attribute :x, instance_reader: false
end

A.new.x = 1
A.new.x # NoMethodError
">Copy</button>
</div>
<p>為方便起見，<code>class_attribute</code> 還定義了一個例項謂詞，它是例項讀取器返回的雙重否定。在上面的例子中，它被稱為“x?”。</p><p>當<code>:instance_reader</code> 為<code>false</code> 時，例項謂詞返回一個<code>NoMethodError</code>，就像reader 方法一樣。</p><p>如果你不想要例項謂詞，傳遞 <code>instance_predicate: false</code> 並且它不會被定義。</p><p>注意：在<code>active_support/core_ext/class/attribute.rb</code> 中定義。</p><p>[class#class_attribute]：<a href="https://api.Rubyonrails.org/classes/class.html#method-i-class_attribute">https://api.Rubyonrails.org/classes/class.html#method-i-class_attribute</a></p><h5 id="cattr-reader-cattr-writer-cattr-accessor"><a class="anchorlink" href="#cattr-reader-cattr-writer-cattr-accessor">4.1.2 <code>cattr_reader</code>、<code>cattr_writer</code> 和 <code>cattr_accessor</code></a></h5><p>宏 [<code>cattr_reader</code>][Module#cattr_reader]、[<code>cattr_writer</code>][Module#cattr_writer] 和 [<code>cattr_accessor</code>][Module#cattr_accessor] 類似於它們的 <code>attr_*</code> 對應物，但用於類。他們將一個類變數初始化為 <code>nil</code>，除非它已經存在，並生成相應的類方法來訪問它：</p><div class="code_container">
<pre><code class="highlight plaintext">class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans.
  cattr_accessor :emulate_booleans
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans.
  cattr_accessor :emulate_booleans
end
">Copy</button>
</div>
<p>此外，您可以將一個塊傳遞給 <code>cattr_*</code> 以使用預設值設定屬性：</p><div class="code_container">
<pre><code class="highlight plaintext">class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans with default value of true.
  cattr_accessor :emulate_booleans, default: true
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="class MysqlAdapter &lt; AbstractAdapter
  # Generates class methods to access @@emulate_booleans with default value of true.
  cattr_accessor :emulate_booleans, default: true
end
">Copy</button>
</div>
<p>例項方法也是為了方便而建立的，它們只是類屬性的代理。因此，例項可以更改類屬性，但不能像<code>class_attribute</code>（見上文）那樣覆蓋它。例如給出</p><div class="code_container">
<pre><code class="highlight plaintext">module actionView
  class Base
    cattr_accessor :field_error_proc, default: Proc.new { ... }
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="module actionView
  class Base
    cattr_accessor :field_error_proc, default: Proc.new { ... }
  end
end
">Copy</button>
</div>
<p>我們可以在Views 中訪問<code>field_error_proc</code>。</p><p>可以透過將<code>:instance_reader</code> 設定為<code>false</code> 來阻止讀取器例項方法的生成，透過將<code>:instance_writer</code> 設定為<code>false</code> 可以阻止生成器例項方法的生成。可以透過將 <code>:instance_accessor</code> 設定為 <code>false</code> 來阻止這兩種方法的生成。在所有情況下，該值必須完全為“false”，而不是任何錯誤值。</p><div class="code_container">
<pre><code class="highlight plaintext">module A
  class B
    # No first_name instance reader is generated.
    cattr_accessor :first_name, instance_reader: false
    # No last_name= instance writer is generated.
    cattr_accessor :last_name, instance_writer: false
    # No surname instance reader or surname= writer is generated.
    cattr_accessor :surname, instance_accessor: false
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="module A
  class B
    # No first_name instance reader is generated.
    cattr_accessor :first_name, instance_reader: false
    # No last_name= instance writer is generated.
    cattr_accessor :last_name, instance_writer: false
    # No surname instance reader or surname= writer is generated.
    cattr_accessor :surname, instance_accessor: false
  end
end
">Copy</button>
</div>
<p>Model 可能會發現將 <code>:instance_accessor</code> 設定為 <code>false</code> 作為一種防止批次賦值設定屬性的方法很有用。</p><p>注意：在<code>active_support/core_ext/module/attribute_accessors.rb</code> 中定義。</p><p>[module#cattr_accessor]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-cattr_accessor">https://api.Rubyonrails.org/classes/module.html#method-i-cattr_accessor</a>
[module#cattr_reader]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-cattr_reader">https://api.Rubyonrails.org/classes/module.html#method-i-cattr_reader</a>
[module#cattr_writer]：<a href="https://api.Rubyonrails.org/classes/module.html#method-i-cattr_writer">https://api.Rubyonrails.org/classes/module.html#method-i-cattr_writer</a></p><h4 id=""><a class="anchorlink" href="#">4.2 子類和後代</a></h4><h5 id=""><a class="anchorlink" href="#">4.2.1 <code>子類</code></a></h5><p>[<code>subclasses</code>][Class#subclasses] 方法返回接收者的子類：</p><div class="code_container">
<pre><code class="highlight plaintext">class C; end
C.subclasses # =&gt; []

class B &lt; C; end
C.subclasses # =&gt; [B]

class A &lt; B; end
C.subclasses # =&gt; [B]

class D &lt; C; end
C.subclasses # =&gt; [B, D]
</code></pre>
<button class="clipboard-button" data-clipboard-text="class C; end
C.subclasses # =&gt; []

class B &lt; C; end
C.subclasses # =&gt; [B]

class A &lt; B; end
C.subclasses # =&gt; [B]

class D &lt; C; end
C.subclasses # =&gt; [B, D]
">Copy</button>
</div>
<p>未指定這些類的返回順序。</p><p>注意：在<code>active_support/core_ext/class/subclasses.rb</code> 中定義。</p><p>[class#subclasses]：<a href="https://api.Rubyonrails.org/classes/class.html#method-i-subclasses">https://api.Rubyonrails.org/classes/class.html#method-i-subclasses</a></p><h5 id=""><a class="anchorlink" href="#">4.2.2 <code>後代</code></a></h5><p>[<code>descendants</code>][Class#descendants] 方法返回所有比其接收者 <code>&lt;</code> 的類：</p><div class="code_container">
<pre><code class="highlight plaintext">class C; end
C.descendants # =&gt; []

class B &lt; C; end
C.descendants # =&gt; [B]

class A &lt; B; end
C.descendants # =&gt; [B, A]

class D &lt; C; end
C.descendants # =&gt; [B, A, D]
</code></pre>
<button class="clipboard-button" data-clipboard-text="class C; end
C.descendants # =&gt; []

class B &lt; C; end
C.descendants # =&gt; [B]

class A &lt; B; end
C.descendants # =&gt; [B, A]

class D &lt; C; end
C.descendants # =&gt; [B, A, D]
">Copy</button>
</div>
<p>未指定這些類的返回順序。</p><p>注意：在<code>active_support/core_ext/class/subclasses.rb</code> 中定義。</p><p>[class#descendants]：<a href="https://api.Rubyonrails.org/classes/class.html#method-i-descendants">https://api.Rubyonrails.org/classes/class.html#method-i-descendants</a></p><h3 id="string"><a class="anchorlink" href="#string">5 <code>String</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">5.1 輸出安全</a></h4><h5 id=""><a class="anchorlink" href="#">5.1.1 動機</a></h5><p>將資料插入 html 模板需要格外小心。例如，您不能直接將 <code>@reView.title</code> 逐字插入到 html 頁面中。一方面，如果 reView 的標題是“flanagan &amp; matz rules！”輸出不會是格式正確的，因為必須將與號轉義為“&amp;”。此外，根據應用程式，這可能是一個很大的安全漏洞，因為使用者可以注入惡意 html 設定手工製作的 reView 標題。檢視 <a href="security.html#cross-site-scripting-xss">安全指南</a> 中有關跨站點指令碼的部分，瞭解有關風險的更多資訊。</p><h5 id=""><a class="anchorlink" href="#">5.1.2 安全字串</a></h5><p>Active Support 有 <em>(html) safe</em> 字串的概念。安全字串是標記為可按原樣插入 html 的字串。它是可信的，不管它是否被逃脫。</p><p>預設情況下，字串被認為是 <em>unsafe</em> ：</p><div class="code_container">
<pre><code class="highlight plaintext">"".html_safe? # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text='"".html_safe? # =&gt; false
'>Copy</button>
</div>
<p>您可以使用 [<code>html_safe</code>][String#html_safe] 方法從給定的字串中獲取安全字串：</p><div class="code_container">
<pre><code class="highlight plaintext">s = "".html_safe
s.html_safe? # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text='s = "".html_safe
s.html_safe? # =&gt; true
'>Copy</button>
</div>
<p>重要的是要理解 <code>html_safe</code> 不執行任何轉義，它只是一個斷言：</p><div class="code_container">
<pre><code class="highlight plaintext">s = "&lt;script&gt;...&lt;/script&gt;".html_safe
s.html_safe? # =&gt; true
s            # =&gt; "&lt;script&gt;...&lt;/script&gt;"
</code></pre>
<button class="clipboard-button" data-clipboard-text='s = "&lt;script&gt;...&lt;/script&gt;".html_safe
s.html_safe? # =&gt; true
s            # =&gt; "&lt;script&gt;...&lt;/script&gt;"
'>Copy</button>
</div>
<p>您有責任確保在特定字串上呼叫 <code>html_safe</code> 是正常的。</p><p>如果您附加到安全字串上，或者使用 <code>concat</code>/<code>&lt;&lt;</code> 或使用 <code>+</code>，結果是一個安全字串。不安全的引數被轉義：</p><div class="code_container">
<pre><code class="highlight plaintext">"".html_safe + "&lt;" # =&gt; "&amp;lt;"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"".html_safe + "&lt;" # =&gt; "&amp;lt;"
'>Copy</button>
</div>
<p>直接附加安全引數：</p><div class="code_container">
<pre><code class="highlight plaintext">"".html_safe + "&lt;".html_safe # =&gt; "&lt;"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"".html_safe + "&lt;".html_safe # =&gt; "&lt;"
'>Copy</button>
</div>
<p>這些方法不應該用在普通的Views 中。不安全的值會自動轉義：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="vi">@reView</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# fine, escaped if needed %&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= @reView.title %&gt; &lt;%# fine, escaped if needed %&gt;
">Copy</button>
</div>
<p>要逐字插入內容，請使用 [<code>raw</code>][] Helper 而不是呼叫 <code>html_safe</code>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">raw</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# inserts @cms.current_template as is %&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%= raw @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
">Copy</button>
</div>
<p>或者，等效地，使用 <code>&lt;%==</code>：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span><span class="o">=</span> <span class="vi">@cms</span><span class="p">.</span><span class="nf">current_template</span> <span class="cp">%&gt;</span> <span class="c">&lt;%# inserts @cms.current_template as is %&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;%== @cms.current_template %&gt; &lt;%# inserts @cms.current_template as is %&gt;
">Copy</button>
</div>
<p><code>raw</code> Helper 為你呼叫 <code>html_safe</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">def raw(stringish)
  stringish.to_s.html_safe
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="def raw(stringish)
  stringish.to_s.html_safe
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/output_safety.rb</code> 中定義。</p><p>[<code>raw</code>]：<a href="https://api.Rubyonrails.org/classes/actionview/helpers/outputsafetyhelper.html#method-i-raw">https://api.Rubyonrails.org/classes/actionview/helpers/outputsafetyhelper.html#method-i-raw</a>
[string#html_safe]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-html_safe">https://api.Rubyonrails.org/classes/string.html#method-i-html_safe</a></p><h5 id=""><a class="anchorlink" href="#">5.1.3 變換</a></h5><p>根據經驗，除了上面解釋的連線之外，任何可能改變字串的方法都會給你一個不安全的字串。它們是 <code>downcase</code>、<code>gsub</code>、<code>strip</code>、<code>chomp</code>、<code>underscore</code> 等。</p><p>在像 <code>gsub!</code> 這樣的就地轉換的情況下，接收器本身變得不安全。</p><p>資訊：無論轉換是否真的改變了某些東西，安全位總是會丟失。</p><h5 id=""><a class="anchorlink" href="#">5.1.4 轉換和強制</a></h5><p>對安全字串呼叫 <code>to_s</code> 返回一個安全字串，但使用 <code>to_str</code> 強制返回一個不安全字串。</p><h5 id="-"><a class="anchorlink" href="#-">5.1.5 複製</a></h5><p>在安全字串上呼叫 <code>dup</code> 或 <code>clone</code> 會產生安全字串。</p><h4 id=""><a class="anchorlink" href="#">5.2 <code>移除</code></a></h4><p>方法 [<code>remove</code>][String#remove] 將刪除所有出現的模式：</p><div class="code_container">
<pre><code class="highlight plaintext">"Hello World".remove(/Hello /) # =&gt; "World"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Hello World".remove(/Hello /) # =&gt; "World"
'>Copy</button>
</div>
<p>還有破壞性版本<code>String#remove!</code>。</p><p>注意：在<code>active_support/core_ext/string/filters.rb</code> 中定義。</p><p>[string#remove]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-remove">https://api.Rubyonrails.org/classes/string.html#method-i-remove</a></p><h4 id=""><a class="anchorlink" href="#">5.3 <code>擠壓</code></a></h4><p>方法 [<code>squish</code>][String#squish] 去除前導和尾隨空格，並用一個空格替換一行空格：</p><div class="code_container">
<pre><code class="highlight plaintext">" \n  foo\n\r \t bar \n".squish # =&gt; "foo bar"
</code></pre>
<button class="clipboard-button" data-clipboard-text='" \n  foo\n\r \t bar \n".squish # =&gt; "foo bar"
'>Copy</button>
</div>
<p>還有破壞性版本<code>String#squish!</code>。</p><p>請注意，它同時處理 ASCII 和 Unicode 空格。</p><p>注意：在<code>active_support/core_ext/string/filters.rb</code> 中定義。</p><p>[string#squish]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-squish">https://api.Rubyonrails.org/classes/string.html#method-i-squish</a></p><h4 id=""><a class="anchorlink" href="#">5.4 <code>截斷</code></a></h4><p>方法 [<code>truncate</code>][String#truncate] 返回在給定的 <code>length</code> 之後截斷的接收者的副本：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate(20)
# =&gt; "Oh dear! Oh dear!..."
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate(20)
# =&gt; "Oh dear! Oh dear!..."
'>Copy</button>
</div>
<p>省略號可以使用 <code>:omission</code> 選項進行自定義：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate(20, omission: '&amp;hellip;')
# =&gt; "Oh dear! Oh &amp;hellip;"
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(20, omission: '&amp;hellip;')
# =&gt; &quot;Oh dear! Oh &amp;hellip;&quot;
">Copy</button>
</div>
<p>請特別注意，截斷考慮了省略字串的長度。</p><p>傳遞一個 <code>:separator</code> 以在自然中斷處截斷字串：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate(18)
# =&gt; "Oh dear! Oh dea..."
"Oh dear! Oh dear! I shall be late!".truncate(18, separator: ' ')
# =&gt; "Oh dear! Oh..."
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(18)
# =&gt; &quot;Oh dear! Oh dea...&quot;
&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate(18, separator: ' ')
# =&gt; &quot;Oh dear! Oh...&quot;
">Copy</button>
</div>
<p>選項<code>:separator</code> 可以是一個正則表示式：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate(18, separator: /\s/)
# =&gt; "Oh dear! Oh..."
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate(18, separator: /\s/)
# =&gt; "Oh dear! Oh..."
'>Copy</button>
</div>
<p>在上面的例子中，“親愛的”首先被切斷，但隨後<code>:separator</code> 阻止了它。</p><p>注意：在<code>active_support/core_ext/string/filters.rb</code> 中定義。</p><p>[string#truncate]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-truncate">https://api.Rubyonrails.org/classes/string.html#method-i-truncate</a></p><h4 id="truncate-bytes"><a class="anchorlink" href="#truncate-bytes">5.5 <code>truncate_bytes</code></a></h4><p>方法 [<code>truncate_bytes</code>][String#truncate_bytes] 返回其接收者的副本，最多被截斷為 <code>bytesize</code> 位元組：</p><div class="code_container">
<pre><code class="highlight plaintext">"👍👍👍👍".truncate_bytes(15)
# =&gt; "👍👍👍…"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"👍👍👍👍".truncate_bytes(15)
# =&gt; "👍👍👍…"
'>Copy</button>
</div>
<p>省略號可以使用 <code>:omission</code> 選項進行自定義：</p><div class="code_container">
<pre><code class="highlight plaintext">"👍👍👍👍".truncate_bytes(15, omission: "🖖")
# =&gt; "👍👍🖖"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"👍👍👍👍".truncate_bytes(15, omission: "🖖")
# =&gt; "👍👍🖖"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/filters.rb</code> 中定義。</p><p>[string#truncate_bytes]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-truncate_bytes">https://api.Rubyonrails.org/classes/string.html#method-i-truncate_bytes</a></p><h4 id="truncate-words"><a class="anchorlink" href="#truncate-words">5.6 <code>truncate_words</code></a></h4><p>方法 [<code>truncate_words</code>][String#truncate_words] 返回在給定單詞數後截斷的接收者副本：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate_words(4)
# =&gt; "Oh dear! Oh dear!..."
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate_words(4)
# =&gt; "Oh dear! Oh dear!..."
'>Copy</button>
</div>
<p>省略號可以使用 <code>:omission</code> 選項進行自定義：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate_words(4, omission: '&amp;hellip;')
# =&gt; "Oh dear! Oh dear!&amp;hellip;"
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate_words(4, omission: '&amp;hellip;')
# =&gt; &quot;Oh dear! Oh dear!&amp;hellip;&quot;
">Copy</button>
</div>
<p>傳遞一個 <code>:separator</code> 以在自然中斷處截斷字串：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate_words(3, separator: '!')
# =&gt; "Oh dear! Oh dear! I shall be late..."
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;Oh dear! Oh dear! I shall be late!&quot;.truncate_words(3, separator: '!')
# =&gt; &quot;Oh dear! Oh dear! I shall be late...&quot;
">Copy</button>
</div>
<p>選項<code>:separator</code> 可以是一個正則表示式：</p><div class="code_container">
<pre><code class="highlight plaintext">"Oh dear! Oh dear! I shall be late!".truncate_words(4, separator: /\s/)
# =&gt; "Oh dear! Oh dear!..."
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Oh dear! Oh dear! I shall be late!".truncate_words(4, separator: /\s/)
# =&gt; "Oh dear! Oh dear!..."
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/filters.rb</code> 中定義。</p><p>[string#truncate_words]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-truncate_words">https://api.Rubyonrails.org/classes/string.html#method-i-truncate_words</a></p><h4 id=""><a class="anchorlink" href="#">5.7 <code>詢價</code></a></h4><p>[<code>inquiry</code>][String#inquiry] 方法將字串轉換為 <code>StringInquirer</code> 物件，使相等性檢查更漂亮。</p><div class="code_container">
<pre><code class="highlight plaintext">"production".inquiry.production? # =&gt; true
"active".inquiry.inactive?       # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text='"production".inquiry.production? # =&gt; true
"active".inquiry.inactive?       # =&gt; false
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inquiry.rb</code> 中定義。</p><p>[string#inquiry]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-inquiry">https://api.Rubyonrails.org/classes/string.html#method-i-inquiry</a></p><h4 id="string-starts-with-questionmark-ends-with-questionmark"><a class="anchorlink" href="#string-starts-with-questionmark-ends-with-questionmark">5.8 <code>starts_with?</code> 和 <code>ends_with?</code></a></h4><p>Active Support 定義了 <code>string#start_with?</code> 和 <code>string#end_with?</code> 的第三人稱別名：</p><div class="code_container">
<pre><code class="highlight plaintext">"foo".starts_with?("f") # =&gt; true
"foo".ends_with?("o")   # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo".starts_with?("f") # =&gt; true
"foo".ends_with?("o")   # =&gt; true
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/starts_ends_with.rb</code> 中定義。</p><h4 id="strip-heredoc"><a class="anchorlink" href="#strip-heredoc">5.9 <code>strip_heredoc</code></a></h4><p>方法 [<code>strip_heredoc</code>][String#strip_heredoc] 去除了heredocs 中的縮排。</p><p>例如在</p><div class="code_container">
<pre><code class="highlight plaintext">if options[:usage]
  puts &lt;&lt;-USAGE.strip_heredoc
    This command does such and such.

    Supported options are:
      -h         This message
      ...
  USAGE
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="if options[:usage]
  puts &lt;&lt;-USAGE.strip_heredoc
    This command does such and such.

    Supported options are:
      -h         This message
      ...
  USAGE
end
">Copy</button>
</div>
<p>使用者將看到與左邊距對齊的使用訊息。</p><p>從技術上講，它查詢整個字串中縮排最少的行，並刪除
大量的領先空白。</p><p>注意：在<code>active_support/core_ext/string/strip.rb</code> 中定義。</p><p>[string#strip_heredoc]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-strip_heredoc">https://api.Rubyonrails.org/classes/string.html#method-i-strip_heredoc</a></p><h4 id=""><a class="anchorlink" href="#">5.10 <code>縮排</code></a></h4><p>[<code>indent</code>][String#indent] 方法縮排接收器中的行：</p><div class="code_container">
<pre><code class="highlight plaintext">&lt;&lt;EOS.indent(2)
def some_method
  some_code
end
EOS
# =&gt;
  def some_method
    some_code
  end
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;&lt;EOS.indent(2)
def some_method
  some_code
end
EOS
# =&gt;
  def some_method
    some_code
  end
">Copy</button>
</div>
<p>第二個引數 <code>indent_string</code> 指定要使用的縮排字串。預設值為 <code>nil</code>，它告訴方法在第一個縮排行進行有根據的猜測，如果沒有，則回退到一個空格。</p><div class="code_container">
<pre><code class="highlight plaintext">"  foo".indent(2)        # =&gt; "    foo"
"foo\n\t\tbar".indent(2) # =&gt; "\t\tfoo\n\t\t\t\tbar"
"foo".indent(2, "\t")    # =&gt; "\t\tfoo"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"  foo".indent(2)        # =&gt; "    foo"
"foo\n\t\tbar".indent(2) # =&gt; "\t\tfoo\n\t\t\t\tbar"
"foo".indent(2, "\t")    # =&gt; "\t\tfoo"
'>Copy</button>
</div>
<p>雖然 <code>indent_string</code> 通常是一個空格或製表符，但它可以是任何字串。</p><p>第三個引數 <code>indent_empty_lines</code> 是一個標誌，表示是否應該縮排空行。預設為假。</p><div class="code_container">
<pre><code class="highlight plaintext">"foo\n\nbar".indent(2)            # =&gt; "  foo\n\n  bar"
"foo\n\nbar".indent(2, nil, true) # =&gt; "  foo\n  \n  bar"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"foo\n\nbar".indent(2)            # =&gt; "  foo\n\n  bar"
"foo\n\nbar".indent(2, nil, true) # =&gt; "  foo\n  \n  bar"
'>Copy</button>
</div>
<p>[<code>indent!</code>][String#indent!] 方法執行就地縮排。</p><p>注意：在<code>active_support/core_ext/string/indent.rb</code> 中定義。</p><p>[string#indent!]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-indent-21">https://api.Rubyonrails.org/classes/string.html#method-i-indent-21</a>
[string#indent]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-indent">https://api.Rubyonrails.org/classes/string.html#method-i-indent</a></p><h4 id="string-"><a class="anchorlink" href="#string-">5.11 訪問</a></h4><h5 id=""><a class="anchorlink" href="#">5.11.1 <code>在（位置）</code></a></h5><p>[<code>at</code>][String#at] 方法返回字串在位置 <code>position</code> 處的字元：</p><div class="code_container">
<pre><code class="highlight plaintext">"hello".at(0)  # =&gt; "h"
"hello".at(4)  # =&gt; "o"
"hello".at(-1) # =&gt; "o"
"hello".at(10) # =&gt; nil
</code></pre>
<button class="clipboard-button" data-clipboard-text='"hello".at(0)  # =&gt; "h"
"hello".at(4)  # =&gt; "o"
"hello".at(-1) # =&gt; "o"
"hello".at(10) # =&gt; nil
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/access.rb</code> 中定義。</p><p>[string#at]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-at">https://api.Rubyonrails.org/classes/string.html#method-i-at</a></p><h5 id=""><a class="anchorlink" href="#">5.11.2 <code>來自（位置）</code></a></h5><p>[<code>from</code>][String#from] 方法返回從位置 <code>position</code> 開始的字串的子字串：</p><div class="code_container">
<pre><code class="highlight plaintext">"hello".from(0)  # =&gt; "hello"
"hello".from(2)  # =&gt; "llo"
"hello".from(-2) # =&gt; "lo"
"hello".from(10) # =&gt; nil
</code></pre>
<button class="clipboard-button" data-clipboard-text='"hello".from(0)  # =&gt; "hello"
"hello".from(2)  # =&gt; "llo"
"hello".from(-2) # =&gt; "lo"
"hello".from(10) # =&gt; nil
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/access.rb</code> 中定義。</p><p>[string#from]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-from">https://api.Rubyonrails.org/classes/string.html#method-i-from</a></p><h5 id=""><a class="anchorlink" href="#">5.11.3 <code>到（位置）</code></a></h5><p>[<code>to</code>][String#to] 方法返回字串的子串直到位置 <code>position</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">"hello".to(0)  # =&gt; "h"
"hello".to(2)  # =&gt; "hel"
"hello".to(-2) # =&gt; "hell"
"hello".to(10) # =&gt; "hello"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"hello".to(0)  # =&gt; "h"
"hello".to(2)  # =&gt; "hel"
"hello".to(-2) # =&gt; "hell"
"hello".to(10) # =&gt; "hello"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/access.rb</code> 中定義。</p><p>[string#to]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-to">https://api.Rubyonrails.org/classes/string.html#method-i-to</a></p><h5 id="1"><a class="anchorlink" href="#1">5.11.4 <code>第一個（限制= 1）</code></a></h5><p>[<code>first</code>][String#first] 方法返回一個包含字串的第一個 <code>limit</code> 字元的子字串。</p><p>如果<code>n</code> &gt; 0，則呼叫<code>str.first(n)</code> 等價於<code>str.to(n-1)</code>，並在<code>n</code> == 0 時返回一個空字串。</p><p>注意：在<code>active_support/core_ext/string/access.rb</code> 中定義。</p><p>[string#first]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-first">https://api.Rubyonrails.org/classes/string.html#method-i-first</a></p><h5 id="last-limit-1"><a class="anchorlink" href="#last-limit-1">5.11.5 <code>last(limit = 1)</code></a></h5><p>[<code>last</code>][String#last] 方法返回一個包含字串的最後一個 <code>limit</code> 字元的子字串。</p><p>如果<code>n</code> &gt; 0，則呼叫<code>str.last(n)</code> 等價於<code>str.from(-n)</code>，並在<code>n</code> == 0 時返回一個空字串。</p><p>注意：在<code>active_support/core_ext/string/access.rb</code> 中定義。</p><p>[string#last]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-last">https://api.Rubyonrails.org/classes/string.html#method-i-last</a></p><h4 id=""><a class="anchorlink" href="#">5.12 曲折</a></h4><h5 id=""><a class="anchorlink" href="#">5.12.1 <code>複數化</code></a></h5><p>方法 [<code>pluralize</code>][String#pluralize] 返回其接收者的複數：</p><div class="code_container">
<pre><code class="highlight plaintext">"table".pluralize     # =&gt; "tables"
"Ruby".pluralize      # =&gt; "rubies"
"equipment".pluralize # =&gt; "equipment"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"table".pluralize     # =&gt; "tables"
"Ruby".pluralize      # =&gt; "rubies"
"equipment".pluralize # =&gt; "equipment"
'>Copy</button>
</div>
<p>如上例所示，Active Support 知道一些不規則複數和不可數名詞。內建規則可以在 <code>config/initializers/inflections.rb</code> 中擴充套件。預設情況下，此檔案由 <code>rails new</code> 命令生成，並在註釋中包含說明。</p><p><code>pluralize</code> 也可以採用可選的 <code>count</code> 引數。如果 <code>count == 1</code> 將返回單數形式。對於 <code>count</code> 的任何其他值，將返回複數形式：</p><div class="code_container">
<pre><code class="highlight plaintext">"dude".pluralize(0) # =&gt; "dudes"
"dude".pluralize(1) # =&gt; "dude"
"dude".pluralize(2) # =&gt; "dudes"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"dude".pluralize(0) # =&gt; "dudes"
"dude".pluralize(1) # =&gt; "dude"
"dude".pluralize(2) # =&gt; "dudes"
'>Copy</button>
</div>
<p>active record 使用此方法計算對應於 Model 的預設表名：</p><div class="code_container">
<pre><code class="highlight plaintext"># active_record/Model_schema.rb
def undecorated_table_name(Model_name)
  table_name = Model_name.to_s.demodulize.underscore
  pluralize_table_names ? table_name.pluralize : table_name
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_record/Model_schema.rb
def undecorated_table_name(Model_name)
  table_name = Model_name.to_s.demodulize.underscore
  pluralize_table_names ? table_name.pluralize : table_name
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#pluralize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-pluralize">https://api.Rubyonrails.org/classes/string.html#method-i-pluralize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.2 <code>單一化</code></a></h5><p>[<code>singularize</code>][String#singularize] 方法是 <code>pluralize</code> 的逆方法：</p><div class="code_container">
<pre><code class="highlight plaintext">"tables".singularize    # =&gt; "table"
"rubies".singularize    # =&gt; "Ruby"
"equipment".singularize # =&gt; "equipment"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"tables".singularize    # =&gt; "table"
"rubies".singularize    # =&gt; "Ruby"
"equipment".singularize # =&gt; "equipment"
'>Copy</button>
</div>
<p>Associations 使用此方法計算相應預設關聯類的名稱：</p><div class="code_container">
<pre><code class="highlight plaintext"># active_record/reflection.rb
def derive_class_name
  class_name = name.to_s.camelize
  class_name = class_name.singularize if collection?
  class_name
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_record/reflection.rb
def derive_class_name
  class_name = name.to_s.camelize
  class_name = class_name.singularize if collection?
  class_name
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#singularize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-singularize">https://api.Rubyonrails.org/classes/string.html#method-i-singularize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.3 <code>駱駝化</code></a></h5><p>方法 [<code>camelize</code>][String#camelize] 以駝峰形式返回其接收器：</p><div class="code_container">
<pre><code class="highlight plaintext">"product".camelize    # =&gt; "Product"
"admin_user".camelize # =&gt; "AdminUser"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"product".camelize    # =&gt; "Product"
"admin_user".camelize # =&gt; "AdminUser"
'>Copy</button>
</div>
<p>根據經驗，您可以將此方法視為將路徑轉換為 ​​Ruby 類或模組名稱的方法，其中斜線分隔名稱空間：</p><div class="code_container">
<pre><code class="highlight plaintext">"backoffice/Session".camelize # =&gt; "backoffice::Session"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"backoffice/Session".camelize # =&gt; "backoffice::Session"
'>Copy</button>
</div>
<p>例如，action pack 使用此方法載入提供某個Session 儲存的類：</p><div class="code_container">
<pre><code class="highlight plaintext"># action_controller/metal/Session_management.rb
def Session_store=(store)
  @@session_store = store.is_a?(Symbol) ?
    actiondispatch::Session.const_get(store.to_s.camelize) :
    store
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="# action_controller/metal/Session_management.rb
def Session_store=(store)
  @@session_store = store.is_a?(Symbol) ?
    actiondispatch::Session.const_get(store.to_s.camelize) :
    store
end
">Copy</button>
</div>
<p><code>camelize</code> 接受一個可選引數，它可以是 <code>:upper</code>（預設）或 <code>:lower</code>。對於後者，第一個字母變為小寫：</p><div class="code_container">
<pre><code class="highlight plaintext">"visual_effect".camelize(:lower) # =&gt; "visualEffect"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"visual_effect".camelize(:lower) # =&gt; "visualEffect"
'>Copy</button>
</div>
<p>這對於以遵循該約定的語言（例如 JavaScript）計算方法名稱可能很方便。</p><p>資訊：根據經驗，您可以將 <code>camelize</code> 視為 <code>underscore</code> 的倒數，儘管有些情況下不成立：<code>"sslerror".underscore.camelize</code> 返回 <code>"sslerror"</code>。為了支援這種情況，Active Support 允許您在 <code>config/initializers/inflections.rb</code> 中指定首字母縮略詞：</p><div class="code_container">
<pre><code class="highlight plaintext">ActiveSupport::Inflector.inflections do |inflect|
  inflect.acronym 'SSL'
end

"SSLError".underscore.camelize # =&gt; "SSLError"
</code></pre>
<button class="clipboard-button" data-clipboard-text="ActiveSupport::Inflector.inflections do |inflect|
  inflect.acronym 'SSL'
end

&quot;SSLError&quot;.underscore.camelize # =&gt; &quot;SSLError&quot;
">Copy</button>
</div>
<p><code>camelize</code> 別名為 [<code>camelcase</code>][String#camelcase]。</p><p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#camelcase]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-camelcase">https://api.Rubyonrails.org/classes/string.html#method-i-camelcase</a>
[string#camelize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-camelize">https://api.Rubyonrails.org/classes/string.html#method-i-camelize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.4 <code>下劃線</code></a></h5><p>方法 [<code>underscore</code>][String#underscore] 反過來，從駝峰案例到路徑：</p><div class="code_container">
<pre><code class="highlight plaintext">"Product".underscore   # =&gt; "product"
"AdminUser".underscore # =&gt; "admin_user"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Product".underscore   # =&gt; "product"
"AdminUser".underscore # =&gt; "admin_user"
'>Copy</button>
</div>
<p>還將 "::" 轉換回 "/"：</p><div class="code_container">
<pre><code class="highlight plaintext">"backoffice::Session".underscore # =&gt; "backoffice/Session"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"backoffice::Session".underscore # =&gt; "backoffice/Session"
'>Copy</button>
</div>
<p>並理解以小寫字母開頭的字串：</p><div class="code_container">
<pre><code class="highlight plaintext">"visualEffect".underscore # =&gt; "visual_effect"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"visualEffect".underscore # =&gt; "visual_effect"
'>Copy</button>
</div>
<p><code>underscore</code> 不接受任何引數。</p><p>rails 使用 <code>underscore</code> 來獲取 Controller 類的小寫名稱：</p><div class="code_container">
<pre><code class="highlight plaintext"># actionpack/lib/abstract_Controller/base.rb
def Controller_path
  @Controller_path ||= name.delete_suffix("Controller").underscore
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='# actionpack/lib/abstract_Controller/base.rb
def Controller_path
  @Controller_path ||= name.delete_suffix("Controller").underscore
end
'>Copy</button>
</div>
<p>例如，該值是您在 <code>params[:Controller]</code> 中獲得的值。</p><p>資訊：根據經驗，您可以將“下劃線”視為“駱駝化”的反義詞，但在某些情況下並不成立。例如，<code>"SSLError".underscore.camelize</code> 返回 <code>"SslError"</code>。</p><p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#underscore]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-underscore">https://api.Rubyonrails.org/classes/string.html#method-i-underscore</a></p><h5 id=""><a class="anchorlink" href="#">5.12.5 <code>標題化</code></a></h5><p>[<code>titleize</code>][String#titleize] 方法將接收器中的單詞大寫：</p><div class="code_container">
<pre><code class="highlight plaintext">"alice in wonderland".titleize # =&gt; "Alice In Wonderland"
"fermat's enigma".titleize     # =&gt; "Fermat's Enigma"
</code></pre>
<button class="clipboard-button" data-clipboard-text="&quot;alice in wonderland&quot;.titleize # =&gt; &quot;Alice In Wonderland&quot;
&quot;fermat's enigma&quot;.titleize     # =&gt; &quot;Fermat's Enigma&quot;
">Copy</button>
</div>
<p><code>titleize</code> 別名為 [<code>titlecase</code>][String#titlecase]。</p><p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#titlecase]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-titlecase">https://api.Rubyonrails.org/classes/string.html#method-i-titlecase</a>
[string#titleize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-titleize">https://api.Rubyonrails.org/classes/string.html#method-i-titleize</a></p><h5 id="dasherize"><a class="anchorlink" href="#dasherize">5.12.6 <code>dasherize</code></a></h5><p>方法 [<code>dasherize</code>][String#dasherize] 用破折號替換接收器中的下劃線：</p><div class="code_container">
<pre><code class="highlight plaintext">"name".dasherize         # =&gt; "name"
"contact_data".dasherize # =&gt; "contact-data"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"name".dasherize         # =&gt; "name"
"contact_data".dasherize # =&gt; "contact-data"
'>Copy</button>
</div>
<p>Models 的 xml 序列化程式使用此方法對節點名稱進行 dasherize：</p><div class="code_container">
<pre><code class="highlight plaintext"># active_Model/serializers/xml.rb
def reformat_name(name)
  name = name.camelize if camelize?
  dasherize? ? name.dasherize : name
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_Model/serializers/xml.rb
def reformat_name(name)
  name = name.camelize if camelize?
  dasherize? ? name.dasherize : name
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#dasherize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-dasherize">https://api.Rubyonrails.org/classes/string.html#method-i-dasherize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.7 <code>解調</code></a></h5><p>給定一個帶有限定常量名的字串，[<code>demodulize</code>][String#demodulize] 返回常量名，即最右邊的部分：</p><div class="code_container">
<pre><code class="highlight plaintext">"Product".demodulize                        # =&gt; "Product"
"backoffice::usersController".demodulize    # =&gt; "usersController"
"Admin::Hotel::ReservationUtils".demodulize # =&gt; "ReservationUtils"
"::Inflections".demodulize                  # =&gt; "Inflections"
"".demodulize                               # =&gt; ""
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Product".demodulize                        # =&gt; "Product"
"backoffice::usersController".demodulize    # =&gt; "usersController"
"Admin::Hotel::ReservationUtils".demodulize # =&gt; "ReservationUtils"
"::Inflections".demodulize                  # =&gt; "Inflections"
"".demodulize                               # =&gt; ""
'>Copy</button>
</div>
<p>例如Active Record 使用此方法計算計數器快取列的名稱：</p><div class="code_container">
<pre><code class="highlight plaintext"># active_record/reflection.rb
def counter_cache_column
  if options[:counter_cache] == true
    "#{active_record.name.demodulize.underscore.pluralize}_count"
  elsif options[:counter_cache]
    options[:counter_cache]
  end
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='# active_record/reflection.rb
def counter_cache_column
  if options[:counter_cache] == true
    "#{active_record.name.demodulize.underscore.pluralize}_count"
  elsif options[:counter_cache]
    options[:counter_cache]
  end
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#demodulize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-demodulize">https://api.Rubyonrails.org/classes/string.html#method-i-demodulize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.8 <code>解常量</code></a></h5><p>給定一個帶有限定常量引用表示式的字串，[<code>deconstantize</code>][String#deconstantize] 刪除最右邊的部分，通常留下常量容器的名稱：</p><div class="code_container">
<pre><code class="highlight plaintext">"Product".deconstantize                        # =&gt; ""
"backoffice::usersController".deconstantize    # =&gt; "backoffice"
"Admin::Hotel::ReservationUtils".deconstantize # =&gt; "Admin::Hotel"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Product".deconstantize                        # =&gt; ""
"backoffice::usersController".deconstantize    # =&gt; "backoffice"
"Admin::Hotel::ReservationUtils".deconstantize # =&gt; "Admin::Hotel"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#deconstantize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-deconstantize">https://api.Rubyonrails.org/classes/string.html#method-i-deconstantize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.9 <code>引數化</code></a></h5><p>方法 [<code>parameterize</code>][String#parameterize] 以一種可用於漂亮 URL 的方式標準化其接收器。</p><div class="code_container">
<pre><code class="highlight plaintext">"John Smith".parameterize # =&gt; "john-smith"
"Kurt Gödel".parameterize # =&gt; "kurt-godel"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"John Smith".parameterize # =&gt; "john-smith"
"Kurt Gödel".parameterize # =&gt; "kurt-godel"
'>Copy</button>
</div>
<p>要保留字串的大小寫，請將 <code>preserve_case</code> 引數設定為 true。預設情況下，<code>preserve_case</code> 設定為 false。</p><div class="code_container">
<pre><code class="highlight plaintext">"John Smith".parameterize(preserve_case: true) # =&gt; "John-Smith"
"Kurt Gödel".parameterize(preserve_case: true) # =&gt; "Kurt-Godel"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"John Smith".parameterize(preserve_case: true) # =&gt; "John-Smith"
"Kurt Gödel".parameterize(preserve_case: true) # =&gt; "Kurt-Godel"
'>Copy</button>
</div>
<p>要使用自定義分隔符，請覆蓋 <code>separator</code> 引數。</p><div class="code_container">
<pre><code class="highlight plaintext">"John Smith".parameterize(separator: "_") # =&gt; "john\_smith"
"Kurt Gödel".parameterize(separator: "_") # =&gt; "kurt\_godel"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"John Smith".parameterize(separator: "_") # =&gt; "john\_smith"
"Kurt Gödel".parameterize(separator: "_") # =&gt; "kurt\_godel"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#parameterize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-parameterize">https://api.Rubyonrails.org/classes/string.html#method-i-parameterize</a></p><h5 id="tableize"><a class="anchorlink" href="#tableize">5.12.10 <code>tableize</code></a></h5><p>方法 [<code>tableize</code>][String#tableize] 是 <code>underscore</code> 後跟 <code>pluralize</code>。</p><div class="code_container">
<pre><code class="highlight plaintext">"Person".tableize      # =&gt; "people"
"Invoice".tableize     # =&gt; "invoices"
"InvoiceLine".tableize # =&gt; "invoice_lines"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Person".tableize      # =&gt; "people"
"Invoice".tableize     # =&gt; "invoices"
"InvoiceLine".tableize # =&gt; "invoice_lines"
'>Copy</button>
</div>
<p>根據經驗，<code>tableize</code> 返回與給定Model 對應的表名，用於簡單情況。 active record 中的實際實現確實不是直接的<code>tableize</code>，因為它還解調了類名並檢查了一些可能影響返回字串的選項。</p><p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#tableize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-tableize">https://api.Rubyonrails.org/classes/string.html#method-i-tableize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.11 <code>分類</code></a></h5><p>方法 [<code>classify</code>][String#classify] 是 <code>tableize</code> 的反函式。它為您提供與表名對應的類名：</p><div class="code_container">
<pre><code class="highlight plaintext">"people".classify        # =&gt; "Person"
"invoices".classify      # =&gt; "Invoice"
"invoice_lines".classify # =&gt; "InvoiceLine"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"people".classify        # =&gt; "Person"
"invoices".classify      # =&gt; "Invoice"
"invoice_lines".classify # =&gt; "InvoiceLine"
'>Copy</button>
</div>
<p>該方法理解限定的表名：</p><div class="code_container">
<pre><code class="highlight plaintext">"highrise_production.companies".classify # =&gt; "Company"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"highrise_production.companies".classify # =&gt; "Company"
'>Copy</button>
</div>
<p>請注意，<code>classify</code> 將類名作為字串返回。你可以透過呼叫 <code>constantize</code> 來獲取實際的類物件，接下來解釋。</p><p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#classify]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-classify">https://api.Rubyonrails.org/classes/string.html#method-i-classify</a></p><h5 id=""><a class="anchorlink" href="#">5.12.12 <code>常量化</code></a></h5><p>方法 [<code>constantize</code>][String#constantize] 解析其接收器中的常量引用表示式：</p><div class="code_container">
<pre><code class="highlight plaintext">"Integer".constantize # =&gt; Integer

module M
  X = 1
end
"M::X".constantize # =&gt; 1
</code></pre>
<button class="clipboard-button" data-clipboard-text='"Integer".constantize # =&gt; Integer

module M
  X = 1
end
"M::X".constantize # =&gt; 1
'>Copy</button>
</div>
<p>如果字串評估為沒有已知常量，或者它的內容甚至不是一個有效的常量名稱，<code>constantize</code> 會引發 <code>NameError</code>。</p><p><code>constantize</code> 的常量名稱解析總是從頂級 <code>Object</code> 開始，即使沒有前導“::”。</p><div class="code_container">
<pre><code class="highlight plaintext">X = :in_Object
module M
  X = :in_M

  X                 # =&gt; :in_M
  "::X".constantize # =&gt; :in_Object
  "X".constantize   # =&gt; :in_Object (!)
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='X = :in_Object
module M
  X = :in_M

  X                 # =&gt; :in_M
  "::X".constantize # =&gt; :in_Object
  "X".constantize   # =&gt; :in_Object (!)
end
'>Copy</button>
</div>
<p>所以，它通常不等同於Ruby 在同一地點所做的，有一個真正的常數被評估。</p><p>郵件程式測試用例使用 <code>constantize</code> 從測試類的名稱中獲取被測試的郵件程式：</p><div class="code_container">
<pre><code class="highlight plaintext"># Action_mailer/test_case.rb
def determine_default_mailer(name)
  name.delete_suffix("Test").constantize
rescue NameError =&gt; e
  raise NonInferrableMailerError.new(name)
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='# Action_mailer/test_case.rb
def determine_default_mailer(name)
  name.delete_suffix("Test").constantize
rescue NameError =&gt; e
  raise NonInferrableMailerError.new(name)
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#constantize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-constantize">https://api.Rubyonrails.org/classes/string.html#method-i-constantize</a></p><h5 id=""><a class="anchorlink" href="#">5.12.13 <code>人性化</code></a></h5><p>方法 [<code>humanize</code>][String#humanize] 調整屬性名稱以顯示給終端使用者。</p><p>具體來說，它執行這些轉換：</p>
<ul>
<li>將人為屈折規則應用於論證。</li>
<li>刪除前導下劃線，如果有的話。</li>
<li>刪除“_id”字尾（如果存在）。</li>
<li>用空格替換下劃線（如果有）。</li>
<li>將除首字母縮略詞以外的所有單詞小寫。</li>
<li>首字母大寫。</li>
</ul>
<p>可以透過設定關閉第一個單詞的大寫
<code>:capitalize</code> 選項設定為 false（預設為 true）。</p><div class="code_container">
<pre><code class="highlight plaintext">"name".humanize                         # =&gt; "Name"
"author_id".humanize                    # =&gt; "Author"
"author_id".humanize(capitalize: false) # =&gt; "author"
"comments_count".humanize               # =&gt; "Comments count"
"_id".humanize                          # =&gt; "Id"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"name".humanize                         # =&gt; "Name"
"author_id".humanize                    # =&gt; "Author"
"author_id".humanize(capitalize: false) # =&gt; "author"
"comments_count".humanize               # =&gt; "Comments count"
"_id".humanize                          # =&gt; "Id"
'>Copy</button>
</div>
<p>如果將“SSL”定義為首字母縮寫詞：</p><div class="code_container">
<pre><code class="highlight plaintext">'ssl_error'.humanize # =&gt; "SSL error"
</code></pre>
<button class="clipboard-button" data-clipboard-text="'ssl_error'.humanize # =&gt; &quot;SSL error&quot;
">Copy</button>
</div>
<p>Helper 方法 <code>full_messages</code> 使用 <code>humanize</code> 作為後備以包含
屬性名稱：</p><div class="code_container">
<pre><code class="highlight plaintext">def full_messages
  map { |attribute, message| full_message(attribute, message) }
end

def full_message
  # ...
  attr_name = attribute.to_s.tr('.', '_').humanize
  attr_name = @base.class.human_attribute_name(attribute, default: attr_name)
  # ...
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="def full_messages
  map { |attribute, message| full_message(attribute, message) }
end

def full_message
  # ...
  attr_name = attribute.to_s.tr('.', '_').humanize
  attr_name = @base.class.human_attribute_name(attribute, default: attr_name)
  # ...
end
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#humanize]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-humanize">https://api.Rubyonrails.org/classes/string.html#method-i-humanize</a></p><h5 id="foreign-key"><a class="anchorlink" href="#foreign-key">5.12.14 <code>foreign_key</code></a></h5><p>方法 [<code>foreign_key</code>][String#foreign_key] 從類名中給出外來鍵列名。為此，它會解調、下劃線並新增“_id”：</p><div class="code_container">
<pre><code class="highlight plaintext">"User".foreign_key           # =&gt; "user_id"
"InvoiceLine".foreign_key    # =&gt; "invoice_line_id"
"admin::Session".foreign_key # =&gt; "Session_id"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"User".foreign_key           # =&gt; "user_id"
"InvoiceLine".foreign_key    # =&gt; "invoice_line_id"
"admin::Session".foreign_key # =&gt; "Session_id"
'>Copy</button>
</div>
<p>如果您不想在“_id”中使用下劃線，則傳遞一個錯誤引數：</p><div class="code_container">
<pre><code class="highlight plaintext">"User".foreign_key(false) # =&gt; "userid"
</code></pre>
<button class="clipboard-button" data-clipboard-text='"User".foreign_key(false) # =&gt; "userid"
'>Copy</button>
</div>
<p>Associations 使用這個方法來推斷外來鍵，例如 <code>has_one</code> 和 <code>has_many</code> 這樣做：</p><div class="code_container">
<pre><code class="highlight plaintext"># active_record/Associations.rb
foreign_key = options[:foreign_key] || reflection.active_record.name.foreign_key
</code></pre>
<button class="clipboard-button" data-clipboard-text="# active_record/Associations.rb
foreign_key = options[:foreign_key] || reflection.active_record.name.foreign_key
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/string/inflections.rb</code> 中定義。</p><p>[string#foreign_key]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-foreign_key">https://api.Rubyonrails.org/classes/string.html#method-i-foreign_key</a></p><h4 id="string-"><a class="anchorlink" href="#string-">5.13 次轉化</a></h4><h5 id="to-date-to-time-to-datetime"><a class="anchorlink" href="#to-date-to-time-to-datetime">5.13.1 <code>to_date</code>、<code>to_time</code>、<code>to_datetime</code></a></h5><p>方法 [<code>to_date</code>][String#to_date]、[<code>to_time</code>][String#to_time] 和 [<code>to_datetime</code>][String#to_datetime] 基本上是圍繞 <code>Date._parse</code> 的便利包裝器：</p><div class="code_container">
<pre><code class="highlight plaintext">"2010-07-27".to_date              # =&gt; Tue, 27 Jul 2010
"2010-07-27 23:37:00".to_time     # =&gt; 2010-07-27 23:37:00 +0200
"2010-07-27 23:37:00".to_datetime # =&gt; Tue, 27 Jul 2010 23:37:00 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text='"2010-07-27".to_date              # =&gt; Tue, 27 Jul 2010
"2010-07-27 23:37:00".to_time     # =&gt; 2010-07-27 23:37:00 +0200
"2010-07-27 23:37:00".to_datetime # =&gt; Tue, 27 Jul 2010 23:37:00 +0000
'>Copy</button>
</div>
<p><code>to_time</code> 接收一個可選引數 <code>:utc</code> 或 <code>:local</code>，以指示您想要的時間在哪個時區：</p><div class="code_container">
<pre><code class="highlight plaintext">"2010-07-27 23:42:00".to_time(:utc)   # =&gt; 2010-07-27 23:42:00 UTC
"2010-07-27 23:42:00".to_time(:local) # =&gt; 2010-07-27 23:42:00 +0200
</code></pre>
<button class="clipboard-button" data-clipboard-text='"2010-07-27 23:42:00".to_time(:utc)   # =&gt; 2010-07-27 23:42:00 UTC
"2010-07-27 23:42:00".to_time(:local) # =&gt; 2010-07-27 23:42:00 +0200
'>Copy</button>
</div>
<p>預設是<code>:local</code>。</p><p>更多細節請參考<code>Date._parse</code> 的文件。</p><p>資訊：他們三個為空白接收者返回“nil”。</p><p>注意：在<code>active_support/core_ext/string/conversions.rb</code> 中定義。</p><p>[string#to_date]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-to_date">https://api.Rubyonrails.org/classes/string.html#method-i-to_date</a>
[string#to_datetime]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-to_datetime">https://api.Rubyonrails.org/classes/string.html#method-i-to_datetime</a>
[string#to_time]：<a href="https://api.Rubyonrails.org/classes/string.html#method-i-to_time">https://api.Rubyonrails.org/classes/string.html#method-i-to_time</a></p><h3 id="symbol"><a class="anchorlink" href="#symbol">6 <code>Symbol</code> 的擴充套件</a></h3><h4 id="symbol-starts-with-questionmark-ends-with-questionmark"><a class="anchorlink" href="#symbol-starts-with-questionmark-ends-with-questionmark">6.1 <code>starts_with?</code> 和 <code>ends_with?</code></a></h4><p>active support 定義了 <code>Symbol#start_with?</code> 和 <code>Symbol#end_with?</code> 的第三人稱別名：</p><div class="code_container">
<pre><code class="highlight plaintext">:foo.starts_with?("f") # =&gt; true
:foo.ends_with?("o")   # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text=':foo.starts_with?("f") # =&gt; true
:foo.ends_with?("o")   # =&gt; true
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/Symbol/starts_ends_with.rb</code> 中定義。</p><h3 id="numeric"><a class="anchorlink" href="#numeric">7 <code>Numeric</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">7.1 位元組</a></h4><p>所有數字都響應這些方法：</p>
<ul>
<li>[<code>bytes</code>][Numeric#bytes]</li>
<li>[<code>千位元組</code>][數字#千位元組]</li>
<li>[<code>兆位元組</code>][數字#兆位元組]</li>
<li>[<code>gigabytes</code>][Numeric#gigabytes]</li>
<li>[<code>太位元組</code>][數字#太位元組]</li>
<li>[<code>petabytes</code>][Numeric#petabytes]</li>
<li>[<code>exabytes</code>][數字#exabytes]</li>
</ul>
<p>它們使用 1024 的轉換因子返回相應的位元組數：</p><div class="code_container">
<pre><code class="highlight plaintext">2.kilobytes   # =&gt; 2048
3.megabytes   # =&gt; 3145728
3.5.gigabytes # =&gt; 3758096384
-4.exabytes   # =&gt; -4611686018427387904
</code></pre>
<button class="clipboard-button" data-clipboard-text="2.kilobytes   # =&gt; 2048
3.megabytes   # =&gt; 3145728
3.5.gigabytes # =&gt; 3758096384
-4.exabytes   # =&gt; -4611686018427387904
">Copy</button>
</div>
<p>單數形式具有別名，因此您可以說：</p><div class="code_container">
<pre><code class="highlight plaintext">1.megabyte # =&gt; 1048576
</code></pre>
<button class="clipboard-button" data-clipboard-text="1.megabyte # =&gt; 1048576
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/numeric/bytes.rb</code> 中定義。</p><p>[numeric#bytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-bytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-bytes</a>
[numeric#exabytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-exabytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-exabytes</a>
[numeric#gigabytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-gigabytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-gigabytes</a>
[numeric#kilobytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-kilobytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-kilobytes</a>
[numeric#megabytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-megabytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-megabytes</a>
[numeric#petabytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-petabytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-petabytes</a>
[numeric#terabytes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-terabytes">https://api.Rubyonrails.org/classes/numeric.html#method-i-terabytes</a></p><h4 id="numeric-"><a class="anchorlink" href="#numeric-">7.2 時間</a></h4><p>以下方法：</p>
<ul>
<li>[<code>秒</code>][數字#秒]</li>
<li>[<code>分鐘</code>][數字#分鐘]</li>
<li>[<code>小時</code>][數字#小時]</li>
<li>[<code>days</code>][數字#days]</li>
<li>[<code>weeks</code>][數字#weeks]</li>
<li>[<code>fortnights</code>][數字#fortnights]</li>
</ul>
<p>啟用時間宣告和計算，例如<code>45.minutes + 2.hours + 4.weeks</code>。它們的返回值也可以新增到 Time 物件或從 Time 物件中減去。</p><p>這些方法可以結合 [<code>from_now</code>][Duration#from_now]、[<code>ago</code>][Duration#ago] 等進行精確的日期計算。例如：</p><div class="code_container">
<pre><code class="highlight plaintext"># equivalent to Time.current.advance(days: 1)
1.day.from_now

# equivalent to Time.current.advance(weeks: 2)
2.weeks.from_now

# equivalent to Time.current.advance(days: 4, weeks: 5)
(4.days + 5.weeks).from_now
</code></pre>
<button class="clipboard-button" data-clipboard-text="# equivalent to Time.current.advance(days: 1)
1.day.from_now

# equivalent to Time.current.advance(weeks: 2)
2.weeks.from_now

# equivalent to Time.current.advance(days: 4, weeks: 5)
(4.days + 5.weeks).from_now
">Copy</button>
</div>
<p>警告。對於其他持續時間，請參閱“Integer”的時間擴充套件。</p><p>注意：在<code>active_support/core_ext/numeric/time.rb</code> 中定義。</p><p>[duration#ago]：<a href="https://api.Rubyonrails.org/classes/activesupport/duration.html#method-i-ago">https://api.Rubyonrails.org/classes/activesupport/duration.html#method-i-ago</a>
[duration#from_now]：<a href="https://api.Rubyonrails.org/classes/activesupport/duration.html#method-i-from_now">https://api.Rubyonrails.org/classes/activesupport/duration.html#method-i-from_now</a>
[numeric#days]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-days">https://api.Rubyonrails.org/classes/numeric.html#method-i-days</a>
[numeric#fortnights]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-fortnights">https://api.Rubyonrails.org/classes/numeric.html#method-i-fortnights</a>
[numeric#hours]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-hours">https://api.Rubyonrails.org/classes/numeric.html#method-i-hours</a>
[numeric#minutes]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-minutes">https://api.Rubyonrails.org/classes/numeric.html#method-i-minutes</a>
[numeric#seconds]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-seconds">https://api.Rubyonrails.org/classes/numeric.html#method-i-seconds</a>
[numeric#weeks]：<a href="https://api.Rubyonrails.org/classes/numeric.html#method-i-weeks">https://api.Rubyonrails.org/classes/numeric.html#method-i-weeks</a></p><h4 id=""><a class="anchorlink" href="#">7.3 格式</a></h4><p>以多種方式啟用數字格式。</p><p>生成一個數字的字串表示作為電話號碼：</p><div class="code_container">
<pre><code class="highlight plaintext">5551234.to_s(:phone)
# =&gt; 555-1234
1235551234.to_s(:phone)
# =&gt; 123-555-1234
1235551234.to_s(:phone, area_code: true)
# =&gt; (123) 555-1234
1235551234.to_s(:phone, delimiter: " ")
# =&gt; 123 555 1234
1235551234.to_s(:phone, area_code: true, extension: 555)
# =&gt; (123) 555-1234 x 555
1235551234.to_s(:phone, country_code: 1)
# =&gt; +1-123-555-1234
</code></pre>
<button class="clipboard-button" data-clipboard-text='5551234.to_s(:phone)
# =&gt; 555-1234
1235551234.to_s(:phone)
# =&gt; 123-555-1234
1235551234.to_s(:phone, area_code: true)
# =&gt; (123) 555-1234
1235551234.to_s(:phone, delimiter: " ")
# =&gt; 123 555 1234
1235551234.to_s(:phone, area_code: true, extension: 555)
# =&gt; (123) 555-1234 x 555
1235551234.to_s(:phone, country_code: 1)
# =&gt; +1-123-555-1234
'>Copy</button>
</div>
<p>生成一個數字的字串表示作為貨幣：</p><div class="code_container">
<pre><code class="highlight plaintext">1234567890.50.to_s(:currency)                 # =&gt; $1,234,567,890.50
1234567890.506.to_s(:currency)                # =&gt; $1,234,567,890.51
1234567890.506.to_s(:currency, precision: 3)  # =&gt; $1,234,567,890.506
</code></pre>
<button class="clipboard-button" data-clipboard-text="1234567890.50.to_s(:currency)                 # =&gt; $1,234,567,890.50
1234567890.506.to_s(:currency)                # =&gt; $1,234,567,890.51
1234567890.506.to_s(:currency, precision: 3)  # =&gt; $1,234,567,890.506
">Copy</button>
</div>
<p>以百分比形式生成數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight plaintext">100.to_s(:percentage)
# =&gt; 100.000%
100.to_s(:percentage, precision: 0)
# =&gt; 100%
1000.to_s(:percentage, delimiter: '.', separator: ',')
# =&gt; 1.000,000%
302.24398923423.to_s(:percentage, precision: 5)
# =&gt; 302.24399%
</code></pre>
<button class="clipboard-button" data-clipboard-text="100.to_s(:percentage)
# =&gt; 100.000%
100.to_s(:percentage, precision: 0)
# =&gt; 100%
1000.to_s(:percentage, delimiter: '.', separator: ',')
# =&gt; 1.000,000%
302.24398923423.to_s(:percentage, precision: 5)
# =&gt; 302.24399%
">Copy</button>
</div>
<p>以分隔形式生成數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight plaintext">12345678.to_s(:delimited)                     # =&gt; 12,345,678
12345678.05.to_s(:delimited)                  # =&gt; 12,345,678.05
12345678.to_s(:delimited, delimiter: ".")     # =&gt; 12.345.678
12345678.to_s(:delimited, delimiter: ",")     # =&gt; 12,345,678
12345678.05.to_s(:delimited, separator: " ")  # =&gt; 12,345,678 05
</code></pre>
<button class="clipboard-button" data-clipboard-text='12345678.to_s(:delimited)                     # =&gt; 12,345,678
12345678.05.to_s(:delimited)                  # =&gt; 12,345,678.05
12345678.to_s(:delimited, delimiter: ".")     # =&gt; 12.345.678
12345678.to_s(:delimited, delimiter: ",")     # =&gt; 12,345,678
12345678.05.to_s(:delimited, separator: " ")  # =&gt; 12,345,678 05
'>Copy</button>
</div>
<p>生成四捨五入到精度的數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight plaintext">111.2345.to_s(:rounded)                     # =&gt; 111.235
111.2345.to_s(:rounded, precision: 2)       # =&gt; 111.23
13.to_s(:rounded, precision: 5)             # =&gt; 13.00000
389.32314.to_s(:rounded, precision: 0)      # =&gt; 389
111.2345.to_s(:rounded, significant: true)  # =&gt; 111
</code></pre>
<button class="clipboard-button" data-clipboard-text="111.2345.to_s(:rounded)                     # =&gt; 111.235
111.2345.to_s(:rounded, precision: 2)       # =&gt; 111.23
13.to_s(:rounded, precision: 5)             # =&gt; 13.00000
389.32314.to_s(:rounded, precision: 0)      # =&gt; 389
111.2345.to_s(:rounded, significant: true)  # =&gt; 111
">Copy</button>
</div>
<p>生成一個數字的字串表示，作為人類可讀的位元組數：</p><div class="code_container">
<pre><code class="highlight plaintext">123.to_s(:human_size)                  # =&gt; 123 Bytes
1234.to_s(:human_size)                 # =&gt; 1.21 KB
12345.to_s(:human_size)                # =&gt; 12.1 KB
1234567.to_s(:human_size)              # =&gt; 1.18 MB
1234567890.to_s(:human_size)           # =&gt; 1.15 GB
1234567890123.to_s(:human_size)        # =&gt; 1.12 TB
1234567890123456.to_s(:human_size)     # =&gt; 1.1 PB
1234567890123456789.to_s(:human_size)  # =&gt; 1.07 EB
</code></pre>
<button class="clipboard-button" data-clipboard-text="123.to_s(:human_size)                  # =&gt; 123 Bytes
1234.to_s(:human_size)                 # =&gt; 1.21 KB
12345.to_s(:human_size)                # =&gt; 12.1 KB
1234567.to_s(:human_size)              # =&gt; 1.18 MB
1234567890.to_s(:human_size)           # =&gt; 1.15 GB
1234567890123.to_s(:human_size)        # =&gt; 1.12 TB
1234567890123456.to_s(:human_size)     # =&gt; 1.1 PB
1234567890123456789.to_s(:human_size)  # =&gt; 1.07 EB
">Copy</button>
</div>
<p>以人類可讀的單詞生成數字的字串表示形式：</p><div class="code_container">
<pre><code class="highlight plaintext">123.to_s(:human)               # =&gt; "123"
1234.to_s(:human)              # =&gt; "1.23 Thousand"
12345.to_s(:human)             # =&gt; "12.3 Thousand"
1234567.to_s(:human)           # =&gt; "1.23 Million"
1234567890.to_s(:human)        # =&gt; "1.23 Billion"
1234567890123.to_s(:human)     # =&gt; "1.23 Trillion"
1234567890123456.to_s(:human)  # =&gt; "1.23 Quadrillion"
</code></pre>
<button class="clipboard-button" data-clipboard-text='123.to_s(:human)               # =&gt; "123"
1234.to_s(:human)              # =&gt; "1.23 Thousand"
12345.to_s(:human)             # =&gt; "12.3 Thousand"
1234567.to_s(:human)           # =&gt; "1.23 Million"
1234567890.to_s(:human)        # =&gt; "1.23 Billion"
1234567890123.to_s(:human)     # =&gt; "1.23 Trillion"
1234567890123456.to_s(:human)  # =&gt; "1.23 Quadrillion"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/numeric/conversions.rb</code> 中定義。</p><h3 id="integer"><a class="anchorlink" href="#integer">8 <code>Integer</code> 的擴充套件</a></h3><h4 id="multiple-of-questionmark"><a class="anchorlink" href="#multiple-of-questionmark">8.1 <code>multiple_of?</code></a></h4><p>方法 [<code>multiple_of?</code>][Integer#multiple_of?] 測試一個整數是否是引數的倍數：</p><div class="code_container">
<pre><code class="highlight plaintext">2.multiple_of?(1) # =&gt; true
1.multiple_of?(2) # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text="2.multiple_of?(1) # =&gt; true
1.multiple_of?(2) # =&gt; false
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/integer/multiple.rb</code> 中定義。</p><p>[integer#multiple_of?]：<a href="https://api.Rubyonrails.org/classes/integer.html#method-i-multiple_of-3f">https://api.Rubyonrails.org/classes/integer.html#method-i-multiple_of-3f</a></p><h4 id=""><a class="anchorlink" href="#">8.2 <code>序數</code></a></h4><p>[<code>ordinal</code>][Integer#ordinal] 方法返回接收者整數對應的序數字尾字串：</p><div class="code_container">
<pre><code class="highlight plaintext">1.ordinal    # =&gt; "st"
2.ordinal    # =&gt; "nd"
53.ordinal   # =&gt; "rd"
2009.ordinal # =&gt; "th"
-21.ordinal  # =&gt; "st"
-134.ordinal # =&gt; "th"
</code></pre>
<button class="clipboard-button" data-clipboard-text='1.ordinal    # =&gt; "st"
2.ordinal    # =&gt; "nd"
53.ordinal   # =&gt; "rd"
2009.ordinal # =&gt; "th"
-21.ordinal  # =&gt; "st"
-134.ordinal # =&gt; "th"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/integer/inflections.rb</code> 中定義。</p><p>[整數#ordinal]：<a href="https://api.Rubyonrails.org/classes/integer.html#method-i-ordinal">https://api.Rubyonrails.org/classes/integer.html#method-i-ordinal</a></p><h4 id=""><a class="anchorlink" href="#">8.3 <code>有序化</code></a></h4><p>[<code>ordinalize</code>][Integer#ordinalize] 方法返回接收者整數對應的序數字符串。相比之下，請注意 <code>ordinal</code> 方法返回 <strong>only</strong> 字尾字串。</p><div class="code_container">
<pre><code class="highlight plaintext">1.ordinalize    # =&gt; "1st"
2.ordinalize    # =&gt; "2nd"
53.ordinalize   # =&gt; "53rd"
2009.ordinalize # =&gt; "2009th"
-21.ordinalize  # =&gt; "-21st"
-134.ordinalize # =&gt; "-134th"
</code></pre>
<button class="clipboard-button" data-clipboard-text='1.ordinalize    # =&gt; "1st"
2.ordinalize    # =&gt; "2nd"
53.ordinalize   # =&gt; "53rd"
2009.ordinalize # =&gt; "2009th"
-21.ordinalize  # =&gt; "-21st"
-134.ordinalize # =&gt; "-134th"
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/integer/inflections.rb</code> 中定義。</p><p>[整數#ordinalize]：<a href="https://api.Rubyonrails.org/classes/integer.html#method-i-ordinalize">https://api.Rubyonrails.org/classes/integer.html#method-i-ordinalize</a></p><h4 id="integer"><a class="anchorlink" href="#integer">8.4 時間</a></h4><p>以下方法：</p>
<ul>
<li>[<code>月</code>][整數#月]</li>
<li>[<code>年</code>][整數#年]</li>
</ul>
<p>啟用時間宣告和計算，例如<code>4.months + 5.years</code>。它們的返回值也可以新增到 Time 物件或從 Time 物件中減去。</p><p>這些方法可以結合 [<code>from_now</code>][Duration#from_now]、[<code>ago</code>][Duration#ago] 等進行精確的日期計算。例如：</p><div class="code_container">
<pre><code class="highlight plaintext"># equivalent to Time.current.advance(months: 1)
1.month.from_now

# equivalent to Time.current.advance(years: 2)
2.years.from_now

# equivalent to Time.current.advance(months: 4, years: 5)
(4.months + 5.years).from_now
</code></pre>
<button class="clipboard-button" data-clipboard-text="# equivalent to Time.current.advance(months: 1)
1.month.from_now

# equivalent to Time.current.advance(years: 2)
2.years.from_now

# equivalent to Time.current.advance(months: 4, years: 5)
(4.months + 5.years).from_now
">Copy</button>
</div>
<p>警告。對於其他持續時間，請參閱“數字”的時間擴充套件。</p><p>注意：在<code>active_support/core_ext/integer/time.rb</code> 中定義。</p><p>[integer#months]：<a href="https://api.Rubyonrails.org/classes/integer.html#method-i-months">https://api.Rubyonrails.org/classes/integer.html#method-i-months</a>
[整數#年]：<a href="https://api.Rubyonrails.org/classes/integer.html#method-i-years">https://api.Rubyonrails.org/classes/integer.html#method-i-years</a></p><h3 id="bigdecimal"><a class="anchorlink" href="#bigdecimal">9 <code>BigDecimal</code> 的擴充套件</a></h3><h4 id="bigdecimal-to-s"><a class="anchorlink" href="#bigdecimal-to-s">9.1 <code>to_s</code></a></h4><p><code>to_s</code> 方法提供了一個預設的說明符“F”。這意味著對 <code>to_s</code> 的簡單呼叫將導致浮點表示而不是工程符號：</p><div class="code_container">
<pre><code class="highlight plaintext">BigDecimal(5.00, 6).to_s       # =&gt; "5.0"
</code></pre>
<button class="clipboard-button" data-clipboard-text='BigDecimal(5.00, 6).to_s       # =&gt; "5.0"
'>Copy</button>
</div>
<p>並且還支援 Symbol 說明符：</p><div class="code_container">
<pre><code class="highlight plaintext">BigDecimal(5.00, 6).to_s(:db)  # =&gt; "5.0"
</code></pre>
<button class="clipboard-button" data-clipboard-text='BigDecimal(5.00, 6).to_s(:db)  # =&gt; "5.0"
'>Copy</button>
</div>
<p>仍然支援工程符號：</p><div class="code_container">
<pre><code class="highlight plaintext">BigDecimal(5.00, 6).to_s("e")  # =&gt; "0.5E1"
</code></pre>
<button class="clipboard-button" data-clipboard-text='BigDecimal(5.00, 6).to_s("e")  # =&gt; "0.5E1"
'>Copy</button>
</div>
<h3 id="enumerable"><a class="anchorlink" href="#enumerable">10 <code>Enumerable</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">10.1 <code>總和</code></a></h4><p>方法 [<code>sum</code>][Enumerable#sum] 新增可列舉的元素：</p><div class="code_container">
<pre><code class="highlight plaintext">[1, 2, 3].sum # =&gt; 6
(1..100).sum  # =&gt; 5050
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].sum # =&gt; 6
(1..100).sum  # =&gt; 5050
">Copy</button>
</div>
<p>加法僅假設元素響應 <code>+</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">[[1, 2], [2, 3], [3, 4]].sum    # =&gt; [1, 2, 2, 3, 3, 4]
%w(foo bar baz).sum             # =&gt; "foobarbaz"
{a: 1, b: 2, c: 3}.sum          # =&gt; [:a, 1, :b, 2, :c, 3]
</code></pre>
<button class="clipboard-button" data-clipboard-text='[[1, 2], [2, 3], [3, 4]].sum    # =&gt; [1, 2, 2, 3, 3, 4]
%w(foo bar baz).sum             # =&gt; "foobarbaz"
{a: 1, b: 2, c: 3}.sum          # =&gt; [:a, 1, :b, 2, :c, 3]
'>Copy</button>
</div>
<p>預設情況下，空集合的總和為零，但這是可自定義的：</p><div class="code_container">
<pre><code class="highlight plaintext">[].sum    # =&gt; 0
[].sum(1) # =&gt; 1
</code></pre>
<button class="clipboard-button" data-clipboard-text="[].sum    # =&gt; 0
[].sum(1) # =&gt; 1
">Copy</button>
</div>
<p>如果給出了一個塊，<code>sum</code> 將成為一個迭代器，它產生集合的元素並對返回的值求和：</p><div class="code_container">
<pre><code class="highlight plaintext">(1..5).sum {|n| n * 2 } # =&gt; 30
[2, 4, 6, 8, 10].sum    # =&gt; 30
</code></pre>
<button class="clipboard-button" data-clipboard-text="(1..5).sum {|n| n * 2 } # =&gt; 30
[2, 4, 6, 8, 10].sum    # =&gt; 30
">Copy</button>
</div>
<p>空接收器的總和也可以用這種形式定製：</p><div class="code_container">
<pre><code class="highlight plaintext">[].sum(1) {|n| n**3} # =&gt; 1
</code></pre>
<button class="clipboard-button" data-clipboard-text="[].sum(1) {|n| n**3} # =&gt; 1
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#sum]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-sum">https://api.Rubyonrails.org/classes/enumerable.html#method-i-sum</a></p><h4 id="index-by"><a class="anchorlink" href="#index-by">10.2 <code>index_by</code></a></h4><p>方法 [<code>index_by</code>][Enumerable#index_by] 生成一個雜湊，其中包含由某個鍵索引的可列舉元素。</p><p>它遍歷集合並將每個元素傳遞給一個塊。該元素將由塊返回的值作為鍵：</p><div class="code_container">
<pre><code class="highlight plaintext">invoices.index_by(&amp;:number)
# =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}
</code></pre>
<button class="clipboard-button" data-clipboard-text="invoices.index_by(&amp;:number)
# =&gt; {'2009-032' =&gt; &lt;Invoice ...&gt;, '2009-008' =&gt; &lt;Invoice ...&gt;, ...}
">Copy</button>
</div>
<p>警告。鍵通常應該是唯一的。如果塊為不同的元素返回相同的值，則不會為該鍵構建集合。最後一項將獲勝。</p><p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#index_by]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-index_by">https://api.Rubyonrails.org/classes/enumerable.html#method-i-index_by</a></p><h4 id="index-with"><a class="anchorlink" href="#index-with">10.3 <code>index_with</code></a></h4><p>方法 [<code>index_with</code>][Enumerable#index_with] 生成一個以可列舉元素作為鍵的雜湊值。價值
是傳遞的預設值或在塊中返回。</p><div class="code_container">
<pre><code class="highlight plaintext">post = Post.new(title: "hey there", body: "what's up?")

%i( title body ).index_with { |attr_name| post.public_send(attr_name) }
# =&gt; { title: "hey there", body: "what's up?" }

WEEKDAYS.index_with(Interval.all_day)
# =&gt; { monday: [ 0, 1440 ], … }
</code></pre>
<button class="clipboard-button" data-clipboard-text="post = Post.new(title: &quot;hey there&quot;, body: &quot;what's up?&quot;)

%i( title body ).index_with { |attr_name| post.public_send(attr_name) }
# =&gt; { title: &quot;hey there&quot;, body: &quot;what's up?&quot; }

WEEKDAYS.index_with(Interval.all_day)
# =&gt; { monday: [ 0, 1440 ], … }
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#index_with]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-index_with">https://api.Rubyonrails.org/classes/enumerable.html#method-i-index_with</a></p><h4 id=""><a class="anchorlink" href="#">10.4 <code>很多？</code></a></h4><p>方法 [<code>many?</code>][Enumerable#many?] 是 <code>collection.size &gt; 1</code> 的簡寫：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="k">if</span> <span class="n">pages</span><span class="p">.</span><span class="nf">many?</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">pagination_links</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% if pages.many? %&gt;
  &lt;%= pagination_links %&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>如果給出了一個可選塊，<code>many?</code> 只考慮那些返回 true 的元素：</p><div class="code_container">
<pre><code class="highlight plaintext">@see_more = videos.many? {|video| video.category == params[:category]}
</code></pre>
<button class="clipboard-button" data-clipboard-text="@see_more = videos.many? {|video| video.category == params[:category]}
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#many?]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-many-3f">https://api.Rubyonrails.org/classes/enumerable.html#method-i-many-3f</a></p><h4 id=""><a class="anchorlink" href="#">10.5 <code>排除？</code></a></h4><p>謂詞 [<code>exclude?</code>][Enumerable#exclude?] 測試給定的物件是否<strong>不</strong>屬於集合。它是對內建 <code>include?</code> 的否定：</p><div class="code_container">
<pre><code class="highlight plaintext">to_visit &lt;&lt; node if visited.exclude?(node)
</code></pre>
<button class="clipboard-button" data-clipboard-text="to_visit &lt;&lt; node if visited.exclude?(node)
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#exclude?]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-exclude-3f">https://api.Rubyonrails.org/classes/enumerable.html#method-i-exclude-3f</a></p><h4 id=""><a class="anchorlink" href="#">10.6 <code>包括</code></a></h4><p>方法 [<code>includes</code>][Enumerable#include] 返回一個包含傳遞元素的新列舉：</p><div class="code_container">
<pre><code class="highlight plaintext">[ 1, 2, 3 ].including(4, 5)                    # =&gt; [ 1, 2, 3, 4, 5 ]
["David", "Rafael"].including %w[ Aaron Todd ] # =&gt; ["David", "Rafael", "Aaron", "Todd"]
</code></pre>
<button class="clipboard-button" data-clipboard-text='[ 1, 2, 3 ].including(4, 5)                    # =&gt; [ 1, 2, 3, 4, 5 ]
["David", "Rafael"].including %w[ Aaron Todd ] # =&gt; ["David", "Rafael", "Aaron", "Todd"]
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#include]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-%E5%8C%85%E6%8B%AC">https://api.Rubyonrails.org/classes/enumerable.html#method-i-包括</a></p><h4 id=""><a class="anchorlink" href="#">10.7 <code>排除</code></a></h4><p>方法 [<code>exclude</code>][Enumerable# exclude] 返回具有指定元素的可列舉的副本
移除：</p><div class="code_container">
<pre><code class="highlight plaintext">["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
</code></pre>
<button class="clipboard-button" data-clipboard-text='["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
'>Copy</button>
</div>
<p><code>排除</code> 別名為 [<code>without</code>][Enumerable#without]。</p><p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable# exclude]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-">https://api.Rubyonrails.org/classes/enumerable.html#method-i-</a> exclude
[enumerable#without]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-without">https://api.Rubyonrails.org/classes/enumerable.html#method-i-without</a></p><h4 id=""><a class="anchorlink" href="#">10.8 <code>採摘</code></a></h4><p>方法 [<code>pluck</code>][Enumerable#pluck] 從每個元素中提取給定的鍵：</p><div class="code_container">
<pre><code class="highlight plaintext">[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pluck(:name) # =&gt; ["David", "Rafael", "Aaron"]
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pluck(:id, :name) # =&gt; [[1, "David"], [2, "Rafael"]]
</code></pre>
<button class="clipboard-button" data-clipboard-text='[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pluck(:name) # =&gt; ["David", "Rafael", "Aaron"]
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pluck(:id, :name) # =&gt; [[1, "David"], [2, "Rafael"]]
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#pluck]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-pluck">https://api.Rubyonrails.org/classes/enumerable.html#method-i-pluck</a></p><h4 id=""><a class="anchorlink" href="#">10.9 <code>挑選</code></a></h4><p>[<code>pick</code>][Enumerable#pick] 方法從第一個元素中提取給定的鍵：</p><div class="code_container">
<pre><code class="highlight plaintext">[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pick(:name) # =&gt; "David"
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pick(:id, :name) # =&gt; [1, "David"]
</code></pre>
<button class="clipboard-button" data-clipboard-text='[{ name: "David" }, { name: "Rafael" }, { name: "Aaron" }].pick(:name) # =&gt; "David"
[{ id: 1, name: "David" }, { id: 2, name: "Rafael" }].pick(:id, :name) # =&gt; [1, "David"]
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/enumerable.rb</code> 中定義。</p><p>[enumerable#pick]：<a href="https://api.Rubyonrails.org/classes/enumerable.html#method-i-pick">https://api.Rubyonrails.org/classes/enumerable.html#method-i-pick</a></p><h3 id="array"><a class="anchorlink" href="#array">11 <code>Array</code> 的擴充套件</a></h3><h4 id="array"><a class="anchorlink" href="#array">11.1 訪問</a></h4><p>Active Support 增加了陣列的 api 以簡化訪問它們的某些方式。例如， [<code>to</code>][array#to] 返回元素的子陣列，直到傳遞的索引處：</p><div class="code_container">
<pre><code class="highlight plaintext">%w(a b c d).to(2) # =&gt; ["a", "b", "c"]
[].to(7)          # =&gt; []
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(a b c d).to(2) # =&gt; ["a", "b", "c"]
[].to(7)          # =&gt; []
'>Copy</button>
</div>
<p>類似地， [<code>from</code>][Array#from] 返回從傳遞索引處的元素到結尾的尾部。如果索引大於陣列的長度，則返回一個空陣列。</p><div class="code_container">
<pre><code class="highlight plaintext">%w(a b c d).from(2)  # =&gt; ["c", "d"]
%w(a b c d).from(10) # =&gt; []
[].from(0)           # =&gt; []
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(a b c d).from(2)  # =&gt; ["c", "d"]
%w(a b c d).from(10) # =&gt; []
[].from(0)           # =&gt; []
'>Copy</button>
</div>
<p>[<code>includes</code>][Array#include] 方法返回一個包含傳遞元素的新陣列：</p><div class="code_container">
<pre><code class="highlight plaintext">[ 1, 2, 3 ].including(4, 5)          # =&gt; [ 1, 2, 3, 4, 5 ]
[ [ 0, 1 ] ].including([ [ 1, 0 ] ]) # =&gt; [ [ 0, 1 ], [ 1, 0 ] ]
</code></pre>
<button class="clipboard-button" data-clipboard-text="[ 1, 2, 3 ].including(4, 5)          # =&gt; [ 1, 2, 3, 4, 5 ]
[ [ 0, 1 ] ].including([ [ 1, 0 ] ]) # =&gt; [ [ 0, 1 ], [ 1, 0 ] ]
">Copy</button>
</div>
<p>方法 [<code>exclude</code>][Array# exclude] 返回不包括指定元素的 Array 的副本。
這是對使用 <code>Array#-</code> 的 <code>Enumerable# exclude</code> 的最佳化
出於效能原因而不是<code>Array#reject</code>。</p><div class="code_container">
<pre><code class="highlight plaintext">["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
[ [ 0, 1 ], [ 1, 0 ] ].excluding([ [ 1, 0 ] ])                  # =&gt; [ [ 0, 1 ] ]
</code></pre>
<button class="clipboard-button" data-clipboard-text='["David", "Rafael", "Aaron", "Todd"].excluding("Aaron", "Todd") # =&gt; ["David", "Rafael"]
[ [ 0, 1 ], [ 1, 0 ] ].excluding([ [ 1, 0 ] ])                  # =&gt; [ [ 0, 1 ] ]
'>Copy</button>
</div>
<p>方法 [<code>second</code>][Array#second]、[<code>third</code>][Array#third]、[<code>fourth</code>][Array#fourth] 和 [<code>fifth</code>][Array#fifth] 返回對應的元素, [<code>second_to_last</code>][Array#second_to_last] 和 [<code>third_to_last</code>][Array#third_to_last] （<code>first</code> 和 <code>last</code> 是內建的）。由於社會智慧和積極的建設性，[<code>forty_two</code>][Array#forty_two] 也可用。</p><div class="code_container">
<pre><code class="highlight plaintext">%w(a b c d).third # =&gt; "c"
%w(a b c d).fifth # =&gt; nil
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(a b c d).third # =&gt; "c"
%w(a b c d).fifth # =&gt; nil
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/array/access.rb</code> 中定義。</p><p>[陣列#排除]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-%E6%8E%92%E9%99%A4">https://api.Rubyonrails.org/classes/array.html#method-i-排除</a>
[array#fifth]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-fifth">https://api.Rubyonrails.org/classes/array.html#method-i-fifth</a>
[array#forty_two]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-forty_two">https://api.Rubyonrails.org/classes/array.html#method-i-forty_two</a>
[array#fourth]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-fourth">https://api.Rubyonrails.org/classes/array.html#method-i-fourth</a>
[array#from]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-from">https://api.Rubyonrails.org/classes/array.html#method-i-from</a>
[array#include]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-include">https://api.Rubyonrails.org/classes/array.html#method-i-include</a>
[array#second]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-second">https://api.Rubyonrails.org/classes/array.html#method-i-second</a>
[array#second_to_last]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-second_to_last">https://api.Rubyonrails.org/classes/array.html#method-i-second_to_last</a>
[array#third]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-third">https://api.Rubyonrails.org/classes/array.html#method-i-third</a>
[array#third_to_last]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-third_to_last">https://api.Rubyonrails.org/classes/array.html#method-i-third_to_last</a>
[array#to]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-to">https://api.Rubyonrails.org/classes/array.html#method-i-to</a></p><h4 id="array-"><a class="anchorlink" href="#array-">11.2 提取</a></h4><p>方法 [<code>extract!</code>][Array#extract!] 移除並返回塊返回真值的元素。
如果沒有給出塊，則返回一個列舉器。</p><div class="code_container">
<pre><code class="highlight plaintext">numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
odd_numbers = numbers.extract! { |number| number.odd? } # =&gt; [1, 3, 5, 7, 9]
numbers # =&gt; [0, 2, 4, 6, 8]
</code></pre>
<button class="clipboard-button" data-clipboard-text="numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
odd_numbers = numbers.extract! { |number| number.odd? } # =&gt; [1, 3, 5, 7, 9]
numbers # =&gt; [0, 2, 4, 6, 8]
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/array/extract.rb</code> 中定義。</p><p>[array#extract!]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-extract-21">https://api.Rubyonrails.org/classes/array.html#method-i-extract-21</a></p><h4 id="action"><a class="anchorlink" href="#action">11.3 選項提取action</a></h4><p>當方法呼叫中的最後一個引數是雜湊時，除了 <code>&amp;block</code> 引數，Ruby 允許您省略括號：</p><div class="code_container">
<pre><code class="highlight plaintext">User.exists?(email: params[:email])
</code></pre>
<button class="clipboard-button" data-clipboard-text="User.exists?(email: params[:email])
">Copy</button>
</div>
<p>這種語法糖在 Rails 中被大量使用，以避免出現過多的位置引數，而是提供模擬命名引數的介面。特別是使用尾隨雜湊作為選項是非常慣用的。</p><p>但是，如果一個方法需要可變數量的引數並在其宣告中使用“*”，那麼這樣的選項雜湊最終會成為引數陣列的一個專案，在那裡它失去了它的作用。</p><p>在這些情況下，您可以使用 [<code>extract_options!</code>][Array#extract_options!] 對選項雜湊進行特殊處理。此方法檢查陣列最後一項的型別。如果它是一個雜湊，它彈出它並返回它，否則它返回一個空的雜湊。</p><p>例如，讓我們看看 <code>caches_action</code> Controller 宏的定義：</p><div class="code_container">
<pre><code class="highlight plaintext">def caches_Action(*Actions)
  return unless cache_configured?
  options = Actions.extract_options!
  # ...
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="def caches_Action(*Actions)
  return unless cache_configured?
  options = Actions.extract_options!
  # ...
end
">Copy</button>
</div>
<p>此方法接收任意數量的Action 名稱，以及作為最後一個引數的可選雜湊選項。透過呼叫 <code>extract_options!</code>，您可以獲得選項雜湊，並以簡單而明確的方式將其從 <code>Actions</code> 中刪除。</p><p>注意：在<code>active_support/core_ext/array/extract_options.rb</code> 中定義。</p><p>[array#extract_options!]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-extract_options-21">https://api.Rubyonrails.org/classes/array.html#method-i-extract_options-21</a></p><h4 id="array"><a class="anchorlink" href="#array">11.4 次轉化</a></h4><h5 id="to-sentence"><a class="anchorlink" href="#to-sentence">11.4.1 <code>to_sentence</code></a></h5><p>[<code>to_sentence</code>][Array#to_sentence] 方法將一個數組轉換為一個字串，該字串包含一個列舉其專案的句子：</p><div class="code_container">
<pre><code class="highlight plaintext">%w().to_sentence                # =&gt; ""
%w(Earth).to_sentence           # =&gt; "Earth"
%w(Earth Wind).to_sentence      # =&gt; "Earth and Wind"
%w(Earth Wind Fire).to_sentence # =&gt; "Earth, Wind, and Fire"
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w().to_sentence                # =&gt; ""
%w(Earth).to_sentence           # =&gt; "Earth"
%w(Earth Wind).to_sentence      # =&gt; "Earth and Wind"
%w(Earth Wind Fire).to_sentence # =&gt; "Earth, Wind, and Fire"
'>Copy</button>
</div>
<p>此方法接受三個選項：</p>
<ul>
<li>
<code>:two_words_connector</code>：用於長度為 2 的陣列。預設為“和”。</li>
<li>
<code>:words_connector</code>: 用於連線具有 3 個或更多元素的陣列元素，除了最後兩個。預設為“,”。</li>
<li>
<code>:last_word_connector</code>：用於連線具有 3 個或更多元素的陣列的最後一項。預設為“，和”。</li>
</ul>
<p>這些選項的預設值可以本地化，它們的鍵是：</p>
<table>
<thead>
<tr>
<th>選項</th>
<th>I18n 鍵</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:two_words_connector</code></td>
<td><code>support.array.two_words_connector</code></td>
</tr>
<tr>
<td><code>:words_connector</code></td>
<td><code>support.array.words_connector</code></td>
</tr>
<tr>
<td><code>:last_word_connector</code></td>
<td><code>support.array.last_word_connector</code></td>
</tr>
</tbody>
</table>
<p>注意：在<code>active_support/core_ext/array/conversions.rb</code> 中定義。</p><p>[array#to_sentence]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-to_sentence">https://api.Rubyonrails.org/classes/array.html#method-i-to_sentence</a></p><h5 id="to-formatted-s"><a class="anchorlink" href="#to-formatted-s">11.4.2 <code>to_formatted_s</code></a></h5><p>預設情況下，方法 [<code>to_formatted_s</code>][Array#to_formatted_s] 的作用類似於 <code>to_s</code>。</p><p>但是，如果陣列包含響應 <code>id</code> 的專案，Symbol
<code>:db</code> 可以作為引數傳遞。這通常與
Active Record 物件的集合。返回的字串是：</p><div class="code_container">
<pre><code class="highlight plaintext">[].to_formatted_s(:db)            # =&gt; "null"
[user].to_formatted_s(:db)        # =&gt; "8456"
invoice.lines.to_formatted_s(:db) # =&gt; "23,567,556,12"
</code></pre>
<button class="clipboard-button" data-clipboard-text='[].to_formatted_s(:db)            # =&gt; "null"
[user].to_formatted_s(:db)        # =&gt; "8456"
invoice.lines.to_formatted_s(:db) # =&gt; "23,567,556,12"
'>Copy</button>
</div>
<p>上面示例中的整數應該來自對“id”的相應呼叫。</p><p>注意：在<code>active_support/core_ext/array/conversions.rb</code> 中定義。</p><p>[array#to_formatted_s]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-to_formatted_s">https://api.Rubyonrails.org/classes/array.html#method-i-to_formatted_s</a></p><h5 id="array-to-xml"><a class="anchorlink" href="#array-to-xml">11.4.3 <code>to_xml</code></a></h5><p>方法 [<code>to_xml</code>][Array#to_xml] 返回一個包含其接收者的 XML 表示的字串：</p><div class="code_container">
<pre><code class="highlight plaintext">Contributor.limit(2).order(:rank).to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors type="array"&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank type="integer"&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank type="integer"&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='Contributor.limit(2).order(:rank).to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors type="array"&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank type="integer"&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id type="integer"&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank type="integer"&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
'>Copy</button>
</div>
<p>為此，它依次向每個專案傳送 <code>to_xml</code>，並在根節點下收集結果。所有專案都必須響應 <code>to_xml</code>，否則會引發異常。</p><p>預設情況下，根元素的名稱是第一個專案的類名稱的帶下劃線和破折號的複數形式，前提是其餘元素屬於該型別（用<code>is_a?</code>檢查）並且它們不是雜湊。在上面的例子中是“貢獻者”。</p><p>如果有任何元素不屬於第一個元素的型別，則根節點變為“物件”：</p><div class="code_container">
<pre><code class="highlight plaintext">[Contributor.first, Commit.first].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;id type="integer"&gt;4583&lt;/id&gt;
#     &lt;name&gt;Aaron Batalion&lt;/name&gt;
#     &lt;rank type="integer"&gt;53&lt;/rank&gt;
#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;author&gt;Joshua Peek&lt;/author&gt;
#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;
#     &lt;branch&gt;origin/master&lt;/branch&gt;
#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;
#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;
#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;
#     &lt;id type="integer"&gt;190316&lt;/id&gt;
#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;
#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;
#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='[Contributor.first, Commit.first].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;id type="integer"&gt;4583&lt;/id&gt;
#     &lt;name&gt;Aaron Batalion&lt;/name&gt;
#     &lt;rank type="integer"&gt;53&lt;/rank&gt;
#     &lt;url-id&gt;aaron-batalion&lt;/url-id&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;author&gt;Joshua Peek&lt;/author&gt;
#     &lt;authored-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/authored-timestamp&gt;
#     &lt;branch&gt;origin/master&lt;/branch&gt;
#     &lt;committed-timestamp type="datetime"&gt;2009-09-02T16:44:36Z&lt;/committed-timestamp&gt;
#     &lt;committer&gt;Joshua Peek&lt;/committer&gt;
#     &lt;git-show nil="true"&gt;&lt;/git-show&gt;
#     &lt;id type="integer"&gt;190316&lt;/id&gt;
#     &lt;imported-from-svn type="boolean"&gt;false&lt;/imported-from-svn&gt;
#     &lt;message&gt;Kill AMo observing wrap_with_notifications since ARes was only using it&lt;/message&gt;
#     &lt;sha1&gt;723a47bfb3708f968821bc969a9a3fc873a3ed58&lt;/sha1&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
'>Copy</button>
</div>
<p>如果接收者是雜湊陣列，則根元素預設也是“物件”：</p><div class="code_container">
<pre><code class="highlight plaintext">[{a: 1, b: 2}, {c: 3}].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;b type="integer"&gt;2&lt;/b&gt;
#     &lt;a type="integer"&gt;1&lt;/a&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;c type="integer"&gt;3&lt;/c&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='[{a: 1, b: 2}, {c: 3}].to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;objects type="array"&gt;
#   &lt;object&gt;
#     &lt;b type="integer"&gt;2&lt;/b&gt;
#     &lt;a type="integer"&gt;1&lt;/a&gt;
#   &lt;/object&gt;
#   &lt;object&gt;
#     &lt;c type="integer"&gt;3&lt;/c&gt;
#   &lt;/object&gt;
# &lt;/objects&gt;
'>Copy</button>
</div>
<p>警告。如果集合為空，則根元素預設為“nil-classes”。這是一個問題，例如，如果集合為空，則上述貢獻者列表的根元素將不是“貢獻者”，而是“nil-classes”。您可以使用 <code>:root</code> 選項來確保根元素一致。</p><p>預設情況下，子節點的名稱是單數化的根節點的名稱。在上面的例子中，我們已經看到了“貢獻者”和“物件”。選項<code>:children</code> 允許你設定這些節點名稱。</p><p>預設的 XML 構建器是 <code>Builder::XmlMarkup</code> 的一個新例項。你可以透過 <code>:builder</code> 選項配置你自己的構建器。該方法還接受像 <code>:dasherize</code> 和朋友這樣的選項，它們被轉發到構建器：</p><div class="code_container">
<pre><code class="highlight plaintext">Contributor.limit(2).order(:rank).to_xml(skip_types: true)
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='Contributor.limit(2).order(:rank).to_xml(skip_types: true)
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;contributors&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4356&lt;/id&gt;
#     &lt;name&gt;Jeremy Kemper&lt;/name&gt;
#     &lt;rank&gt;1&lt;/rank&gt;
#     &lt;url-id&gt;jeremy-kemper&lt;/url-id&gt;
#   &lt;/contributor&gt;
#   &lt;contributor&gt;
#     &lt;id&gt;4404&lt;/id&gt;
#     &lt;name&gt;David Heinemeier Hansson&lt;/name&gt;
#     &lt;rank&gt;2&lt;/rank&gt;
#     &lt;url-id&gt;david-heinemeier-hansson&lt;/url-id&gt;
#   &lt;/contributor&gt;
# &lt;/contributors&gt;
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/array/conversions.rb</code> 中定義。</p><p>[array#to_xml]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-to_xml">https://api.Rubyonrails.org/classes/array.html#method-i-to_xml</a></p><h4 id=""><a class="anchorlink" href="#">11.5 換行</a></h4><p>方法 [<code>Array.wrap</code>][Array.wrap] 將其引數包裝在一個數組中，除非它已經是一個數組（或類似陣列）。</p><p>具體來說：</p>
<ul>
<li>如果引數為 <code>nil</code>，則返回一個空陣列。</li>
<li>否則，如果引數響應 <code>to_ary</code> 它被呼叫，並且如果 <code>to_ary</code> 的值不是 <code>nil</code>，則返回它。</li>
<li>否則，返回一個以引數為單個元素的陣列。</li>
</ul>
<div class="code_container">
<pre><code class="highlight plaintext">Array.wrap(nil)       # =&gt; []
Array.wrap([1, 2, 3]) # =&gt; [1, 2, 3]
Array.wrap(0)         # =&gt; [0]
</code></pre>
<button class="clipboard-button" data-clipboard-text="Array.wrap(nil)       # =&gt; []
Array.wrap([1, 2, 3]) # =&gt; [1, 2, 3]
Array.wrap(0)         # =&gt; [0]
">Copy</button>
</div>
<p>這個方法的目的類似於<code>Kernel#Array</code>，但有一些區別：</p>
<ul>
<li>如果引數響應 <code>to_ary</code>，則呼叫該方法。 <code>Kernel#Array</code> 繼續嘗試 <code>to_a</code>，如果返回值為 <code>nil</code>，但 <code>Array.wrap</code> 立即返回一個以引數作為其單個元素的陣列。</li>
<li>如果<code>to_ary</code> 的返回值既不是<code>nil</code> 也不是<code>Array</code> 物件，<code>Kernel#Array</code> 會引發異常，而<code>Array.wrap</code> 不會，它只是返回值。</li>
<li>它不會在引數上呼叫 <code>to_a</code>，如果引數沒有響應 <code>to_ary</code>，它會返回一個以該引數作為其單個元素的陣列。</li>
</ul>
<p>最後一點特別值得對一些列舉進行比較：</p><div class="code_container">
<pre><code class="highlight plaintext">Array.wrap(foo: :bar) # =&gt; [{:foo=&gt;:bar}]
Array(foo: :bar)      # =&gt; [[:foo, :bar]]
</code></pre>
<button class="clipboard-button" data-clipboard-text="Array.wrap(foo: :bar) # =&gt; [{:foo=&gt;:bar}]
Array(foo: :bar)      # =&gt; [[:foo, :bar]]
">Copy</button>
</div>
<p>還有一個使用 splat 運算子的相關成語：</p><div class="code_container">
<pre><code class="highlight plaintext">[*object]
</code></pre>
<button class="clipboard-button" data-clipboard-text="[*object]
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/array/wrap.rb</code> 中定義。</p><p>[array.wrap]：<a href="https://api.Rubyonrails.org/classes/array.html#method-c-wrap">https://api.Rubyonrails.org/classes/array.html#method-c-wrap</a></p><h4 id="array"><a class="anchorlink" href="#array">11.6 複製</a></h4><p>方法 [<code>Array#deep_dup</code>][Array#deep_dup] 複製自身和裡面的所有物件
使用Active Support 方法<code>object#deep_dup</code> 遞迴。它的工作原理類似於 <code>array#map</code>，向內部的每個物件傳送 <code>deep_dup</code> 方法。</p><div class="code_container">
<pre><code class="highlight plaintext">array = [1, [2, 3]]
dup = array.deep_dup
dup[1][2] = 4
array[1][2] == nil   # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="array = [1, [2, 3]]
dup = array.deep_dup
dup[1][2] = 4
array[1][2] == nil   # =&gt; true
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/deep_dup.rb</code> 中定義。</p><p>[array#deep_dup]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-deep_dup">https://api.Rubyonrails.org/classes/array.html#method-i-deep_dup</a></p><h4 id=""><a class="anchorlink" href="#">11.7 分組</a></h4><h5 id="in-groups-of-number-fill-with-nil"><a class="anchorlink" href="#in-groups-of-number-fill-with-nil">11.7.1 <code>in_groups_of(number, fill_with = nil)</code></a></h5><p>方法 [<code>in_groups_of</code>][Array#in_groups_of] 將陣列拆分為特定大小的連續組。它返回一個包含組的陣列：</p><div class="code_container">
<pre><code class="highlight plaintext">[1, 2, 3].in_groups_of(2) # =&gt; [[1, 2], [3, nil]]
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].in_groups_of(2) # =&gt; [[1, 2], [3, nil]]
">Copy</button>
</div>
<p>或者如果傳遞了一個塊，則依次產生它們：</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%</span> <span class="n">sample</span><span class="p">.</span><span class="nf">in_groups_of</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">a</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">b</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">c</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<button class="clipboard-button" data-clipboard-text="&lt;% sample.in_groups_of(3) do |a, b, c| %&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;%= a %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= b %&gt;&lt;/td&gt;
    &lt;td&gt;&lt;%= c %&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;% end %&gt;
">Copy</button>
</div>
<p>第一個示例展示了 <code>in_groups_of</code> 如何根據需要使用盡可能多的 <code>nil</code> 元素填充最後一個組以獲得所請求的大小。您可以使用第二個可選引數更改此填充值：</p><div class="code_container">
<pre><code class="highlight plaintext">[1, 2, 3].in_groups_of(2, 0) # =&gt; [[1, 2], [3, 0]]
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].in_groups_of(2, 0) # =&gt; [[1, 2], [3, 0]]
">Copy</button>
</div>
<p>你可以透過傳遞<code>false</code>來告訴方法不要填充最後一組：</p><div class="code_container">
<pre><code class="highlight plaintext">[1, 2, 3].in_groups_of(2, false) # =&gt; [[1, 2], [3]]
</code></pre>
<button class="clipboard-button" data-clipboard-text="[1, 2, 3].in_groups_of(2, false) # =&gt; [[1, 2], [3]]
">Copy</button>
</div>
<p>因此，<code>false</code> 不能用作填充值。</p><p>注意：在<code>active_support/core_ext/array/grouping.rb</code> 中定義。</p><p>[array#in_groups_of]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-in_groups_of">https://api.Rubyonrails.org/classes/array.html#method-i-in_groups_of</a></p><h5 id="in-groups-number-fill-with-nil"><a class="anchorlink" href="#in-groups-number-fill-with-nil">11.7.2 <code>in_groups(number,fill_with = nil)</code></a></h5><p>[<code>in_groups</code>][Array#in_groups] 方法將陣列拆分為一定數量的組。該方法返回一個包含組的陣列：</p><div class="code_container">
<pre><code class="highlight plaintext">%w(1 2 3 4 5 6 7).in_groups(3)
# =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3)
# =&gt; [["1", "2", "3"], ["4", "5", nil], ["6", "7", nil]]
'>Copy</button>
</div>
<p>或者如果傳遞了一個塊，則依次產生它們：</p><div class="code_container">
<pre><code class="highlight plaintext">%w(1 2 3 4 5 6 7).in_groups(3) {|group| p group}
["1", "2", "3"]
["4", "5", nil]
["6", "7", nil]
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3) {|group| p group}
["1", "2", "3"]
["4", "5", nil]
["6", "7", nil]
'>Copy</button>
</div>
<p>上面的例子表明，<code>in_groups</code> 根據需要用尾隨的 <code>nil</code> 元素填充一些組。一個組最多可以獲得這些額外元素中的一個，如果有的話，最右邊的一個。擁有它們的組總是最後一個。</p><p>您可以使用第二個可選引數更改此填充值：</p><div class="code_container">
<pre><code class="highlight plaintext">%w(1 2 3 4 5 6 7).in_groups(3, "0")
# =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3, "0")
# =&gt; [["1", "2", "3"], ["4", "5", "0"], ["6", "7", "0"]]
'>Copy</button>
</div>
<p>您可以透過傳遞 <code>false</code> 來告訴該方法不要填充較小的組：</p><div class="code_container">
<pre><code class="highlight plaintext">%w(1 2 3 4 5 6 7).in_groups(3, false)
# =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]
</code></pre>
<button class="clipboard-button" data-clipboard-text='%w(1 2 3 4 5 6 7).in_groups(3, false)
# =&gt; [["1", "2", "3"], ["4", "5"], ["6", "7"]]
'>Copy</button>
</div>
<p>因此，<code>false</code> 不能用作填充值。</p><p>注意：在<code>active_support/core_ext/array/grouping.rb</code> 中定義。</p><p>[array#in_groups]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-in_groups">https://api.Rubyonrails.org/classes/array.html#method-i-in_groups</a></p><h5 id="split-value-nil"><a class="anchorlink" href="#split-value-nil">11.7.3 <code>split(value = nil)</code></a></h5><p>方法 [<code>split</code>][Array#split] 用分隔符分割陣列並返回結果塊​​。</p><p>如果傳遞了一個塊，則分隔符是該塊為其返回 true 的陣列元素：</p><div class="code_container">
<pre><code class="highlight plaintext">(-5..5).to_a.split { |i| i.multiple_of?(4) }
# =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]
</code></pre>
<button class="clipboard-button" data-clipboard-text="(-5..5).to_a.split { |i| i.multiple_of?(4) }
# =&gt; [[-5], [-3, -2, -1], [1, 2, 3], [5]]
">Copy</button>
</div>
<p>否則，作為引數接收的值，預設為 <code>nil</code>，是分隔符：</p><div class="code_container">
<pre><code class="highlight plaintext">[0, 1, -5, 1, 1, "foo", "bar"].split(1)
# =&gt; [[0], [-5], [], ["foo", "bar"]]
</code></pre>
<button class="clipboard-button" data-clipboard-text='[0, 1, -5, 1, 1, "foo", "bar"].split(1)
# =&gt; [[0], [-5], [], ["foo", "bar"]]
'>Copy</button>
</div>
<p>提示：在前面的示例中觀察到，連續的分隔符會導致空陣列。</p><p>注意：在<code>active_support/core_ext/array/grouping.rb</code> 中定義。</p><p>[array#split]：<a href="https://api.Rubyonrails.org/classes/array.html#method-i-split">https://api.Rubyonrails.org/classes/array.html#method-i-split</a></p><h3 id="hash"><a class="anchorlink" href="#hash">12 <code>Hash</code> 的擴充套件</a></h3><h4 id="hash-"><a class="anchorlink" href="#hash-">12.1 次轉化</a></h4><h5 id="to-xml"><a class="anchorlink" href="#to-xml">12.1.1 <code>to_xml</code></a></h5><p>方法 [<code>to_xml</code>][Hash#to_xml] 返回一個包含其接收者的 XML 表示的字串：</p><div class="code_container">
<pre><code class="highlight plaintext">{"foo" =&gt; 1, "bar" =&gt; 2}.to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;hash&gt;
#   &lt;foo type="integer"&gt;1&lt;/foo&gt;
#   &lt;bar type="integer"&gt;2&lt;/bar&gt;
# &lt;/hash&gt;
</code></pre>
<button class="clipboard-button" data-clipboard-text='{"foo" =&gt; 1, "bar" =&gt; 2}.to_xml
# =&gt;
# &lt;?xml version="1.0" encoding="UTF-8"?&gt;
# &lt;hash&gt;
#   &lt;foo type="integer"&gt;1&lt;/foo&gt;
#   &lt;bar type="integer"&gt;2&lt;/bar&gt;
# &lt;/hash&gt;
'>Copy</button>
</div>
<p>為此，該方法遍歷對並構建依賴於 <em>values</em> 的節點。給定一對<code>key</code>，<code>value</code>：</p>
<ul>
<li><p>如果 <code>value</code> 是一個雜湊值，那麼會使用 <code>key</code> 作為 <code>:root</code> 進行遞迴呼叫。</p></li>
<li><p>如果 <code>value</code> 是一個數組，則遞迴呼叫 <code>key</code> 為 <code>:root</code>，<code>key</code> 單數化為 <code>:children</code>。</p></li>
<li><p>如果 <code>value</code> 是一個可呼叫物件，它必須期待一兩個引數。根據 arity，呼叫可呼叫物件時使用 <code>options</code> 雜湊作為第一個引數，<code>key</code> 作為 <code>:root</code>，並將 <code>key</code> 單數化作為第二個引數。它的返回值成為一個新節點。</p></li>
<li><p>如果<code>value</code> 響應<code>to_xml</code>，則使用<code>key</code> 作為<code>:root</code> 呼叫該方法。</p></li>
<li><p>否則，建立一個以<code>key</code> 作為標籤的節點，以<code>value</code> 的字串表示作為文字節點。如果<code>value</code> 是<code>nil</code>，則新增設定為“true”的屬性“nil”。除非選項<code>:skip_types</code> 存在且為真，則還會根據以下對映新增屬性“type”：</p></li>
</ul>
<div class="code_container">
<pre><code class="highlight plaintext">XML_TYPE_NAMES = {
  "Symbol"     =&gt; "Symbol",
  "Integer"    =&gt; "integer",
  "BigDecimal" =&gt; "decimal",
  "Float"      =&gt; "float",
  "TrueClass"  =&gt; "boolean",
  "FalseClass" =&gt; "boolean",
  "Date"       =&gt; "date",
  "DateTime"   =&gt; "datetime",
  "Time"       =&gt; "datetime"
}
</code></pre>
<button class="clipboard-button" data-clipboard-text='XML_TYPE_NAMES = {
  "Symbol"     =&gt; "Symbol",
  "Integer"    =&gt; "integer",
  "BigDecimal" =&gt; "decimal",
  "Float"      =&gt; "float",
  "TrueClass"  =&gt; "boolean",
  "FalseClass" =&gt; "boolean",
  "Date"       =&gt; "date",
  "DateTime"   =&gt; "datetime",
  "Time"       =&gt; "datetime"
}
'>Copy</button>
</div>
<p>預設情況下，根節點是“hash”，但可以透過 <code>:root</code> 選項進行配置。</p><p>預設的 XML 構建器是 <code>Builder::XmlMarkup</code> 的一個新例項。你可以使用 <code>:builder</code> 選項配置你自己的構建器。該方法還接受像 <code>:dasherize</code> 和朋友這樣的選項，它們被轉發到構建器。</p><p>注意：在<code>active_support/core_ext/hash/conversions.rb</code> 中定義。</p><p>[hash#to_xml]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-to_xml">https://api.Rubyonrails.org/classes/hash.html#method-i-to_xml</a></p><h4 id=""><a class="anchorlink" href="#">12.2 合併</a></h4><p>Ruby 有一個內建方法 <code>hash#merge</code> 可以合併兩個雜湊值：</p><div class="code_container">
<pre><code class="highlight plaintext">{a: 1, b: 1}.merge(a: 0, c: 2)
# =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}
</code></pre>
<button class="clipboard-button" data-clipboard-text="{a: 1, b: 1}.merge(a: 0, c: 2)
# =&gt; {:a=&gt;0, :b=&gt;1, :c=&gt;2}
">Copy</button>
</div>
<p>Active Support 定義了更多可能方便的合併雜湊的方法。</p><h5 id="reverse-merge-reverse-merge"><a class="anchorlink" href="#reverse-merge-reverse-merge">12.2.1 <code>reverse_merge</code> 和 <code>reverse_merge！</code></a></h5><p>如果發生衝突，引數雜湊中的鍵將在“合併”中獲勝。您可以使用以下習慣用法以緊湊的方式支援具有預設值的選項雜湊：</p><div class="code_container">
<pre><code class="highlight plaintext">options = {length: 30, omission: "..."}.merge(options)
</code></pre>
<button class="clipboard-button" data-clipboard-text='options = {length: 30, omission: "..."}.merge(options)
'>Copy</button>
</div>
<p>Active Support 定義了 [<code>reverse_merge</code>][hash#reverse_merge]，以防您更喜歡這種替代表示法：</p><div class="code_container">
<pre><code class="highlight plaintext">options = options.reverse_merge(length: 30, omission: "...")
</code></pre>
<button class="clipboard-button" data-clipboard-text='options = options.reverse_merge(length: 30, omission: "...")
'>Copy</button>
</div>
<p>還有一個 bang 版本 [<code>reverse_merge!</code>][Hash#reverse_merge!] 執行合併：</p><div class="code_container">
<pre><code class="highlight plaintext">options.reverse_merge!(length: 30, omission: "...")
</code></pre>
<button class="clipboard-button" data-clipboard-text='options.reverse_merge!(length: 30, omission: "...")
'>Copy</button>
</div>
<p>警告。考慮到 <code>reverse_merge!</code> 可能會改變呼叫者的雜湊值，這可能是也可能不是一個好主意。</p><p>注意：在<code>active_support/core_ext/hash/reverse_merge.rb</code> 中定義。</p><p>[hash#reverse_merge!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-reverse_merge-21">https://api.Rubyonrails.org/classes/hash.html#method-i-reverse_merge-21</a>
[hash#reverse_merge]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-reverse_merge">https://api.Rubyonrails.org/classes/hash.html#method-i-reverse_merge</a></p><h5 id="reverse-update"><a class="anchorlink" href="#reverse-update">12.2.2 <code>reverse_update</code></a></h5><p>方法 [<code>reverse_update</code>][Hash#reverse_update] 是 <code>reverse_merge!</code> 的別名，如上所述。</p><p>警告。請注意，<code>reverse_update</code> 沒有爆炸。</p><p>注意：在<code>active_support/core_ext/hash/reverse_merge.rb</code> 中定義。</p><p>[hash#reverse_update]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-reverse_update">https://api.Rubyonrails.org/classes/hash.html#method-i-reverse_update</a></p><h5 id="deep-merge-deep-merge"><a class="anchorlink" href="#deep-merge-deep-merge">12.2.3 <code>deep_merge</code> 和 <code>deep_merge！</code></a></h5><p>正如您在前面的示例中看到的那樣，如果在兩個雜湊中都找到了一個鍵，則引數中的那個值將獲勝。</p><p>Active Support 定義了 [<code>hash#deep_merge</code>][hash#deep_merge]。在深度合併中，如果在兩個雜湊中都找到了一個鍵，並且它們的值依次是雜湊，那麼它們的 <em>merge</em> 成為結果雜湊中的值：</p><div class="code_container">
<pre><code class="highlight plaintext">{a: {b: 1}}.deep_merge(a: {c: 2})
# =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}
</code></pre>
<button class="clipboard-button" data-clipboard-text="{a: {b: 1}}.deep_merge(a: {c: 2})
# =&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}
">Copy</button>
</div>
<p>方法 [<code>deep_merge!</code>][Hash#deep_merge!] 執行深度合併。</p><p>注意：在<code>active_support/core_ext/hash/deep_merge.rb</code> 中定義。</p><p>[hash#deep_merge!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_merge-21">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_merge-21</a>
[hash#deep_merge]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_merge">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_merge</a></p><h4 id=""><a class="anchorlink" href="#">12.3 深度複製</a></h4><p>方法 [<code>Hash#deep_dup</code>][Hash#deep_dup] 複製自身和所有的鍵和值
使用Active Support 方法<code>object#deep_dup</code> 在內部遞迴。它的工作原理類似於 <code>enumerator#each_with_object</code>，向內部的每一對傳送 <code>deep_dup</code> 方法。</p><div class="code_container">
<pre><code class="highlight plaintext">hash = { a: 1, b: { c: 2, d: [3, 4] } }

dup = hash.deep_dup
dup[:b][:e] = 5
dup[:b][:d] &lt;&lt; 5

hash[:b][:e] == nil      # =&gt; true
hash[:b][:d] == [3, 4]   # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = { a: 1, b: { c: 2, d: [3, 4] } }

dup = hash.deep_dup
dup[:b][:e] = 5
dup[:b][:d] &lt;&lt; 5

hash[:b][:e] == nil      # =&gt; true
hash[:b][:d] == [3, 4]   # =&gt; true
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/object/deep_dup.rb</code> 中定義。</p><p>[hash#deep_dup]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_dup">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_dup</a></p><h4 id=""><a class="anchorlink" href="#">12.4 使用金鑰</a></h4><h5 id="except-except-bang"><a class="anchorlink" href="#except-except-bang">12.4.1 <code>except</code> 和 <code>except!</code></a></h5><p>方法 [<code>except</code>][Hash#except] 返回一個雜湊，其中刪除了引數列表中的鍵（如果存在）：</p><div class="code_container">
<pre><code class="highlight plaintext">{a: 1, b: 2}.except(:a) # =&gt; {:b=&gt;2}
</code></pre>
<button class="clipboard-button" data-clipboard-text="{a: 1, b: 2}.except(:a) # =&gt; {:b=&gt;2}
">Copy</button>
</div>
<p>如果接收者響應 <code>convert_key</code>，則在每個引數上呼叫該方法。這使得 <code>except</code> 可以很好地處理具有無差異訪問的雜湊，例如：</p><div class="code_container">
<pre><code class="highlight plaintext">{a: 1}.with_indifferent_access.except(:a)  # =&gt; {}
{a: 1}.with_indifferent_access.except("a") # =&gt; {}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.with_indifferent_access.except(:a)  # =&gt; {}
{a: 1}.with_indifferent_access.except("a") # =&gt; {}
'>Copy</button>
</div>
<p>還有 bang 變體 [<code>except!</code>][Hash#except!] 可以刪除適當的鍵。</p><p>注意：在<code>active_support/core_ext/hash/except.rb</code> 中定義。</p><p>[hash#except!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-except-21">https://api.Rubyonrails.org/classes/hash.html#method-i-except-21</a>
[hash#except]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-except">https://api.Rubyonrails.org/classes/hash.html#method-i-except</a></p><h5 id="stringify-keys-stringify-keys"><a class="anchorlink" href="#stringify-keys-stringify-keys">12.4.2 <code>stringify_keys</code> 和 <code>stringify_keys！</code></a></h5><p>方法 [<code>stringify_keys</code>][Hash#stringify_keys] 返回一個雜湊，該雜湊具有接收器中鍵的字串化版本。它透過向他們傳送 <code>to_s</code> 來實現：</p><div class="code_container">
<pre><code class="highlight plaintext">{nil =&gt; nil, 1 =&gt; 1, a: :a}.stringify_keys
# =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, a: :a}.stringify_keys
# =&gt; {"" =&gt; nil, "1" =&gt; 1, "a" =&gt; :a}
'>Copy</button>
</div>
<p>在金鑰衝突的情況下，該值將是最近插入雜湊的值：</p><div class="code_container">
<pre><code class="highlight plaintext">{"a" =&gt; 1, a: 2}.stringify_keys
# The result will be
# =&gt; {"a"=&gt;2}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{"a" =&gt; 1, a: 2}.stringify_keys
# The result will be
# =&gt; {"a"=&gt;2}
'>Copy</button>
</div>
<p>此方法可能很有用，例如可以輕鬆接受 Symbol 和字串作為選項。例如<code>actionview::helpers::formhelper</code> 定義：</p><div class="code_container">
<pre><code class="highlight plaintext">def to_check_box_tag(options = {}, checked_value = "1", unchecked_value = "0")
  options = options.stringify_keys
  options["type"] = "checkbox"
  # ...
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='def to_check_box_tag(options = {}, checked_value = "1", unchecked_value = "0")
  options = options.stringify_keys
  options["type"] = "checkbox"
  # ...
end
'>Copy</button>
</div>
<p>第二行可以安全地訪問“type”鍵，並讓使用者傳遞<code>:type</code>或“type”。</p><p>還有 bang 變體 [<code>stringify_keys!</code>][Hash#stringify_keys!] 將鍵字串化到位。</p><p>除此之外，可以使用 [<code>deep_stringify_keys</code>][Hash#deep_stringify_keys] 和 [<code>deep_stringify_keys!</code>][Hash#deep_stringify_keys!] 將給定雜湊中的所有鍵和巢狀在其中的所有雜湊字串化。結果的一個例子是：</p><div class="code_container">
<pre><code class="highlight plaintext">{nil =&gt; nil, 1 =&gt; 1, nested: {a: 3, 5 =&gt; 5}}.deep_stringify_keys
# =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, nested: {a: 3, 5 =&gt; 5}}.deep_stringify_keys
# =&gt; {""=&gt;nil, "1"=&gt;1, "nested"=&gt;{"a"=&gt;3, "5"=&gt;5}}
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/hash/keys.rb</code> 中定義。</p><p>[hash#deep_stringify_keys!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_stringify_keys-21">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_stringify_keys-21</a>
[hash#deep_stringify_keys]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_stringify_keys">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_stringify_keys</a>
[hash#stringify_keys!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-stringify_keys-21">https://api.Rubyonrails.org/classes/hash.html#method-i-stringify_keys-21</a>
[hash#stringify_keys]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-stringify_keys">https://api.Rubyonrails.org/classes/hash.html#method-i-stringify_keys</a></p><h5 id="symbolize-keys-symbolize-keys-bang"><a class="anchorlink" href="#symbolize-keys-symbolize-keys-bang">12.4.3 <code>symbolize_keys</code> 和 <code>symbolize_keys!</code></a></h5><p>在可能的情況下，方法 [<code>Symbolize_keys</code>][hash#Symbolize_keys] 返回一個雜湊，該雜湊在接收器中具有 Symbolized 版本的金鑰。它透過向他們傳送 <code>to_sym</code> 來實現：</p><div class="code_container">
<pre><code class="highlight plaintext">{nil =&gt; nil, 1 =&gt; 1, "a" =&gt; "a"}.Symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, "a" =&gt; "a"}.Symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, :a=&gt;"a"}
'>Copy</button>
</div>
<p>警告。請注意，在前面的示例中，只有一個鍵被 Symbol 化。</p><p>在金鑰衝突的情況下，該值將是最近插入雜湊的值：</p><div class="code_container">
<pre><code class="highlight plaintext">{"a" =&gt; 1, a: 2}.Symbolize_keys
# =&gt; {:a=&gt;2}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{"a" =&gt; 1, a: 2}.Symbolize_keys
# =&gt; {:a=&gt;2}
'>Copy</button>
</div>
<p>此方法可能很有用，例如可以輕鬆接受 Symbol 和字串作為選項。例如<code>actiontext::taghelper</code> 定義</p><div class="code_container">
<pre><code class="highlight plaintext">def rich_text_area_tag(name, value = nil, options = {})
  options = options.Symbolize_keys

  options[:input] ||= "trix_input_#{actiontext::tagHelper.id += 1}"
  # ...
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='def rich_text_area_tag(name, value = nil, options = {})
  options = options.Symbolize_keys

  options[:input] ||= "trix_input_#{actiontext::tagHelper.id += 1}"
  # ...
end
'>Copy</button>
</div>
<p>第三行可以安全地訪問<code>:input</code> 鍵，並讓使用者傳遞<code>:input</code> 或“input”。</p><p>還有 bang 變體 [<code>Symbolize_keys!</code>][hash#Symbolize_keys!] 可以Symbol適當地調整鍵。</p><p>除此之外，可以使用 [<code>deep_Symbolize_keys</code>][hash#deep_Symbolize_keys] 和 [<code>deep_Symbolize_keys!</code>][hash#deep_Symbolize_keys!] 來Symbol將給定雜湊中的所有鍵以及巢狀在其中的所有雜湊化。結果的一個例子是：</p><div class="code_container">
<pre><code class="highlight plaintext">{nil =&gt; nil, 1 =&gt; 1, "nested" =&gt; {"a" =&gt; 3, 5 =&gt; 5}}.deep_Symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}
</code></pre>
<button class="clipboard-button" data-clipboard-text='{nil =&gt; nil, 1 =&gt; 1, "nested" =&gt; {"a" =&gt; 3, 5 =&gt; 5}}.deep_Symbolize_keys
# =&gt; {nil=&gt;nil, 1=&gt;1, nested:{a:3, 5=&gt;5}}
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/hash/keys.rb</code> 中定義。</p><p>[hash#deep_symbolize_keys!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_symbolize_keys-21">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_symbolize_keys-21</a>
[hash#deep_symbolize_keys]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_symbolize_keys">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_symbolize_keys</a>
[hash#symbolize_keys!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-symbolize_keys-21">https://api.Rubyonrails.org/classes/hash.html#method-i-symbolize_keys-21</a>
[hash#symbolize_keys]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-symbolize_keys">https://api.Rubyonrails.org/classes/hash.html#method-i-symbolize_keys</a></p><h5 id="to-options-to-options"><a class="anchorlink" href="#to-options-to-options">12.4.4 <code>to_options</code> 和 <code>to_options！</code></a></h5><p>方法 [<code>to_options</code>][hash#to_options] 和 [<code>to_options!</code>][hash#to_options!] 分別是 <code>Symbolize_keys</code> 和 <code>Symbolize_keys!</code> 的別名。</p><p>注意：在<code>active_support/core_ext/hash/keys.rb</code> 中定義。</p><p>[hash#to_options!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-to_options-21">https://api.Rubyonrails.org/classes/hash.html#method-i-to_options-21</a>
[hash#to_options]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-to_options">https://api.Rubyonrails.org/classes/hash.html#method-i-to_options</a></p><h5 id="assert-valid-keys"><a class="anchorlink" href="#assert-valid-keys">12.4.5 <code>assert_valid_keys</code></a></h5><p>方法 [<code>assert_valid_keys</code>][Hash#assert_valid_keys] 接收任意數量的引數，並檢查接收者是否有該列表之外的任何鍵。如果確實如此，則會引發 <code>ArgumentError</code>。</p><div class="code_container">
<pre><code class="highlight plaintext">{a: 1}.assert_valid_keys(:a)  # passes
{a: 1}.assert_valid_keys("a") # ArgumentError
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.assert_valid_keys(:a)  # passes
{a: 1}.assert_valid_keys("a") # ArgumentError
'>Copy</button>
</div>
<p>例如，active record 在構建 Association 時不接受未知選項。它透過 <code>assert_valid_keys</code> 實現該控制。</p><p>注意：在<code>active_support/core_ext/hash/keys.rb</code> 中定義。</p><p>[hash#assert_valid_keys]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-assert_valid_keys">https://api.Rubyonrails.org/classes/hash.html#method-i-assert_valid_keys</a></p><h4 id=""><a class="anchorlink" href="#">12.5 處理值</a></h4><h5 id="deep-transform-values-deep-transform-values"><a class="anchorlink" href="#deep-transform-values-deep-transform-values">12.5.1 <code>deep_transform_values</code> 和 <code>deep_transform_values！</code></a></h5><p>方法 [<code>deep_transform_values</code>][Hash#deep_transform_values] 返回一個新的雜湊，其中所有值都由塊操作轉換。這包括來自根雜湊和所有巢狀雜湊和陣列的值。</p><div class="code_container">
<pre><code class="highlight plaintext">hash = { person: { name: 'Rob', age: '28' } }

hash.deep_transform_values{ |value| value.to_s.upcase }
# =&gt; {person: {name: "ROB", age: "28"}}
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = { person: { name: 'Rob', age: '28' } }

hash.deep_transform_values{ |value| value.to_s.upcase }
# =&gt; {person: {name: &quot;ROB&quot;, age: &quot;28&quot;}}
">Copy</button>
</div>
<p>還有 bang 變體 [<code>deep_transform_values!</code>][Hash#deep_transform_values!] 使用塊操作破壞性地轉換所有值。</p><p>注意：在<code>active_support/core_ext/hash/deep_transform_values.rb</code> 中定義。</p><p>[hash#deep_transform_values!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_transform_values-21">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_transform_values-21</a>
[hash#deep_transform_values]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-deep_transform_values">https://api.Rubyonrails.org/classes/hash.html#method-i-deep_transform_values</a></p><h4 id=""><a class="anchorlink" href="#">12.6 切片</a></h4><p>方法 [<code>slice!</code>][Hash#slice!] 僅用給定的鍵替換雜湊，並返回包含刪除的鍵/值對的雜湊。</p><div class="code_container">
<pre><code class="highlight plaintext">hash = {a: 1, b: 2}
rest = hash.slice!(:a) # =&gt; {:b=&gt;2}
hash                   # =&gt; {:a=&gt;1}
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = {a: 1, b: 2}
rest = hash.slice!(:a) # =&gt; {:b=&gt;2}
hash                   # =&gt; {:a=&gt;1}
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/hash/slice.rb</code> 中定義。</p><p>[hash#slice!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-slice-21">https://api.Rubyonrails.org/classes/hash.html#method-i-slice-21</a></p><h4 id="hash"><a class="anchorlink" href="#hash">12.7 提取</a></h4><p>方法 [<code>extract!</code>][Hash#extract!] 刪除並返回匹配給定鍵的鍵/值對。</p><div class="code_container">
<pre><code class="highlight plaintext">hash = {a: 1, b: 2}
rest = hash.extract!(:a) # =&gt; {:a=&gt;1}
hash                     # =&gt; {:b=&gt;2}
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = {a: 1, b: 2}
rest = hash.extract!(:a) # =&gt; {:a=&gt;1}
hash                     # =&gt; {:b=&gt;2}
">Copy</button>
</div>
<p><code>extract!</code> 方法返回與接收者相同的 Hash 子類。</p><div class="code_container">
<pre><code class="highlight plaintext">hash = {a: 1, b: 2}.with_indifferent_access
rest = hash.extract!(:a).class
# =&gt; ActiveSupport::HashWithIndifferentAccess
</code></pre>
<button class="clipboard-button" data-clipboard-text="hash = {a: 1, b: 2}.with_indifferent_access
rest = hash.extract!(:a).class
# =&gt; ActiveSupport::HashWithIndifferentAccess
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/hash/slice.rb</code> 中定義。</p><p>[hash#extract!]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-extract-21">https://api.Rubyonrails.org/classes/hash.html#method-i-extract-21</a></p><h4 id=""><a class="anchorlink" href="#">12.8 無所謂訪問</a></h4><p>方法 [<code>with_indifferent_access</code>][Hash#with_indifferent_access] 從其接收者返回一個 [<code>ActiveSupport::HashWithIndifferentAccess</code>][ActiveSupport::HashWithIndifferentAccess]：</p><div class="code_container">
<pre><code class="highlight plaintext">{a: 1}.with_indifferent_access["a"] # =&gt; 1
</code></pre>
<button class="clipboard-button" data-clipboard-text='{a: 1}.with_indifferent_access["a"] # =&gt; 1
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/hash/indifferent_access.rb</code> 中定義。</p><p>[activesupport::hashwithindifferentaccess]：<a href="https://api.Rubyonrails.org/classes/activesupport/hashwithindifferentaccess.html">https://api.Rubyonrails.org/classes/activesupport/hashwithindifferentaccess.html</a>
[hash#with_indifferent_access]：<a href="https://api.Rubyonrails.org/classes/hash.html#method-i-with_indifferent_access">https://api.Rubyonrails.org/classes/hash.html#method-i-with_indifferent_access</a></p><h3 id="regexp"><a class="anchorlink" href="#regexp">13 <code>Regexp</code> 的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">13.1 <code>多行？</code></a></h4><p>方法 [<code>multiline?</code>][Regexp#multiline?] 表示正則表示式是否設定了 <code>/m</code> 標誌，即點是否與換行符匹配。</p><div class="code_container">
<pre><code class="highlight plaintext">%r{.}.multiline?  # =&gt; false
%r{.}m.multiline? # =&gt; true

Regexp.new('.').multiline?                    # =&gt; false
Regexp.new('.', Regexp::MULTILINE).multiline? # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="%r{.}.multiline?  # =&gt; false
%r{.}m.multiline? # =&gt; true

Regexp.new('.').multiline?                    # =&gt; false
Regexp.new('.', Regexp::MULTILINE).multiline? # =&gt; true
">Copy</button>
</div>
<p>Rails 在一個地方使用這個方法，也在路由程式碼中。路由要求不允許使用多行正則表示式，並且此標誌可以簡化執行該約束。</p><div class="code_container">
<pre><code class="highlight plaintext">def verify_regexp_requirements(requirements)
  # ...
  if requirement.multiline?
    raise ArgumentError, "Regexp multiline option is not allowed in routing requirements: #{requirement.inspect}"
  end
  # ...
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='def verify_regexp_requirements(requirements)
  # ...
  if requirement.multiline?
    raise ArgumentError, "Regexp multiline option is not allowed in routing requirements: #{requirement.inspect}"
  end
  # ...
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/regexp.rb</code> 中定義。</p><p>[regexp#multiline?]：<a href="https://api.Rubyonrails.org/classes/regexp.html#method-i-multiline-3f">https://api.Rubyonrails.org/classes/regexp.html#method-i-multiline-3f</a></p><h3 id=""><a class="anchorlink" href="#">14 “範圍”的擴充套件</a></h3><h4 id="to-s"><a class="anchorlink" href="#to-s">14.1 <code>to_s</code></a></h4><p>Active Support 擴充套件了<code>range#to_s</code> 方法，以便它理解一個可選的格式引數。在撰寫本文時，唯一支援的非預設格式是 <code>:db</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">(Date.today..Date.tomorrow).to_s
# =&gt; "2009-10-25..2009-10-26"

(Date.today..Date.tomorrow).to_s(:db)
# =&gt; "BETWEEN '2009-10-25' AND '2009-10-26'"
</code></pre>
<button class="clipboard-button" data-clipboard-text="(Date.today..Date.tomorrow).to_s
# =&gt; &quot;2009-10-25..2009-10-26&quot;

(Date.today..Date.tomorrow).to_s(:db)
# =&gt; &quot;BETWEEN '2009-10-25' AND '2009-10-26'&quot;
">Copy</button>
</div>
<p>如示例所示，<code>:db</code> 格式生成一個 <code>between</code> sql 子句。 Active Record 用於支援條件中的範圍值。</p><p>注意：在<code>active_support/core_ext/range/conversions.rb</code> 中定義。</p><h4 id="include-questionmark"><a class="anchorlink" href="#include-questionmark">14.2 <code>===</code> 和 <code>include?</code></a></h4><p>方法 <code>Range#===</code> 和 <code>Range#include?</code> 說明某個值是否落在給定例項的兩端之間：</p><div class="code_container">
<pre><code class="highlight plaintext">(2..3).include?(Math::E) # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="(2..3).include?(Math::E) # =&gt; true
">Copy</button>
</div>
<p>Active Support 擴充套件了這些方法，以便引數可以依次為另一個範圍。在這種情況下，我們測試引數範圍的末端是否屬於接收器本身：</p><div class="code_container">
<pre><code class="highlight plaintext">(1..10) === (3..7)  # =&gt; true
(1..10) === (0..7)  # =&gt; false
(1..10) === (3..11) # =&gt; false
(1...9) === (3..9)  # =&gt; false

(1..10).include?(3..7)  # =&gt; true
(1..10).include?(0..7)  # =&gt; false
(1..10).include?(3..11) # =&gt; false
(1...9).include?(3..9)  # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text="(1..10) === (3..7)  # =&gt; true
(1..10) === (0..7)  # =&gt; false
(1..10) === (3..11) # =&gt; false
(1...9) === (3..9)  # =&gt; false

(1..10).include?(3..7)  # =&gt; true
(1..10).include?(0..7)  # =&gt; false
(1..10).include?(3..11) # =&gt; false
(1...9).include?(3..9)  # =&gt; false
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/range/compare_range.rb</code> 中定義。</p><h4 id=""><a class="anchorlink" href="#">14.3 <code>重疊？</code></a></h4><p>方法 [<code>Range#overlaps?</code>][Range#overlaps?] 表示任何兩個給定的範圍是否有非空交集：</p><div class="code_container">
<pre><code class="highlight plaintext">(1..10).overlaps?(7..11)  # =&gt; true
(1..10).overlaps?(0..7)   # =&gt; true
(1..10).overlaps?(11..27) # =&gt; false
</code></pre>
<button class="clipboard-button" data-clipboard-text="(1..10).overlaps?(7..11)  # =&gt; true
(1..10).overlaps?(0..7)   # =&gt; true
(1..10).overlaps?(11..27) # =&gt; false
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/range/overlaps.rb</code> 中定義。</p><p>[range#overlaps?]：<a href="https://api.Rubyonrails.org/classes/range.html#method-i-overlaps-3f">https://api.Rubyonrails.org/classes/range.html#method-i-overlaps-3f</a></p><h3 id=""><a class="anchorlink" href="#">15 “日期”的擴充套件</a></h3><h4 id="-"><a class="anchorlink" href="#-">15.1 計算</a></h4><p>資訊：以下計算方法在 1582 年 10 月存在邊緣情況，因為 5..14 天不存在。為簡潔起見，本指南並未記錄他們當時的行為，但足以說明他們的行為符合您的預期。也就是說，<code>date.new(1582, 10, 4).tomorrow</code> 返回 <code>date.new(1582, 10, 15)</code> 等等。請檢查Active Support 測試套件中的<code>test/core_ext/date_ext_test.rb</code> 以瞭解預期行為。</p><h5 id="date-current"><a class="anchorlink" href="#date-current">15.1.1 <code>date.current</code></a></h5><p>Active Support 將 [<code>date.current</code>][date.current] 定義為當前時區中的今天。這就像<code>date.today</code>，除了它尊重使用者時區，如果定義。它還定義了 [<code>date.yesterday</code>][date.yesterday] 和 [<code>date.tomorrow</code>][date.tomorrow]，以及例項謂詞 [<code>past?</code>][dateandtime::calculations#past?]、[ <code>今天？</code>][dateandtime::calculations#today?]、[<code>tomorrow?</code>][dateandtime::calculations#tomorrow?]、[<code>next_day?</code>][dateandtime::calculations#next_day?]、[<code>yesterday ?</code>][dateandtime::calculations#yesterday?], [<code>prev_day?</code>][dateandtime::calculations#prev_day?], [<code>future?</code>][dateandtime::calculations#future?], [<code>on_weekday?</code> ][dateandtime::calculations#on_weekday?] 和 [<code>on_weekend?</code>][dateandtime::calculations#on_weekend?]，所有這些都相對於 <code>date.current</code>。</p><p>使用尊重使用者時區的方法進行日期比較時，請確保使用“Date.current”而不是“Date.today”。在某些情況下，使用者時區可能在未來與系統時區相比，“Date.today”預設使用。這意味著“Date.today”可能等於“Date.yesterday”。</p><p>注意：在<code>active_support/core_ext/date/calculations.rb</code> 中定義。</p><p>[date.current]：<a href="https://api.Rubyonrails.org/classes/date.html#method-c-current">https://api.Rubyonrails.org/classes/date.html#method-c-current</a>
[date.tomorrow]：<a href="https://api.Rubyonrails.org/classes/date.html#method-c-tomorrow">https://api.Rubyonrails.org/classes/date.html#method-c-tomorrow</a>
[date.yesterday]：<a href="https://api.Rubyonrails.org/classes/date.html#method-c-yesterday">https://api.Rubyonrails.org/classes/date.html#method-c-yesterday</a>
[dateandtime::calculations#future?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-future-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-future-3f</a>
[dateandtime::calculations#on_weekday?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-on_weekday-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-on_weekday-3f</a>
[dateandtime::calculations#on_weekend?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-on_weekend-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-on_weekend-3f</a>
[dateandtime::calculations#past?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-past-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-past-3f</a></p><h5 id=""><a class="anchorlink" href="#">15.1.2 命名日期</a></h5><h6 id="beginning-of-week-end-of-week"><a class="anchorlink" href="#beginning-of-week-end-of-week">15.1.2.1 <code>beginning_of_week</code>、<code>end_of_week</code></a></h6><p>方法 [<code>beginning_of_week</code>][DateAndTime::Calculations#beginning_of_week] 和 [<code>end_of_week</code>][DateAndTime::Calculations#end_of_week] 返回日期
分別是一週的開始和結束。假定周開始於
星期一，但可以透過傳遞引數來更改，將執行緒設定為本地
<code>Date.beginning_of_week</code> 或 <code>config.beginning_of_week</code>。</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.beginning_of_week          # =&gt; Mon, 03 May 2010
d.beginning_of_week(:sunday) # =&gt; Sun, 02 May 2010
d.end_of_week                # =&gt; Sun, 09 May 2010
d.end_of_week(:sunday)       # =&gt; Sat, 08 May 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.beginning_of_week          # =&gt; Mon, 03 May 2010
d.beginning_of_week(:sunday) # =&gt; Sun, 02 May 2010
d.end_of_week                # =&gt; Sun, 09 May 2010
d.end_of_week(:sunday)       # =&gt; Sat, 08 May 2010
">Copy</button>
</div>
<p><code>beginning_of_week</code> 的別名為 [<code>at_beginning_of_week</code>][DateAndTime::Calculations#at_beginning_of_week]，而 <code>end_of_week</code> 的別名為 [<code>at_end_of_week</code>][DateAndTime::Calculations#at_end_of_week]。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#at_beginning_of_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_week</a>
[dateandtime::calculations#at_end_of_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_week</a>
[dateandtime::calculations#beginning_of_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_week</a>
[dateandtime::calculations#end_of_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_week</a></p><h6 id=""><a class="anchorlink" href="#">15.1.2.2 <code>星期一</code>、<code>星期日</code></a></h6><p>方法 [<code>monday</code>][DateAndTime::Calculations#monday] 和 [<code>sunday</code>][DateAndTime::Calculations#sunday] 返回前一個星期一的日期和
下週日，分別。</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.monday                     # =&gt; Mon, 03 May 2010
d.sunday                     # =&gt; Sun, 09 May 2010

d = Date.new(2012, 9, 10)    # =&gt; Mon, 10 Sep 2012
d.monday                     # =&gt; Mon, 10 Sep 2012

d = Date.new(2012, 9, 16)    # =&gt; Sun, 16 Sep 2012
d.sunday                     # =&gt; Sun, 16 Sep 2012
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 8)     # =&gt; Sat, 08 May 2010
d.monday                     # =&gt; Mon, 03 May 2010
d.sunday                     # =&gt; Sun, 09 May 2010

d = Date.new(2012, 9, 10)    # =&gt; Mon, 10 Sep 2012
d.monday                     # =&gt; Mon, 10 Sep 2012

d = Date.new(2012, 9, 16)    # =&gt; Sun, 16 Sep 2012
d.sunday                     # =&gt; Sun, 16 Sep 2012
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#monday]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-monday">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-monday</a>
[dateandtime::calculations#sunday]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-sunday">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-sunday</a></p><h6 id="prev-week-next-week"><a class="anchorlink" href="#prev-week-next-week">15.1.2.3 <code>prev_week</code>、<code>next_week</code></a></h6><p>方法 [<code>next_week</code>][dateandtime::calculations#next_week] 接收一個Symbol 的英文日期名稱（預設是執行緒本地 [<code>date.beginning_of_week</code>][date.beginning_of_week]，或 <code>config.beginning_of_week]。 begin_of_week</code> 或 <code>:monday</code>) 並返回與該天對應的日期。</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.next_week              # =&gt; Mon, 10 May 2010
d.next_week(:saturday)   # =&gt; Sat, 15 May 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.next_week              # =&gt; Mon, 10 May 2010
d.next_week(:saturday)   # =&gt; Sat, 15 May 2010
">Copy</button>
</div>
<p>方法 [<code>prev_week</code>][DateAndTime::Calculations#prev_week] 是類似的：</p><div class="code_container">
<pre><code class="highlight plaintext">d.prev_week              # =&gt; Mon, 26 Apr 2010
d.prev_week(:saturday)   # =&gt; Sat, 01 May 2010
d.prev_week(:friday)     # =&gt; Fri, 30 Apr 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="d.prev_week              # =&gt; Mon, 26 Apr 2010
d.prev_week(:saturday)   # =&gt; Sat, 01 May 2010
d.prev_week(:friday)     # =&gt; Fri, 30 Apr 2010
">Copy</button>
</div>
<p><code>prev_week</code> 別名為 [<code>last_week</code>][DateAndTime::Calculations#last_week]。</p><p>當設定了 Date.beginning_of_week 或 config.beginning_of_week 時，next_week 和 prev_week 都按預期工作。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[date.beginning_of_week]：<a href="https://api.Rubyonrails.org/classes/date.html#method-c-beginning_of_week">https://api.Rubyonrails.org/classes/date.html#method-c-beginning_of_week</a>
[dateandtime::calculations#last_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_week</a>
[dateandtime::calculations#next_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-next_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-next_week</a>
[dateandtime::calculations#prev_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-prev_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-prev_week</a></p><h6 id="beginning-of-month-end-of-month"><a class="anchorlink" href="#beginning-of-month-end-of-month">15.1.2.4 <code>beginning_of_month</code>、<code>end_of_month</code></a></h6><p>方法 [<code>beginning_of_month</code>][DateAndTime::Calculations#beginning_of_month] 和 [<code>end_of_month</code>][DateAndTime::Calculations#end_of_month] 返回月份的開始和結束日期：</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_month     # =&gt; Sat, 01 May 2010
d.end_of_month           # =&gt; Mon, 31 May 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_month     # =&gt; Sat, 01 May 2010
d.end_of_month           # =&gt; Mon, 31 May 2010
">Copy</button>
</div>
<p><code>beginning_of_month</code> 的別名為 [<code>at_beginning_of_month</code>][DateAndTime::Calculations#at_beginning_of_month]，而 <code>end_of_month</code> 的別名為 [<code>at_end_of_month</code>][DateAndTime::Calculations#at_end_of_month]。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#at_beginning_of_month]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_month">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_month</a>
[dateandtime::calculations#at_end_of_month]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_month">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_month</a>
[dateandtime::calculations#beginning_of_month]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_month">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_month</a>
[dateandtime::calculations#end_of_month]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_month">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_month</a></p><h6 id="beginning-of-quarter-end-of-quarter"><a class="anchorlink" href="#beginning-of-quarter-end-of-quarter">15.1.2.5 <code>beginning_of_quarter</code>、<code>end_of_quarter</code></a></h6><p>方法 [<code>beginning_of_quarter</code>][DateAndTime::Calculations#beginning_of_quarter] 和 [<code>end_of_quarter</code>][DateAndTime::Calculations#end_of_quarter] 返回接收方日曆年季度開始和結束的日期：</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_quarter   # =&gt; Thu, 01 Apr 2010
d.end_of_quarter         # =&gt; Wed, 30 Jun 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_quarter   # =&gt; Thu, 01 Apr 2010
d.end_of_quarter         # =&gt; Wed, 30 Jun 2010
">Copy</button>
</div>
<p><code>beginning_of_quarter</code> 的別名為 [<code>at_beginning_of_quarter</code>][DateAndTime::Calculations#at_beginning_of_quarter]，而 <code>end_of_quarter</code> 的別名為 [<code>at_end_of_quarter</code>][DateAndTime::Calculations#at_end_of_quarter]。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#at_beginning_of_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_quarter</a>
[dateandtime::calculations#at_end_of_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_quarter</a>
[dateandtime::calculations#beginning_of_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_quarter</a>
[dateandtime::calculations#end_of_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_quarter</a></p><h6 id="beginning-of-year-end-of-year"><a class="anchorlink" href="#beginning-of-year-end-of-year">15.1.2.6 <code>beginning_of_year</code>、<code>end_of_year</code></a></h6><p>方法 [<code>beginning_of_year</code>][DateAndTime::Calculations#beginning_of_year] 和 [<code>end_of_year</code>][DateAndTime::Calculations#end_of_year] 返回年份的開始和結束日期：</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_year      # =&gt; Fri, 01 Jan 2010
d.end_of_year            # =&gt; Fri, 31 Dec 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.new(2010, 5, 9) # =&gt; Sun, 09 May 2010
d.beginning_of_year      # =&gt; Fri, 01 Jan 2010
d.end_of_year            # =&gt; Fri, 31 Dec 2010
">Copy</button>
</div>
<p><code>beginning_of_year</code> 的別名為 [<code>at_beginning_of_year</code>][DateAndTime::Calculations#at_beginning_of_year]，而 <code>end_of_year</code> 的別名為 [<code>at_end_of_year</code>][DateAndTime::Calculations#at_end_of_year]。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#at_beginning_of_year]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_year">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_beginning_of_year</a>
[dateandtime::calculations#at_end_of_year]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_year">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-at_end_of_year</a>
[dateandtime::calculations#beginning_of_year]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_year">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-beginning_of_year</a>
[dateandtime::calculations#end_of_year]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_year">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-end_of_year</a></p><h5 id=""><a class="anchorlink" href="#">15.1.3 其他日期計算</a></h5><h6 id="years-ago-years-since"><a class="anchorlink" href="#years-ago-years-since">15.1.3.1 <code>years_ago</code>，<code>years_since</code></a></h6><p>方法 [<code>years_ago</code>][DateAndTime::Calculations#years_ago] 接收若干年並返回與多年前相同的日期：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.new(2010, 6, 7)
date.years_ago(10) # =&gt; Wed, 07 Jun 2000
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.years_ago(10) # =&gt; Wed, 07 Jun 2000
">Copy</button>
</div>
<p>[<code>years_since</code>][DateAndTime::Calculations#years_since] 時間向前移動：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.new(2010, 6, 7)
date.years_since(10) # =&gt; Sun, 07 Jun 2020
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.years_since(10) # =&gt; Sun, 07 Jun 2020
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2012, 2, 29).years_ago(3)     # =&gt; Sat, 28 Feb 2009
Date.new(2012, 2, 29).years_since(3)   # =&gt; Sat, 28 Feb 2015
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2012, 2, 29).years_ago(3)     # =&gt; Sat, 28 Feb 2009
Date.new(2012, 2, 29).years_since(3)   # =&gt; Sat, 28 Feb 2015
">Copy</button>
</div>
<p>[<code>last_year</code>][DateAndTime::Calculations#last_year] 是 <code>#years_ago(1)</code> 的簡寫。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#last_year]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_year">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_year</a>
[dateandtime::calculations#years_ago]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-years_ago">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-years_ago</a>
[dateandtime::calculations#years_since]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-years_since">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-years_since</a></p><h6 id="months-ago-months-since"><a class="anchorlink" href="#months-ago-months-since">15.1.3.2 <code>months_ago</code>、<code>months_since</code></a></h6><p>方法 [<code>months_ago</code>][DateAndTime::Calculations#months_ago] 和 [<code>months_since</code>][DateAndTime::Calculations#months_since] 的工作方式類似：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 4, 30).months_ago(2)   # =&gt; Sun, 28 Feb 2010
Date.new(2010, 4, 30).months_since(2) # =&gt; Wed, 30 Jun 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 4, 30).months_ago(2)   # =&gt; Sun, 28 Feb 2010
Date.new(2010, 4, 30).months_since(2) # =&gt; Wed, 30 Jun 2010
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 4, 30).months_ago(2)    # =&gt; Sun, 28 Feb 2010
Date.new(2009, 12, 31).months_since(2) # =&gt; Sun, 28 Feb 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 4, 30).months_ago(2)    # =&gt; Sun, 28 Feb 2010
Date.new(2009, 12, 31).months_since(2) # =&gt; Sun, 28 Feb 2010
">Copy</button>
</div>
<p>[<code>last_month</code>][DateAndTime::Calculations#last_month] 是 <code>#months_ago(1)</code> 的簡寫。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#last_month]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_month">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_month</a>
[dateandtime::calculations#months_ago]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-months_ago">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-months_ago</a>
[dateandtime::calculations#months_since]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-months_since">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-months_since</a></p><h6 id="weeks-ago"><a class="anchorlink" href="#weeks-ago">15.1.3.3 <code>weeks_ago</code></a></h6><p>方法 [<code>weeks_ago</code>][DateAndTime::Calculations#weeks_ago] 類似地工作數週：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 5, 24).weeks_ago(1)    # =&gt; Mon, 17 May 2010
Date.new(2010, 5, 24).weeks_ago(2)    # =&gt; Mon, 10 May 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 5, 24).weeks_ago(1)    # =&gt; Mon, 17 May 2010
Date.new(2010, 5, 24).weeks_ago(2)    # =&gt; Mon, 10 May 2010
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#weeks_ago]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-weeks_ago">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-weeks_ago</a></p><h6 id="-"><a class="anchorlink" href="#-">15.1.3.4 <code>提前</code></a></h6><p>跳轉到其他日期的最通用方法是 [<code>advance</code>][Date#advance]。這個方法接收一個帶有鍵<code>:years</code>、<code>:months</code>、<code>:weeks</code>、<code>:days</code>的雜湊，並返回一個與當前鍵指示一樣多的日期：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.new(2010, 6, 6)
date.advance(years: 1, weeks: 2)  # =&gt; Mon, 20 Jun 2011
date.advance(months: 2, days: -2) # =&gt; Wed, 04 Aug 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 6)
date.advance(years: 1, weeks: 2)  # =&gt; Mon, 20 Jun 2011
date.advance(months: 2, days: -2) # =&gt; Wed, 04 Aug 2010
">Copy</button>
</div>
<p>請注意，在前面的示例中，增量可能為負。</p><p>為了執行計算，該方法首先遞增年，然後是月，然後是周，最後是天。這個命令在幾個月結束時很重要。比如說，我們現在是 2010 年 2 月底，我們想向前推進一個月零一天。</p><p>方法<code>advance</code>先提前一個月，然後一天，結果是：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 2, 28).advance(months: 1, days: 1)
# =&gt; Sun, 29 Mar 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 2, 28).advance(months: 1, days: 1)
# =&gt; Sun, 29 Mar 2010
">Copy</button>
</div>
<p>而如果反過來，結果會有所不同：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 2, 28).advance(days: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 2, 28).advance(days: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date/calculations.rb</code> 中定義。</p><p>[date#advance]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-advance">https://api.Rubyonrails.org/classes/date.html#method-i-advance</a></p><h5 id="--"><a class="anchorlink" href="#--">15.1.4 改變元件</a></h5><p>方法 [<code>change</code>][Date#change] 允許您獲取與接收者相同的新日期，除了給定的年、月或日：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 12, 23).change(year: 2011, month: 11)
# =&gt; Wed, 23 Nov 2011
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 12, 23).change(year: 2011, month: 11)
# =&gt; Wed, 23 Nov 2011
">Copy</button>
</div>
<p>此方法不容忍不存在的日期，如果更改無效，則會引發 <code>ArgumentError</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(2010, 1, 31).change(month: 2)
# =&gt; ArgumentError: invalid date
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(2010, 1, 31).change(month: 2)
# =&gt; ArgumentError: invalid date
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date/calculations.rb</code> 中定義。</p><p>[date#change]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-change">https://api.Rubyonrails.org/classes/date.html#method-i-change</a></p><h5 id="--"><a class="anchorlink" href="#--">15.1.5 持續時間</a></h5><p>[<code>Duration</code>][ActiveSupport::Duration] 物件可以新增到日期或從日期中減去：</p><div class="code_container">
<pre><code class="highlight plaintext">d = Date.current
# =&gt; Mon, 09 Aug 2010
d + 1.year
# =&gt; Tue, 09 Aug 2011
d - 3.hours
# =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = Date.current
# =&gt; Mon, 09 Aug 2010
d + 1.year
# =&gt; Tue, 09 Aug 2011
d - 3.hours
# =&gt; Sun, 08 Aug 2010 21:00:00 UTC +00:00
">Copy</button>
</div>
<p>它們轉化為對“since”或“advance”的呼叫。例如在這裡我們得到了日曆改革的正確跳轉：</p><div class="code_container">
<pre><code class="highlight plaintext">Date.new(1582, 10, 4) + 1.day
# =&gt; Fri, 15 Oct 1582
</code></pre>
<button class="clipboard-button" data-clipboard-text="Date.new(1582, 10, 4) + 1.day
# =&gt; Fri, 15 Oct 1582
">Copy</button>
</div>
<p>[activesupport::duration]：<a href="https://api.Rubyonrails.org/classes/activesupport/duration.html">https://api.Rubyonrails.org/classes/activesupport/duration.html</a></p><h5 id=""><a class="anchorlink" href="#">15.1.6 時間戳</a></h5><p>資訊：如果可能，以下方法返回一個 <code>Time</code> 物件，否則返回一個 <code>DateTime</code>。如果設定，則它們遵循使用者時區。</p><h6 id="beginning-of-day-end-of-day"><a class="anchorlink" href="#beginning-of-day-end-of-day">15.1.6.1 <code>beginning_of_day</code>、<code>end_of_day</code></a></h6><p>方法 [<code>beginning_of_day</code>][Date#beginning_of_day] 返回一天開始（00:00:00）的時間戳：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.new(2010, 6, 7)
date.beginning_of_day # =&gt; Mon Jun 07 00:00:00 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.beginning_of_day # =&gt; Mon Jun 07 00:00:00 +0200 2010
">Copy</button>
</div>
<p>方法 [<code>end_of_day</code>][Date#end_of_day] 返回一天結束時的時間戳 (23:59:59)：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.new(2010, 6, 7)
date.end_of_day # =&gt; Mon Jun 07 23:59:59 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.new(2010, 6, 7)
date.end_of_day # =&gt; Mon Jun 07 23:59:59 +0200 2010
">Copy</button>
</div>
<p><code>beginning_of_day</code> 別名為 [<code>at_beginning_of_day</code>][Date#at_beginning_of_day]、[<code>midnight</code>][Date#midnight]、[<code>at_midnight</code>][Date#at_midnight]。</p><p>注意：在<code>active_support/core_ext/date/calculations.rb</code> 中定義。</p><p>[date#at_beginning_of_day]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-at_beginning_of_day">https://api.Rubyonrails.org/classes/date.html#method-i-at_beginning_of_day</a>
[date#at_midnight]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-at_midnight">https://api.Rubyonrails.org/classes/date.html#method-i-at_midnight</a>
[date#beginning_of_day]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-beginning_of_day">https://api.Rubyonrails.org/classes/date.html#method-i-beginning_of_day</a>
[date#end_of_day]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-end_of_day">https://api.Rubyonrails.org/classes/date.html#method-i-end_of_day</a>
[date#midnight]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-midnight">https://api.Rubyonrails.org/classes/date.html#method-i-midnight</a></p><h6 id="beginning-of-hour-end-of-hour"><a class="anchorlink" href="#beginning-of-hour-end-of-hour">15.1.6.2 <code>beginning_of_hour</code>、<code>end_of_hour</code></a></h6><p>方法 [<code>beginning_of_hour</code>][DateTime#beginning_of_hour] 返回小時開始時的時間戳 (hh:00:00)：</p><div class="code_container">
<pre><code class="highlight plaintext">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_hour # =&gt; Mon Jun 07 19:00:00 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_hour # =&gt; Mon Jun 07 19:00:00 +0200 2010
">Copy</button>
</div>
<p>方法 [<code>end_of_hour</code>][DateTime#end_of_hour] 返回小時結束時的時間戳 (hh:59:59)：</p><div class="code_container">
<pre><code class="highlight plaintext">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_hour # =&gt; Mon Jun 07 19:59:59 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_hour # =&gt; Mon Jun 07 19:59:59 +0200 2010
">Copy</button>
</div>
<p><code>beginning_of_hour</code> 別名為 [<code>at_beginning_of_hour</code>][DateTime#at_beginning_of_hour]。</p><p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><h6 id="beginning-of-minute-end-of-minute"><a class="anchorlink" href="#beginning-of-minute-end-of-minute">15.1.6.3 <code>beginning_of_minute</code>、<code>end_of_minute</code></a></h6><p>方法 [<code>beginning_of_minute</code>][DateTime#beginning_of_minute] 返回分鐘開始時的時間戳 (hh:mm:00)：</p><div class="code_container">
<pre><code class="highlight plaintext">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_minute # =&gt; Mon Jun 07 19:55:00 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.beginning_of_minute # =&gt; Mon Jun 07 19:55:00 +0200 2010
">Copy</button>
</div>
<p>方法 [<code>end_of_minute</code>][DateTime#end_of_minute] 返回分鐘結束時的時間戳 (hh:mm:59)：</p><div class="code_container">
<pre><code class="highlight plaintext">date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_minute # =&gt; Mon Jun 07 19:55:59 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = DateTime.new(2010, 6, 7, 19, 55, 25)
date.end_of_minute # =&gt; Mon Jun 07 19:55:59 +0200 2010
">Copy</button>
</div>
<p><code>beginning_of_minute</code> 別名為 [<code>at_beginning_of_minute</code>][DateTime#at_beginning_of_minute]。</p><p>資訊：<code>beginning_of_hour</code>、<code>end_of_hour</code>、<code>beginning_of_minute</code> 和<code>end_of_minute</code> 是為<code>Time</code> 和<code>DateTime</code> 實現的，但<strong>不是</strong> <code>Date</code>，因為請求開始或結束是沒有意義的“Date”例項上的小時或分鐘。</p><p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime#at_beginning_of_minute]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-at_beginning_of_minute">https://api.Rubyonrails.org/classes/datetime.html#method-i-at_beginning_of_minute</a>
[datetime#beginning_of_minute]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-beginning_of_minute">https://api.Rubyonrails.org/classes/datetime.html#method-i-beginning_of_minute</a>
[datetime#end_of_minute]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-end_of_minute">https://api.Rubyonrails.org/classes/datetime.html#method-i-end_of_minute</a></p><h6 id=""><a class="anchorlink" href="#">15.1.6.4 <code>以前</code>，<code>自從</code></a></h6><p>方法 [<code>ago</code>][Date#ago] 接收秒數作為引數，並從午夜返回幾秒前的時間戳：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.current # =&gt; Fri, 11 Jun 2010
date.ago(1)         # =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.current # =&gt; Fri, 11 Jun 2010
date.ago(1)         # =&gt; Thu, 10 Jun 2010 23:59:59 EDT -04:00
">Copy</button>
</div>
<p>同樣， [<code>since</code>][Date#since] 向前移動：</p><div class="code_container">
<pre><code class="highlight plaintext">date = Date.current # =&gt; Fri, 11 Jun 2010
date.since(1)       # =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00
</code></pre>
<button class="clipboard-button" data-clipboard-text="date = Date.current # =&gt; Fri, 11 Jun 2010
date.since(1)       # =&gt; Fri, 11 Jun 2010 00:00:01 EDT -04:00
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date/calculations.rb</code> 中定義。</p><p>[date#ago]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-ago">https://api.Rubyonrails.org/classes/date.html#method-i-ago</a>
[日期#since]：<a href="https://api.Rubyonrails.org/classes/date.html#method-i-since">https://api.Rubyonrails.org/classes/date.html#method-i-since</a></p><h5 id=""><a class="anchorlink" href="#">15.1.7 其他時間計算</a></h5><h4 id=""><a class="anchorlink" href="#">15.2 次轉化</a></h4><h3 id="datetime"><a class="anchorlink" href="#datetime">16 <code>DateTime</code> 的擴充套件</a></h3><p>警告：<code>DateTime</code> 不知道 DST 規則，因此當 DST 更改正在進行時，其中一些方法具有邊緣情況。例如 [<code>seconds_since_midnight</code>][DateTime#seconds_since_midnight] 可能不會返回這樣一天的實際金額。</p><h4 id="datetime"><a class="anchorlink" href="#datetime">16.1 計算</a></h4><p>類<code>DateTime</code> 是<code>Date</code> 的子類，所以透過載入<code>active_support/core_ext/date/calculations.rb</code> 你可以繼承這些方法和它們的別名，除了它們總是返回日期時間。</p><p>重新實現了以下方法，因此您<strong>不需要</strong>為這些方法載入<code>active_support/core_ext/date/calculations.rb</code>：</p>
<ul>
<li>[<code>beginning_of_day</code>][DateTime#beginning_of_day] / [<code>midnight</code>][DateTime#midnight] / [<code>at_midnight</code>][DateTime#at_midnight] / [<code>at_beginning_of_day</code>][DateTime#at_beginning_of_day]</li>
<li>[<code>end_of_day</code>][日期時間#end_of_day]</li>
<li>[<code>ago</code>][DateTime#ago]</li>
<li>[<code>since</code>][DateTime#since] / [<code>in</code>][DateTime#in]</li>
</ul>
<p>另一方面，[<code>advance</code>][DateTime#advance] 和 [<code>change</code>][DateTime#change] 也被定義並支援更多選項，它們在下面記錄。</p><p>以下方法僅在 <code>active_support/core_ext/date_time/calculations.rb</code> 中實現，因為它們僅在與 <code>DateTime</code> 例項一起使用時才有意義：</p>
<ul>
<li>[<code>beginning_of_hour</code>][DateTime#beginning_of_hour] / [<code>at_beginning_of_hour</code>][DateTime#at_beginning_of_hour]</li>
<li>[<code>end_of_hour</code>][DateTime#end_of_hour]</li>
</ul>
<p>[datetime#ago]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-ago">https://api.Rubyonrails.org/classes/datetime.html#method-i-ago</a>
[datetime#at_beginning_of_day]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-at_beginning_of_day">https://api.Rubyonrails.org/classes/datetime.html#method-i-at_beginning_of_day</a>
[datetime#at_beginning_of_hour]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-at_beginning_of_hour">https://api.Rubyonrails.org/classes/datetime.html#method-i-at_beginning_of_hour</a>
[datetime#at_midnight]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-at_midnight">https://api.Rubyonrails.org/classes/datetime.html#method-i-at_midnight</a>
[datetime#beginning_of_day]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-beginning_of_day">https://api.Rubyonrails.org/classes/datetime.html#method-i-beginning_of_day</a>
[datetime#beginning_of_hour]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-beginning_of_hour">https://api.Rubyonrails.org/classes/datetime.html#method-i-beginning_of_hour</a>
[datetime#end_of_day]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-end_of_day">https://api.Rubyonrails.org/classes/datetime.html#method-i-end_of_day</a>
[datetime#end_of_hour]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-end_of_hour">https://api.Rubyonrails.org/classes/datetime.html#method-i-end_of_hour</a>
[datetime#in]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-in">https://api.Rubyonrails.org/classes/datetime.html#method-i-in</a>
[datetime#midnight]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-midnight">https://api.Rubyonrails.org/classes/datetime.html#method-i-midnight</a></p><h5 id=""><a class="anchorlink" href="#">16.1.1 命名日期時間</a></h5><h6 id="datetime-current"><a class="anchorlink" href="#datetime-current">16.1.1.1 <code>datetime.current</code></a></h6><p>Active Support 將 [<code>datetime.current</code>][datetime.current] 定義為類似於 <code>time.now.to_datetime</code>，除了它遵循使用者時區（如果已定義）。例項謂詞 [<code>past?</code>][dateandtime::calculations#past?] 和 [<code>future?</code>][dateandtime::calculations#future?] 是相對於 <code>datetime.current</code> 定義的。</p><p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime.current]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-c-current">https://api.Rubyonrails.org/classes/datetime.html#method-c-current</a></p><h5 id=""><a class="anchorlink" href="#">16.1.2 其他擴充套件</a></h5><h6 id="seconds-since-midnight"><a class="anchorlink" href="#seconds-since-midnight">16.1.2.1 <code>seconds_since_midnight</code></a></h6><p>方法 [<code>seconds_since_midnight</code>][DateTime#seconds_since_midnight] 返回自午夜以來的秒數：</p><div class="code_container">
<pre><code class="highlight plaintext">now = DateTime.current     # =&gt; Mon, 07 Jun 2010 20:26:36 +0000
now.seconds_since_midnight # =&gt; 73596
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current     # =&gt; Mon, 07 Jun 2010 20:26:36 +0000
now.seconds_since_midnight # =&gt; 73596
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime#seconds_since_midnight]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-seconds_since_midnight">https://api.Rubyonrails.org/classes/datetime.html#method-i-seconds_since_midnight</a></p><h6 id="utc"><a class="anchorlink" href="#utc">16.1.2.2 <code>utc</code></a></h6><p>方法 [<code>utc</code>][DateTime#utc] 為您提供以 UTC 表示的接收器中的相同日期時間。</p><div class="code_container">
<pre><code class="highlight plaintext">now = DateTime.current # =&gt; Mon, 07 Jun 2010 19:27:52 -0400
now.utc                # =&gt; Mon, 07 Jun 2010 23:27:52 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current # =&gt; Mon, 07 Jun 2010 19:27:52 -0400
now.utc                # =&gt; Mon, 07 Jun 2010 23:27:52 +0000
">Copy</button>
</div>
<p>此方法也別名為 [<code>getutc</code>][DateTime#getutc]。</p><p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime#getutc]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-getutc">https://api.Rubyonrails.org/classes/datetime.html#method-i-getutc</a>
[datetime#utc]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-utc">https://api.Rubyonrails.org/classes/datetime.html#method-i-utc</a></p><h6 id="utc"><a class="anchorlink" href="#utc">16.1.2.3 <code>utc？</code></a></h6><p>謂詞 [<code>utc?</code>][DateTime#utc?] 表示接收方是否將 UTC 作為其時區：</p><div class="code_container">
<pre><code class="highlight plaintext">now = DateTime.now # =&gt; Mon, 07 Jun 2010 19:30:47 -0400
now.utc?           # =&gt; false
now.utc.utc?       # =&gt; true
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.now # =&gt; Mon, 07 Jun 2010 19:30:47 -0400
now.utc?           # =&gt; false
now.utc.utc?       # =&gt; true
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime#utc?]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-utc-3f">https://api.Rubyonrails.org/classes/datetime.html#method-i-utc-3f</a></p><h6 id=""><a class="anchorlink" href="#">16.1.2.4 <code>提前</code></a></h6><p>跳轉到另一個日期時間的最通用方法是 [<code>advance</code>][DateTime#advance]。這個方法接收一個帶有鍵<code>:years</code>、<code>:months</code>、<code>:weeks</code>、<code>:days</code>、<code>:hours</code>、<code>:minutes</code>和<code>:seconds</code>的雜湊值，並返回一個提前的日期時間正如當前鍵所指示的那樣。</p><div class="code_container">
<pre><code class="highlight plaintext">d = DateTime.current
# =&gt; Thu, 05 Aug 2010 11:33:31 +0000
d.advance(years: 1, months: 1, days: 1, hours: 1, minutes: 1, seconds: 1)
# =&gt; Tue, 06 Sep 2011 12:34:32 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = DateTime.current
# =&gt; Thu, 05 Aug 2010 11:33:31 +0000
d.advance(years: 1, months: 1, days: 1, hours: 1, minutes: 1, seconds: 1)
# =&gt; Tue, 06 Sep 2011 12:34:32 +0000
">Copy</button>
</div>
<p>此方法首先計算目標日期，將 <code>:years</code>、<code>:months</code>、<code>:weeks</code> 和 <code>:days</code> 傳遞到上面記錄的 <code>Date#advance</code>。之後，它將呼叫 [<code>since</code>][DateTime#since] 的時間調整為提前的秒數。這個順序是相關的，在某些邊緣情況下，不同的順序會給出不同的日期時間。 <code>Date#advance</code> 中的示例適用，我們可以擴充套件它以顯示與時間位相關的順序相關性。</p><p>如果我們首先移動日期位（也有相對的處理順序，如前所述），然後我們得到例如以下計算的時間位：</p><div class="code_container">
<pre><code class="highlight plaintext">d = DateTime.new(2010, 2, 28, 23, 59, 59)
# =&gt; Sun, 28 Feb 2010 23:59:59 +0000
d.advance(months: 1, seconds: 1)
# =&gt; Mon, 29 Mar 2010 00:00:00 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="d = DateTime.new(2010, 2, 28, 23, 59, 59)
# =&gt; Sun, 28 Feb 2010 23:59:59 +0000
d.advance(months: 1, seconds: 1)
# =&gt; Mon, 29 Mar 2010 00:00:00 +0000
">Copy</button>
</div>
<p>但是如果我們反過來計算它們，結果就會不同：</p><div class="code_container">
<pre><code class="highlight plaintext">d.advance(seconds: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010 00:00:00 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="d.advance(seconds: 1).advance(months: 1)
# =&gt; Thu, 01 Apr 2010 00:00:00 +0000
">Copy</button>
</div>
<p>警告：由於<code>DateTime</code> 不支援夏令時，你可能會在一個不存在的時間點結束，而沒有警告或錯誤告訴你。</p><p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime#advance]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-advance">https://api.Rubyonrails.org/classes/datetime.html#method-i-advance</a>
[datetime#since]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-since">https://api.Rubyonrails.org/classes/datetime.html#method-i-since</a></p><h5 id="datetime"><a class="anchorlink" href="#datetime">16.1.3 改變元件</a></h5><p>方法 [<code>change</code>][DateTime#change] 允許您獲取與接收者相同的新日期時間，除了給定的選項，可能包括 <code>:year</code>、<code>:month</code>、<code>:day</code>、 <code>:hour</code>、<code>:min</code>、<code>:sec</code>、<code>:offset</code>、<code>:start</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">now = DateTime.current
# =&gt; Tue, 08 Jun 2010 01:56:22 +0000
now.change(year: 2011, offset: Rational(-6, 24))
# =&gt; Wed, 08 Jun 2011 01:56:22 -0600
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current
# =&gt; Tue, 08 Jun 2010 01:56:22 +0000
now.change(year: 2011, offset: Rational(-6, 24))
# =&gt; Wed, 08 Jun 2011 01:56:22 -0600
">Copy</button>
</div>
<p>如果小時歸零，那麼分鐘和秒也歸零（除非它們給出了值）：</p><div class="code_container">
<pre><code class="highlight plaintext">now.change(hour: 0)
# =&gt; Tue, 08 Jun 2010 00:00:00 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="now.change(hour: 0)
# =&gt; Tue, 08 Jun 2010 00:00:00 +0000
">Copy</button>
</div>
<p>類似地，如果分鐘歸零，那麼秒也歸零（除非它給出了一個值）：</p><div class="code_container">
<pre><code class="highlight plaintext">now.change(min: 0)
# =&gt; Tue, 08 Jun 2010 01:00:00 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="now.change(min: 0)
# =&gt; Tue, 08 Jun 2010 01:00:00 +0000
">Copy</button>
</div>
<p>此方法不容忍不存在的日期，如果更改無效，則會引發 <code>ArgumentError</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">DateTime.current.change(month: 2, day: 30)
# =&gt; ArgumentError: invalid date
</code></pre>
<button class="clipboard-button" data-clipboard-text="DateTime.current.change(month: 2, day: 30)
# =&gt; ArgumentError: invalid date
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date_time/calculations.rb</code> 中定義。</p><p>[datetime#change]：<a href="https://api.Rubyonrails.org/classes/datetime.html#method-i-change">https://api.Rubyonrails.org/classes/datetime.html#method-i-change</a></p><h5 id="datetime"><a class="anchorlink" href="#datetime">16.1.4 持續時間</a></h5><p>[<code>Duration</code>][ActiveSupport::Duration] 物件可以新增到日期時間和從中減去：</p><div class="code_container">
<pre><code class="highlight plaintext">now = DateTime.current
# =&gt; Mon, 09 Aug 2010 23:15:17 +0000
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:15:17 +0000
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:15:17 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = DateTime.current
# =&gt; Mon, 09 Aug 2010 23:15:17 +0000
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:15:17 +0000
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:15:17 +0000
">Copy</button>
</div>
<p>它們轉化為對“since”或“advance”的呼叫。例如在這裡我們得到了日曆改革的正確跳轉：</p><div class="code_container">
<pre><code class="highlight plaintext">DateTime.new(1582, 10, 4, 23) + 1.hour
# =&gt; Fri, 15 Oct 1582 00:00:00 +0000
</code></pre>
<button class="clipboard-button" data-clipboard-text="DateTime.new(1582, 10, 4, 23) + 1.hour
# =&gt; Fri, 15 Oct 1582 00:00:00 +0000
">Copy</button>
</div>
<h3 id=""><a class="anchorlink" href="#">17 “時間”的擴充套件</a></h3><h4 id=""><a class="anchorlink" href="#">17.1 計算</a></h4><p>它們是類似的。請參閱上面的文件並考慮以下差異：</p>
<ul>
<li>[<code>change</code>][Time#change] 接受一個額外的 <code>:usec</code> 選項。</li>
<li>
<code>Time</code> 理解 DST，因此您可以得到正確的 DST 計算，如</li>
</ul>
<div class="code_container">
<pre><code class="highlight plaintext">Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;

# In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.
t = Time.local(2010, 3, 28, 1, 59, 59)
# =&gt; Sun Mar 28 01:59:59 +0100 2010
t.advance(seconds: 1)
# =&gt; Sun Mar 28 03:00:00 +0200 2010
</code></pre>
<button class="clipboard-button" data-clipboard-text='Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;

# In Barcelona, 2010/03/28 02:00 +0100 becomes 2010/03/28 03:00 +0200 due to DST.
t = Time.local(2010, 3, 28, 1, 59, 59)
# =&gt; Sun Mar 28 01:59:59 +0100 2010
t.advance(seconds: 1)
# =&gt; Sun Mar 28 03:00:00 +0200 2010
'>Copy</button>
</div>

<ul>
<li>如果 [<code>since</code>][Time#since] 或 [<code>ago</code>][Time#ago] 跳轉到不能用 <code>Time</code> 表示的時間，則返回 <code>DateTime</code> 物件。</li>
</ul>
<p>[time#ago]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-ago">https://api.Rubyonrails.org/classes/time.html#method-i-ago</a>
[time#change]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-change">https://api.Rubyonrails.org/classes/time.html#method-i-change</a>
[time#since]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-since">https://api.Rubyonrails.org/classes/time.html#method-i-since</a></p><h5 id="time-current"><a class="anchorlink" href="#time-current">17.1.1 <code>time.current</code></a></h5><p>Active Support 將 [<code>time.current</code>][time.current] 定義為當前時區中的今天。這就像<code>time.now</code>，除了它尊重使用者時區（如果定義）。它還定義了例項謂詞 [<code>past?</code>][dateandtime::calculations#past?], [<code>today?</code>][dateandtime::calculations#today?], [<code>tomorrow?</code>][dateandtime::calculations#明天？]、[<code>next_day?</code>][dateandtime::calculations#next_day?]、[<code>yesterday?</code>][dateandtime::calculations#yesterday?]、[<code>prev_day?</code>][dateandtime::calculations#prev_day? ] 和 [<code>future?</code>][dateandtime::calculations#future?]，所有這些都相對於 <code>time.current</code>。</p><p>使用尊重使用者時區的方法進行時間比較時，請確保使用“Time.current”而不是“Time.now”。在某些情況下，與“Time.now”預設使用的系統時區相比，使用者時區可能在未來。這意味著<code>Time.now.to_date</code> 可能等於<code>Date.yesterday</code>。</p><p>注意：在<code>active_support/core_ext/time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#next_day?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-next_day-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-next_day-3f</a>
[dateandtime::calculations#prev_day?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-prev_day-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-prev_day-3f</a>
[dateandtime::calculations#today?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-today-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-today-3f</a>
[dateandtime::calculations#tomorrow?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-tomorrow-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-tomorrow-3f</a>
[dateandtime::calculations#yesterday?]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-yesterday-3f">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-yesterday-3f</a></p><h5 id="all-day-all-week-all-month-all-quarter-all-year"><a class="anchorlink" href="#all-day-all-week-all-month-all-quarter-all-year">17.1.2 <code>all_day</code>、<code>all_week</code>、<code>all_month</code>、<code>all_quarter</code> 和 <code>all_year</code></a></h5><p>方法 [<code>all_day</code>][DateAndTime::Calculations#all_day] 返回一個表示當前時間一整天的範圍。</p><div class="code_container">
<pre><code class="highlight plaintext">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_day
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_day
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Mon, 09 Aug 2010 23:59:59 UTC +00:00
">Copy</button>
</div>
<p>類似地，[<code>all_week</code>][DateAndTime::Calculations#all_week]、[<code>all_month</code>][DateAndTime::Calculations#all_month]、[<code>all_quarter</code>][DateAndTime::Calculations#all_quarter] 和 [<code>all_year</code>][ DateAndTime::Calculations#all_year] 都用於生成時間範圍。</p><div class="code_container">
<pre><code class="highlight plaintext">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_week
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00
now.all_week(:sunday)
# =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00
now.all_month
# =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00
now.all_quarter
# =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00
now.all_year
# =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now.all_week
# =&gt; Mon, 09 Aug 2010 00:00:00 UTC +00:00..Sun, 15 Aug 2010 23:59:59 UTC +00:00
now.all_week(:sunday)
# =&gt; Sun, 16 Sep 2012 00:00:00 UTC +00:00..Sat, 22 Sep 2012 23:59:59 UTC +00:00
now.all_month
# =&gt; Sat, 01 Aug 2010 00:00:00 UTC +00:00..Tue, 31 Aug 2010 23:59:59 UTC +00:00
now.all_quarter
# =&gt; Thu, 01 Jul 2010 00:00:00 UTC +00:00..Thu, 30 Sep 2010 23:59:59 UTC +00:00
now.all_year
# =&gt; Fri, 01 Jan 2010 00:00:00 UTC +00:00..Fri, 31 Dec 2010 23:59:59 UTC +00:00
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#all_day]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_day">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_day</a>
[dateandtime::calculations#all_month]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_month">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_month</a>
[dateandtime::calculations#all_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_quarter</a>
[dateandtime::calculations#all_week]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_week">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_week</a>
[dateandtime::calculations#all_year]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_year">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-all_year</a>
[time.current]：<a href="https://api.Rubyonrails.org/classes/time.html#method-c-current">https://api.Rubyonrails.org/classes/time.html#method-c-current</a></p><h5 id="prev-day-next-day"><a class="anchorlink" href="#prev-day-next-day">17.1.3 <code>prev_day</code>、<code>next_day</code></a></h5><p>[<code>prev_day</code>][Time#prev_day] 和 [<code>next_day</code>][Time#next_day] 返回最後一天或第二天的時間：</p><div class="code_container">
<pre><code class="highlight plaintext">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_day               # =&gt; 2010-05-07 00:00:00 +0900
t.next_day               # =&gt; 2010-05-09 00:00:00 +0900
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_day               # =&gt; 2010-05-07 00:00:00 +0900
t.next_day               # =&gt; 2010-05-09 00:00:00 +0900
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/time/calculations.rb</code> 中定義。</p><p>[time#next_day]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-next_day">https://api.Rubyonrails.org/classes/time.html#method-i-next_day</a>
[time#prev_day]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-prev_day">https://api.Rubyonrails.org/classes/time.html#method-i-prev_day</a></p><h5 id="prev-month-next-month"><a class="anchorlink" href="#prev-month-next-month">17.1.4 <code>prev_month</code>、<code>next_month</code></a></h5><p>[<code>prev_month</code>][Time#prev_month] 和 [<code>next_month</code>][Time#next_month] 返回上個月或下個月的同一天的時間：</p><div class="code_container">
<pre><code class="highlight plaintext">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_month             # =&gt; 2010-04-08 00:00:00 +0900
t.next_month             # =&gt; 2010-06-08 00:00:00 +0900
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_month             # =&gt; 2010-04-08 00:00:00 +0900
t.next_month             # =&gt; 2010-06-08 00:00:00 +0900
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight plaintext">Time.new(2000, 5, 31).prev_month # =&gt; 2000-04-30 00:00:00 +0900
Time.new(2000, 3, 31).prev_month # =&gt; 2000-02-29 00:00:00 +0900
Time.new(2000, 5, 31).next_month # =&gt; 2000-06-30 00:00:00 +0900
Time.new(2000, 1, 31).next_month # =&gt; 2000-02-29 00:00:00 +0900
</code></pre>
<button class="clipboard-button" data-clipboard-text="Time.new(2000, 5, 31).prev_month # =&gt; 2000-04-30 00:00:00 +0900
Time.new(2000, 3, 31).prev_month # =&gt; 2000-02-29 00:00:00 +0900
Time.new(2000, 5, 31).next_month # =&gt; 2000-06-30 00:00:00 +0900
Time.new(2000, 1, 31).next_month # =&gt; 2000-02-29 00:00:00 +0900
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/time/calculations.rb</code> 中定義。</p><p>[time#next_month]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-next_month">https://api.Rubyonrails.org/classes/time.html#method-i-next_month</a>
[time#prev_month]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-prev_month">https://api.Rubyonrails.org/classes/time.html#method-i-prev_month</a></p><h5 id="prev-year-next-year"><a class="anchorlink" href="#prev-year-next-year">17.1.5 <code>prev_year</code>、<code>next_year</code></a></h5><p>[<code>prev_year</code>][Time#prev_year] 和 [<code>next_year</code>][Time#next_year] 返回上一年或下一年同一天/一個月的時間：</p><div class="code_container">
<pre><code class="highlight plaintext">t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_year              # =&gt; 2009-05-08 00:00:00 +0900
t.next_year              # =&gt; 2011-05-08 00:00:00 +0900
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0900
t.prev_year              # =&gt; 2009-05-08 00:00:00 +0900
t.next_year              # =&gt; 2011-05-08 00:00:00 +0900
">Copy</button>
</div>
<p>如果日期是閏年的 2 月 29 日，您將獲得 28 日：</p><div class="code_container">
<pre><code class="highlight plaintext">t = Time.new(2000, 2, 29) # =&gt; 2000-02-29 00:00:00 +0900
t.prev_year               # =&gt; 1999-02-28 00:00:00 +0900
t.next_year               # =&gt; 2001-02-28 00:00:00 +0900
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.new(2000, 2, 29) # =&gt; 2000-02-29 00:00:00 +0900
t.prev_year               # =&gt; 1999-02-28 00:00:00 +0900
t.next_year               # =&gt; 2001-02-28 00:00:00 +0900
">Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/time/calculations.rb</code> 中定義。</p><p>[time#next_year]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-next_year">https://api.Rubyonrails.org/classes/time.html#method-i-next_year</a>
[time#prev_year]：<a href="https://api.Rubyonrails.org/classes/time.html#method-i-prev_year">https://api.Rubyonrails.org/classes/time.html#method-i-prev_year</a></p><h5 id="prev-quarter-next-quarter"><a class="anchorlink" href="#prev-quarter-next-quarter">17.1.6 <code>prev_quarter</code>、<code>next_quarter</code></a></h5><p>[<code>prev_quarter</code>][DateAndTime::Calculations#prev_quarter] 和 [<code>next_quarter</code>][DateAndTime::Calculations#next_quarter] 返回上一季度或下一季度的同一天的日期：</p><div class="code_container">
<pre><code class="highlight plaintext">t = Time.local(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0300
t.prev_quarter             # =&gt; 2010-02-08 00:00:00 +0200
t.next_quarter             # =&gt; 2010-08-08 00:00:00 +0300
</code></pre>
<button class="clipboard-button" data-clipboard-text="t = Time.local(2010, 5, 8) # =&gt; 2010-05-08 00:00:00 +0300
t.prev_quarter             # =&gt; 2010-02-08 00:00:00 +0200
t.next_quarter             # =&gt; 2010-08-08 00:00:00 +0300
">Copy</button>
</div>
<p>如果這樣的一天不存在，則返回相應月份的最後一天：</p><div class="code_container">
<pre><code class="highlight plaintext">Time.local(2000, 7, 31).prev_quarter  # =&gt; 2000-04-30 00:00:00 +0300
Time.local(2000, 5, 31).prev_quarter  # =&gt; 2000-02-29 00:00:00 +0200
Time.local(2000, 10, 31).prev_quarter # =&gt; 2000-07-31 00:00:00 +0300
Time.local(2000, 11, 31).next_quarter # =&gt; 2001-03-01 00:00:00 +0200
</code></pre>
<button class="clipboard-button" data-clipboard-text="Time.local(2000, 7, 31).prev_quarter  # =&gt; 2000-04-30 00:00:00 +0300
Time.local(2000, 5, 31).prev_quarter  # =&gt; 2000-02-29 00:00:00 +0200
Time.local(2000, 10, 31).prev_quarter # =&gt; 2000-07-31 00:00:00 +0300
Time.local(2000, 11, 31).next_quarter # =&gt; 2001-03-01 00:00:00 +0200
">Copy</button>
</div>
<p><code>prev_quarter</code> 別名為 [<code>last_quarter</code>][DateAndTime::Calculations#last_quarter]。</p><p>注意：在<code>active_support/core_ext/date_and_time/calculations.rb</code> 中定義。</p><p>[dateandtime::calculations#last_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-last_quarter</a>
[dateandtime::calculations#next_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-next_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-next_quarter</a>
[dateandtime::calculations#prev_quarter]：<a href="https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-prev_quarter">https://api.Rubyonrails.org/classes/dateandtime/calculations.html#method-i-prev_quarter</a></p><h4 id=""><a class="anchorlink" href="#">17.2 時間建構函式</a></h4><p>如果定義了使用者時區，Active Support 將 [<code>time.current</code>][time.current] 定義為 <code>time.zone.now</code>，並回退到 <code>time.now</code>：</p><div class="code_container">
<pre><code class="highlight plaintext">Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;
Time.current
# =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00
</code></pre>
<button class="clipboard-button" data-clipboard-text='Time.zone_default
# =&gt; #&lt;ActiveSupport::TimeZone:0x7f73654d4f38 @utc_offset=nil, @name="Madrid", ...&gt;
Time.current
# =&gt; Fri, 06 Aug 2010 17:11:58 CEST +02:00
'>Copy</button>
</div>
<p>與 <code>DateTime</code> 類似，謂詞 [<code>past?</code>][DateAndTime::Calculations#past?] 和 [<code>future?</code>][DateAndTime::Calculations#future?] 與 <code>Time.current</code> 相關。</p><p>如果要構造的時間超出執行時平臺中<code>Time</code>支援的範圍，則丟棄usecs並返回<code>DateTime</code>物件。</p><h5 id=""><a class="anchorlink" href="#">17.2.1 持續時間</a></h5><p>[<code>Duration</code>][ActiveSupport::Duration] 物件可以新增到時間物件或從時間物件中減去：</p><div class="code_container">
<pre><code class="highlight plaintext">now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00
</code></pre>
<button class="clipboard-button" data-clipboard-text="now = Time.current
# =&gt; Mon, 09 Aug 2010 23:20:05 UTC +00:00
now + 1.year
# =&gt; Tue, 09 Aug 2011 23:21:11 UTC +00:00
now - 1.week
# =&gt; Mon, 02 Aug 2010 23:21:11 UTC +00:00
">Copy</button>
</div>
<p>它們轉化為對“since”或“advance”的呼叫。例如在這裡我們得到了日曆改革的正確跳轉：</p><div class="code_container">
<pre><code class="highlight plaintext">Time.utc(1582, 10, 3) + 5.days
# =&gt; Mon Oct 18 00:00:00 UTC 1582
</code></pre>
<button class="clipboard-button" data-clipboard-text="Time.utc(1582, 10, 3) + 5.days
# =&gt; Mon Oct 18 00:00:00 UTC 1582
">Copy</button>
</div>
<h3 id=""><a class="anchorlink" href="#">18 <code>檔案</code>的擴充套件</a></h3><h4 id="atomic-write"><a class="anchorlink" href="#atomic-write">18.1 <code>atomic_write</code></a></h4><p>使用類方法 [<code>File.atomic_write</code>][File.atomic_write]，您可以以防止任何讀者看到半寫內容的方式寫入檔案。</p><p>檔名作為引數傳遞，該方法產生一個為寫入而開啟的檔案控制代碼。一旦塊完成，<code>atomic_write</code> 關閉檔案控制代碼並完成其工作。</p><p>例如，Action pack 使用這種方法來編寫像 <code>all.css</code> 這樣的資產快取檔案：</p><div class="code_container">
<pre><code class="highlight plaintext">File.atomic_write(joined_asset_path) do |cache|
  cache.write(join_asset_file_contents(asset_paths))
end
</code></pre>
<button class="clipboard-button" data-clipboard-text="File.atomic_write(joined_asset_path) do |cache|
  cache.write(join_asset_file_contents(asset_paths))
end
">Copy</button>
</div>
<p>為了完成這個 <code>atomic_write</code> 建立一個臨時檔案。這是塊中的程式碼實際寫入的檔案。完成後，臨時檔案被重新命名，這是 POSIX 系統上的原子操作。如果目標檔案存在，<code>atomic_write</code> 將覆蓋它並保留所有者和許可權。然而，在少數情況下，<code>atomic_write</code> 無法更改檔案所有權或許可權，該錯誤會被捕獲並跳過信任使用者/檔案系統以確保需要它的程序可以訪問該檔案。</p><p>筆記。由於 chmod 操作 <code>atomic_write</code> 執行，如果目標檔案上設定了一個 ACL，這個 ACL 將被重新計算/修改。</p><p>警告。請注意，您不能附加 <code>atomic_write</code>。</p><p>輔助檔案寫入臨時檔案的標準目錄中，但您可以傳遞您選擇的目錄作為第二個引數。</p><p>注意：在<code>active_support/core_ext/file/atomic.rb</code> 中定義。</p><p>[file.atomic_write]：<a href="https://api.Rubyonrails.org/classes/file.html#method-c-atomic_write">https://api.Rubyonrails.org/classes/file.html#method-c-atomic_write</a></p><h3 id="nameerror"><a class="anchorlink" href="#nameerror">19 <code>NameError</code> 的擴充套件</a></h3><p>Active Support 將 [<code>missing_name?</code>][nameerror#missing_name?] 新增到 <code>nameerror</code>，它測試是否由於作為引數傳遞的名稱而引發異常。</p><p>名稱可以作為Symbol 或字串給出。 Symbol 針對裸常量名稱進行測試，字串針對完全限定的常量名稱進行測試。</p><p>提示：Symbol 可以表示一個完全限定的常量名，如<code>:"activerecord::base"</code>，所以定義Symbols 的行為是為了方便，而不是因為技術上必須如此。</p><p>例如，當<code>articlesController</code> 的action 被呼叫時，rails 會樂觀地嘗試使用<code>articleshelper</code>。 helper 模組不存在是可以的，因此如果引發該常量名稱的異常，則應將其靜音。但也有可能是 <code>articles_helper.rb</code> 由於實際未知常量而引發 <code>nameerror</code>。應該重新加註。 <code>missing_name?</code> 方法提供了一種區分兩種情況的方法：</p><div class="code_container">
<pre><code class="highlight plaintext">def default_Helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  Helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "Helpers/#{module_path}_Helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='def default_Helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  Helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "Helpers/#{module_path}_Helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/name_error.rb</code> 中定義。</p><p>[nameerror#missing_name?]：<a href="https://api.Rubyonrails.org/classes/nameerror.html#method-i-missing_name-3f">https://api.Rubyonrails.org/classes/nameerror.html#method-i-missing_name-3f</a></p><h3 id="loaderror"><a class="anchorlink" href="#loaderror">20 <code>LoadError</code> 的擴充套件</a></h3><p>Active Support 將 [<code>is_missing?</code>][loaderror#is_missing?] 新增到 <code>loaderror</code>。</p><p>給定一個路徑名 <code>is_missing?</code> 測試異常是否是由於該特定檔案引起的（除了“.rb”副檔名）。</p><p>例如，當<code>articlesController</code> 的action 被呼叫時，rails 會嘗試載入<code>articles_helper.rb</code>，但該檔案可能不存在。沒關係，helper 模組不是強制性的，因此 rails 會消除載入錯誤。但也有可能是 helper 模組確實存在，進而需要另一個缺失的庫。在這種情況下，rails 必須重新引發異常。 <code>is_missing?</code> 方法提供了一種區分兩種情況的方法：</p><div class="code_container">
<pre><code class="highlight plaintext">def default_Helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  Helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "Helpers/#{module_path}_Helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
</code></pre>
<button class="clipboard-button" data-clipboard-text='def default_Helper_module!
  module_name = name.delete_suffix("Controller")
  module_path = module_name.underscore
  Helper module_path
rescue LoadError =&gt; e
  raise e unless e.is_missing? "Helpers/#{module_path}_Helper"
rescue NameError =&gt; e
  raise e unless e.missing_name? "#{module_name}Helper"
end
'>Copy</button>
</div>
<p>注意：在<code>active_support/core_ext/load_error.rb</code> 中定義。</p><p>[loaderror#is_missing?]：<a href="https://api.Rubyonrails.org/classes/loaderror.html#method-i-is_missing-3f">https://api.Rubyonrails.org/classes/loaderror.html#method-i-is_missing-3f</a></p>

        <h3>反饋</h3>
        <p>
          我們鼓勵您幫助提高本指南的質量。
        </p>
        <p>
          如果您發現任何拼寫錯誤或事實錯誤，請貢獻。
          首先，您可以閱讀我們的 <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">文檔貢獻</a> 部分。
        </p>
        <p>
          您還可能會發現不完整的內容或不是最新的內容。
          請務必為 main 添加任何缺失的文檔。確保檢查
          <a href="https://edgeguides.rubyonrails.org">Edge Guides</a> 先驗證
          如果問題已經在主分支上解決。
          檢查 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南指南</a>
          風格和慣例。
        </p>
        <p>
          如果由於某種原因您發現需要修復但無法自行修補的內容，請
          <a href="https://github.com/rails/rails/issues">open an issue</a>。
        </p>
        <p>最後但並非最不重要的是，關於 Ruby on Rails 的任何討論
          <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">rubyonrails-docs 郵件列表</a> 上的文檔非常受歡迎。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本作品已獲得<a href="https://creativecommons.org/licenses/by-sa/4.0/">知識共享署名-相同方式共享 4.0 國際</a>許可</p>
<p>“Rails”、“Ruby on Rails”和 Rails 標誌是 David Heinemeier Hansson 的商標。 保留所有權利。</p>
    </div>
  </div>
</body>
</html>
